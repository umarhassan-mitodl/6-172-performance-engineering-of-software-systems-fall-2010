---
about_this_resource_text: <p><strong>Description:</strong> Guest lecture by Ravi Soundararajan
  of VMware, covering ten case studies in performance engineering.</p>
content_type: resource
course_id: 6-172-performance-engineering-of-software-systems-fall-2010
embedded_media:
- id: Video-InternetArchive-MP4
  media_location: http://www.archive.org/download/MIT6.172F10/MIT6_172_F10_lec22_300k.mp4
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Video-Internet Archive-MP4
  type: Video
  uid: 54f4f8b272be0c03dbde010a5faf4339
- id: Video-iTunesU-MP4
  media_location: http://itunes.apple.com/us/itunes-u/lecture-22-a-tale-10-bugs/id481759887?i=109649255
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Video-iTunes U-MP4
  type: Video
  uid: a972ebd4497e32017cdc39c6a74a8fa0
- id: Video-YouTube-Stream
  media_location: Ahnns47FKHM
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Video-YouTube-Stream
  type: Video
  uid: 1053e6b06cc412898b3f69d9ad27e3c4
- id: Thumbnail-YouTube-JPG
  media_location: https://img.youtube.com/vi/Ahnns47FKHM/default.jpg
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Thumbnail-YouTube-JPG
  type: Thumbnail
  uid: f31186a8de91c8ff2a80edb6aeb970f2
- id: MIT6_172F10_lec22.pdf
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-22-a-tale-of-10-bugs-performance-engineering-at-vmware/MIT6_172F10_lec22.pdf
  title: MIT6_172F10_lec22.pdf
  type: null
  uid: f67fbe906c55dcf715614769af758ba8
- id: 3Play-3PlayYouTubeid-MP4
  media_location: Ahnns47FKHM
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: 3Play-3Play YouTube id
  type: 3Play
  uid: 351987d320607923b2a387876f35e059
- id: Ahnns47FKHM.srt
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-22-a-tale-of-10-bugs-performance-engineering-at-vmware/Ahnns47FKHM.srt
  title: 3play caption file
  type: null
  uid: f5fb3fc7dcaf46d61ad26622550e7b81
- id: Ahnns47FKHM.pdf
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-22-a-tale-of-10-bugs-performance-engineering-at-vmware/Ahnns47FKHM.pdf
  title: 3play pdf file
  type: null
  uid: 5a6385d1eb2031855729da884c1f81f8
- id: Caption-3Play YouTube id-SRT
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Caption-3Play YouTube id-SRT-English - US
  type: Caption
  uid: 966c827cede303e510661ac7208a8507
- id: Transcript-3Play YouTube id-PDF
  parent_uid: 6c5baf590c2f3b1e77d7ae779baf7afc
  title: Transcript-3Play YouTube id-PDF-English - US
  type: Transcript
  uid: c48d7a041f40057d3b93b9458e276f5a
file: null
file_size: null
hide_download: true
hide_download_original: null
inline_embed_id: 96899705lecture22:ataleof10bugs:performanceengineeringatvmware17805332
layout: video
license: https://creativecommons.org/licenses/by-nc-sa/4.0/
order_index: 247
parent_uid: 24169d0487e846a39c316276f85b8cb5
related_resources_text: ''
short_url: lecture-22-a-tale-of-10-bugs-performance-engineering-at-vmware
technical_location: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-22-a-tale-of-10-bugs-performance-engineering-at-vmware
title: 'Lecture 22: A Tale of 10 Bugs: Performance Engineering at VMware'
transcript: '<p><span m=''120''>The</span> <span m=''190''>following</span> <span
  m=''630''>content</span> <span m=''1230''>is</span> <span m=''1340''>provided</span>
  <span m=''1790''>under</span> <span m=''2070''>a</span> <span m=''2090''>Creative</span>
  <span m=''2500''>Commons</span> <span m=''2910''>license.</span> <span m=''3910''>Your</span>
  <span m=''4200''>support</span> <span m=''4700''>will</span> <span m=''4870''>help</span>
  <span m=''5100''>MIT</span> <span m=''5580''>OpenCourseWare</span> <span m=''6360''>continue</span>
  <span m=''6870''>to</span> <span m=''6950''>offer</span> <span m=''7380''>high</span>
  <span m=''7590''>quality</span> <span m=''8119''>educational</span> <span m=''8740''>resources</span>
  <span m=''9390''>for</span> <span m=''9520''>free.</span> <span m=''10600''>To</span>
  <span m=''10730''>make</span> <span m=''10930''>a</span> <span m=''10980''>donation</span>
  <span m=''11620''>or</span> <span m=''11930''>view</span> <span m=''12340''>additional</span>
  <span m=''12800''>materials</span> <span m=''13340''>from</span> <span m=''13500''>hundreds</span>
  <span m=''13930''>of</span> <span m=''14040''>MIT</span> <span m=''14460''>courses,</span>
  <span m=''15460''>visit</span> <span m=''15790''>MIT</span> <span m=''16219''>OpenCourseWare</span>
  <span m=''17250''>at</span> <span m=''17430''>ocw.mit.edu.</span> </p><p><span m=''30460''>PROFESSOR:
  And</span> <span m=''31010''>so</span> <span m=''31610''>today</span> <span m=''31810''>we</span>
  <span m=''32119''>have</span> <span m=''32430''>Ravi ,</span> <span m=''33380''>who</span>
  <span m=''33800''>is</span> <span m=''35900''>I</span> <span m=''36010''>guess</span>
  <span m=''36240''>a</span> <span m=''36980''>performance</span> <span m=''37700''>engineer</span>
  <span m=''38310''>at</span> <span m=''38920''>VMware,</span> <span m=''39370''>where</span>
  <span m=''39840''>he</span> <span m=''39980''>basically</span> <span m=''40480''>looks</span>
  <span m=''40760''>at</span> <span m=''40960''>how</span> <span m=''41190''>to</span>
  <span m=''41320''>get</span> <span m=''42280''>really</span> <span m=''42500''>good</span>
  <span m=''42700''>performance</span> <span m=''43280''>in</span> <span m=''43420''>many,</span>
  <span m=''43620''>many</span> <span m=''44940''>different</span> <span m=''45420''>things</span>
  <span m=''45590''>in</span> <span m=''45680''>VMware.</span> <span m=''46920''>So</span>
  <span m=''47100''>Ravi </span> <span m=''48040''>is</span> <span m=''48510''>an</span>
  <span m=''49290''>MIT</span> <span m=''49690''>undergrad.</span> <span m=''51210''>I
  guess</span> <span m=''51460''>a</span> <span m=''51680''>long</span> <span m=''51840''>time</span>
  <span m=''52130''>ago.</span> </p><p><span m=''52475''>RAVI SOUNDARARAJAN: Yeah,</span>
  <span m=''52820''>''92.</span> </p><p><span m=''53360''>PROFESSOR: ''92.</span>
  <span m=''53590''>There</span> <span m=''53740''>you</span> <span m=''53890''>go.</span>
  <span m=''54470''>And</span> <span m=''55050''>then</span> <span m=''55380''>he</span>
  <span m=''55470''>got</span> <span m=''55610''>his</span> <span m=''56410''>PhD</span>
  <span m=''56930''>from</span> <span m=''57170''>Stanford</span> <span m=''57890''>and</span>
  <span m=''58780''>end</span> <span m=''58940''>up</span> <span m=''59070''>in</span>
  <span m=''59180''>VMware</span> <span m=''59660''>looking</span> <span m=''60040''>at</span>
  <span m=''61480''>a</span> <span m=''61540''>lot</span> <span m=''62010''>of</span>
  <span m=''62450''>interesting</span> <span m=''62790''>performance</span> <span
  m=''63220''>stuff.</span> <span m=''63680''>So</span> <span m=''63960''>today,</span>
  <span m=''64580''>he''s</span> <span m=''64950''>going</span> <span m=''65050''>to</span>
  <span m=''65160''>give</span> <span m=''65269''>us</span> <span m=''65529''>a</span>
  <span m=''65790''>kind</span> <span m=''65970''>of</span> <span m=''66150''>a</span>
  <span m=''66960''>bird''s</span> <span m=''67380''>eye</span> <span m=''67460''>view</span>
  <span m=''67780''>of</span> <span m=''68420''>how</span> <span m=''69640''>these</span>
  <span m=''69920''>kind</span> <span m=''70080''>of</span> <span m=''70160''>technologies,</span>
  <span m=''70880''>what</span> <span m=''71030''>you</span> <span m=''71130''>guys</span>
  <span m=''71260''>are</span> <span m=''71400''>learning,</span> <span m=''71850''>is</span>
  <span m=''72210''>useful</span> <span m=''72730''>and</span> <span m=''72850''>how</span>
  <span m=''73010''>it''s</span> <span m=''73170''>used</span> <span m=''73490''>in</span>
  <span m=''73580''>industry.</span> <span m=''74510''>OK,</span> <span m=''74710''>Ravi.
  </span> <span m=''74970''>Take</span> <span m=''75310''>over.</span> </p><p><span
  m=''76040''>RAVI SOUNDARARAJAN: First</span> <span m=''76530''>question,</span>
  <span m=''76970''>can</span> <span m=''77130''>everybody</span> <span m=''77550''>hear</span>
  <span m=''77730''>me?</span> <span m=''77880''>And is</span> <span m=''78070''>the</span>
  <span m=''78160''>mic</span> <span m=''78440''>on?</span> <span m=''79210''>OK.</span>
  <span m=''79480''>Good.</span> <span m=''79720''>I</span> <span m=''79790''>have</span>
  <span m=''79940''>a</span> <span m=''80000''>bit</span> <span m=''80160''>of</span>
  <span m=''80270''>a</span> <span m=''80330''>sore</span> <span m=''80590''>throat.</span>
  <span m=''80775''>So</span> <span m=''80960''>I''m</span> <span m=''81070''>sorry</span>
  <span m=''82540''>if</span> <span m=''82620''>you</span> <span m=''82780''>can''t
  hear me.</span> </p><p><span m=''82940''>The</span> <span m=''83200''>other</span>
  <span m=''83320''>thing</span> <span m=''83480''>I</span> <span m=''83510''>want</span>
  <span m=''83700''>to</span> <span m=''83760''>say is</span> <span m=''83970''>I''m</span>
  <span m=''84050''>actually</span> <span m=''84230''>really</span> <span m=''84410''>glad</span>
  <span m=''84650''>you''re</span> <span m=''84750''>here.</span> <span m=''84910''>Because</span>
  <span m=''85460''>I</span> <span m=''85560''>remember</span> <span m=''85900''>very</span>
  <span m=''86270''>distinctly</span> <span m=''86600''>in</span> <span m=''86930''>1990</span>
  <span m=''87540''>when</span> <span m=''87660''>I</span> <span m=''87740''>was</span>
  <span m=''87820''>an</span> <span m=''87900''>undergrad,</span> <span m=''88240''>I</span>
  <span m=''88330''>was taking</span> <span m=''88540''>6.111.</span> <span m=''89540''>And</span>
  <span m=''89890''>I</span> <span m=''90010''>had</span> <span m=''90090''>a</span>
  <span m=''90180''>bug</span> <span m=''90450''>in</span> <span m=''90520''>my</span>
  <span m=''90650''>final</span> <span m=''90920''>project.</span> <span m=''91400''>It</span>
  <span m=''91520''>just</span> <span m=''91670''>wasn''t</span> <span m=''91950''>working.</span>
  <span m=''92220''>And</span> <span m=''92310''>I</span> <span m=''92570''>was</span>
  <span m=''92770''>going</span> <span m=''92870''>to</span> <span m=''92930''>skip</span>
  <span m=''93190''>the</span> <span m=''93280''>lecture</span> <span m=''93560''>that</span>
  <span m=''93690''>day.</span> <span m=''94000''>But I was</span> <span m=''94230''>like,</span>
  <span m=''94400''>whatever,</span> <span m=''94680''>I''ll</span> <span m=''94790''>go.</span>
  </p><p><span m=''95210''>So</span> <span m=''95460''>went to</span> <span m=''95580''>the</span>
  <span m=''95670''>lecture.</span> <span m=''95910''>Turns</span> <span m=''96110''>out</span>
  <span m=''96240''>Don</span> <span m=''96440''>Troxell</span> <span m=''97190''>pointed</span>
  <span m=''97520''>out</span> <span m=''97660''>something</span> <span m=''98150''>in</span>
  <span m=''98300''>that</span> <span m=''98490''>lecture.</span> <span m=''98790''>I
  was</span> <span m=''98930''>like,</span> <span m=''99190''>that''s</span> <span
  m=''99440''>my</span> <span m=''99570''>problem.</span> <span m=''99860''>And I</span>
  <span m=''99960''>went</span> <span m=''100160''>back,</span> <span m=''100550''>fixed
  it.</span> <span m=''100680''>Everything</span> <span m=''100990''>worked.</span>
  <span m=''101170''>And</span> <span m=''101270''>I was</span> <span m=''101370''>very</span>
  <span m=''101530''>happy.</span> <span m=''102390''>I</span> <span m=''102540''>don''t</span>
  <span m=''102650''>think</span> <span m=''102760''>that''s</span> <span m=''102920''>going</span>
  <span m=''103010''>to</span> <span m=''103060''>happen</span> <span m=''103300''>here.</span>
  <span m=''103500''>But</span> <span m=''103610''>it</span> <span m=''103660''>would</span>
  <span m=''103750''>be</span> <span m=''103840''>nice</span> <span m=''104060''>if</span>
  <span m=''104120''>it</span> <span m=''104200''>did.</span> <span m=''104520''>So</span>
  <span m=''104830''>that''s</span> <span m=''105030''>cool.</span> </p><p><span m=''105720''>So</span>
  <span m=''106310''>instead</span> <span m=''106650''>of</span> <span m=''106760''>just</span>
  <span m=''107250''>talking</span> <span m=''107530''>about</span> <span m=''107680''>what</span>
  <span m=''107810''>a</span> <span m=''107860''>performance</span> <span m=''108320''>engineer</span>
  <span m=''108690''>does,</span> <span m=''109180''>I</span> <span m=''109300''>would--</span>
  <span m=''110100''>I''ll just--</span> <span m=''112690''>Power</span> <span m=''112980''>is</span>
  <span m=''113130''>coming</span> <span m=''113460''>in.</span> <span m=''113650''>But--</span>
  <span m=''113930''>Oh,</span> <span m=''114210''>there</span> <span m=''114430''>it
  is.</span> <span m=''114580''>Perfect.</span> <span m=''115210''>So</span> <span
  m=''115450''>instead</span> <span m=''115750''>of</span> <span m=''115810''>just</span>
  <span m=''115990''>talking</span> <span m=''116280''>about what</span> <span m=''116480''>performance</span>
  <span m=''116950''>engineering</span> <span m=''117370''>is</span> <span m=''117490''>about.</span>
  <span m=''117750''>I</span> <span m=''117810''>just</span> <span m=''118000''>wanted</span>
  <span m=''118120''>to</span> <span m=''118220''>go</span> <span m=''118390''>through</span>
  <span m=''118540''>10</span> <span m=''118830''>bugs</span> <span m=''119090''>that</span>
  <span m=''119190''>I''ve</span> <span m=''119300''>actually</span> <span m=''119620''>been</span>
  <span m=''119810''>involved</span> <span m=''120280''>in.</span> <span m=''120740''>And</span>
  <span m=''120970''>hopefully,</span> <span m=''121360''>they''ll</span> <span m=''121480''>be</span>
  <span m=''121580''>interesting</span> <span m=''122050''>to</span> <span m=''122180''>you.</span>
  <span m=''122290''>Because</span> <span m=''122470''>each</span> <span m=''122620''>one</span>
  <span m=''122740''>of</span> <span m=''122800''>them</span> <span m=''122900''>was</span>
  <span m=''123310''>interesting</span> <span m=''123810''>to</span> <span m=''123940''>me.</span>
  </p><p><span m=''125200''>So</span> <span m=''125540''>let''s</span> <span m=''125770''>start</span>
  <span m=''126040''>out</span> <span m=''126280''>with--</span> <span m=''127080''>I</span>
  <span m=''127180''>just</span> <span m=''127360''>wanted</span> <span m=''127570''>to</span>
  <span m=''127630''>start</span> <span m=''127840''>this</span> <span m=''128000''>out</span>
  <span m=''128090''>with</span> <span m=''128180''>a</span> <span m=''128259''>bang.</span>
  <span m=''128620''>So</span> <span m=''128830''>for</span> <span m=''129009''>dramatic</span>
  <span m=''129400''>effect</span> <span m=''129720''>everybody</span> <span m=''130169''>read</span>
  <span m=''130639''>through</span> <span m=''130850''>this</span> <span m=''131110''>slide.</span>
  <span m=''131430''>It''s</span> <span m=''131560''>basically</span> <span m=''131970''>an</span>
  <span m=''132070''>email</span> <span m=''132480''>thread</span> <span m=''132980''>from</span>
  <span m=''133180''>one</span> <span m=''133350''>of</span> <span m=''133430''>my</span>
  <span m=''133550''>colleagues.</span> <span m=''135800''>And</span> <span m=''136240''>raise</span>
  <span m=''136570''>your hand</span> <span m=''136650''>when</span> <span m=''136770''>you''re</span>
  <span m=''136850''>done.</span> <span m=''137080''>So</span> <span m=''137270''>I''ll
  know</span> <span m=''137430''>when</span> <span m=''137550''>you''re</span> <span
  m=''137660''>done.</span> </p><p><span m=''146590''>OK.</span> <span m=''146850''>Anyway,</span>
  <span m=''147130''>so</span> <span m=''147250''>the</span> <span m=''147350''>point</span>
  <span m=''147640''>of</span> <span m=''147830''>this</span> <span m=''148020''>is</span>
  <span m=''148170''>that</span> <span m=''148340''>his</span> <span m=''148530''>question</span>
  <span m=''148910''>ended</span> <span m=''149110''>up</span> <span m=''149220''>being,</span>
  <span m=''149700''>why</span> <span m=''150120''>is</span> <span m=''150260''>the</span>
  <span m=''150340''>percent</span> <span m=''150770''>lock</span> <span m=''151080''>time</span>
  <span m=''151350''>in</span> <span m=''151450''>the</span> <span m=''151530''>database</span>
  <span m=''152640''>increasing</span> <span m=''153810''>despite</span> <span m=''154280''>a</span>
  <span m=''154390''>lighter</span> <span m=''154790''>load</span> <span m=''155180''>for</span>
  <span m=''155350''>the</span> <span m=''155460''>thing</span> <span m=''155710''>that</span>
  <span m=''155900''>uses</span> <span m=''156280''>that</span> <span m=''156510''>database?</span>
  <span m=''157290''>Now,</span> <span m=''157470''>if</span> <span m=''157530''>you''re</span>
  <span m=''157660''>like</span> <span m=''157960''>me,</span> <span m=''158170''>you</span>
  <span m=''158320''>read</span> <span m=''158530''>this</span> <span m=''158690''>email,</span>
  <span m=''159360''>and</span> <span m=''159490''>your</span> <span m=''159590''>first</span>
  <span m=''159910''>question is</span> <span m=''160220''>what</span> <span m=''160310''>the</span>
  <span m=''160380''>hell</span> <span m=''160690''>is</span> <span m=''160750''>he</span>
  <span m=''160830''>talking</span> <span m=''161180''>about?</span> <span m=''162030''>So</span>
  <span m=''162180''>that''s</span> <span m=''162390''>why</span> <span m=''162630''>titled</span>
  <span m=''162960''>this</span> <span m=''163040''>slide</span> <span m=''163520''>like</span>
  <span m=''163890''>that.</span> </p><p><span m=''164420''>So</span> <span m=''164960''>let''s</span>
  <span m=''165250''>actually</span> <span m=''165540''>deconstruct</span> <span m=''166110''>what,</span>
  <span m=''166390''>a,</span> <span m=''166640''>that</span> <span m=''166840''>email</span>
  <span m=''167190''>meant.</span> <span m=''167390''>And,</span> <span m=''167550''>b,</span>
  <span m=''167750''>what</span> <span m=''167950''>it</span> <span m=''168050''>meant</span>
  <span m=''168290''>to</span> <span m=''168420''>me.</span> <span m=''169180''>So</span>
  <span m=''169510''>in</span> <span m=''169650''>order</span> <span m=''169790''>to</span>
  <span m=''169900''>do</span> <span m=''170060''>that,</span> <span m=''170350''>I</span>
  <span m=''170410''>want</span> <span m=''170610''>to</span> <span m=''170670''>first</span>
  <span m=''170940''>talk</span> <span m=''171170''>about</span> <span m=''171430''>the</span>
  <span m=''171490''>system</span> <span m=''171930''>that he</span> <span m=''172080''>was</span>
  <span m=''172190''>talking</span> <span m=''172570''>about</span> <span m=''173050''>and</span>
  <span m=''173640''>help</span> <span m=''173870''>describe</span> <span m=''174320''>what</span>
  <span m=''174460''>the</span> <span m=''174580''>actual</span> <span m=''174970''>problem</span>
  <span m=''175420''>he</span> <span m=''175560''>was</span> <span m=''175690''>seeing</span>
  <span m=''176020''>was.</span> <span m=''176650''>So</span> <span m=''176830''>here</span>
  <span m=''177000''>we</span> <span m=''177100''>have</span> <span m=''177220''>a</span>
  <span m=''177270''>standard</span> <span m=''177770''>multi-tier</span> <span m=''178550''>set</span>
  <span m=''178810''>up.</span> <span m=''179500''>What</span> <span m=''179700''>we''ve</span>
  <span m=''179890''>got</span> <span m=''180600''>is</span> <span m=''180860''>that</span>
  <span m=''181410''>we''ve</span> <span m=''181650''>got</span> <span m=''181870''>a</span>
  <span m=''181930''>server,</span> <span m=''182730''>which</span> <span m=''182900''>is</span>
  <span m=''182990''>our</span> <span m=''183060''>middleware</span> <span m=''183440''>server.</span>
  <span m=''183800''>And it</span> <span m=''183900''>talks</span> <span m=''184100''>to</span>
  <span m=''184230''>a</span> <span m=''184300''>database.</span> <span m=''184800''>And</span>
  <span m=''184870''>then</span> <span m=''184950''>we</span> <span m=''185040''>have</span>
  <span m=''185140''>a</span> <span m=''185190''>bunch</span> <span m=''185440''>of</span>
  <span m=''185530''>hosts</span> <span m=''185940''>on</span> <span m=''186080''>the</span>
  <span m=''186210''>other</span> <span m=''186450''>end.</span> <span m=''186840''>Those</span>
  <span m=''187060''>are</span> <span m=''187120''>labeled</span> <span m=''187420''>by</span>
  <span m=''187630''>agent,</span> <span m=''188070''>HAL,</span> <span m=''188370''>whatever.</span>
  <span m=''188900''>Anyway,</span> <span m=''189190''>those</span> <span m=''189430''>are</span>
  <span m=''189490''>hosts</span> <span m=''189790''>running</span> <span m=''190020''>virtual</span>
  <span m=''190400''>machines.</span> </p><p><span m=''192350''>And</span> <span m=''192750''>here''s</span>
  <span m=''192990''>the</span> <span m=''193080''>setup.</span> <span m=''193630''>You''ve</span>
  <span m=''193820''>got</span> <span m=''193980''>a</span> <span m=''194030''>client.</span>
  <span m=''194810''>And</span> <span m=''194940''>that</span> <span m=''195080''>client</span>
  <span m=''195420''>issues</span> <span m=''195720''>a</span> <span m=''195810''>command</span>
  <span m=''196250''>to</span> <span m=''196320''>this</span> <span m=''196480''>middleware</span>
  <span m=''196920''>server.</span> <span m=''197730''>And</span> <span m=''197850''>that</span>
  <span m=''197970''>middleware</span> <span m=''198350''>server</span> <span m=''198630''>tries</span>
  <span m=''198870''>to</span> <span m=''198970''>figure</span> <span m=''199300''>out</span>
  <span m=''199560''>what</span> <span m=''199970''>host or</span> <span m=''200410''>what</span>
  <span m=''200610''>virtual</span> <span m=''200990''>machine</span> <span m=''201420''>needs</span>
  <span m=''201640''>to</span> <span m=''201710''>be</span> <span m=''201810''>contacted.</span>
  <span m=''202690''>So</span> <span m=''203260''>the</span> <span m=''203480''>middleware</span>
  <span m=''204180''>goes</span> <span m=''204430''>ahead and</span> <span m=''204750''>does
  that.</span> <span m=''204990''>And</span> <span m=''205180''>it</span> <span m=''205310''>performs</span>
  <span m=''205710''>an</span> <span m=''205810''>operation</span> <span m=''206430''>on</span>
  <span m=''206620''>that</span> <span m=''206830''>host.</span> <span m=''207520''>And</span>
  <span m=''207660''>after</span> <span m=''207860''>performing</span> <span m=''208250''>the</span>
  <span m=''208370''>operation,</span> <span m=''209620''>it</span> <span m=''209840''>then</span>
  <span m=''210040''>archives</span> <span m=''210560''>some</span> <span m=''210770''>of</span>
  <span m=''210840''>the</span> <span m=''210920''>information</span> <span m=''211920''>that</span>
  <span m=''212280''>it</span> <span m=''212640''>gained</span> <span m=''213340''>to</span>
  <span m=''213570''>the</span> <span m=''213680''>database.</span> <span m=''214170''>And</span>
  <span m=''214290''>once</span> <span m=''214500''>it</span> <span m=''214570''>archived</span>
  <span m=''214930''>the</span> <span m=''214990''>information</span> <span m=''215450''>to</span>
  <span m=''215530''>the</span> <span m=''215630''>database,</span> <span m=''216330''>it</span>
  <span m=''216470''>went</span> <span m=''216660''>ahead</span> <span m=''216820''>and</span>
  <span m=''216950''>notified</span> <span m=''217430''>the</span> <span m=''217560''>client</span>
  <span m=''218200''>that</span> <span m=''218640''>the</span> <span m=''218950''>operation</span>
  <span m=''219500''>itself</span> <span m=''219820''>was</span> <span m=''219970''>done.</span>
  </p><p><span m=''220360''>Fairly</span> <span m=''220660''>simple.</span> <span
  m=''220960''>Send a</span> <span m=''221160''>request</span> <span m=''221520''>to
  a</span> <span m=''221600''>server.</span> <span m=''222020''>Server</span> <span
  m=''222300''>contacts</span> <span m=''222960''>some</span> <span m=''223200''>other</span>
  <span m=''223710''>host.</span> <span m=''224260''>Host</span> <span m=''224510''>comes</span>
  <span m=''224650''>back</span> <span m=''224830''>to</span> <span m=''224900''>the</span>
  <span m=''225000''>server</span> <span m=''225390''>and says</span> <span m=''225510''>it''s</span>
  <span m=''225670''>done.</span> <span m=''226120''>Server</span> <span m=''226440''>persists</span>
  <span m=''226930''>information</span> <span m=''227370''>to</span> <span m=''227420''>the</span>
  <span m=''227530''>database</span> <span m=''228170''>and</span> <span m=''228290''>then</span>
  <span m=''228920''>notifies</span> <span m=''229400''>the</span> <span m=''229440''>client</span>
  <span m=''229810''>everything</span> <span m=''230180''>is</span> <span m=''230330''>done.</span>
  </p><p><span m=''230860''>So</span> <span m=''231070''>the</span> <span m=''231210''>actual</span>
  <span m=''231710''>problem</span> <span m=''232080''>that</span> <span m=''232840''>my</span>
  <span m=''232980''>colleague</span> <span m=''233400''>was</span> <span m=''233520''>seeing</span>
  <span m=''233980''>was,</span> <span m=''234590''>he</span> <span m=''234770''>was</span>
  <span m=''234920''>sending</span> <span m=''235400''>less</span> <span m=''235800''>and</span>
  <span m=''235930''>less</span> <span m=''236260''>load</span> <span m=''236590''>to</span>
  <span m=''236740''>this</span> <span m=''236920''>middleware</span> <span m=''237330''>server,</span>
  <span m=''237900''>which</span> <span m=''238150''>therefore</span> <span m=''238610''>means</span>
  <span m=''238830''>that</span> <span m=''238900''>less</span> <span m=''239180''>and</span>
  <span m=''239240''>less</span> <span m=''239490''>goes</span> <span m=''239680''>to</span>
  <span m=''239770''>the</span> <span m=''239870''>host</span> <span m=''240260''>and</span>
  <span m=''240360''>less</span> <span m=''240620''>and</span> <span m=''240680''>less</span>
  <span m=''240960''>goes</span> <span m=''241160''>to</span> <span m=''241240''>the</span>
  <span m=''241330''>database.</span> <span m=''243130''>However,</span> <span m=''243920''>the</span>
  <span m=''244020''>percent</span> <span m=''244280''>of</span> <span m=''244540''>time</span>
  <span m=''244790''>spent</span> <span m=''245490''>in</span> <span m=''245710''>the</span>
  <span m=''245780''>database</span> <span m=''246510''>was</span> <span m=''246720''>higher.</span>
  <span m=''248060''>So</span> <span m=''248170''>despite</span> <span m=''248550''>a</span>
  <span m=''248610''>lighter</span> <span m=''248890''>load</span> <span m=''249220''>and
  less</span> <span m=''249640''>stuff</span> <span m=''249900''>going</span> <span
  m=''250140''>to</span> <span m=''250190''>the</span> <span m=''250280''>database,</span>
  <span m=''250860''>the</span> <span m=''250960''>percent</span> <span m=''251310''>of</span>
  <span m=''251400''>time</span> <span m=''251660''>spent</span> <span m=''252000''>in</span>
  <span m=''252070''>the</span> <span m=''252150''>database</span> <span m=''252600''>was</span>
  <span m=''252720''>higher.</span> <span m=''253830''>Probably,</span> <span m=''254210''>all</span>
  <span m=''254310''>of</span> <span m=''254410''>you are</span> <span m=''254550''>smart</span>
  <span m=''254890''>enough to</span> <span m=''254950''>know</span> <span m=''255030''>what</span>
  <span m=''255110''>the</span> <span m=''255200''>actual</span> <span m=''255470''>problem</span>
  <span m=''255810''>is.</span> <span m=''255960''>But</span> <span m=''256140''>we''ll</span>
  <span m=''256320''>go</span> <span m=''256470''>through</span> <span m=''256600''>it</span>
  <span m=''256690''>step</span> <span m=''256870''>by</span> <span m=''256990''>step.</span>
  </p><p><span m=''258490''>So</span> <span m=''258810''>the</span> <span m=''258940''>deal</span>
  <span m=''259310''>is</span> <span m=''259430''>this.</span> <span m=''259470''>The</span>
  <span m=''259510''>first</span> <span m=''259760''>thing</span> <span m=''259870''>I</span>
  <span m=''259910''>did</span> <span m=''260050''>is</span> <span m=''260170''>I</span>
  <span m=''260269''>examined</span> <span m=''260910''>the</span> <span m=''261019''>amount</span>
  <span m=''261329''>of</span> <span m=''261420''>time</span> <span m=''261640''>that</span>
  <span m=''261740''>each</span> <span m=''261980''>lock</span> <span m=''262220''>was</span>
  <span m=''262410''>held</span> <span m=''263000''>for</span> <span m=''263140''>each</span>
  <span m=''263280''>of</span> <span m=''263380''>these</span> <span m=''263480''>different</span>
  <span m=''263750''>operations.</span> <span m=''264280''>And</span> <span m=''264370''>what</span>
  <span m=''264530''>I</span> <span m=''264580''>did</span> <span m=''264720''>was</span>
  <span m=''264830''>I</span> <span m=''264900''>varied</span> <span m=''265280''>the
  load</span> <span m=''265630''>just</span> <span m=''265900''>as</span> <span m=''267160''>my</span>
  <span m=''267340''>colleague</span> <span m=''267800''>did.</span> <span m=''268160''>And</span>
  <span m=''268250''>what</span> <span m=''268420''>you</span> <span m=''268520''>see</span>
  <span m=''268850''>are</span> <span m=''269130''>six</span> <span m=''269630''>different</span>
  <span m=''270200''>lines.</span> <span m=''270990''>On</span> <span m=''271130''>the</span>
  <span m=''271280''>x-axis</span> <span m=''271930''>is</span> <span m=''272080''>each</span>
  <span m=''272300''>of</span> <span m=''272380''>the</span> <span m=''272460''>different</span>
  <span m=''272790''>locks</span> <span m=''273120''>that</span> <span m=''273240''>we</span>
  <span m=''273400''>acquire in</span> <span m=''273880''>our</span> <span m=''273980''>system.</span>
  <span m=''274630''>And</span> <span m=''274770''>on</span> <span m=''274860''>the</span>
  <span m=''274950''>y-axis</span> <span m=''275640''>is</span> <span m=''275730''>the</span>
  <span m=''275820''>latency</span> <span m=''276380''>of</span> <span m=''276470''>those</span>
  <span m=''276710''>locks</span> <span m=''277120''>in</span> <span m=''277270''>milliseconds.</span>
  <span m=''278270''>And</span> <span m=''279540''>basically,</span> <span m=''279980''>the</span>
  <span m=''280370''>axis</span> <span m=''280810''>for</span> <span m=''280890''>this--</span>
  <span m=''281540''>the legend</span> <span m=''281880''>for this</span> <span m=''282070''>chart</span>
  <span m=''282420''>says</span> <span m=''282550''>Locked-4,</span> <span m=''283200''>which</span>
  <span m=''283390''>means</span> <span m=''283570''>a</span> <span m=''283610''>certain</span>
  <span m=''283910''>type</span> <span m=''284100''>of</span> <span m=''284210''>load,</span>
  <span m=''284640''>all the</span> <span m=''284990''>way</span> <span m=''285150''>down</span>
  <span m=''285200''>to</span> <span m=''285345''>Locked-128.</span> </p><p><span
  m=''286540''>OK.</span> <span m=''287150''>And</span> <span m=''287320''>the</span>
  <span m=''287400''>deal</span> <span m=''287760''>is</span> <span m=''288480''>that</span>
  <span m=''288670''>when</span> <span m=''288830''>you</span> <span m=''288960''>have</span>
  <span m=''289330''>lock-128,</span> <span m=''290380''>what</span> <span m=''290510''>that</span>
  <span m=''290660''>indicates</span> <span m=''291120''>is that</span> <span m=''291250''>there''s</span>
  <span m=''291390''>128</span> <span m=''292270''>hosts</span> <span m=''292800''>per</span>
  <span m=''293070''>thread.</span> <span m=''293660''>Which,</span> <span m=''293940''>take</span>
  <span m=''294110''>my</span> <span m=''294190''>word</span> <span m=''294380''>for</span>
  <span m=''294570''>it, that</span> <span m=''294720''>means</span> <span m=''294880''>that
  you''ve</span> <span m=''295070''>got</span> <span m=''295220''>a</span> <span m=''295280''>lighter</span>
  <span m=''295560''>load.</span> <span m=''296070''>So</span> <span m=''296220''>basically,</span>
  <span m=''296610''>the</span> <span m=''296710''>lowest</span> <span m=''297970''>line</span>
  <span m=''298280''>in</span> <span m=''298370''>the</span> <span m=''298460''>legend</span>
  <span m=''299080''>is</span> <span m=''299270''>the</span> <span m=''299350''>lightest</span>
  <span m=''299790''>load.</span> <span m=''299980''>And</span> <span m=''300040''>the</span>
  <span m=''300110''>highest</span> <span m=''300530''>line</span> <span m=''300770''>in</span>
  <span m=''300830''>the</span> <span m=''300900''>legend</span> <span m=''301220''>is</span>
  <span m=''301400''>the</span> <span m=''301500''>highest</span> <span m=''301880''>load.</span>
  <span m=''302900''>And</span> <span m=''303030''>as</span> <span m=''303180''>you</span>
  <span m=''303290''>can</span> <span m=''303440''>see,</span> <span m=''303680''>although</span>
  <span m=''303860''>it''s</span> <span m=''303950''>a</span> <span m=''304000''>little</span>
  <span m=''304210''>bit</span> <span m=''304350''>obscured</span> <span m=''304740''>in</span>
  <span m=''304810''>this</span> <span m=''304980''>chart,</span> <span m=''305580''>the</span>
  <span m=''305670''>bottom</span> <span m=''306060''>line</span> <span m=''306410''>is</span>
  <span m=''306590''>that</span> <span m=''306770''>this</span> <span m=''306930''>is</span>
  <span m=''307020''>about</span> <span m=''307250''>time</span> <span m=''307510''>you''re</span>
  <span m=''307630''>spent</span> <span m=''307890''>holding</span> <span m=''308190''>a</span>
  <span m=''308250''>lock.</span> </p><p><span m=''309670''>In</span> <span m=''309850''>this</span>
  <span m=''310040''>chart,</span> <span m=''310350''>lock-4</span> <span m=''311140''>indicates</span>
  <span m=''311530''>a</span> <span m=''311620''>heavy</span> <span m=''311910''>load.</span>
  <span m=''312330''>Lock-128</span> <span m=''313400''>indicates</span> <span m=''313770''>a</span>
  <span m=''313820''>lighter</span> <span m=''314130''>load.</span> <span m=''314580''>And</span>
  <span m=''314700''>what</span> <span m=''314830''>this</span> <span m=''314960''>chart</span>
  <span m=''315160''>indicates</span> <span m=''315560''>is</span> <span m=''315660''>that,</span>
  <span m=''315790''>in</span> <span m=''315910''>fact,</span> <span m=''316450''>you</span>
  <span m=''316610''>are</span> <span m=''316760''>spending</span> <span m=''317150''>more</span>
  <span m=''317370''>time</span> <span m=''317630''>in</span> <span m=''317750''>the</span>
  <span m=''317840''>locks</span> <span m=''318430''>with</span> <span m=''318690''>a</span>
  <span m=''318790''>heavier</span> <span m=''319210''>load,</span> <span m=''319550''>lock-4,</span>
  <span m=''320550''>than</span> <span m=''320770''>you</span> <span m=''320920''>are</span>
  <span m=''321080''>with</span> <span m=''321230''>a</span> <span m=''321340''>lighter</span>
  <span m=''321680''>load,</span> <span m=''321900''>lock-128.</span> <span m=''323480''>So</span>
  <span m=''324360''>the</span> <span m=''324500''>latency</span> <span m=''324920''>prologue</span>
  <span m=''325540''>is</span> <span m=''325750''>higher</span> <span m=''326190''>with</span>
  <span m=''326280''>a</span> <span m=''326380''>higher</span> <span m=''326670''>load,</span>
  <span m=''326900''>which</span> <span m=''327050''>is</span> <span m=''327140''>totally</span>
  <span m=''327420''>reasonable.</span> <span m=''328080''>And</span> <span m=''328400''>it</span>
  <span m=''328570''>turns</span> <span m=''328850''>out</span> <span m=''328980''>that</span>
  <span m=''329060''>if</span> <span m=''329130''>we</span> <span m=''329220''>translate</span>
  <span m=''329730''>my</span> <span m=''329850''>colleague''s</span> <span m=''330280''>question</span>
  <span m=''330720''>into</span> <span m=''331150''>reality,</span> <span m=''331890''>what</span>
  <span m=''332900''>he''s</span> <span m=''333040''>asking</span> <span m=''333410''>is</span>
  <span m=''333590''>why</span> <span m=''333970''>is</span> <span m=''334060''>the</span>
  <span m=''334130''>percent</span> <span m=''334510''>time</span> <span m=''334740''>spent</span>
  <span m=''334870''>in</span> <span m=''334920''>the</span> <span m=''335020''>database</span>
  <span m=''335630''>higher,</span> <span m=''336320''>even</span> <span m=''336520''>though</span>
  <span m=''336610''>you</span> <span m=''336700''>have</span> <span m=''336810''>a</span>
  <span m=''336860''>lighter</span> <span m=''337190''>load?</span> </p><p><span m=''337860''>Well,</span>
  <span m=''338300''>the</span> <span m=''338450''>answer</span> <span m=''338750''>ends</span>
  <span m=''338900''>up</span> <span m=''339000''>being</span> <span m=''339270''>that</span>
  <span m=''339460''>when</span> <span m=''339560''>you</span> <span m=''339640''>have</span>
  <span m=''339720''>a</span> <span m=''339770''>lighter</span> <span m=''340100''>load,</span>
  <span m=''340610''>overall,</span> <span m=''341090''>you''re</span> <span m=''341200''>spending</span>
  <span m=''341520''>less</span> <span m=''341710''>time</span> <span m=''341960''>in</span>
  <span m=''342040''>locks,</span> <span m=''342490''>which</span> <span m=''342700''>means</span>
  <span m=''342860''>that</span> <span m=''342940''>any</span> <span m=''343120''>time</span>
  <span m=''343350''>you</span> <span m=''343410''>spend</span> <span m=''343710''>in
  the</span> <span m=''343780''>database,</span> <span m=''344270''>if</span> <span
  m=''344390''>that''s</span> <span m=''344610''>a</span> <span m=''344670''>fixed</span>
  <span m=''345000''>cost,</span> <span m=''345530''>is</span> <span m=''345730''>going</span>
  <span m=''345870''>to</span> <span m=''346020''>be</span> <span m=''346150''>a</span>
  <span m=''346180''>higher</span> <span m=''346530''>percent</span> <span m=''347070''>of</span>
  <span m=''347220''>the</span> <span m=''347350''>overall</span> <span m=''347810''>time.</span>
  <span m=''348590''>So</span> <span m=''348820''>it</span> <span m=''348910''>turns</span>
  <span m=''349210''>out,</span> <span m=''349750''>there</span> <span m=''350040''>really</span>
  <span m=''350260''>wasn''t</span> <span m=''350640''>an</span> <span m=''350730''>issue.</span>
  <span m=''350950''>There</span> <span m=''351070''>was</span> <span m=''351140''>nothing</span>
  <span m=''351380''>odd</span> <span m=''351640''>here.</span> <span m=''351820''>It''s</span>
  <span m=''352110''>exactly what you''d</span> <span m=''352400''>expect,</span>
  <span m=''352960''>because</span> <span m=''353180''>the</span> <span m=''353270''>database</span>
  <span m=''353740''>imposes</span> <span m=''354270''>essentially</span> <span m=''354740''>a</span>
  <span m=''354790''>fixed</span> <span m=''355070''>amount</span> <span m=''355280''>of</span>
  <span m=''355380''>latency</span> <span m=''355810''>per</span> <span m=''356040''>operation.</span>
  </p><p><span m=''357120''>And</span> <span m=''358110''>in</span> <span m=''358260''>order</span>
  <span m=''358410''>to</span> <span m=''358520''>confirm</span> <span m=''358930''>that,</span>
  <span m=''359080''>I</span> <span m=''359150''>also</span> <span m=''359390''>looked</span>
  <span m=''359590''>at</span> <span m=''359650''>the</span> <span m=''359760''>time</span>
  <span m=''360020''>spent</span> <span m=''360360''>contending</span> <span m=''360900''>for</span>
  <span m=''361050''>locks.</span> <span m=''361340''>So</span> <span m=''361700''>you</span>
  <span m=''361850''>really</span> <span m=''362050''>want</span> <span m=''362230''>a</span>
  <span m=''362290''>lock,</span> <span m=''362520''>but</span> <span m=''362630''>someone</span>
  <span m=''362860''>else</span> <span m=''363070''>gets</span> <span m=''363310''>it</span>
  <span m=''364030''>instead.</span> <span m=''364450''>And</span> <span m=''364490''>you</span>
  <span m=''364560''>have</span> <span m=''364660''>to</span> <span m=''364760''>wait.</span>
  <span m=''365170''>And</span> <span m=''365540''>the</span> <span m=''365670''>trend</span>
  <span m=''365950''>is</span> <span m=''366030''>exactly</span> <span m=''366460''>the</span>
  <span m=''366570''>same.</span> <span m=''367060''>When</span> <span m=''367290''>you</span>
  <span m=''367430''>have</span> <span m=''367580''>a</span> <span m=''367630''>lighter</span>
  <span m=''367990''>load,</span> <span m=''368980''>you</span> <span m=''369420''>end</span>
  <span m=''369600''>up</span> <span m=''369660''>having</span> <span m=''369950''>a</span>
  <span m=''370000''>much</span> <span m=''370260''>lower</span> <span m=''370580''>overall</span>
  <span m=''371000''>latency.</span> <span m=''371410''>But</span> <span m=''371550''>that</span>
  <span m=''371710''>just</span> <span m=''371890''>means</span> <span m=''372070''>that</span>
  <span m=''372160''>any</span> <span m=''372340''>latency</span> <span m=''372760''>you</span>
  <span m=''372870''>spend</span> <span m=''373130''>in</span> <span m=''373200''>this</span>
  <span m=''373370''>database,</span> <span m=''374590''>its</span> <span m=''375170''>percent</span>
  <span m=''375440''>impact</span> <span m=''375930''>on</span> <span m=''376010''>the</span>
  <span m=''376110''>entire</span> <span m=''376550''>operation</span> <span m=''377080''>is</span>
  <span m=''377230''>quite</span> <span m=''377470''>a</span> <span m=''377520''>bit</span>
  <span m=''377650''>higher.</span> </p><p><span m=''379180''>So</span> <span m=''380240''>to</span>
  <span m=''380680''>take</span> <span m=''381060''>a</span> <span m=''381130''>look</span>
  <span m=''381370''>at</span> <span m=''381470''>this</span> <span m=''381800''>and</span>
  <span m=''382040''>to</span> <span m=''382110''>do</span> <span m=''382210''>a</span>
  <span m=''382280''>postmortem</span> <span m=''382920''>on</span> <span m=''382970''>this</span>
  <span m=''383130''>case</span> <span m=''383380''>study,</span> <span m=''385730''>his</span>
  <span m=''385950''>first</span> <span m=''386260''>thing</span> <span m=''386400''>was</span>
  <span m=''386520''>some</span> <span m=''386720''>random</span> <span m=''387070''>email,</span>
  <span m=''387400''>which</span> <span m=''387550''>kind</span> <span m=''387700''>of</span>
  <span m=''387900''>was</span> <span m=''388160''>nonsense.</span> <span m=''388880''>But</span>
  <span m=''389620''>it</span> <span m=''389730''>was</span> <span m=''389880''>less</span>
  <span m=''390130''>nonsensical</span> <span m=''390650''>once</span> <span m=''390830''>you</span>
  <span m=''390910''>actually</span> <span m=''391100''>tried</span> <span m=''391290''>to</span>
  <span m=''391380''>understand</span> <span m=''391870''>what</span> <span m=''392060''>this</span>
  <span m=''392140''>setup</span> <span m=''392500''>was.</span> <span m=''392680''>So</span>
  <span m=''392850''>step</span> <span m=''393160''>one</span> <span m=''393360''>is</span>
  <span m=''393490''>figure</span> <span m=''393740''>out</span> <span m=''393830''>what</span>
  <span m=''394110''>is</span> <span m=''394300''>the</span> <span m=''394400''>experimental</span>
  <span m=''394860''>setup</span> <span m=''395170''>and</span> <span m=''395660''>what</span>
  <span m=''395890''>are</span> <span m=''395930''>the</span> <span m=''396040''>parameters</span>
  <span m=''396295''>that</span> <span m=''396550''>are</span> <span m=''396690''>being</span>
  <span m=''396900''>studied.</span> <span m=''397710''>The</span> <span m=''397830''>next</span>
  <span m=''398050''>thing</span> <span m=''398190''>to</span> <span m=''398240''>understand</span>
  <span m=''398610''>is</span> <span m=''398720''>what''s</span> <span m=''398980''>being</span>
  <span m=''399190''>measured?</span> <span m=''399530''>I remember</span> <span m=''399750''>what</span>
  <span m=''399810''>my</span> <span m=''399920''>colleague</span> <span m=''400360''>said.</span>
  <span m=''400580''>He said</span> <span m=''400800''>the</span> <span m=''400900''>percent</span>
  <span m=''401090''>of</span> <span m=''401280''>time</span> <span m=''401540''>in</span>
  <span m=''401650''>the</span> <span m=''401740''>database</span> <span m=''402210''>was</span>
  <span m=''402740''>pretty</span> <span m=''402970''>high.</span> <span m=''403290''>Why</span>
  <span m=''403560''>is</span> <span m=''403760''>that?</span> <span m=''403960''>Well,</span>
  <span m=''404480''>OK.</span> <span m=''404770''>So</span> <span m=''404900''>we</span>
  <span m=''405020''>have</span> <span m=''405150''>to</span> <span m=''405240''>understand</span>
  <span m=''405850''>what</span> <span m=''406060''>this</span> <span m=''406170''>multi-tier</span>
  <span m=''406570''>setup</span> <span m=''406910''>is,</span> <span m=''407180''>why</span>
  <span m=''407660''>you</span> <span m=''407810''>would</span> <span m=''407910''>be</span>
  <span m=''408040''>going</span> <span m=''408210''>to</span> <span m=''408390''>the</span>
  <span m=''408480''>database,</span> <span m=''408910''>and</span> <span m=''409040''>what</span>
  <span m=''409200''>it</span> <span m=''409330''>means</span> <span m=''409690''>if</span>
  <span m=''409770''>the</span> <span m=''409860''>time</span> <span m=''410120''>spent</span>
  <span m=''410350''>in</span> <span m=''410420''>that</span> <span m=''410590''>database</span>
  <span m=''411130''>is</span> <span m=''411310''>high.</span> </p><p><span m=''412770''>And</span>
  <span m=''412900''>I</span> <span m=''412950''>guess</span> <span m=''413180''>the</span>
  <span m=''413270''>next</span> <span m=''413550''>thing</span> <span m=''413700''>you</span>
  <span m=''413770''>want</span> <span m=''413920''>to</span> <span m=''413980''>do</span>
  <span m=''414090''>is</span> <span m=''414170''>you</span> <span m=''414250''>want</span>
  <span m=''414390''>to</span> <span m=''414430''>say,</span> <span m=''414570''>well,</span>
  <span m=''414720''>OK,</span> <span m=''414910''>he''s</span> <span m=''415070''>complaining</span>
  <span m=''415390''>about</span> <span m=''415550''>lock</span> <span m=''415930''>latency.</span>
  <span m=''416070''>So</span> <span m=''416170''>I</span> <span m=''416240''>must</span>
  <span m=''416500''>have</span> <span m=''416600''>some</span> <span m=''416760''>sort</span>
  <span m=''416920''>of</span> <span m=''417000''>visibility</span> <span m=''417540''>there</span>
  <span m=''417710''>somewhere.</span> <span m=''418080''>Let</span> <span m=''418180''>me</span>
  <span m=''418280''>go</span> <span m=''418430''>and</span> <span m=''418490''>look</span>
  <span m=''418940''>at</span> <span m=''419090''>the</span> <span m=''419190''>appropriate</span>
  <span m=''419650''>metric</span> <span m=''419960''>to</span> <span m=''420050''>figure</span>
  <span m=''420300''>out</span> <span m=''420400''>what''s</span> <span m=''420730''>going</span>
  <span m=''421000''>on</span> <span m=''421410''>and</span> <span m=''421680''>why</span>
  <span m=''421870''>time</span> <span m=''422150''>is</span> <span m=''422250''>being</span>
  <span m=''422460''>spent</span> <span m=''422800''>there.</span> </p><p><span m=''424080''>And</span>
  <span m=''424260''>finally,</span> <span m=''424690''>it''s</span> <span m=''424830''>appropriate</span>
  <span m=''425310''>to--</span> <span m=''425530''>once</span> <span m=''425800''>you''ve</span>
  <span m=''425910''>got</span> <span m=''426080''>all</span> <span m=''426190''>this</span>
  <span m=''426350''>data,</span> <span m=''426770''>don''t</span> <span m=''426930''>make</span>
  <span m=''427070''>any</span> <span m=''427220''>assumptions--</span> <span m=''427770''>just</span>
  <span m=''427950''>draw</span> <span m=''428140''>the</span> <span m=''428260''>appropriate</span>
  <span m=''428650''>conclusion</span> <span m=''429030''>based</span> <span m=''429310''>on</span>
  <span m=''429380''>the</span> <span m=''429480''>data.</span> <span m=''433500''>The</span>
  <span m=''433610''>problem</span> <span m=''433860''>is</span> <span m=''433960''>basically</span>
  <span m=''434350''>that</span> <span m=''434460''>with</span> <span m=''434550''>a</span>
  <span m=''434650''>lighter</span> <span m=''434960''>load</span> <span m=''435280''>the</span>
  <span m=''435380''>impact</span> <span m=''435730''>of</span> <span m=''435830''>that</span>
  <span m=''435930''>database</span> <span m=''436370''>becomes</span> <span m=''436780''>larger,</span>
  <span m=''437510''>even</span> <span m=''437790''>if</span> <span m=''437920''>it</span>
  <span m=''438010''>were</span> <span m=''438150''>the</span> <span m=''438250''>same</span>
  <span m=''439040''>under</span> <span m=''439340''>a</span> <span m=''439360''>heavier</span>
  <span m=''439640''>load.</span> <span m=''439830''>Because</span> <span m=''440050''>under</span>
  <span m=''440280''>a heavier</span> <span m=''440530''>load</span> <span m=''440720''>other</span>
  <span m=''440980''>aspects</span> <span m=''441380''>of</span> <span m=''441450''>the</span>
  <span m=''441540''>system</span> <span m=''441930''>also</span> <span m=''442350''>get</span>
  <span m=''442570''>stressed</span> <span m=''443210''>that</span> <span m=''443400''>don''t</span>
  <span m=''443590''>get</span> <span m=''443740''>stressed</span> <span m=''444110''>in</span>
  <span m=''444180''>a</span> <span m=''444250''>lighter</span> <span m=''444540''>load.</span>
  </p><p><span m=''446280''>So,</span> <span m=''446605''>and</span> <span m=''446930''>this</span>
  <span m=''447160''>is</span> <span m=''447290''>basically</span> <span m=''447640''>what</span>
  <span m=''447730''>I''m</span> <span m=''447830''>saying</span> <span m=''448060''>here,</span>
  <span m=''448200''>yeah,</span> <span m=''448460''>the</span> <span m=''448540''>percent</span>
  <span m=''448830''>lock time</span> <span m=''449270''>in the</span> <span m=''449360''>database</span>
  <span m=''450270''>overall</span> <span m=''450680''>is</span> <span m=''450810''>higher.</span>
  <span m=''451390''>But</span> <span m=''451590''>the</span> <span m=''451700''>overall</span>
  <span m=''452110''>lock</span> <span m=''452320''>time</span> <span m=''452540''>is</span>
  <span m=''452580''>smaller.</span> <span m=''453030''>So everything</span> <span
  m=''453400''>is</span> <span m=''453930''>behaving</span> <span m=''454310''>exactly</span>
  <span m=''454810''>as</span> <span m=''454900''>you</span> <span m=''455010''>would</span>
  <span m=''455120''>expect.</span> </p><p><span m=''457050''>So</span> <span m=''457960''>this</span>
  <span m=''458230''>was</span> <span m=''458440''>one</span> <span m=''458620''>simple</span>
  <span m=''458980''>study</span> <span m=''459750''>and</span> <span m=''459790''>hopefully
  it</span> <span m=''460100''>didn''t</span> <span m=''460260''>require</span> <span
  m=''460560''>any</span> <span m=''460730''>virtualization</span> <span m=''461380''>specific</span>
  <span m=''462230''>knowledge.</span> <span m=''462760''>What</span> <span m=''463000''>I''m</span>
  <span m=''463080''>going</span> <span m=''463160''>to</span> <span m=''463240''>do</span>
  <span m=''463370''>now is</span> <span m=''463620''>go</span> <span m=''463720''>over</span>
  <span m=''463920''>a</span> <span m=''463970''>bunch</span> <span m=''464220''>of</span>
  <span m=''464310''>other</span> <span m=''464520''>different</span> <span m=''464790''>case</span>
  <span m=''465000''>studies</span> <span m=''465300''>that I''ve</span> <span m=''465470''>looked</span>
  <span m=''465740''>at</span> <span m=''465850''>and</span> <span m=''467160''>crystallize</span>
  <span m=''467760''>what</span> <span m=''467900''>lessons</span> <span m=''468270''>I</span>
  <span m=''468340''>learned</span> <span m=''468580''>from</span> <span m=''468770''>doing</span>
  <span m=''468990''>those</span> <span m=''469170''>studies.</span> <span m=''470560''>So</span>
  <span m=''471510''>I</span> <span m=''471610''>guess</span> <span m=''471800''>the</span>
  <span m=''472670''>next</span> <span m=''472920''>case</span> <span m=''473080''>study</span>
  <span m=''473300''>I want</span> <span m=''473440''>to</span> <span m=''473490''>talk</span>
  <span m=''473710''>about is</span> <span m=''473860''>something</span> <span m=''474140''>that
  I</span> <span m=''474230''>call</span> <span m=''474470''>garbage</span> <span
  m=''474880''>in,</span> <span m=''475000''>garbage</span> <span m=''475350''>out.</span>
  <span m=''477080''>I</span> <span m=''477200''>think</span> <span m=''477330''>that''s</span>
  <span m=''477490''>something</span> <span m=''477750''>I</span> <span m=''477800''>learned</span>
  <span m=''477990''>on</span> <span m=''478040''>the</span> <span m=''478120''>first</span>
  <span m=''478360''>day</span> <span m=''478450''>of</span> <span m=''478540''>001.</span>
  </p><p><span m=''479600''>So</span> <span m=''479750''>here''s</span> <span m=''479940''>the</span>
  <span m=''480020''>deal.</span> <span m=''480670''>You''ve</span> <span m=''480830''>got</span>
  <span m=''481010''>a</span> <span m=''481060''>customer.</span> <span m=''481480''>And
  he</span> <span m=''481570''>wants</span> <span m=''481790''>to</span> <span m=''481890''>draw</span>
  <span m=''482170''>this</span> <span m=''482430''>chart.</span> <span m=''484400''>And</span>
  <span m=''484560''>this</span> <span m=''484750''>chart</span> <span m=''485250''>is</span>
  <span m=''485400''>basically,</span> <span m=''486270''>on</span> <span m=''486410''>the</span>
  <span m=''486530''>x-axis</span> <span m=''487090''>is</span> <span m=''487200''>time</span>
  <span m=''487650''>and</span> <span m=''487860''>on</span> <span m=''487970''>the</span>
  <span m=''488050''>y-axis</span> <span m=''488650''>is</span> <span m=''488730''>some</span>
  <span m=''488960''>metric.</span> <span m=''489360''>It</span> <span m=''489590''>happens</span>
  <span m=''489790''>to</span> <span m=''489890''>be</span> <span m=''489990''>CPU</span>
  <span m=''490320''>usage</span> <span m=''490590''>megahertz.</span> <span m=''490980''>But</span>
  <span m=''491090''>it</span> <span m=''491150''>doesn''t</span> <span m=''491370''>really</span>
  <span m=''491570''>matter.</span> </p><p><span m=''492340''>OK.</span> <span m=''492960''>So</span>
  <span m=''493110''>he</span> <span m=''493230''>wants</span> <span m=''493350''>to</span>
  <span m=''493460''>get</span> <span m=''493610''>this</span> <span m=''493740''>chart.</span>
  <span m=''493870''>And it</span> <span m=''494000''>turns</span> <span m=''494280''>out--</span>
  <span m=''494610''>if</span> <span m=''494720''>you</span> <span m=''494850''>remember</span>
  <span m=''495110''>the</span> <span m=''495230''>diagram</span> <span m=''495490''>I</span>
  <span m=''495590''>showed</span> <span m=''495870''>before,</span> <span m=''496180''>we</span>
  <span m=''496280''>have</span> <span m=''496400''>a</span> <span m=''496440''>server</span>
  <span m=''497220''>and</span> <span m=''497430''>a</span> <span m=''497470''>bunch</span>
  <span m=''497680''>of</span> <span m=''497790''>hosts</span> <span m=''498020''>at</span>
  <span m=''498110''>the</span> <span m=''498230''>end.</span> <span m=''498810''>So</span>
  <span m=''499190''>the</span> <span m=''499280''>client</span> <span m=''499610''>simply</span>
  <span m=''499810''>has</span> <span m=''499910''>to</span> <span m=''500000''>send</span>
  <span m=''500210''>a</span> <span m=''500230''>request</span> <span m=''500540''>to</span>
  <span m=''500590''>that</span> <span m=''500770''>server.</span> <span m=''501100''>And
  the</span> <span m=''501210''>server</span> <span m=''501470''>will</span> <span
  m=''501580''>generate</span> <span m=''501870''>the</span> <span m=''501940''>data,</span>
  <span m=''502150''>send</span> <span m=''502360''>back</span> <span m=''502560''>to</span>
  <span m=''502610''>the</span> <span m=''502710''>client.</span> <span m=''503480''>And</span>
  <span m=''503640''>it</span> <span m=''503730''>turns</span> <span m=''504050''>out</span>
  <span m=''504220''>that</span> <span m=''504350''>if</span> <span m=''504450''>any</span>
  <span m=''504650''>of--</span> <span m=''505070''>all</span> <span m=''505360''>of</span>
  <span m=''505450''>you,</span> <span m=''505540''>I''m</span> <span m=''505620''>sure,</span>
  <span m=''505820''>are</span> <span m=''505920''>familiar</span> <span m=''506130''>with
  Pearl,</span> <span m=''506480''>Python,</span> <span m=''506860''>and</span> <span
  m=''506920''>all</span> <span m=''507010''>these</span> <span m=''507140''>different</span>
  <span m=''507400''>scripted</span> <span m=''507700''>languages.</span> <span m=''508440''>There''s</span>
  <span m=''508670''>another</span> <span m=''508950''>one</span> <span m=''509140''>that''s</span>
  <span m=''509350''>very</span> <span m=''509630''>popular</span> <span m=''510020''>in</span>
  <span m=''510090''>the</span> <span m=''510170''>Windows</span> <span m=''510550''>community</span>
  <span m=''510890''>called</span> <span m=''511460''>PowerShell.</span> </p><p><span
  m=''512049''>And</span> <span m=''512250''>so</span> <span m=''512500''>it</span>
  <span m=''512570''>turns</span> <span m=''512830''>out</span> <span m=''512929''>that</span>
  <span m=''513039''>our</span> <span m=''513200''>server</span> <span m=''513520''>has</span>
  <span m=''513679''>a</span> <span m=''514059''>PowerShell</span> <span m=''514299''>interface.</span>
  <span m=''514710''>You</span> <span m=''514809''>can</span> <span m=''514909''>write</span>
  <span m=''515030''>a</span> <span m=''515390''>PowerShell</span> <span m=''515630''>script</span>
  <span m=''516090''>to</span> <span m=''516190''>get</span> <span m=''516340''>any</span>
  <span m=''516460''>statistic</span> <span m=''516950''>that</span> <span m=''517080''>you</span>
  <span m=''517190''>want.</span> <span m=''517480''>And</span> <span m=''517559''>then</span>
  <span m=''517669''>you</span> <span m=''517770''>can</span> <span m=''517919''>write</span>
  <span m=''518230''>that</span> <span m=''518659''>to some</span> <span m=''519039''>database</span>
  <span m=''519750''>or</span> <span m=''519900''>some</span> <span m=''520070''>spreadsheet</span>
  <span m=''520539''>and</span> <span m=''520669''>get</span> <span m=''520840''>this</span>
  <span m=''521000''>charge.</span> </p><p><span m=''521549''>So</span> <span m=''521710''>here''s</span>
  <span m=''521919''>the</span> <span m=''522010''>deal.</span> <span m=''522220''>We</span>
  <span m=''522309''>have</span> <span m=''522490''>a</span> <span m=''522549''>user.</span>
  <span m=''522850''>And</span> <span m=''523330''>what</span> <span m=''523470''>he</span>
  <span m=''523559''>does,</span> <span m=''523860''>as</span> <span m=''524000''>I''ve</span>
  <span m=''524179''>indicated</span> <span m=''524590''>at</span> <span m=''524660''>the</span>
  <span m=''524730''>bottom,</span> <span m=''525320''>is</span> <span m=''525460''>that</span>
  <span m=''525520''>he</span> <span m=''525610''>wants</span> <span m=''525770''>to</span>
  <span m=''525850''>get</span> <span m=''525950''>the</span> <span m=''526020''>CPU</span>
  <span m=''526410''>usage</span> <span m=''526660''>for the</span> <span m=''526720''>last</span>
  <span m=''527050''>hour.</span> <span m=''527680''>So</span> <span m=''527970''>he</span>
  <span m=''528080''>just</span> <span m=''528260''>writes</span> <span m=''528490''>a</span>
  <span m=''528550''>simple</span> <span m=''528860''>script,</span> <span m=''529130''>using</span>
  <span m=''529720''>PowerShell.</span> <span m=''529980''>It</span> <span m=''530030''>doesn''t</span>
  <span m=''530240''>really</span> <span m=''530420''>matter</span> <span m=''530700''>what</span>
  <span m=''530840''>the</span> <span m=''530910''>syntax</span> <span m=''531480''>is.</span>
  <span m=''531620''>But</span> <span m=''531750''>the</span> <span m=''531830''>point
  is,</span> <span m=''532010''>he</span> <span m=''532140''>does</span> <span m=''532300''>what''s</span>
  <span m=''532480''>called</span> <span m=''532640''>a</span> <span m=''532770''>get-stats</span>
  <span m=''533340''>call.</span> <span m=''533880''>And he</span> <span m=''534060''>indicates,</span>
  <span m=''534590''>OK,</span> <span m=''534790''>I</span> <span m=''534830''>want</span>
  <span m=''535140''>this</span> <span m=''535690''>virtual</span> <span m=''536170''>machine.</span>
  <span m=''536660''>I</span> <span m=''536710''>want</span> <span m=''536950''>this</span>
  <span m=''537250''>stat,</span> <span m=''537550''>whatever.</span> <span m=''538090''>And</span>
  <span m=''538230''>then</span> <span m=''538310''>he</span> <span m=''538400''>gets</span>
  <span m=''538590''>his</span> <span m=''538700''>information</span> <span m=''539200''>and
  writes</span> <span m=''539450''>it to</span> <span m=''539630''>a</span> <span
  m=''539680''>file.</span> </p><p><span m=''540530''>No</span> <span m=''540750''>big</span>
  <span m=''540930''>deal.</span> <span m=''541260''>It''s</span> <span m=''541360''>just</span>
  <span m=''541540''>a</span> <span m=''541590''>simple</span> <span m=''541890''>script</span>
  <span m=''542250''>to</span> <span m=''542340''>get</span> <span m=''542520''>some</span>
  <span m=''542640''>statistics.</span> <span m=''543570''>Now,</span> <span m=''544020''>here''s</span>
  <span m=''544230''>what</span> <span m=''544400''>is</span> <span m=''544660''>actually</span>
  <span m=''545020''>interesting.</span> <span m=''546440''>I</span> <span m=''546550''>wrote</span>
  <span m=''546790''>that</span> <span m=''546970''>script</span> <span m=''547480''>using</span>
  <span m=''548080''>PowerShell.</span> <span m=''549440''>Now,</span> <span m=''549600''>let''s</span>
  <span m=''549850''>compare</span> <span m=''550340''>a</span> <span m=''550490''>PowerShell</span>
  <span m=''551040''>implementation</span> <span m=''551840''>to</span> <span m=''552030''>a</span>
  <span m=''552060''>highly</span> <span m=''552470''>tuned</span> <span m=''552780''>Java</span>
  <span m=''553150''>implementation</span> <span m=''554060''>of</span> <span m=''554230''>the</span>
  <span m=''554330''>very</span> <span m=''554720''>same</span> <span m=''555010''>script.</span>
  </p><p><span m=''555900''>Now,</span> <span m=''556140''>what</span> <span m=''556320''>I''ve</span>
  <span m=''556440''>done</span> <span m=''556650''>here is</span> <span m=''556800''>I''ve</span>
  <span m=''556890''>shown</span> <span m=''557810''>the</span> <span m=''558050''>performance</span>
  <span m=''558590''>of</span> <span m=''558630''>that</span> <span m=''558730''>very</span>
  <span m=''558960''>same</span> <span m=''559170''>script</span> <span m=''559620''>when</span>
  <span m=''559900''>getting</span> <span m=''560170''>data</span> <span m=''560400''>for</span>
  <span m=''560530''>one</span> <span m=''560780''>virtual</span> <span m=''561130''>machine,</span>
  <span m=''561520''>which</span> <span m=''561600''>is</span> <span m=''561700''>the</span>
  <span m=''561740''>first</span> <span m=''562070''>row,</span> <span m=''562790''>six,</span>
  <span m=''564060''>about</span> <span m=''564340''>40.</span> <span m=''564700''>And</span>
  <span m=''564860''>then</span> <span m=''564960''>up</span> <span m=''565040''>to</span>
  <span m=''565510''>a</span> <span m=''565550''>little</span> <span m=''565730''>over</span>
  <span m=''565870''>300</span> <span m=''566300''>virtual</span> <span m=''566630''>machines.</span>
  <span m=''567330''>Look</span> <span m=''567680''>at</span> <span m=''567790''>the</span>
  <span m=''567870''>scaling</span> <span m=''568710''>of</span> <span m=''569090''>this</span>
  <span m=''569390''>script.</span> <span m=''569870''>In</span> <span m=''570010''>the</span>
  <span m=''570720''>middle</span> <span m=''571620''>column,</span> <span m=''572130''>I</span>
  <span m=''572300''>have</span> <span m=''572720''>the</span> <span m=''573040''>performance</span>
  <span m=''573510''>for</span> <span m=''573570''>this</span> <span m=''573720''>PowerCLI</span>
  <span m=''574400''>script</span> <span m=''574490''>that</span> <span m=''574640''>I</span>
  <span m=''574690''>just</span> <span m=''574910''>showed</span> <span m=''575150''>you</span>
  <span m=''575220''>on</span> <span m=''575280''>the</span> <span m=''575350''>previous</span>
  <span m=''575750''>slide.</span> <span m=''576280''>As</span> <span m=''576460''>you</span>
  <span m=''576550''>can</span> <span m=''576690''>see,</span> <span m=''576840''>it</span>
  <span m=''576910''>goes</span> <span m=''577140''>from</span> <span m=''577310''>a</span>
  <span m=''577350''>healthy</span> <span m=''577700''>9.2</span> <span m=''578580''>seconds</span>
  <span m=''579310''>to</span> <span m=''579430''>over</span> <span m=''579700''>43</span>
  <span m=''580530''>minutes</span> <span m=''581300''>if</span> <span m=''581450''>you</span>
  <span m=''581580''>increase</span> <span m=''582010''>the</span> <span m=''582090''>size</span>
  <span m=''582390''>of</span> <span m=''582490''>your</span> <span m=''582620''>inventory.</span>
  <span m=''583270''>In</span> <span m=''583490''>contrast,</span> <span m=''584050''>if</span>
  <span m=''584120''>you</span> <span m=''584210''>use</span> <span m=''584380''>a</span>
  <span m=''584460''>Java-based</span> <span m=''585150''>implementation,</span> <span
  m=''586050''>it</span> <span m=''586200''>starts</span> <span m=''586480''>a</span>
  <span m=''586540''>little</span> <span m=''586740''>slower</span> <span m=''587010''>than</span>
  <span m=''587140''>PowerCLI</span> <span m=''587450''>at</span> <span m=''587780''>14</span>
  <span m=''588120''>seconds.</span> <span m=''588430''>But</span> <span m=''588550''>the</span>
  <span m=''588630''>scaling</span> <span m=''589090''>is</span> <span m=''589240''>far</span>
  <span m=''589500''>superior.</span> <span m=''590030''>It</span> <span m=''590100''>ends</span>
  <span m=''590240''>up</span> <span m=''590320''>at</span> <span m=''590430''>50</span>
  <span m=''590730''>seconds.</span> </p><p><span m=''592110''>So</span> <span m=''592280''>the</span>
  <span m=''592370''>question</span> <span m=''592840''>is</span> <span m=''593240''>why?</span>
  <span m=''594010''>What''s</span> <span m=''594490''>different</span> <span m=''594830''>about</span>
  <span m=''595070''>these</span> <span m=''595180''>scripts</span> <span m=''595600''>at</span>
  <span m=''595830''>scale</span> <span m=''596510''>versus</span> <span m=''596800''>when</span>
  <span m=''596970''>I</span> <span m=''597040''>wrote</span> <span m=''597280''>the</span>
  <span m=''597360''>little</span> <span m=''597580''>toy</span> <span m=''597820''>script?</span>
  <span m=''598360''>Now,</span> <span m=''598450''>to</span> <span m=''598510''>give</span>
  <span m=''598670''>you</span> <span m=''598780''>some</span> <span m=''598970''>color,</span>
  <span m=''599320''>why</span> <span m=''599570''>this</span> <span m=''599730''>matters</span>
  <span m=''600000''>to</span> <span m=''600080''>someone</span> <span m=''600360''>like</span>
  <span m=''600530''>me</span> <span m=''600690''>is</span> <span m=''601160''>that</span>
  <span m=''601270''>every</span> <span m=''601470''>once in</span> <span m=''601620''>a
  while,</span> <span m=''601840''>I''ll</span> <span m=''601890''>get</span> <span
  m=''602100''>a</span> <span m=''602240''>call</span> <span m=''602310''>from</span>
  <span m=''602440''>a</span> <span m=''602560''>system</span> <span m=''602780''>admin,</span>
  <span m=''603160''>who</span> <span m=''603260''>wants</span> <span m=''603480''>a</span>
  <span m=''603520''>very</span> <span m=''603740''>simple</span> <span m=''604000''>script</span>
  <span m=''604270''>that</span> <span m=''604410''>does</span> <span m=''604680''>blah.</span>
  <span m=''605190''>And</span> <span m=''605330''>they</span> <span m=''605470''>say,</span>
  <span m=''605760''>I</span> <span m=''606050''>wrote</span> <span m=''606120''>this
  simple</span> <span m=''606460''>script</span> <span m=''606990''>in</span> <span
  m=''607110''>my</span> <span m=''607220''>development</span> <span m=''607710''>environment,</span>
  <span m=''608210''>and it worked</span> <span m=''608460''>fine.</span> <span m=''608640''>But</span>
  <span m=''608760''>then</span> <span m=''608870''>I</span> <span m=''608920''>run
  it</span> <span m=''609120''>in</span> <span m=''609170''>my</span> <span m=''609280''>production</span>
  <span m=''609660''>environment,</span> <span m=''610220''>and</span> <span m=''610370''>it</span>
  <span m=''610410''>completely</span> <span m=''610850''>breaks.</span> <span m=''611220''>What''s</span>
  <span m=''611500''>going</span> <span m=''611750''>on?</span> </p><p><span m=''612160''>So</span>
  <span m=''612320''>often,</span> <span m=''612600''>problems</span> <span m=''612890''>like</span>
  <span m=''613010''>this</span> <span m=''613190''>actually</span> <span m=''613550''>occur.</span>
  <span m=''614240''>Now</span> <span m=''614740''>I''m</span> <span m=''614910''>calling</span>
  <span m=''615200''>this</span> <span m=''615350''>garbage</span> <span m=''615690''>in,</span>
  <span m=''615780''>garbage</span> <span m=''616100''>out,</span> <span m=''616250''>because</span>
  <span m=''616480''>you</span> <span m=''616590''>can</span> <span m=''616700''>see</span>
  <span m=''616910''>that</span> <span m=''617030''>with</span> <span m=''617190''>PowerCLI</span>
  <span m=''617550''>and</span> <span m=''617770''>Java,</span> <span m=''618020''>we''re</span>
  <span m=''618150''>getting</span> <span m=''618330''>very</span> <span m=''618610''>different</span>
  <span m=''618850''>results.</span> <span m=''619550''>The</span> <span m=''619660''>deal</span>
  <span m=''619980''>is</span> <span m=''620170''>that</span> <span m=''620280''>in</span>
  <span m=''620400''>PowerCLI,</span> <span m=''621420''>I</span> <span m=''621540''>wrote</span>
  <span m=''621760''>a</span> <span m=''621840''>very</span> <span m=''622340''>naive</span>
  <span m=''622800''>script.</span> <span m=''623190''>And</span> <span m=''623270''>I''ll</span>
  <span m=''623400''>explain</span> <span m=''623860''>how</span> <span m=''624130''>in</span>
  <span m=''624190''>a</span> <span m=''624240''>moment.</span> <span m=''625330''>And</span>
  <span m=''625500''>that</span> <span m=''625590''>very</span> <span m=''625840''>naive</span>
  <span m=''626110''>script</span> <span m=''626340''>has</span> <span m=''626440''>not</span>
  <span m=''626760''>performed</span> <span m=''627230''>at</span> <span m=''627300''>all.</span>
  <span m=''627560''>Whereas</span> <span m=''627910''>in</span> <span m=''628010''>Java,</span>
  <span m=''628540''>I</span> <span m=''628680''>wrote</span> <span m=''628830''>a</span>
  <span m=''628860''>very</span> <span m=''629070''>highly</span> <span m=''629500''>tuned</span>
  <span m=''629830''>script.</span> <span m=''630640''>And</span> <span m=''630850''>it
  ended up</span> <span m=''631170''>taking</span> <span m=''631690''>about</span>
  <span m=''631890''>an</span> <span m=''631970''>order of</span> <span m=''632240''>magnitude</span>
  <span m=''632710''>less</span> <span m=''632980''>time.</span> </p><p><span m=''633390''>So</span>
  <span m=''633910''>garbage in,</span> <span m=''634300''>garbage</span> <span m=''634680''>out.</span>
  <span m=''634830''>Good</span> <span m=''634970''>stuff</span> <span m=''635210''>in,</span>
  <span m=''635390''>good</span> <span m=''635560''>stuff</span> <span m=''635780''>out.</span>
  <span m=''636290''>Let''s</span> <span m=''636530''>try</span> <span m=''636750''>to</span>
  <span m=''636850''>understand</span> <span m=''637500''>why.</span> <span m=''639460''>OK.</span>
  <span m=''640040''>Here''s</span> <span m=''640240''>the</span> <span m=''640320''>deal.</span>
  <span m=''641310''>All</span> <span m=''641480''>of</span> <span m=''641580''>you</span>
  <span m=''641650''>are</span> <span m=''641700''>probably</span> <span m=''641980''>familiar</span>
  <span m=''642280''>with</span> <span m=''642360''>the</span> <span m=''642430''>difference</span>
  <span m=''642760''>between</span> <span m=''642960''>scripting</span> <span m=''643380''>and</span>
  <span m=''643460''>high</span> <span m=''643620''>level</span> <span m=''643880''>languages,</span>
  <span m=''644410''>or</span> <span m=''644560''>low</span> <span m=''644780''>level</span>
  <span m=''645230''>languages</span> <span m=''645410''>or</span> <span m=''645480''>whatever
  you</span> <span m=''645610''>want to</span> <span m=''645670''>call them.</span>
  </p><p><span m=''645980''>So</span> <span m=''646070''>the</span> <span m=''646170''>idea</span>
  <span m=''646370''>is</span> <span m=''646450''>that</span> <span m=''646730''>if</span>
  <span m=''646840''>you''re</span> <span m=''646970''>running</span> <span m=''647180''>something</span>
  <span m=''647670''>using</span> <span m=''648000''>a</span> <span m=''648040''>shell</span>
  <span m=''648320''>script</span> <span m=''648630''>or</span> <span m=''648680''>running</span>
  <span m=''648900''>Pearl,</span> <span m=''649160''>or</span> <span m=''649310''>whatever.</span>
  <span m=''650440''>These</span> <span m=''650750''>things</span> <span m=''650960''>are</span>
  <span m=''651000''>usually</span> <span m=''651360''>meant</span> <span m=''651670''>for</span>
  <span m=''651820''>ease</span> <span m=''652040''>of</span> <span m=''652140''>use.</span>
  <span m=''652360''>But</span> <span m=''652480''>they''re</span> <span m=''652570''>not</span>
  <span m=''652900''>necessarily</span> <span m=''653760''>meant</span> <span m=''654020''>for</span>
  <span m=''654150''>performance</span> <span m=''654650''>reasons.</span> <span m=''655140''>And</span>
  <span m=''655290''>so</span> <span m=''655410''>they</span> <span m=''655510''>hide</span>
  <span m=''655840''>a</span> <span m=''655910''>lot</span> <span m=''656100''>of</span>
  <span m=''656180''>details</span> <span m=''656580''>from</span> <span m=''656690''>the</span>
  <span m=''656790''>users</span> <span m=''657120''>so that it''s</span> <span m=''657410''>easier</span>
  <span m=''657680''>to</span> <span m=''657760''>come</span> <span m=''657910''>to</span>
  <span m=''658130''>a quick</span> <span m=''658200''>prototype.</span> <span m=''659210''>You</span>
  <span m=''659320''>don''t</span> <span m=''659450''>have</span> <span m=''659570''>to</span>
  <span m=''659640''>declare</span> <span m=''660010''>variables.</span> <span m=''660330''>Do
  all</span> <span m=''660650''>this</span> <span m=''660890''>kind</span> <span m=''661000''>of</span>
  <span m=''661090''>junk,</span> <span m=''661480''>right,</span> <span m=''661920''>if</span>
  <span m=''662040''>you''re</span> <span m=''662130''>using</span> <span m=''662340''>scripting</span>
  <span m=''662730''>language.</span> </p><p><span m=''663210''>In</span> <span m=''663370''>contrast,</span>
  <span m=''663860''>if you''re</span> <span m=''663950''>using,</span> <span m=''664240''>Java,</span>
  <span m=''664590''>C++,</span> <span m=''665170''>whatever,</span> <span m=''665510''>you</span>
  <span m=''665610''>have</span> <span m=''666150''>Typesafe</span> <span m=''666655''>and
  all this</span> <span m=''666910''>nonsense.</span> <span m=''667320''>You</span>
  <span m=''667390''>have</span> <span m=''667470''>to</span> <span m=''667570''>worry</span>
  <span m=''667850''>about</span> <span m=''668080''>what</span> <span m=''668230''>the</span>
  <span m=''668330''>declarations</span> <span m=''668850''>of your</span> <span m=''669030''>variables</span>
  <span m=''669460''>are.</span> <span m=''669760''>Make</span> <span m=''669960''>sure</span>
  <span m=''670070''>they''re</span> <span m=''670210''>correct</span> <span m=''670480''>types,</span>
  <span m=''670750''>et</span> <span m=''670960''>cetera.</span> <span m=''671180''>So</span>
  <span m=''671640''>they</span> <span m=''671780''>tend</span> <span m=''671970''>to</span>
  <span m=''672030''>be</span> <span m=''672130''>more</span> <span m=''672310''>difficult</span>
  <span m=''672770''>to</span> <span m=''672850''>get</span> <span m=''673030''>running.</span>
  <span m=''673600''>But</span> <span m=''673800''>once</span> <span m=''674790''>you</span>
  <span m=''674870''>get</span> <span m=''675030''>them</span> <span m=''675110''>running,</span>
  <span m=''675530''>you</span> <span m=''675640''>can use</span> <span m=''675770''>a</span>
  <span m=''675830''>lot</span> <span m=''676050''>of</span> <span m=''676120''>advanced</span>
  <span m=''677000''>tools</span> <span m=''677570''>that</span> <span m=''677730''>just</span>
  <span m=''677910''>aren''t</span> <span m=''678070''>available</span> <span m=''678580''>necessarily</span>
  <span m=''679140''>in</span> <span m=''679250''>toolkits.</span> </p><p><span m=''680090''>And</span>
  <span m=''680250''>we''re</span> <span m=''680360''>going</span> <span m=''680440''>to</span>
  <span m=''680530''>talk</span> <span m=''680810''>about</span> <span m=''681040''>how</span>
  <span m=''681320''>this</span> <span m=''681800''>difference</span> <span m=''683300''>manifested</span>
  <span m=''683870''>itself</span> <span m=''684150''>in</span> <span m=''684210''>this</span>
  <span m=''684330''>particular</span> <span m=''684740''>problem.</span> <span m=''686100''>I</span>
  <span m=''686330''>said</span> <span m=''686640''>that</span> <span m=''686750''>when</span>
  <span m=''686910''>I</span> <span m=''686990''>told</span> <span m=''687230''>the</span>
  <span m=''687310''>customer</span> <span m=''687720''>to write</span> <span m=''687920''>a
  simple</span> <span m=''688210''>PowerCLI</span> <span m=''688820''>script,</span>
  <span m=''689360''>they</span> <span m=''689480''>just</span> <span m=''689670''>have</span>
  <span m=''689770''>to</span> <span m=''689850''>do</span> <span m=''689970''>one</span>
  <span m=''690280''>call.</span> <span m=''690950''>Get-stat.</span> <span m=''691930''>And</span>
  <span m=''692120''>here''s</span> <span m=''692310''>a</span> <span m=''692370''>bunch</span>
  <span m=''692600''>of</span> <span m=''692800''>arguments</span> <span m=''693270''>to</span>
  <span m=''693360''>tell</span> <span m=''693560''>it</span> <span m=''693700''>what</span>
  <span m=''693870''>statistic</span> <span m=''694310''>it</span> <span m=''694380''>wants</span>
  <span m=''694610''>to</span> <span m=''694700''>grab.</span> <span m=''695720''>It''s</span>
  <span m=''695910''>a</span> <span m=''696240''>toolkit.</span> <span m=''696670''>It''s</span>
  <span m=''696910''>doing</span> <span m=''697150''>a</span> <span m=''697210''>lot</span>
  <span m=''697430''>of</span> <span m=''697520''>work</span> <span m=''697900''>for</span>
  <span m=''698240''>you.</span> </p><p><span m=''698660''>What''s</span> <span m=''699050''>it</span>
  <span m=''699130''>doing</span> <span m=''699360''>for</span> <span m=''699620''>you?</span>
  <span m=''699760''>Well,</span> <span m=''700190''>it</span> <span m=''700300''>turns</span>
  <span m=''700530''>out</span> <span m=''700600''>it''s</span> <span m=''700730''>calling</span>
  <span m=''701030''>our</span> <span m=''701150''>internal</span> <span m=''701550''>APIs.</span>
  <span m=''702230''>Our</span> <span m=''702450''>internal</span> <span m=''702990''>APIs</span>
  <span m=''703250''>have</span> <span m=''703430''>to</span> <span m=''703540''>work</span>
  <span m=''703770''>for a</span> <span m=''703950''>variety</span> <span m=''704390''>of
  different</span> <span m=''704520''>platforms.</span> <span m=''704880''>So</span>
  <span m=''704990''>they</span> <span m=''705090''>have</span> <span m=''705200''>to</span>
  <span m=''705290''>be</span> <span m=''705600''>incredibly</span> <span m=''706060''>general.</span>
  <span m=''706970''>Under</span> <span m=''707280''>the</span> <span m=''707420''>covers</span>
  <span m=''707800''>of</span> <span m=''707890''>that</span> <span m=''708100''>single</span>
  <span m=''708460''>get-stat</span> <span m=''709000''>call,</span> <span m=''709540''>we</span>
  <span m=''709790''>have</span> <span m=''709950''>about</span> <span m=''710180''>seven</span>
  <span m=''710590''>different</span> <span m=''710890''>steps</span> <span m=''711260''>that
  are</span> <span m=''711350''>going</span> <span m=''711650''>on,</span> <span m=''712230''>ranging</span>
  <span m=''712690''>from</span> <span m=''712980''>asking,</span> <span m=''713670''>OK,</span>
  <span m=''713940''>I</span> <span m=''714060''>want</span> <span m=''714190''>a</span>
  <span m=''714230''>stat</span> <span m=''714550''>for a</span> <span m=''714640''>virtual</span>
  <span m=''715010''>machine,</span> <span m=''715340''>what</span> <span m=''715500''>kinds</span>
  <span m=''715730''>of</span> <span m=''715790''>stats</span> <span m=''716210''>does</span>
  <span m=''716290''>that</span> <span m=''717000''>virtual</span> <span m=''717360''>machine</span>
  <span m=''717660''>export?</span> <span m=''718480''>How</span> <span m=''718670''>frequently</span>
  <span m=''719210''>does it</span> <span m=''719470''>update?</span> <span m=''719980''>All</span>
  <span m=''720210''>kinds</span> <span m=''720400''>of</span> <span m=''720470''>information</span>
  <span m=''720910''>that you</span> <span m=''721030''>probably</span> <span m=''721350''>don''t</span>
  <span m=''721710''>really</span> <span m=''721920''>care about</span> <span m=''722150''>if
  all</span> <span m=''722550''>you</span> <span m=''722630''>want</span> <span m=''722790''>is</span>
  <span m=''722880''>a</span> <span m=''722940''>single</span> <span m=''723230''>stat.</span>
  <span m=''723810''>But</span> <span m=''723970''>you</span> <span m=''724070''>might</span>
  <span m=''724410''>care</span> <span m=''724630''>about if you''re</span> <span
  m=''724980''>writing</span> <span m=''725260''>a</span> <span m=''725320''>production</span>
  <span m=''725760''>quality</span> <span m=''726100''>script.</span> </p><p><span
  m=''726690''>So</span> <span m=''726850''>the</span> <span m=''726920''>point</span>
  <span m=''727120''>is</span> <span m=''727280''>get-stat</span> <span m=''727770''>does</span>
  <span m=''727980''>these</span> <span m=''728160''>seven</span> <span m=''728510''>calls.</span>
  <span m=''729080''>And</span> <span m=''729230''>because</span> <span m=''729510''>you''re</span>
  <span m=''729610''>using</span> <span m=''729890''>a</span> <span m=''729980''>toolkit,</span>
  <span m=''730965''>it</span> <span m=''731290''>hides</span> <span m=''731710''>them</span>
  <span m=''731860''>all</span> <span m=''732000''>from</span> <span m=''732220''>you.</span>
  <span m=''733620''>It</span> <span m=''733760''>spares</span> <span m=''734130''>it.</span>
  <span m=''734260''>It''s</span> <span m=''734800''>very</span> <span m=''735060''>easy</span>
  <span m=''735300''>to</span> <span m=''735350''>use.</span> <span m=''735990''>But</span>
  <span m=''736170''>it</span> <span m=''736270''>turns</span> <span m=''736580''>out,</span>
  <span m=''736840''>this</span> <span m=''736970''>is</span> <span m=''737130''>obviously</span>
  <span m=''737590''>not</span> <span m=''737880''>the</span> <span m=''737950''>most</span>
  <span m=''738290''>optimal</span> <span m=''738630''>way</span> <span m=''738810''>to</span>
  <span m=''738890''>do</span> <span m=''739040''>this.</span> <span m=''739230''>And</span>
  <span m=''739310''>I</span> <span m=''739400''>illustrate</span> <span m=''739930''>that</span>
  <span m=''740150''>by</span> <span m=''740250''>showing</span> <span m=''740600''>you</span>
  <span m=''741080''>conceptually</span> <span m=''741700''>what''s</span> <span m=''741900''>actually</span>
  <span m=''742270''>going</span> <span m=''742540''>on.</span> </p><p><span m=''743600''>On</span>
  <span m=''743830''>the</span> <span m=''743930''>right,</span> <span m=''744520''>I</span>
  <span m=''744580''>guess</span> <span m=''744760''>on</span> <span m=''744890''>your</span>
  <span m=''745030''>left,</span> <span m=''745880''>I''ve</span> <span m=''746040''>got</span>
  <span m=''746230''>what</span> <span m=''746370''>the</span> <span m=''746450''>PowerCLI</span>
  <span m=''747250''>script</span> <span m=''747560''>was doing.</span> <span m=''747950''>You</span>
  <span m=''748130''>call</span> <span m=''748390''>this</span> <span m=''748600''>get-stat</span>
  <span m=''749080''>call,</span> <span m=''749340''>or</span> <span m=''749370''>whatever,</span>
  <span m=''749690''>and what</span> <span m=''749880''>it</span> <span m=''749980''>does</span>
  <span m=''750210''>that</span> <span m=''750360''>for</span> <span m=''750480''>every</span>
  <span m=''750640''>virtual</span> <span m=''751070''>machine</span> <span m=''751450''>that
  you</span> <span m=''751590''>want</span> <span m=''751830''>this</span> <span m=''751910''>statistic</span>
  <span m=''752440''>for,</span> <span m=''752800''>it</span> <span m=''752960''>goes</span>
  <span m=''753240''>through</span> <span m=''753410''>and does</span> <span m=''753530''>all</span>
  <span m=''753670''>these</span> <span m=''753820''>random</span> <span m=''754190''>steps</span>
  <span m=''754530''>that</span> <span m=''754670''>were</span> <span m=''754790''>done</span>
  <span m=''755140''>that</span> <span m=''755270''>I</span> <span m=''755330''>described</span>
  <span m=''755730''>in</span> <span m=''755790''>the</span> <span m=''755860''>previous</span>
  <span m=''756280''>slide.</span> <span m=''756870''>Figuring</span> <span m=''757180''>out</span>
  <span m=''757330''>what</span> <span m=''757520''>stats</span> <span m=''757810''>are</span>
  <span m=''757880''>supported,</span> <span m=''758400''>how</span> <span m=''758520''>frequently</span>
  <span m=''758850''>they</span> <span m=''759180''>updated,</span> <span m=''759790''>and</span>
  <span m=''759920''>then</span> <span m=''760020''>actually</span> <span m=''760260''>going</span>
  <span m=''760590''>and getting</span> <span m=''760860''>the</span> <span m=''761050''>stat.</span>
  </p><p><span m=''761680''>It</span> <span m=''761840''>turns</span> <span m=''762170''>out,</span>
  <span m=''762420''>as</span> <span m=''762560''>I</span> <span m=''762620''>show</span>
  <span m=''762840''>on</span> <span m=''762930''>the</span> <span m=''763010''>right,</span>
  <span m=''763300''>when</span> <span m=''763410''>I</span> <span m=''763460''>do</span>
  <span m=''763570''>this</span> <span m=''763650''>in</span> <span m=''763830''>Java,</span>
  <span m=''764150''>I</span> <span m=''764270''>can</span> <span m=''764430''>take</span>
  <span m=''764640''>advantage</span> <span m=''765050''>of</span> <span m=''765120''>the</span>
  <span m=''765190''>fact</span> <span m=''765520''>that</span> <span m=''767110''>a</span>
  <span m=''767250''>lot</span> <span m=''767460''>of</span> <span m=''767540''>those</span>
  <span m=''767730''>things that</span> <span m=''767970''>I''m</span> <span m=''768120''>asking</span>
  <span m=''768550''>about</span> <span m=''768790''>in</span> <span m=''768930''>the</span>
  <span m=''769070''>toolkit,</span> <span m=''770420''>they</span> <span m=''770640''>never</span>
  <span m=''771160''>change.</span> <span m=''771800''>You''ve</span> <span m=''771920''>got</span>
  <span m=''772040''>a</span> <span m=''772080''>good</span> <span m=''772310''>virtual</span>
  <span m=''772620''>machine.</span> <span m=''773050''>It</span> <span m=''773190''>supports</span>
  <span m=''773600''>things</span> <span m=''773800''>to</span> <span m=''773880''>be</span>
  <span m=''774170''>refreshed</span> <span m=''774600''>every</span> <span m=''775110''>20</span>
  <span m=''775360''>seconds</span> <span m=''775710''>or</span> <span m=''775760''>whatever.</span>
  <span m=''776220''>That</span> <span m=''776550''>never</span> <span m=''776900''>changes.</span>
  <span m=''777520''>You</span> <span m=''777670''>want</span> <span m=''777800''>to</span>
  <span m=''777850''>find</span> <span m=''778050''>out</span> <span m=''778100''>what</span>
  <span m=''778240''>statistics</span> <span m=''778700''>are</span> <span m=''778800''>supported.</span>
  <span m=''779260''>Well,</span> <span m=''779480''>those</span> <span m=''779790''>never</span>
  <span m=''780340''>change</span> <span m=''780760''>once</span> <span m=''781000''>you''ve</span>
  <span m=''781100''>configured</span> <span m=''781530''>it and</span> <span m=''781630''>you</span>
  <span m=''781700''>don''t</span> <span m=''781870''>change</span> <span m=''782130''>anything.</span>
  <span m=''782610''>So</span> <span m=''782830''>why</span> <span m=''783140''>do</span>
  <span m=''783330''>that</span> <span m=''783610''>every</span> <span m=''783920''>single</span>
  <span m=''784300''>time?</span> </p><p><span m=''784910''>So</span> <span m=''785450''>as</span>
  <span m=''785690''>we</span> <span m=''785720''>show in</span> <span m=''786040''>Java,</span>
  <span m=''787220''>you</span> <span m=''787380''>can</span> <span m=''787580''>pull</span>
  <span m=''787790''>a</span> <span m=''787840''>lot</span> <span m=''788220''>of</span>
  <span m=''788280''>that</span> <span m=''788470''>stuff</span> <span m=''788750''>out</span>
  <span m=''788910''>of</span> <span m=''788980''>the</span> <span m=''789080''>main</span>
  <span m=''789390''>body</span> <span m=''789750''>of</span> <span m=''789830''>the</span>
  <span m=''789920''>loop.</span> <span m=''790370''>And</span> <span m=''790550''>if</span>
  <span m=''790640''>you</span> <span m=''790750''>wanted</span> <span m=''791210''>information</span>
  <span m=''791650''>for every</span> <span m=''791820''>VM</span> <span m=''792150''>in</span>
  <span m=''792210''>the</span> <span m=''792280''>system,</span> <span m=''792600''>you</span>
  <span m=''792700''>only</span> <span m=''792870''>have</span> <span m=''792980''>to</span>
  <span m=''793080''>make</span> <span m=''793260''>one</span> <span m=''793560''>call,</span>
  <span m=''794210''>as</span> <span m=''794400''>I</span> <span m=''794460''>show</span>
  <span m=''794690''>at the</span> <span m=''794760''>very</span> <span m=''795000''>bottom,</span>
  <span m=''795520''>for</span> <span m=''795690''>every</span> <span m=''796000''>VM.</span>
  <span m=''796080''>You</span> <span m=''796150''>don''t</span> <span m=''796260''>have</span>
  <span m=''796340''>to</span> <span m=''796430''>make</span> <span m=''796630''>seven</span>
  <span m=''797050''>different</span> <span m=''797350''>RPC</span> <span m=''797830''>calls.</span>
  <span m=''799070''>In</span> <span m=''799230''>fact,</span> <span m=''799500''>you</span>
  <span m=''799570''>could</span> <span m=''799710''>further</span> <span m=''800030''>optimize,</span>
  <span m=''800400''>if</span> <span m=''800490''>you</span> <span m=''800600''>really</span>
  <span m=''800830''>understand</span> <span m=''801300''>the</span> <span m=''801430''>API,</span>
  <span m=''802110''>and</span> <span m=''802270''>collapse</span> <span m=''802660''>a</span>
  <span m=''802710''>few</span> <span m=''802930''>more</span> <span m=''803180''>calls</span>
  <span m=''803500''>in</span> <span m=''803610''>Java that</span> <span m=''804030''>you</span>
  <span m=''804120''>can''t</span> <span m=''804470''>do</span> <span m=''804560''>in</span>
  <span m=''804640''>the</span> <span m=''804720''>toolkit.</span> <span m=''805110''>Because</span>
  <span m=''805340''>again,</span> <span m=''805600''>the toolkit''s</span> <span
  m=''806110''>trying</span> <span m=''806300''>to</span> <span m=''806500''>talk</span>
  <span m=''806740''>at</span> <span m=''806800''>a</span> <span m=''806860''>high</span>
  <span m=''807060''>level,</span> <span m=''807330''>so</span> <span m=''807490''>any</span>
  <span m=''808130''>random</span> <span m=''808550''>dude</span> <span m=''808810''>can</span>
  <span m=''808940''>actually</span> <span m=''809170''>write</span> <span m=''809360''>a</span>
  <span m=''809410''>script.</span> </p><p><span m=''811040''>OK.</span> <span m=''811590''>So</span>
  <span m=''811890''>the</span> <span m=''811990''>point</span> <span m=''812280''>is</span>
  <span m=''812580''>in this</span> <span m=''812800''>PowerCLI</span> <span m=''813450''>world,</span>
  <span m=''813750''>a</span> <span m=''813790''>very</span> <span m=''814000''>simple</span>
  <span m=''814330''>toolkit</span> <span m=''814650''>world,</span> <span m=''815030''>we</span>
  <span m=''815230''>were</span> <span m=''815310''>making</span> <span m=''815580''>five</span>
  <span m=''816180''>RPC</span> <span m=''816700''>calls</span> <span m=''816940''>for</span>
  <span m=''817060''>every</span> <span m=''817440''>VM</span> <span m=''817560''>that</span>
  <span m=''817630''>we</span> <span m=''817690''>wanted</span> <span m=''817910''>stats
  for.</span> <span m=''818330''>Whereas</span> <span m=''818660''>in</span> <span
  m=''819000''>Java,</span> <span m=''819330''>we</span> <span m=''819430''>made</span>
  <span m=''819620''>one</span> <span m=''819870''>call.</span> <span m=''820210''>And</span>
  <span m=''820340''>we</span> <span m=''820430''>can</span> <span m=''820540''>even</span>
  <span m=''820710''>optimize</span> <span m=''821140''>that</span> <span m=''821320''>further.</span>
  <span m=''822560''>And</span> <span m=''822940''>I</span> <span m=''823000''>don''t</span>
  <span m=''823150''>show</span> <span m=''823340''>that</span> <span m=''823490''>here.</span>
  <span m=''823690''>But</span> <span m=''823820''>anyway,</span> <span m=''824060''>the</span>
  <span m=''824150''>bottom</span> <span m=''824410''>line</span> <span m=''824590''>is</span>
  <span m=''824720''>that''s</span> <span m=''825010''>why</span> <span m=''825970''>the</span>
  <span m=''826130''>performance</span> <span m=''826530''>of</span> <span m=''826580''>the</span>
  <span m=''826650''>Java script</span> <span m=''827300''>was</span> <span m=''827460''>so</span>
  <span m=''827670''>much</span> <span m=''827870''>faster.</span> </p><p><span m=''828810''>So</span>
  <span m=''829860''>the</span> <span m=''830020''>idea</span> <span m=''830230''>is</span>
  <span m=''830310''>that</span> <span m=''830420''>with</span> <span m=''830540''>PowerCLI</span>
  <span m=''831030''>what</span> <span m=''831210''>I</span> <span m=''831260''>do</span>
  <span m=''831390''>is</span> <span m=''831450''>I</span> <span m=''831530''>wrote</span>
  <span m=''831700''>very</span> <span m=''831990''>simple,</span> <span m=''832760''>a</span>
  <span m=''832840''>script</span> <span m=''833060''>that</span> <span m=''833180''>anybody</span>
  <span m=''833550''>could</span> <span m=''833680''>understand</span> <span m=''834080''>and
  use,</span> <span m=''834580''>but</span> <span m=''834780''>it''s</span> <span
  m=''834930''>not</span> <span m=''835140''>optimized.</span> <span m=''835810''>I</span>
  <span m=''835930''>didn''t</span> <span m=''836100''>utilize</span> <span m=''836530''>multi-threading.</span>
  <span m=''837390''>I</span> <span m=''837510''>didn''t</span> <span m=''837730''>realize</span>
  <span m=''838180''>that the</span> <span m=''838430''>output</span> <span m=''838700''>format</span>
  <span m=''839080''>of</span> <span m=''839130''>the</span> <span m=''839230''>data</span>
  <span m=''839510''>was</span> <span m=''839660''>really,</span> <span m=''840190''>really</span>
  <span m=''840470''>verbose.</span> <span m=''841000''>Again,</span> <span m=''841240''>that''s</span>
  <span m=''841420''>the</span> <span m=''841490''>kind</span> <span m=''841670''>of</span>
  <span m=''841770''>thing</span> <span m=''842000''>that</span> <span m=''842430''>if</span>
  <span m=''842550''>you</span> <span m=''842670''>really</span> <span m=''842900''>understand</span>
  <span m=''843170''>the</span> <span m=''843400''>APIs</span> <span m=''843540''>you</span>
  <span m=''843630''>can</span> <span m=''843720''>take</span> <span m=''843890''>advantage</span>
  <span m=''844260''>of.</span> </p><p><span m=''844660''>I</span> <span m=''844810''>also</span>
  <span m=''845070''>didn''t</span> <span m=''845280''>realize--</span> <span m=''845950''>as</span>
  <span m=''846060''>a</span> <span m=''846170''>customer,</span> <span m=''846530''>I</span>
  <span m=''846640''>wouldn''t</span> <span m=''846760''>have</span> <span m=''846860''>realized</span>
  <span m=''847270''>that</span> <span m=''847360''>I</span> <span m=''847410''>make</span>
  <span m=''847590''>this</span> <span m=''847720''>one</span> <span m=''847930''>call
  but</span> <span m=''848280''>it expands</span> <span m=''848550''>it to</span>
  <span m=''848820''>a</span> <span m=''848890''>bunch</span> <span m=''849150''>of</span>
  <span m=''849250''>different</span> <span m=''849530''>network</span> <span m=''850250''>requests</span>
  <span m=''850610''>that</span> <span m=''850970''>I</span> <span m=''851110''>didn''t</span>
  <span m=''851330''>know</span> <span m=''851550''>about.</span> <span m=''852680''>In</span>
  <span m=''852850''>contrast,</span> <span m=''853320''>with</span> <span m=''853430''>Java,</span>
  <span m=''853720''>I</span> <span m=''853780''>was</span> <span m=''853930''>able</span>
  <span m=''854070''>to</span> <span m=''854120''>take</span> <span m=''854320''>advantage</span>
  <span m=''854660''>of</span> <span m=''854710''>the</span> <span m=''854800''>power</span>
  <span m=''855830''>of a</span> <span m=''856000''>language</span> <span m=''856320''>like</span>
  <span m=''856490''>Java,</span> <span m=''856730''>where</span> <span m=''856860''>I</span>
  <span m=''856890''>could</span> <span m=''857030''>thread</span> <span m=''857520''>pools.</span>
  <span m=''858640''>I</span> <span m=''858730''>could</span> <span m=''859330''>optimize</span>
  <span m=''859860''>the</span> <span m=''860020''>return</span> <span m=''860370''>format</span>
  <span m=''860650''>of</span> <span m=''860820''>the</span> <span m=''860910''>data.</span>
  <span m=''861320''>And</span> <span m=''861410''>I</span> <span m=''861450''>could</span>
  <span m=''861570''>reduce</span> <span m=''861840''>the</span> <span m=''861900''>number</span>
  <span m=''862090''>of</span> <span m=''862160''>RPC</span> <span m=''862580''>calls.</span>
  </p><p><span m=''863660''>I</span> <span m=''863760''>guess</span> <span m=''863950''>the</span>
  <span m=''864050''>analogy</span> <span m=''864480''>I</span> <span m=''864590''>would</span>
  <span m=''864710''>give</span> <span m=''864950''>is</span> <span m=''865490''>if</span>
  <span m=''865640''>you</span> <span m=''865750''>think</span> <span m=''865920''>about</span>
  <span m=''866080''>assembly</span> <span m=''866470''>code</span> <span m=''866880''>versus</span>
  <span m=''867270''>compiler-generated</span> <span m=''867730''>code,</span> <span
  m=''867880''>nobody</span> <span m=''868210''>here wants</span> <span m=''868390''>to</span>
  <span m=''868450''>sit</span> <span m=''868610''>down</span> <span m=''868770''>and</span>
  <span m=''868850''>write</span> <span m=''868940''>x86</span> <span m=''869460''>Assembly.</span>
  <span m=''869800''>So,</span> <span m=''869980''>of</span> <span m=''870040''>course,</span>
  <span m=''870370''>you</span> <span m=''870530''>write</span> <span m=''870750''>C</span>
  <span m=''871050''>and you use</span> <span m=''871350''>GCC</span> <span m=''871800''>and</span>
  <span m=''871880''>whatever.</span> <span m=''872570''>But</span> <span m=''873100''>maybe</span>
  <span m=''873460''>there</span> <span m=''873610''>are</span> <span m=''873730''>some</span>
  <span m=''873970''>things</span> <span m=''874160''>that</span> <span m=''874180''>would</span>
  <span m=''874340''>actually</span> <span m=''874570''>be</span> <span m=''874680''>faster</span>
  <span m=''875000''>if</span> <span m=''875050''>you</span> <span m=''875190''>wrote</span>
  <span m=''875280''>hand</span> <span m=''875510''>assembly.</span> </p><p><span
  m=''877440''>OK.</span> <span m=''878290''>So,</span> <span m=''878920''>first</span>
  <span m=''879300''>example</span> <span m=''879700''>we</span> <span m=''879810''>gave</span>
  <span m=''880000''>was</span> <span m=''880160''>just</span> <span m=''880450''>understanding</span>
  <span m=''880870''>what</span> <span m=''881010''>on</span> <span m=''881220''>earth
  the</span> <span m=''881310''>problem</span> <span m=''881690''>was.</span> <span
  m=''882030''>The</span> <span m=''882120''>second</span> <span m=''882440''>example</span>
  <span m=''882830''>was</span> <span m=''883160''>if</span> <span m=''883330''>I</span>
  <span m=''883410''>write</span> <span m=''883970''>bad</span> <span m=''884330''>code,</span>
  <span m=''884640''>I''m</span> <span m=''884760''>going</span> <span m=''884940''>to</span>
  <span m=''885010''>usually</span> <span m=''885320''>get</span> <span m=''885500''>bad</span>
  <span m=''885690''>output.</span> <span m=''886220''>In</span> <span m=''886360''>the</span>
  <span m=''886450''>third</span> <span m=''886700''>case,</span> <span m=''886940''>I''m</span>
  <span m=''886980''>going</span> <span m=''887060''>to</span> <span m=''887110''>talk</span>
  <span m=''887350''>a</span> <span m=''887400''>little</span> <span m=''887610''>bit</span>
  <span m=''887810''>about</span> <span m=''888220''>the</span> <span m=''888380''>design</span>
  <span m=''888730''>of</span> <span m=''888800''>an</span> <span m=''888880''>API.</span>
  <span m=''889200''>And</span> <span m=''889360''>I''m</span> <span m=''889490''>going</span>
  <span m=''889570''>to</span> <span m=''889630''>motivate</span> <span m=''890080''>that</span>
  <span m=''890710''>by</span> <span m=''890930''>an</span> <span m=''891010''>example.</span>
  </p><p><span m=''891640''>We</span> <span m=''891830''>have</span> <span m=''892030''>an</span>
  <span m=''892300''>administrator</span> <span m=''892910''>on</span> <span m=''892990''>the</span>
  <span m=''893070''>right</span> <span m=''893260''>hand</span> <span m=''893440''>side.</span>
  <span m=''893700''>And he''s</span> <span m=''893800''>talking</span> <span m=''894070''>to</span>
  <span m=''894120''>the</span> <span m=''894210''>management</span> <span m=''894670''>server.</span>
  <span m=''895320''>This</span> <span m=''895510''>management</span> <span m=''895940''>server</span>
  <span m=''896340''>is</span> <span m=''896360''>responsible</span> <span m=''896820''>for</span>
  <span m=''896950''>telling</span> <span m=''897220''>that</span> <span m=''897440''>administrator</span>
  <span m=''898220''>what''s</span> <span m=''898660''>going</span> <span m=''898930''>in</span>
  <span m=''899160''>every</span> <span m=''899410''>host</span> <span m=''899700''>in</span>
  <span m=''899760''>the</span> <span m=''899830''>system,</span> <span m=''900240''>every</span>
  <span m=''900440''>virtual</span> <span m=''900830''>machine,</span> <span m=''901350''>whatever.</span>
  <span m=''902900''>So</span> <span m=''903200''>let''s</span> <span m=''903510''>pretend</span>
  <span m=''904340''>that</span> <span m=''904660''>the</span> <span m=''904820''>user</span>
  <span m=''905490''>wants--</span> <span m=''905850''>so</span> <span m=''905980''>this</span>
  <span m=''906160''>is</span> <span m=''906240''>a</span> <span m=''906290''>virtualized</span>
  <span m=''906820''>environment--</span> <span m=''907240''>so the</span> <span m=''907400''>idea
  is</span> <span m=''907540''>that</span> <span m=''907620''>the</span> <span m=''907680''>user</span>
  <span m=''907930''>wants to</span> <span m=''908160''>actually</span> <span m=''908460''>access</span>
  <span m=''908825''>his</span> <span m=''909190''>or</span> <span m=''909630''>her</span>
  <span m=''909810''>virtual</span> <span m=''910170''>machine.</span> </p><p><span
  m=''910930''>They''re</span> <span m=''911350''>running</span> <span m=''911540''>a</span>
  <span m=''911740''>Linux</span> <span m=''911940''>virtual</span> <span m=''912190''>machine.</span>
  <span m=''912360''>They</span> <span m=''912420''>want</span> <span m=''912590''>to</span>
  <span m=''912630''>see</span> <span m=''912810''>its</span> <span m=''912950''>console.</span>
  <span m=''913390''>So they</span> <span m=''913510''>can</span> <span m=''913650''>type</span>
  <span m=''913870''>at</span> <span m=''913970''>the</span> <span m=''914050''>console.</span>
  <span m=''916150''>Here''s</span> <span m=''916380''>how</span> <span m=''916530''>that</span>
  <span m=''916740''>roughly</span> <span m=''917080''>works.</span> <span m=''917260''>They</span>
  <span m=''917370''>want</span> <span m=''917540''>to</span> <span m=''917580''>see
  the</span> <span m=''917790''>console</span> <span m=''918220''>of</span> <span
  m=''918290''>the</span> <span m=''918440''>VM</span> <span m=''918520''>that I''ve</span>
  <span m=''918720''>circled.</span> <span m=''919420''>So</span> <span m=''919570''>the</span>
  <span m=''919670''>way</span> <span m=''919880''>it</span> <span m=''919970''>works</span>
  <span m=''920500''>is</span> <span m=''920650''>that</span> <span m=''920810''>this</span>
  <span m=''920960''>user</span> <span m=''921330''>talks</span> <span m=''921700''>to</span>
  <span m=''921800''>the</span> <span m=''921900''>management</span> <span m=''922420''>server.</span>
  <span m=''923900''>The</span> <span m=''924010''>management</span> <span m=''924500''>server</span>
  <span m=''924780''>locates</span> <span m=''925480''>that</span> <span m=''925710''>virtual</span>
  <span m=''926100''>machine,</span> <span m=''926510''>establishes</span> <span m=''927100''>a</span>
  <span m=''927490''>handshaking</span> <span m=''928040''>connection.</span> <span
  m=''928790''>And</span> <span m=''928930''>that</span> <span m=''929090''>connection</span>
  <span m=''929490''>is</span> <span m=''929630''>directly</span> <span m=''930080''>given</span>
  <span m=''930340''>back</span> <span m=''930630''>to</span> <span m=''930730''>that</span>
  <span m=''930990''>user.</span> </p><p><span m=''931470''>So</span> <span m=''931650''>now</span>
  <span m=''931910''>the</span> <span m=''932050''>user</span> <span m=''932360''>can
  interact</span> <span m=''932840''>directly</span> <span m=''933170''>with</span>
  <span m=''933290''>that</span> <span m=''933390''>virtual</span> <span m=''933770''>machine</span>
  <span m=''934230''>and</span> <span m=''934350''>send</span> <span m=''934590''>commands</span>
  <span m=''935330''>and</span> <span m=''935660''>do</span> <span m=''935850''>whatever.</span>
  <span m=''936960''>So</span> <span m=''937100''>we''ve</span> <span m=''937250''>all</span>
  <span m=''937410''>got</span> <span m=''937580''>the</span> <span m=''937640''>setup.</span>
  <span m=''939060''>Very</span> <span m=''939280''>simple.</span> <span m=''940350''>Now</span>
  <span m=''940470''>here''s</span> <span m=''940800''>the deal.</span> <span m=''941450''>The</span>
  <span m=''941570''>problem</span> <span m=''942300''>was</span> <span m=''942945''>that</span>
  <span m=''943250''>our poor</span> <span m=''943500''>little</span> <span m=''943680''>user,</span>
  <span m=''944040''>poor</span> <span m=''944400''>big</span> <span m=''944600''>user,</span>
  <span m=''944850''>whatever,</span> <span m=''945380''>they</span> <span m=''945620''>could</span>
  <span m=''945910''>not</span> <span m=''946160''>start</span> <span m=''946660''>this</span>
  <span m=''946970''>console</span> <span m=''947720''>when</span> <span m=''948160''>they</span>
  <span m=''948300''>were</span> <span m=''948480''>managing</span> <span m=''948920''>a</span>
  <span m=''949010''>large</span> <span m=''949580''>number</span> <span m=''950000''>of</span>
  <span m=''950070''>hosts.</span> </p><p><span m=''950940''>To</span> <span m=''951050''>take</span>
  <span m=''951260''>you</span> <span m=''951350''>back</span> <span m=''951630''>to</span>
  <span m=''951740''>this</span> <span m=''952090''>diagram</span> <span m=''952440''>for</span>
  <span m=''952520''>just</span> <span m=''952680''>a</span> <span m=''952730''>moment,</span>
  <span m=''953840''>on</span> <span m=''954050''>the</span> <span m=''954910''>right</span>
  <span m=''955110''>hand</span> <span m=''955290''>side</span> <span m=''955560''>of
  the screen,</span> <span m=''955820''>I</span> <span m=''955890''>show</span> <span
  m=''956070''>a</span> <span m=''956110''>number</span> <span m=''956360''>of</span>
  <span m=''956420''>hosts.</span> <span m=''956670''>And I show a</span> <span m=''956930''>number
  of</span> <span m=''957150''>virtual</span> <span m=''957490''>machines.</span>
  <span m=''957980''>So</span> <span m=''958140''>what</span> <span m=''958300''>I''m</span>
  <span m=''958410''>basically</span> <span m=''958920''>saying</span> <span m=''959250''>is</span>
  <span m=''959350''>that</span> <span m=''959750''>this</span> <span m=''960030''>administrator</span>
  <span m=''961170''>could</span> <span m=''961470''>not</span> <span m=''961650''>access</span>
  <span m=''962170''>the</span> <span m=''962320''>console</span> <span m=''962900''>of</span>
  <span m=''963200''>his</span> <span m=''963560''>virtual</span> <span m=''963860''>machine
  as</span> <span m=''964210''>the</span> <span m=''964270''>number</span> <span m=''964680''>of</span>
  <span m=''964760''>hosts</span> <span m=''965330''>increased.</span> <span m=''966960''>There</span>
  <span m=''967160''>should</span> <span m=''967320''>be</span> <span m=''967480''>no</span>
  <span m=''967620''>link</span> <span m=''967820''>between</span> <span m=''968120''>these</span>
  <span m=''968270''>two.</span> <span m=''968440''>But</span> <span m=''968660''>there</span>
  <span m=''968770''>was.</span> </p><p><span m=''969600''>So</span> <span m=''970160''>I</span>
  <span m=''970300''>got</span> <span m=''970490''>involved</span> <span m=''970850''>in</span>
  <span m=''970900''>this</span> <span m=''971060''>problem.</span> <span m=''971420''>And</span>
  <span m=''971490''>here</span> <span m=''971660''>I went</span> <span m=''971820''>to
  the</span> <span m=''971970''>client</span> <span m=''972270''>folks.</span> <span
  m=''972540''>And I</span> <span m=''972610''>explained</span> <span m=''972900''>the</span>
  <span m=''972980''>problem.</span> <span m=''973280''>And</span> <span m=''973390''>their</span>
  <span m=''973770''>response</span> <span m=''974250''>was</span> <span m=''974510''>that''s</span>
  <span m=''974720''>obviously</span> <span m=''975190''>a</span> <span m=''975240''>server</span>
  <span m=''975570''>problem.</span> <span m=''977280''>Next</span> <span m=''977570''>step,</span>
  <span m=''977800''>I</span> <span m=''977840''>go</span> <span m=''977980''>to</span>
  <span m=''978030''>the</span> <span m=''978110''>server</span> <span m=''978420''>folks.</span>
  <span m=''979120''>And</span> <span m=''979280''>they</span> <span m=''979420''>said,</span>
  <span m=''979940''>yeah,</span> <span m=''980290''>it''s</span> <span m=''980430''>obviously</span>
  <span m=''981050''>a</span> <span m=''981100''>client</span> <span m=''981440''>problem.</span>
  <span m=''982260''>So</span> <span m=''982420''>then</span> <span m=''982550''>I</span>
  <span m=''982600''>went</span> <span m=''982810''>back</span> <span m=''983000''>and</span>
  <span m=''983100''>thought</span> <span m=''983280''>a</span> <span m=''983320''>little</span>
  <span m=''983470''>bit more</span> <span m=''983670''>about</span> <span m=''983830''>the</span>
  <span m=''983920''>architecture.</span> <span m=''984380''>And what</span> <span
  m=''984520''>I</span> <span m=''984570''>knew</span> <span m=''984810''>is</span>
  <span m=''984920''>that</span> <span m=''985060''>whenever</span> <span m=''985320''>the</span>
  <span m=''985430''>client</span> <span m=''985730''>needs</span> <span m=''985870''>to
  initiate</span> <span m=''985960''>this</span> <span m=''986370''>handshake</span>
  <span m=''986860''>connection,</span> <span m=''987460''>it has</span> <span m=''987850''>to</span>
  <span m=''988040''>spawn a</span> <span m=''988090''>certain</span> <span m=''988350''>process.</span>
  </p><p><span m=''989080''>So</span> <span m=''989490''>that</span> <span m=''989700''>process</span>
  <span m=''990030''>is</span> <span m=''990220''>called</span> <span m=''990480''>the</span>
  <span m=''990550''>VMRC,</span> <span m=''991220''>VMware</span> <span m=''991600''>remote</span>
  <span m=''991750''>console.</span> <span m=''992910''>So</span> <span m=''993090''>I</span>
  <span m=''993160''>talked</span> <span m=''993350''>to</span> <span m=''993410''>the</span>
  <span m=''993490''>client</span> <span m=''993770''>folks</span> <span m=''994020''>again.</span>
  <span m=''994700''>And</span> <span m=''994850''>said,</span> <span m=''995000''>well,</span>
  <span m=''995160''>I</span> <span m=''995240''>think</span> <span m=''995580''>this</span>
  <span m=''995720''>is</span> <span m=''995840''>happening.</span> <span m=''996120''>Oh,</span>
  <span m=''996200''>yeah,</span> <span m=''996540''>it''s</span> <span m=''996700''>a</span>
  <span m=''996750''>VMRC</span> <span m=''997230''>problem.</span> <span m=''998110''>OK.</span>
  <span m=''998350''>So</span> <span m=''998450''>that</span> <span m=''998640''>just</span>
  <span m=''998810''>passes</span> <span m=''999100''>the</span> <span m=''999180''>buck</span>
  <span m=''999370''>another</span> <span m=''999600''>way.</span> </p><p><span m=''999880''>So</span>
  <span m=''1000040''>then</span> <span m=''1000220''>I</span> <span m=''1000300''>talk</span>
  <span m=''1000480''>to</span> <span m=''1000550''>the</span> <span m=''1000650''>VMRC</span>
  <span m=''1001290''>folks.</span> <span m=''1001590''>And</span> <span m=''1001670''>I</span>
  <span m=''1001750''>said,</span> <span m=''1001910''>OK,</span> <span m=''1002480''>I</span>
  <span m=''1002700''>think</span> <span m=''1002910''>I</span> <span m=''1002970''>have</span>
  <span m=''1003090''>this</span> <span m=''1003220''>problem</span> <span m=''1003570''>with
  starting</span> <span m=''1003930''>up.</span> <span m=''1004030''>And</span> <span
  m=''1004120''>they</span> <span m=''1004220''>said,</span> <span m=''1004360''>oh,</span>
  <span m=''1004560''>it''s</span> <span m=''1004680''>probably</span> <span m=''1004970''>authentication.</span>
  <span m=''1005380''>It''s</span> <span m=''1005790''>probably</span> <span m=''1006020''>this.</span>
  <span m=''1006270''>You</span> <span m=''1006350''>have</span> <span m=''1006430''>to</span>
  <span m=''1006490''>enable</span> <span m=''1007020''>verbose</span> <span m=''1007430''>log</span>
  <span m=''1007720''>in</span> <span m=''1007820''>on your</span> <span m=''1008030''>end
  host,</span> <span m=''1008370''>blah,</span> <span m=''1008560''>blah,</span> <span
  m=''1008700''>blah.</span> </p><p><span m=''1009080''>And</span> <span m=''1009210''>at</span>
  <span m=''1009300''>some</span> <span m=''1009450''>point,</span> <span m=''1009680''>I
  got</span> <span m=''1009910''>so</span> <span m=''1010070''>sick</span> <span m=''1010330''>of</span>
  <span m=''1010420''>this.</span> <span m=''1010650''>I</span> <span m=''1010760''>thought,</span>
  <span m=''1010910''>well,</span> <span m=''1010980''>this</span> <span m=''1011120''>is</span>
  <span m=''1011220''>complete</span> <span m=''1011470''>garbage.</span> <span m=''1011970''>I''m</span>
  <span m=''1012180''>actually</span> <span m=''1012400''>going</span> <span m=''1012460''>to</span>
  <span m=''1012510''>take</span> <span m=''1012680''>a</span> <span m=''1012740''>look</span>
  <span m=''1012910''>at</span> <span m=''1012960''>this</span> <span m=''1013080''>a</span>
  <span m=''1013150''>little</span> <span m=''1013300''>more</span> <span m=''1013470''>carefully.</span>
  <span m=''1014330''>And</span> <span m=''1014500''>so,</span> <span m=''1014790''>once</span>
  <span m=''1015070''>I</span> <span m=''1015160''>got</span> <span m=''1015330''>involved,</span>
  <span m=''1016010''>I</span> <span m=''1016130''>got</span> <span m=''1016310''>a</span>
  <span m=''1016360''>little</span> <span m=''1016620''>bit</span> <span m=''1016740''>more</span>
  <span m=''1016910''>information.</span> <span m=''1017390''>And</span> <span m=''1017540''>the</span>
  <span m=''1017600''>information</span> <span m=''1017885''>was</span> <span m=''1018170''>actually
  pretty</span> <span m=''1018270''>useful.</span> </p><p><span m=''1018840''>Here''s</span>
  <span m=''1019050''>the</span> <span m=''1019120''>deal.</span> <span m=''1019900''>When</span>
  <span m=''1020260''>you''re</span> <span m=''1020390''>starting</span> <span m=''1020740''>the</span>
  <span m=''1020840''>remote</span> <span m=''1021090''>console</span> <span m=''1021690''>on
  one of</span> <span m=''1021750''>these</span> <span m=''1021870''>virtual</span>
  <span m=''1022210''>machines</span> <span m=''1022570''>and</span> <span m=''1022650''>you</span>
  <span m=''1022740''>want</span> <span m=''1022900''>to</span> <span m=''1022950''>connect,</span>
  <span m=''1023870''>it</span> <span m=''1024060''>turns</span> <span m=''1024329''>out</span>
  <span m=''1024430''>the</span> <span m=''1024510''>person</span> <span m=''1024810''>that</span>
  <span m=''1024839''>was</span> <span m=''1024950''>having</span> <span m=''1025140''>this</span>
  <span m=''1025300''>problem--</span> <span m=''1025720''>when</span> <span m=''1025880''>you</span>
  <span m=''1025950''>ask</span> <span m=''1026200''>a</span> <span m=''1026300''>few</span>
  <span m=''1026430''>more</span> <span m=''1026589''>questions,</span> <span m=''1026960''>you</span>
  <span m=''1027030''>get</span> <span m=''1027109''>a</span> <span m=''1027180''>few</span>
  <span m=''1027349''>more</span> <span m=''1027520''>answers.</span> <span m=''1027829''>Some</span>
  <span m=''1027990''>of</span> <span m=''1028050''>which</span> <span m=''1028220''>are</span>
  <span m=''1028290''>actually</span> <span m=''1028560''>useful.</span> </p><p><span
  m=''1029190''>So</span> <span m=''1029440''>I</span> <span m=''1029540''>said,</span>
  <span m=''1029740''>well,</span> <span m=''1029930''>if</span> <span m=''1030060''>you</span>
  <span m=''1030170''>do</span> <span m=''1030280''>this</span> <span m=''1030440''>with</span>
  <span m=''1030589''>50</span> <span m=''1030880''>hosts,</span> <span m=''1031290''>do</span>
  <span m=''1031500''>you</span> <span m=''1031700''>see</span> <span m=''1031839''>a</span>
  <span m=''1031890''>problem?</span> <span m=''1032869''>So</span> <span m=''1033119''>50</span>
  <span m=''1033420''>manage</span> <span m=''1033660''>hosts,</span> <span m=''1033819''>he</span>
  <span m=''1033980''>only</span> <span m=''1034089''>wants</span> <span m=''1034280''>to</span>
  <span m=''1034349''>view</span> <span m=''1034520''>one</span> <span m=''1035130''>VM''s</span>
  <span m=''1035619''>console.</span> <span m=''1037050''>No</span> <span m=''1037250''>problem.</span>
  <span m=''1038680''>Then</span> <span m=''1038890''>I</span> <span m=''1038980''>asked</span>
  <span m=''1039300''>him--</span> <span m=''1039550''>and</span> <span m=''1039660''>then</span>
  <span m=''1039760''>I</span> <span m=''1039829''>actually</span> <span m=''1040089''>sat</span>
  <span m=''1040300''>at</span> <span m=''1040339''>my</span> <span m=''1040450''>desk,</span>
  <span m=''1040680''>and</span> <span m=''1040760''>we</span> <span m=''1040869''>reproduced</span>
  <span m=''1041199''>this.</span> <span m=''1041530''>So</span> <span m=''1041660''>then
  I</span> <span m=''1041780''>said,</span> <span m=''1041940''>let''s</span> <span
  m=''1042109''>try</span> <span m=''1042280''>it with</span> <span m=''1042450''>500</span>
  <span m=''1042920''>hosts,</span> <span m=''1043569''>no</span> <span m=''1043880''>problem.</span>
  <span m=''1044579''>Just</span> <span m=''1044849''>a</span> <span m=''1044900''>little</span>
  <span m=''1045079''>bit</span> <span m=''1045200''>slower,</span> <span m=''1045579''>but</span>
  <span m=''1045890''>no</span> <span m=''1046180''>problem.</span> <span m=''1046609''>So</span>
  <span m=''1046819''>again,</span> <span m=''1047099''>the</span> <span m=''1047170''>set</span>
  <span m=''1047349''>up</span> <span m=''1047430''>is</span> <span m=''1047569''>500</span>
  <span m=''1047980''>different</span> <span m=''1048170''>hosts,</span> <span m=''1048310''>he</span>
  <span m=''1048369''>just</span> <span m=''1048520''>wants</span> <span m=''1048660''>to</span>
  <span m=''1048720''>look</span> <span m=''1048850''>at</span> <span m=''1048920''>one</span>
  <span m=''1049280''>VM.</span> <span m=''1049900''>And</span> <span m=''1050030''>it''s</span>
  <span m=''1050120''>taking</span> <span m=''1050390''>longer</span> <span m=''1050690''>and</span>
  <span m=''1050770''>longer</span> <span m=''1051020''>to</span> <span m=''1051070''>view</span>
  <span m=''1051190''>that</span> <span m=''1051360''>one</span> <span m=''1051540''>VM.</span>
  </p><p><span m=''1052060''>Finally,</span> <span m=''1052405''>he</span> <span m=''1052750''>gets</span>
  <span m=''1053100''>to</span> <span m=''1053240''>1,001</span> <span m=''1054400''>hosts.</span>
  <span m=''1055110''>And</span> <span m=''1055390''>that''s</span> <span m=''1055710''>when</span>
  <span m=''1055880''>the</span> <span m=''1055960''>problem</span> <span m=''1056400''>occurs.</span>
  <span m=''1056510''>That'' when</span> <span m=''1056970''>he cannot</span> <span
  m=''1057250''>see</span> <span m=''1057650''>this</span> <span m=''1057860''>console.</span>
  <span m=''1059000''>So</span> <span m=''1059260''>obviously</span> <span m=''1059870''>then,</span>
  <span m=''1060220''>you</span> <span m=''1060340''>go</span> <span m=''1060480''>back</span>
  <span m=''1060710''>and</span> <span m=''1060770''>you</span> <span m=''1060860''>think,</span>
  <span m=''1061210''>well, gee,</span> <span m=''1061560''>is there</span> <span
  m=''1061650''>some</span> <span m=''1061830''>magic</span> <span m=''1062200''>number
  of</span> <span m=''1062480''>1,000</span> <span m=''1062880''>hard</span> <span
  m=''1063280''>coded</span> <span m=''1063930''>anywhere,</span> <span m=''1064220''>such</span>
  <span m=''1064440''>that</span> <span m=''1064570''>we</span> <span m=''1064710''>exceeded</span>
  <span m=''1064990''>it,</span> <span m=''1065110''>and</span> <span m=''1065290''>that
  was</span> <span m=''1065370''>the</span> <span m=''1065440''>problem.</span> <span
  m=''1066290''>And</span> <span m=''1066510''>frankly,</span> <span m=''1066920''>the</span>
  <span m=''1067050''>answer</span> <span m=''1067410''>is</span> <span m=''1067700''>no.</span>
  </p><p><span m=''1068460''>So</span> <span m=''1069150''>let''s</span> <span m=''1069510''>figure</span>
  <span m=''1069720''>out</span> <span m=''1069910''>actually</span> <span m=''1070180''>what</span>
  <span m=''1070370''>did</span> <span m=''1070530''>happen.</span> <span m=''1071130''>So</span>
  <span m=''1071270''>I</span> <span m=''1072320''>made</span> <span m=''1072470''>a</span>
  <span m=''1072500''>bunch</span> <span m=''1072680''>of</span> <span m=''1072720''>different</span>
  <span m=''1072940''>observations</span> <span m=''1073520''>while</span> <span m=''1073680''>I</span>
  <span m=''1073780''>was</span> <span m=''1073880''>debugging</span> <span m=''1074300''>this.</span>
  <span m=''1076100''>When</span> <span m=''1076450''>you</span> <span m=''1076580''>have</span>
  <span m=''1076950''>fewer</span> <span m=''1077310''>than</span> <span m=''1077440''>that</span>
  <span m=''1077610''>magic</span> <span m=''1077920''>number</span> <span m=''1078150''>of</span>
  <span m=''1078220''>1,001</span> <span m=''1078960''>hosts,</span> <span m=''1079320''>here''s</span>
  <span m=''1079520''>what</span> <span m=''1079630''>was</span> <span m=''1079780''>going</span>
  <span m=''1080030''>on.</span> </p><p><span m=''1080890''>Remember</span> <span
  m=''1081290''>the</span> <span m=''1081390''>sequence</span> <span m=''1081800''>of</span>
  <span m=''1081880''>events.</span> <span m=''1082510''>I''m</span> <span m=''1082710''>a</span>
  <span m=''1082750''>client.</span> <span m=''1083900''>I</span> <span m=''1084010''>talked</span>
  <span m=''1084290''>to</span> <span m=''1084420''>a</span> <span m=''1084470''>server.</span>
  <span m=''1085340''>Server</span> <span m=''1085750''>talks</span> <span m=''1086010''>to</span>
  <span m=''1086090''>the</span> <span m=''1086160''>virtual</span> <span m=''1086530''>machine.</span>
  <span m=''1087290''>And</span> <span m=''1087480''>then</span> <span m=''1087620''>that</span>
  <span m=''1087790''>virtual</span> <span m=''1088080''>machine</span> <span m=''1088370''>and</span>
  <span m=''1088470''>I</span> <span m=''1088570''>are</span> <span m=''1088670''>directly</span>
  <span m=''1089090''>connected.</span> </p><p><span m=''1089850''>What</span> <span
  m=''1090300''>I was</span> <span m=''1090490''>noticing</span> <span m=''1091620''>was</span>
  <span m=''1091850''>that</span> <span m=''1092200''>when</span> <span m=''1092360''>there</span>
  <span m=''1092470''>were</span> <span m=''1092570''>less</span> <span m=''1092900''>than</span>
  <span m=''1093030''>1,000</span> <span m=''1093520''>overall</span> <span m=''1093830''>hosts</span>
  <span m=''1094150''>in this</span> <span m=''1094250''>setup,</span> <span m=''1095640''>when</span>
  <span m=''1095880''>I</span> <span m=''1095970''>would</span> <span m=''1096100''>initiate</span>
  <span m=''1096600''>the</span> <span m=''1096690''>command</span> <span m=''1097000''>for</span>
  <span m=''1097090''>this</span> <span m=''1097280''>console.</span> <span m=''1098960''>The</span>
  <span m=''1099920''>CPU</span> <span m=''1100480''>usage</span> <span m=''1100870''>and</span>
  <span m=''1101100''>memory</span> <span m=''1101510''>usage</span> <span m=''1101870''>of</span>
  <span m=''1101930''>this</span> <span m=''1102090''>middle</span> <span m=''1102660''>management</span>
  <span m=''1103180''>server</span> <span m=''1103860''>would</span> <span m=''1104210''>gradually</span>
  <span m=''1104900''>increase,</span> <span m=''1105710''>and</span> <span m=''1105930''>increase,</span>
  <span m=''1106500''>and</span> <span m=''1106670''>increase</span> <span m=''1107830''>until</span>
  <span m=''1108450''>the</span> <span m=''1108570''>console</span> <span m=''1109120''>would</span>
  <span m=''1109250''>actually</span> <span m=''1109590''>show</span> <span m=''1109940''>up.</span>
  </p><p><span m=''1110570''>So</span> <span m=''1111100''>you</span> <span m=''1111240''>right</span>
  <span m=''1111520''>click.</span> <span m=''1111730''>You</span> <span m=''1111810''>want</span>
  <span m=''1111940''>to</span> <span m=''1112020''>pull</span> <span m=''1112470''>up
  a console.</span> <span m=''1112660''>A little</span> <span m=''1112860''>window</span>
  <span m=''1113160''>comes</span> <span m=''1113350''>up.</span> <span m=''1113440''>But</span>
  <span m=''1113530''>it''s</span> <span m=''1113650''>totally</span> <span m=''1113960''>blank.</span>
  <span m=''1114490''>And</span> <span m=''1114630''>then</span> <span m=''1114720''>eventually,</span>
  <span m=''1115220''>after</span> <span m=''1115540''>the</span> <span m=''1115690''>management</span>
  <span m=''1116100''>server</span> <span m=''1116340''>consumes</span> <span m=''1116650''>a</span>
  <span m=''1116690''>lot</span> <span m=''1116850''>of</span> <span m=''1116920''>CPU</span>
  <span m=''1117260''>and</span> <span m=''1117340''>memory,</span> <span m=''1117890''>eventually</span>
  <span m=''1118290''>that</span> <span m=''1118460''>console</span> <span m=''1118900''>comes</span>
  <span m=''1119200''>up.</span> <span m=''1119650''>So</span> <span m=''1119820''>now</span>
  <span m=''1119990''>your</span> <span m=''1120130''>question</span> <span m=''1120560''>is</span>
  <span m=''1121200''>what''s</span> <span m=''1121670''>going</span> <span m=''1121960''>on</span>
  <span m=''1122120''>that''s</span> <span m=''1122280''>causing</span> <span m=''1122550''>the</span>
  <span m=''1122630''>CPU</span> <span m=''1123040''>usage of this</span> <span m=''1123400''>management</span>
  <span m=''1123750''>server.</span> <span m=''1123990''>And</span> <span m=''1124050''>why</span>
  <span m=''1124280''>is</span> <span m=''1124410''>that</span> <span m=''1124540''>scaling</span>
  <span m=''1125250''>with</span> <span m=''1125600''>the</span> <span m=''1125690''>number</span>
  <span m=''1126030''>of</span> <span m=''1126150''>your</span> <span m=''1126260''>virtual</span>
  <span m=''1126630''>machines.</span> </p><p><span m=''1129090''>So</span> <span
  m=''1129960''>the</span> <span m=''1130170''>first</span> <span m=''1130380''>thing</span>
  <span m=''1130500''>I</span> <span m=''1130560''>did--</span> <span m=''1130760''>so</span>
  <span m=''1130950''>one</span> <span m=''1131130''>of</span> <span m=''1131180''>the</span>
  <span m=''1131260''>themes</span> <span m=''1131560''>of</span> <span m=''1131630''>this</span>
  <span m=''1131780''>talk,</span> <span m=''1132030''>I</span> <span m=''1132080''>suppose,</span>
  <span m=''1132440''>is that</span> <span m=''1132520''>there''s</span> <span m=''1132660''>a</span>
  <span m=''1132710''>lot</span> <span m=''1132860''>of</span> <span m=''1132930''>great</span>
  <span m=''1133200''>tools</span> <span m=''1133420''>for</span> <span m=''1133540''>performance</span>
  <span m=''1134010''>debugging.</span> <span m=''1134280''>But</span> <span m=''1134410''>sometimes</span>
  <span m=''1134770''>there''s</span> <span m=''1134930''>no</span> <span m=''1135060''>real</span>
  <span m=''1135290''>substitute</span> <span m=''1135750''>for</span> <span m=''1135870''>common</span>
  <span m=''1136200''>sense</span> <span m=''1136680''>and</span> <span m=''1136850''>for</span>
  <span m=''1136950''>the</span> <span m=''1137060''>things</span> <span m=''1137290''>that</span>
  <span m=''1137370''>are</span> <span m=''1137530''>easiest</span> <span m=''1138010''>to</span>
  <span m=''1138090''>do.</span> <span m=''1138610''>So</span> <span m=''1138870''>the</span>
  <span m=''1138950''>first</span> <span m=''1139240''>thing</span> <span m=''1139390''>I</span>
  <span m=''1139470''>did is</span> <span m=''1139680''>I</span> <span m=''1139710''>looked</span>
  <span m=''1139900''>at</span> <span m=''1139970''>the</span> <span m=''1140050''>log</span>
  <span m=''1140320''>file</span> <span m=''1140550''>of</span> <span m=''1140640''>this</span>
  <span m=''1140720''>server.</span> <span m=''1141410''>Here''s</span> <span m=''1141590''>the</span>
  <span m=''1141680''>rationale.</span> </p><p><span m=''1142810''>If</span> <span
  m=''1143150''>every</span> <span m=''1143410''>time</span> <span m=''1143630''>I</span>
  <span m=''1143880''>invoke this remote</span> <span m=''1144270''>console,</span>
  <span m=''1144680''>I''m</span> <span m=''1144800''>doing</span> <span m=''1145340''>more</span>
  <span m=''1145550''>work</span> <span m=''1145790''>on</span> <span m=''1145890''>the</span>
  <span m=''1145950''>server.</span> <span m=''1146570''>First,</span> <span m=''1147230''>let
  me</span> <span m=''1147330''>just</span> <span m=''1147570''>see</span> <span m=''1147810''>what</span>
  <span m=''1147920''>that</span> <span m=''1148120''>server is</span> <span m=''1148620''>doing.</span>
  <span m=''1150070''>Now,</span> <span m=''1150860''>it</span> <span m=''1151170''>turns</span>
  <span m=''1151500''>out</span> <span m=''1151920''>that</span> <span m=''1152070''>what</span>
  <span m=''1152240''>I''d</span> <span m=''1152320''>noticed</span> <span m=''1152680''>about</span>
  <span m=''1152880''>the</span> <span m=''1152960''>server</span> <span m=''1153450''>was
  that</span> <span m=''1153590''>whenever</span> <span m=''1154020''>the</span> <span
  m=''1154180''>client</span> <span m=''1154480''>would</span> <span m=''1154780''>contact</span>
  <span m=''1155310''>the</span> <span m=''1155390''>server</span> <span m=''1155650''>and</span>
  <span m=''1155720''>say</span> <span m=''1155880''>I</span> <span m=''1155920''>want</span>
  <span m=''1156150''>the</span> <span m=''1156230''>console</span> <span m=''1156620''>of</span>
  <span m=''1156690''>this</span> <span m=''1156860''>VM,</span> <span m=''1157720''>you</span>
  <span m=''1157920''>would</span> <span m=''1158050''>see</span> <span m=''1158310''>a</span>
  <span m=''1158830''>data</span> <span m=''1159260''>retrieval</span> <span m=''1159790''>call</span>
  <span m=''1160280''>from</span> <span m=''1160550''>the</span> <span m=''1160810''>client</span>
  <span m=''1161150''>to</span> <span m=''1161240''>the</span> <span m=''1161330''>server.</span>
  <span m=''1162690''>And</span> <span m=''1162860''>that</span> <span m=''1163050''>data</span>
  <span m=''1163290''>retrieval</span> <span m=''1163610''>call</span> <span m=''1163950''>got</span>
  <span m=''1164110''>more</span> <span m=''1164460''>and</span> <span m=''1164520''>more</span>
  <span m=''1164690''>expensive</span> <span m=''1165140''>with</span> <span m=''1165280''>more</span>
  <span m=''1165620''>hosts</span> <span m=''1165930''>and</span> <span m=''1165980''>more</span>
  <span m=''1166190''>virtual</span> <span m=''1166540''>machines</span> <span m=''1166930''>in</span>
  <span m=''1166980''>the</span> <span m=''1167050''>system.</span> <span m=''1167950''>So</span>
  <span m=''1168130''>the</span> <span m=''1168220''>question</span> <span m=''1168550''>that
  I</span> <span m=''1168810''>asked</span> <span m=''1169100''>was,</span> <span
  m=''1169540''>why</span> <span m=''1169840''>on</span> <span m=''1169930''>earth</span>
  <span m=''1170130''>are</span> <span m=''1170170''>we</span> <span m=''1170300''>doing</span>
  <span m=''1170520''>some</span> <span m=''1170760''>stupid</span> <span m=''1171230''>data</span>
  <span m=''1171470''>retrieval</span> <span m=''1171810''>call</span> <span m=''1172050''>if</span>
  <span m=''1172150''>all</span> <span m=''1172390''>I</span> <span m=''1172460''>wanted</span>
  <span m=''1172810''>is to</span> <span m=''1172870''>say,</span> <span m=''1173350''>here''s</span>
  <span m=''1173560''>a</span> <span m=''1173620''>VM.</span> <span m=''1174080''>Tell</span>
  <span m=''1174210''>me</span> <span m=''1174300''>where</span> <span m=''1174440''>it''s</span>
  <span m=''1174540''>located</span> <span m=''1174910''>so</span> <span m=''1174990''>I</span>
  <span m=''1175060''>can</span> <span m=''1175210''>talk</span> <span m=''1175430''>to</span>
  <span m=''1175540''>it.</span> </p><p><span m=''1176150''>So</span> <span m=''1176770''>it</span>
  <span m=''1176930''>turns</span> <span m=''1177220''>out--</span> <span m=''1178800''>that</span>
  <span m=''1178940''>was</span> <span m=''1179080''>problem</span> <span m=''1179320''>number</span>
  <span m=''1179490''>one.</span> <span m=''1179650''>Problem</span> <span m=''1180110''>number</span>
  <span m=''1180180''>two,</span> <span m=''1181470''>that''s</span> <span m=''1181700''>what</span>
  <span m=''1181790''>happened</span> <span m=''1182080''>when</span> <span m=''1182200''>you</span>
  <span m=''1182270''>had</span> <span m=''1182470''>50</span> <span m=''1182780''>hosts,</span>
  <span m=''1183130''>500,</span> <span m=''1183600''>whatever,</span> <span m=''1183940''>that</span>
  <span m=''1184080''>you</span> <span m=''1184180''>basically</span> <span m=''1184630''>spend</span>
  <span m=''1184880''>more</span> <span m=''1185130''>and</span> <span m=''1185190''>more</span>
  <span m=''1185380''>time</span> <span m=''1185670''>in</span> <span m=''1185740''>this</span>
  <span m=''1185910''>data</span> <span m=''1186140''>retrieval</span> <span m=''1186580''>routine</span>
  <span m=''1187230''>on</span> <span m=''1187370''>the</span> <span m=''1187510''>server.</span>
  <span m=''1188330''>However,</span> <span m=''1188970''>once</span> <span m=''1189220''>you</span>
  <span m=''1189370''>hit that</span> <span m=''1189540''>magic</span> <span m=''1189890''>number</span>
  <span m=''1190220''>of</span> <span m=''1190320''>1,000,</span> <span m=''1192650''>you</span>
  <span m=''1192810''>would</span> <span m=''1192920''>see</span> <span m=''1193110''>this</span>
  <span m=''1193270''>call</span> <span m=''1193480''>start.</span> <span m=''1193970''>But</span>
  <span m=''1194080''>you would</span> <span m=''1194290''>never</span> <span m=''1194560''>see</span>
  <span m=''1194810''>it</span> <span m=''1194900''>end.</span> <span m=''1195560''>And</span>
  <span m=''1195730''>in</span> <span m=''1195840''>fact,</span> <span m=''1196260''>you</span>
  <span m=''1196390''>wouldn''t</span> <span m=''1196590''>see</span> <span m=''1196780''>it</span>
  <span m=''1197020''>end.</span> <span m=''1197140''>You''d</span> <span m=''1197240''>see</span>
  <span m=''1197340''>some</span> <span m=''1197510''>exceptions</span> <span m=''1198110''>somewhere.</span>
  <span m=''1199970''>So</span> <span m=''1200770''>that</span> <span m=''1201110''>to</span>
  <span m=''1201190''>me</span> <span m=''1201310''>was</span> <span m=''1201450''>a</span>
  <span m=''1201520''>clue</span> <span m=''1201710''>that</span> <span m=''1201810''>I</span>
  <span m=''1201870''>better</span> <span m=''1202110''>take</span> <span m=''1202300''>a</span>
  <span m=''1202350''>look</span> <span m=''1202530''>and</span> <span m=''1202630''>see</span>
  <span m=''1202760''>what''s</span> <span m=''1202990''>going</span> <span m=''1203220''>on</span>
  <span m=''1203340''>at</span> <span m=''1203390''>that</span> <span m=''1203510''>exception.</span>
  </p><p><span m=''1204050''>So</span> <span m=''1204250''>here''s</span> <span m=''1204430''>what</span>
  <span m=''1204520''>I</span> <span m=''1204590''>did.</span> <span m=''1205350''>Unfortunately,</span>
  <span m=''1206560''>the</span> <span m=''1206780''>exception</span> <span m=''1207510''>gave</span>
  <span m=''1207760''>me</span> <span m=''1207870''>no</span> <span m=''1208180''>information</span>
  <span m=''1208640''>whatsoever.</span> <span m=''1209010''>So</span> <span m=''1209120''>I</span>
  <span m=''1209170''>went</span> <span m=''1209370''>ahead</span> <span m=''1209560''>and
  I</span> <span m=''1209750''>attached</span> <span m=''1210080''>a</span> <span
  m=''1210250''>debugger</span> <span m=''1210530''>to</span> <span m=''1210630''>the</span>
  <span m=''1210730''>server.</span> <span m=''1211290''>And</span> <span m=''1211430''>when</span>
  <span m=''1211570''>I</span> <span m=''1211630''>did,</span> <span m=''1211820''>I</span>
  <span m=''1211880''>found</span> <span m=''1212150''>out that</span> <span m=''1212310''>it</span>
  <span m=''1212440''>was</span> <span m=''1212570''>an</span> <span m=''1212650''>out</span>
  <span m=''1212830''>of</span> <span m=''1212900''>memory</span> <span m=''1213190''>exception.</span>
  <span m=''1213990''>So</span> <span m=''1214180''>here''s</span> <span m=''1214410''>the</span>
  <span m=''1214490''>deal.</span> <span m=''1215090''>I''m</span> <span m=''1215220''>a</span>
  <span m=''1215290''>poor</span> <span m=''1215560''>admin.</span> <span m=''1216210''>I</span>
  <span m=''1216440''>send</span> <span m=''1216770''>a</span> <span m=''1216790''>request</span>
  <span m=''1217190''>to</span> <span m=''1217290''>look</span> <span m=''1217600''>at</span>
  <span m=''1218080''>a</span> <span m=''1218150''>console.</span> <span m=''1219260''>For</span>
  <span m=''1219470''>some</span> <span m=''1219730''>reason,</span> <span m=''1219990''>some</span>
  <span m=''1220200''>data</span> <span m=''1220520''>handshaking</span> <span m=''1221120''>code</span>
  <span m=''1221360''>takes</span> <span m=''1221680''>place</span> <span m=''1221900''>between</span>
  <span m=''1222060''>the</span> <span m=''1222120''>server</span> <span m=''1222450''>and</span>
  <span m=''1222510''>the</span> <span m=''1222570''>client.</span> <span m=''1223070''>It</span>
  <span m=''1223200''>takes</span> <span m=''1223450''>longer</span> <span m=''1223820''>and
  longer</span> <span m=''1224110''>with</span> <span m=''1224320''>more</span> <span
  m=''1224570''>hosts.</span> <span m=''1225040''>Eventually,</span> <span m=''1225500''>when</span>
  <span m=''1225630''>I</span> <span m=''1225680''>have</span> <span m=''1225840''>too</span>
  <span m=''1225990''>many</span> <span m=''1226200''>hosts,</span> <span m=''1226610''>that</span>
  <span m=''1226810''>thing</span> <span m=''1227560''>ran</span> <span m=''1227850''>out</span>
  <span m=''1227980''>of</span> <span m=''1228050''>memory</span> <span m=''1228510''>and</span>
  <span m=''1228660''>silently</span> <span m=''1229250''>failed.</span> </p><p><span
  m=''1229930''>And</span> <span m=''1230060''>so</span> <span m=''1230180''>my</span>
  <span m=''1230360''>client''s</span> <span m=''1230720''>sitting</span> <span m=''1230900''>around</span>
  <span m=''1231200''>looking</span> <span m=''1231630''>dumb</span> <span m=''1231870''>with</span>
  <span m=''1232010''>a</span> <span m=''1232060''>totally</span> <span m=''1232370''>blank</span>
  <span m=''1232640''>screen,</span> <span m=''1232830''>because</span> <span m=''1233000''>it</span>
  <span m=''1233060''>has</span> <span m=''1233190''>no</span> <span m=''1233370''>idea</span>
  <span m=''1233640''>that its</span> <span m=''1233860''>request</span> <span m=''1234190''>basically</span>
  <span m=''1234540''>got</span> <span m=''1234810''>denied.</span> <span m=''1235400''>So</span>
  <span m=''1235570''>the</span> <span m=''1235680''>question</span> <span m=''1236130''>is</span>
  <span m=''1236900''>why</span> <span m=''1237200''>is</span> <span m=''1237320''>that</span>
  <span m=''1237510''>happening?</span> <span m=''1238650''>And</span> <span m=''1239020''>aha,</span>
  <span m=''1239390''>this</span> <span m=''1239500''>is</span> <span m=''1239590''>where</span>
  <span m=''1239700''>the</span> <span m=''1239970''>aha</span> <span m=''1240080''>moment</span>
  <span m=''1240420''>occurred.</span> <span m=''1242000''>I</span> <span m=''1242120''>happen</span>
  <span m=''1242480''>to</span> <span m=''1242570''>know</span> <span m=''1243490''>that</span>
  <span m=''1244240''>one</span> <span m=''1244540''>of</span> <span m=''1244620''>the</span>
  <span m=''1244710''>reasons</span> <span m=''1245170''>in</span> <span m=''1245300''>our</span>
  <span m=''1245440''>setup,</span> <span m=''1246160''>that</span> <span m=''1246540''>one</span>
  <span m=''1246780''>of</span> <span m=''1246840''>the</span> <span m=''1247150''>causes</span>
  <span m=''1247550''>for</span> <span m=''1247620''>this</span> <span m=''1247780''>data</span>
  <span m=''1247990''>retrieval,</span> <span m=''1249180''>is</span> <span m=''1249380''>that</span>
  <span m=''1249560''>as</span> <span m=''1249690''>a</span> <span m=''1249820''>client,</span>
  <span m=''1250370''>I</span> <span m=''1250480''>want</span> <span m=''1250740''>to</span>
  <span m=''1250790''>know</span> <span m=''1250910''>certain</span> <span m=''1251370''>attributes</span>
  <span m=''1251920''>of</span> <span m=''1252000''>the</span> <span m=''1252070''>virtual</span>
  <span m=''1252490''>machine</span> <span m=''1252810''>that</span> <span m=''1252910''>I</span>
  <span m=''1252970''>wanted</span> <span m=''1253220''>to</span> <span m=''1253400''>view.</span>
  </p><p><span m=''1253900''>For</span> <span m=''1254130''>example,</span> <span
  m=''1254430''>if</span> <span m=''1254520''>I''m</span> <span m=''1254620''>looking</span>
  <span m=''1254850''>at</span> <span m=''1254940''>the</span> <span m=''1255020''>console</span>
  <span m=''1255380''>for a</span> <span m=''1255540''>virtual</span> <span m=''1255980''>machine,</span>
  <span m=''1256700''>I</span> <span m=''1256880''>might</span> <span m=''1257210''>care</span>
  <span m=''1258030''>that</span> <span m=''1258130''>that</span> <span m=''1258310''>virtual</span>
  <span m=''1258610''>machine</span> <span m=''1258880''>has</span> <span m=''1258990''>a</span>
  <span m=''1259040''>CD-ROM</span> <span m=''1259660''>connected.</span> <span m=''1260160''>And</span>
  <span m=''1260310''>I</span> <span m=''1260380''>might</span> <span m=''1260730''>care</span>
  <span m=''1260980''>if that</span> <span m=''1261150''>CD-ROM</span> <span m=''1261620''>got</span>
  <span m=''1261810''>disconnected</span> <span m=''1262330''>or</span> <span m=''1262490''>whatever.</span>
  <span m=''1263430''>That''s</span> <span m=''1263650''>not</span> <span m=''1263790''>something
  you''d</span> <span m=''1264110''>necessarily</span> <span m=''1264740''>associate</span>
  <span m=''1265120''>with a</span> <span m=''1265220''>virtual</span> <span m=''1265610''>machine.</span>
  <span m=''1266460''>But</span> <span m=''1266770''>when</span> <span m=''1266910''>I</span>
  <span m=''1266980''>go</span> <span m=''1267190''>to</span> <span m=''1267240''>the</span>
  <span m=''1267350''>server</span> <span m=''1267650''>to</span> <span m=''1267740''>connect</span>
  <span m=''1268100''>to</span> <span m=''1268220''>it,</span> <span m=''1268530''>the</span>
  <span m=''1268710''>server</span> <span m=''1269030''>wants</span> <span m=''1269230''>to</span>
  <span m=''1269320''>give</span> <span m=''1269480''>me</span> <span m=''1269560''>that</span>
  <span m=''1269680''>information</span> <span m=''1270140''>so</span> <span m=''1270340''>that</span>
  <span m=''1270660''>the</span> <span m=''1270750''>shell,</span> <span m=''1271560''>which</span>
  <span m=''1271840''>is</span> <span m=''1271900''>showing</span> <span m=''1272380''>me</span>
  <span m=''1272480''>this</span> <span m=''1272670''>console</span> <span m=''1273300''>can</span>
  <span m=''1273470''>appropriately</span> <span m=''1274150''>update</span> <span
  m=''1274700''>if</span> <span m=''1274900''>the</span> <span m=''1274990''>virtual</span>
  <span m=''1275340''>machine</span> <span m=''1275690''>gets</span> <span m=''1276030''>disconnected</span>
  <span m=''1276460''>from</span> <span m=''1276630''>its CD-ROM,</span> <span m=''1276990''>whatever.</span>
  </p><p><span m=''1277390''>Anyway,</span> <span m=''1277690''>the</span> <span m=''1277790''>point</span>
  <span m=''1278180''>is</span> <span m=''1278580''>I</span> <span m=''1278730''>looked</span>
  <span m=''1278980''>at</span> <span m=''1279070''>the</span> <span m=''1279160''>code</span>
  <span m=''1279660''>that</span> <span m=''1280300''>this</span> <span m=''1280460''>magical</span>
  <span m=''1281130''>VMRC</span> <span m=''1281490''>routine</span> <span m=''1281810''>was</span>
  <span m=''1281990''>doing.</span> <span m=''1282390''>And</span> <span m=''1282520''>here''s
  what</span> <span m=''1282770''>it</span> <span m=''1282840''>was</span> <span m=''1283030''>doing.</span>
  <span m=''1283810''>It</span> <span m=''1283920''>was</span> <span m=''1284070''>saying,</span>
  <span m=''1284330''>look,</span> <span m=''1285270''>I</span> <span m=''1285450''>want</span>
  <span m=''1285610''>to</span> <span m=''1285650''>start</span> <span m=''1285930''>a
  remote</span> <span m=''1286120''>console</span> <span m=''1286440''>session.</span>
  <span m=''1286770''>I</span> <span m=''1286910''>need</span> <span m=''1287090''>certain</span>
  <span m=''1287370''>information</span> <span m=''1287870''>like</span> <span m=''1288090''>the</span>
  <span m=''1288150''>CD-ROM</span> <span m=''1288710''>connectivity.</span> <span
  m=''1289480''>I''m</span> <span m=''1289670''>going</span> <span m=''1289780''>to</span>
  <span m=''1289880''>go</span> <span m=''1290030''>ahead</span> <span m=''1290160''>and</span>
  <span m=''1290270''>get</span> <span m=''1290410''>that</span> <span m=''1290560''>information</span>
  <span m=''1291200''>for</span> <span m=''1291380''>every</span> <span m=''1291630''>host
  and</span> <span m=''1291860''>every</span> <span m=''1292000''>virtual</span> <span
  m=''1292290''>machine</span> <span m=''1292510''>in</span> <span m=''1292560''>the</span>
  <span m=''1292630''>system.</span> <span m=''1293560''>And</span> <span m=''1293700''>then</span>
  <span m=''1293830''>once</span> <span m=''1294090''>that''s</span> <span m=''1294350''>done,</span>
  <span m=''1294950''>I''ll</span> <span m=''1295150''>go</span> <span m=''1295330''>ahead</span>
  <span m=''1295630''>and</span> <span m=''1295770''>display</span> <span m=''1296090''>the</span>
  <span m=''1296200''>console</span> <span m=''1296570''>for</span> <span m=''1296660''>this</span>
  <span m=''1296790''>one</span> <span m=''1297020''>virtual</span> <span m=''1297370''>machine</span>
  <span m=''1297640''>that</span> <span m=''1297740''>I</span> <span m=''1297790''>care</span>
  <span m=''1298050''>about.</span> </p><p><span m=''1298690''>Well,</span> <span
  m=''1298910''>this</span> <span m=''1299070''>is</span> <span m=''1299220''>clearly</span>
  <span m=''1299500''>just</span> <span m=''1299640''>a</span> <span m=''1299680''>stupid</span>
  <span m=''1300010''>idea.</span> <span m=''1300940''>So</span> <span m=''1301090''>I</span>
  <span m=''1301160''>called</span> <span m=''1301500''>the</span> <span m=''1301590''>guy</span>
  <span m=''1301800''>up and</span> <span m=''1302070''>I</span> <span m=''1302150''>said,</span>
  <span m=''1302860''>you</span> <span m=''1303020''>realize</span> <span m=''1303380''>this
  is</span> <span m=''1303520''>stupid</span> <span m=''1303850''>idea.</span> <span
  m=''1304160''>And</span> <span m=''1304230''>he</span> <span m=''1304340''>said,</span>
  <span m=''1304460''>well,</span> <span m=''1304700''>why?</span> <span m=''1304920''>It''s</span>
  <span m=''1305050''>not</span> <span m=''1305180''>that</span> <span m=''1305290''>expensive.</span>
  <span m=''1305760''>Is</span> <span m=''1305890''>it?</span> <span m=''1306750''>And</span>
  <span m=''1307080''>I</span> <span m=''1307110''>was</span> <span m=''1307260''>like,</span>
  <span m=''1307860''>OK,</span> <span m=''1308080''>we</span> <span m=''1308190''>need</span>
  <span m=''1308290''>to</span> <span m=''1308330''>have</span> <span m=''1308420''>a</span>
  <span m=''1308470''>long</span> <span m=''1308670''>discussion.</span> <span m=''1308985''>And</span>
  <span m=''1309300''>bring</span> <span m=''1309470''>a</span> <span m=''1309520''>priest</span>
  <span m=''1309810''>in</span> <span m=''1309870''>here.</span> <span m=''1310010''>But</span>
  <span m=''1310110''>that''s</span> <span m=''1310260''>a</span> <span m=''1310310''>terrible</span>
  <span m=''1310620''>idea.</span> </p><p><span m=''1311170''>So</span> <span m=''1311380''>what</span>
  <span m=''1311550''>we</span> <span m=''1311650''>ended</span> <span m=''1311860''>up</span>
  <span m=''1311920''>doing</span> <span m=''1312680''>is--</span> <span m=''1313500''>And</span>
  <span m=''1313760''>so</span> <span m=''1313880''>now--</span> <span m=''1314080''>OK,</span>
  <span m=''1314250''>so</span> <span m=''1314360''>that''s</span> <span m=''1314570''>the</span>
  <span m=''1314660''>problem.</span> <span m=''1315080''>The</span> <span m=''1315170''>problem</span>
  <span m=''1315530''>is</span> <span m=''1315890''>we</span> <span m=''1316770''>drew
  a</span> <span m=''1316790''>huge</span> <span m=''1317250''>data</span> <span m=''1317500''>retrieval.</span>
  <span m=''1318000''>None</span> <span m=''1318200''>of</span> <span m=''1318290''>which</span>
  <span m=''1318440''>we</span> <span m=''1318590''>need.</span> <span m=''1318980''>Now</span>
  <span m=''1319190''>why this</span> <span m=''1319580''>1,001</span> <span m=''1320120''>host</span>
  <span m=''1320440''>thing?</span> </p><p><span m=''1321020''>Here''s</span> <span
  m=''1321230''>the</span> <span m=''1321310''>deal.</span> <span m=''1321640''>It</span>
  <span m=''1321860''>turns</span> <span m=''1322150''>out</span> <span m=''1322260''>that</span>
  <span m=''1322410''>in</span> <span m=''1322550''>our</span> <span m=''1322680''>code,</span>
  <span m=''1323350''>we</span> <span m=''1323680''>had--</span> <span m=''1324180''>for</span>
  <span m=''1324550''>old</span> <span m=''1324900''>style</span> <span m=''1325270''>clients,</span>
  <span m=''1325700''>of</span> <span m=''1325840''>which</span> <span m=''1326060''>this</span>
  <span m=''1326200''>was</span> <span m=''1326500''>an</span> <span m=''1326680''>old</span>
  <span m=''1326990''>style</span> <span m=''1327050''>client--</span> <span m=''1327480''>we</span>
  <span m=''1327650''>had</span> <span m=''1327810''>a</span> <span m=''1327870''>restriction.</span>
  <span m=''1328640''>We</span> <span m=''1328850''>said</span> <span m=''1329070''>if</span>
  <span m=''1329160''>you</span> <span m=''1329280''>need</span> <span m=''1329470''>to</span>
  <span m=''1329550''>serialize</span> <span m=''1330190''>more</span> <span m=''1330400''>than</span>
  <span m=''1330600''>200</span> <span m=''1330880''>megabytes</span> <span m=''1331430''>worth</span>
  <span m=''1331640''>of</span> <span m=''1331760''>data,</span> <span m=''1332500''>we''re</span>
  <span m=''1332670''>not</span> <span m=''1332810''>going</span> <span m=''1332910''>to</span>
  <span m=''1332950''>handle</span> <span m=''1333210''>that.</span> <span m=''1333320''>We''re</span>
  <span m=''1333410''>just</span> <span m=''1333520''>going</span> <span m=''1333590''>to</span>
  <span m=''1333650''>fail.</span> <span m=''1334550''>It</span> <span m=''1334720''>turns</span>
  <span m=''1334990''>out</span> <span m=''1335130''>once</span> <span m=''1335360''>we</span>
  <span m=''1335460''>got</span> <span m=''1335660''>1,001</span> <span m=''1336430''>hosts,</span>
  <span m=''1336700''>we</span> <span m=''1337080''>slightly</span> <span m=''1337750''>exceeded</span>
  <span m=''1338120''>that</span> <span m=''1338280''>200</span> <span m=''1338560''>megabyte</span>
  <span m=''1338980''>buffer</span> <span m=''1339250''>size,</span> <span m=''1339830''>we</span>
  <span m=''1340030''>silently</span> <span m=''1340450''>erred</span> <span m=''1340820''>with</span>
  <span m=''1340960''>an</span> <span m=''1341060''>out of</span> <span m=''1341360''>memory</span>
  <span m=''1341580''>exception.</span> <span m=''1342340''>And</span> <span m=''1342700''>we</span>
  <span m=''1342800''>never</span> <span m=''1343090''>returned</span> <span m=''1343250''>to</span>
  <span m=''1343290''>the</span> <span m=''1343390''>client.</span> <span m=''1343710''>And</span>
  <span m=''1343780''>everybody</span> <span m=''1344080''>was</span> <span m=''1344240''>unhappy.</span>
  </p><p><span m=''1344860''>So</span> <span m=''1345280''>it had nothing</span> <span
  m=''1345660''>to do with</span> <span m=''1346000''>1,000 hosts.</span> <span m=''1346040''>It</span>
  <span m=''1346190''>has</span> <span m=''1346340''>to</span> <span m=''1346400''>do</span>
  <span m=''1346500''>with</span> <span m=''1346590''>the</span> <span m=''1346680''>amount</span>
  <span m=''1346890''>of</span> <span m=''1346960''>data</span> <span m=''1347170''>you''re</span>
  <span m=''1347340''>actually</span> <span m=''1347640''>sending.</span> <span m=''1348200''>So</span>
  <span m=''1348500''>luckily,</span> <span m=''1348890''>there</span> <span m=''1349020''>were</span>
  <span m=''1349130''>several</span> <span m=''1349430''>different</span> <span m=''1349720''>fixes.</span>
  <span m=''1350350''>So</span> <span m=''1350650''>I</span> <span m=''1350760''>told</span>
  <span m=''1350990''>the</span> <span m=''1351050''>VMRC</span> <span m=''1351270''>folks,</span>
  <span m=''1351690''>the</span> <span m=''1351830''>guy</span> <span m=''1352070''>that</span>
  <span m=''1352200''>wrote this</span> <span m=''1352330''>thing,</span> <span m=''1352480''>I</span>
  <span m=''1352510''>said,</span> <span m=''1352730''>please,</span> <span m=''1353260''>under</span>
  <span m=''1353480''>no</span> <span m=''1353700''>circumstances,</span> <span m=''1354650''>should</span>
  <span m=''1354930''>you</span> <span m=''1355350''>get</span> <span m=''1355550''>information</span>
  <span m=''1356050''>for</span> <span m=''1356160''>every</span> <span m=''1356370''>single</span>
  <span m=''1356670''>host</span> <span m=''1356740''>if you</span> <span m=''1356950''>only</span>
  <span m=''1357160''>want it</span> <span m=''1357400''>for</span> <span m=''1357480''>this</span>
  <span m=''1357610''>one</span> <span m=''1357840''>guy.</span> <span m=''1358220''>That''s</span>
  <span m=''1358470''>a</span> <span m=''1358540''>terrible</span> <span m=''1358930''>idea.</span>
  </p><p><span m=''1359480''>And</span> <span m=''1359680''>then</span> <span m=''1359720''>I
  went</span> <span m=''1359900''>back</span> <span m=''1360030''>to</span> <span
  m=''1360110''>the</span> <span m=''1360190''>server</span> <span m=''1360520''>folks,</span>
  <span m=''1360770''>and</span> <span m=''1360850''>I</span> <span m=''1360920''>said,</span>
  <span m=''1361590''>you</span> <span m=''1361760''>have</span> <span m=''1361920''>to</span>
  <span m=''1362080''>admit--</span> <span m=''1362600''>first</span> <span m=''1362850''>of</span>
  <span m=''1362940''>all, you have to</span> <span m=''1363050''>fail</span> <span
  m=''1363440''>correctly.</span> <span m=''1364080''>And</span> <span m=''1364230''>second,</span>
  <span m=''1364560''>you</span> <span m=''1364670''>have to</span> <span m=''1364770''>admit</span>
  <span m=''1365150''>sensible</span> <span m=''1365660''>error</span> <span m=''1366050''>messages,</span>
  <span m=''1366540''>because</span> <span m=''1367080''>this</span> <span m=''1367440''>should</span>
  <span m=''1367680''>not</span> <span m=''1367920''>take</span> <span m=''1368130''>the</span>
  <span m=''1368220''>kind of</span> <span m=''1368490''>expertise</span> <span m=''1368880''>that</span>
  <span m=''1368950''>it</span> <span m=''1369080''>took</span> <span m=''1369230''>to</span>
  <span m=''1369330''>figure</span> <span m=''1369660''>out.</span> <span m=''1370330''>And</span>
  <span m=''1370560''>thankfully,</span> <span m=''1370960''>this</span> <span m=''1371090''>made</span>
  <span m=''1371210''>actually</span> <span m=''1371480''>a</span> <span m=''1371530''>pretty</span>
  <span m=''1371730''>huge</span> <span m=''1371950''>difference.</span> <span m=''1372320''>So
  that was</span> <span m=''1372550''>kind of</span> <span m=''1373010''>cool.</span>
  </p><p><span m=''1373890''>So</span> <span m=''1374070''>the</span> <span m=''1374160''>lessons</span>
  <span m=''1374550''>that I</span> <span m=''1374650''>took</span> <span m=''1374840''>away</span>
  <span m=''1375040''>from</span> <span m=''1375200''>this</span> <span m=''1375480''>is</span>
  <span m=''1376860''>if</span> <span m=''1377090''>you''re</span> <span m=''1377200''>going</span>
  <span m=''1377320''>to</span> <span m=''1377390''>create</span> <span m=''1377620''>an</span>
  <span m=''1377700''>API,</span> <span m=''1378730''>create an</span> <span m=''1379180''>API</span>
  <span m=''1379610''>that''s</span> <span m=''1379780''>very</span> <span m=''1380390''>difficult</span>
  <span m=''1380920''>to</span> <span m=''1381130''>abuse</span> <span m=''1382260''>and</span>
  <span m=''1382450''>very</span> <span m=''1382860''>easy</span> <span m=''1383360''>to</span>
  <span m=''1383500''>use.</span> <span m=''1384210''>Not</span> <span m=''1384660''>the</span>
  <span m=''1384810''>opposite.</span> <span m=''1385490''>These</span> <span m=''1385650''>poor</span>
  <span m=''1386110''>VMRC</span> <span m=''1386380''>folks,</span> <span m=''1386560''>it''s</span>
  <span m=''1386670''>like a</span> <span m=''1386890''>three</span> <span m=''1387120''>line</span>
  <span m=''1387340''>piece</span> <span m=''1387520''>of</span> <span m=''1387620''>code</span>
  <span m=''1387790''>to</span> <span m=''1387830''>get</span> <span m=''1387970''>information</span>
  <span m=''1388440''>for</span> <span m=''1388730''>every VM.</span> <span m=''1389150''>It''s</span>
  <span m=''1389300''>like</span> <span m=''1389450''>eight</span> <span m=''1389610''>or</span>
  <span m=''1389670''>nine</span> <span m=''1389990''>lines</span> <span m=''1390310''>to</span>
  <span m=''1390400''>get</span> <span m=''1390530''>information</span> <span m=''1390920''>for</span>
  <span m=''1391030''>just</span> <span m=''1391270''>that</span> <span m=''1391410''>VM.</span>
  <span m=''1391760''>But</span> <span m=''1391980''>those</span> <span m=''1392240''>five</span>
  <span m=''1392510''>lines</span> <span m=''1392770''>make</span> <span m=''1392980''>a</span>
  <span m=''1393050''>boatload</span> <span m=''1393810''>of</span> <span m=''1393870''>difference.</span>
  </p><p><span m=''1395200''>The</span> <span m=''1395330''>other</span> <span m=''1395460''>thing</span>
  <span m=''1395620''>is</span> <span m=''1395720''>that</span> <span m=''1395840''>this</span>
  <span m=''1395980''>was</span> <span m=''1396090''>an</span> <span m=''1396170''>entirely</span>
  <span m=''1396610''>internal</span> <span m=''1396990''>customer.</span> <span m=''1398030''>In</span>
  <span m=''1398170''>other</span> <span m=''1398300''>words,</span> <span m=''1398490''>it''s</span>
  <span m=''1398590''>just</span> <span m=''1398720''>another</span> <span m=''1398940''>group</span>
  <span m=''1399140''>within</span> <span m=''1399390''>VMware.</span> <span m=''1400030''>Imagine</span>
  <span m=''1400460''>you''re</span> <span m=''1400600''>some</span> <span m=''1400750''>external</span>
  <span m=''1401130''>guy</span> <span m=''1401280''>that''s</span> <span m=''1401420''>using</span>
  <span m=''1401610''>the</span> <span m=''1401680''>same</span> <span m=''1401930''>API.</span>
  <span m=''1402530''>You''re</span> <span m=''1402670''>screwed.</span> <span m=''1403700''>So</span>
  <span m=''1404530''>we</span> <span m=''1404630''>have</span> <span m=''1404780''>to</span>
  <span m=''1404870''>be</span> <span m=''1404970''>better at</span> <span m=''1405370''>educating</span>
  <span m=''1405930''>the</span> <span m=''1406010''>people</span> <span m=''1406290''>that
  are</span> <span m=''1406410''>using</span> <span m=''1406770''>our</span> <span
  m=''1406860''>API.</span> <span m=''1407080''>And</span> <span m=''1407180''>don''t</span>
  <span m=''1407340''>just throw it</span> <span m=''1407780''>over</span> <span m=''1407900''>the</span>
  <span m=''1408020''>fence</span> <span m=''1408270''>and</span> <span m=''1408350''>say</span>
  <span m=''1408450''>here''s</span> <span m=''1408630''>an</span> <span m=''1408710''>API.</span>
  <span m=''1409040''>Deal</span> <span m=''1409240''>with</span> <span m=''1409440''>it.</span>
  <span m=''1409970''>There</span> <span m=''1410160''>needs</span> <span m=''1410340''>to</span>
  <span m=''1410420''>be</span> <span m=''1410540''>some</span> <span m=''1410740''>interaction</span>
  <span m=''1411260''>between</span> <span m=''1411560''>them</span> <span m=''1411650''>to</span>
  <span m=''1411720''>make</span> <span m=''1411910''>sure</span> <span m=''1412080''>that</span>
  <span m=''1412380''>this</span> <span m=''1412620''>is</span> <span m=''1412750''>the</span>
  <span m=''1412830''>right</span> <span m=''1413040''>API</span> <span m=''1413430''>for</span>
  <span m=''1413570''>its</span> <span m=''1413710''>job.</span> </p><p><span m=''1416000''>This</span>
  <span m=''1416190''>is</span> <span m=''1416750''>the</span> <span m=''1416890''>next</span>
  <span m=''1417140''>case</span> <span m=''1417320''>study</span> <span m=''1417560''>I</span>
  <span m=''1417600''>want</span> <span m=''1417770''>to</span> <span m=''1417820''>talk</span>
  <span m=''1418040''>about.</span> <span m=''1419120''>This</span> <span m=''1419330''>one</span>
  <span m=''1419460''>actually</span> <span m=''1420440''>was</span> <span m=''1420690''>found</span>
  <span m=''1420910''>by</span> <span m=''1421040''>a</span> <span m=''1421090''>colleague</span>
  <span m=''1421490''>of</span> <span m=''1421560''>mine,</span> <span m=''1421900''>who</span>
  <span m=''1422270''>I''m</span> <span m=''1422560''>going</span> <span m=''1422830''>to</span>
  <span m=''1423060''>abbreviate as</span> <span m=''1423425''>RM.</span> <span m=''1423790''>Very</span>
  <span m=''1423990''>interesting</span> <span m=''1424490''>example.</span> <span
  m=''1425360''>For</span> <span m=''1425470''>those</span> <span m=''1425620''>of
  you  that</span> <span m=''1425810''>took</span> <span m=''1425970''>the</span>
  <span m=''1426030''>class</span> <span m=''1426270''>last</span> <span m=''1426480''>year,</span>
  <span m=''1426890''>I''m recycling</span> <span m=''1427370''>it.</span> <span m=''1427450''>But</span>
  <span m=''1427550''>it''s</span> <span m=''1427650''>a</span> <span m=''1427690''>good</span>
  <span m=''1427790''>example,</span> <span m=''1428120''>so</span> <span m=''1428410''>no</span>
  <span m=''1428560''>worries.</span> </p><p><span m=''1429100''>So</span> <span m=''1429210''>here''s</span>
  <span m=''1429370''>the</span> <span m=''1429430''>deal.</span> <span m=''1432100''>You''ve</span>
  <span m=''1432260''>got</span> <span m=''1432410''>a</span> <span m=''1432450''>benchmark.</span>
  <span m=''1434100''>And</span> <span m=''1434270''>I''ve</span> <span m=''1434380''>got</span>
  <span m=''1434620''>two</span> <span m=''1434950''>builds</span> <span m=''1435450''>of
  a</span> <span m=''1435620''>piece</span> <span m=''1435850''>of</span> <span m=''1435930''>software.</span>
  <span m=''1437020''>When</span> <span m=''1437240''>I</span> <span m=''1437300''>run</span>
  <span m=''1437540''>the</span> <span m=''1437630''>benchmark</span> <span m=''1438120''>against</span>
  <span m=''1438400''>that</span> <span m=''1438570''>piece</span> <span m=''1438770''>of</span>
  <span m=''1438850''>software,</span> <span m=''1439810''>in</span> <span m=''1440050''>case</span>
  <span m=''1440510''>a,</span> <span m=''1441140''>I</span> <span m=''1441270''>was</span>
  <span m=''1441450''>getting</span> <span m=''1441660''>a</span> <span m=''1441740''>throughput</span>
  <span m=''1442080''>of</span> <span m=''1442140''>100</span> <span m=''1442470''>operations</span>
  <span m=''1443050''>per</span> <span m=''1443360''>minute.</span> <span m=''1444860''>In</span>
  <span m=''1445050''>case</span> <span m=''1445450''>b,</span> <span m=''1445780''>I</span>
  <span m=''1445870''>was</span> <span m=''1446030''>getting</span> <span m=''1446240''>half</span>
  <span m=''1446505''>the</span> <span m=''1446770''>throughput.</span> <span m=''1447800''>And</span>
  <span m=''1448230''>what</span> <span m=''1448480''>was</span> <span m=''1448640''>the</span>
  <span m=''1448710''>difference</span> <span m=''1449110''>between</span> <span m=''1449310''>those</span>
  <span m=''1449500''>builds?</span> </p><p><span m=''1450270''>Well,</span> <span
  m=''1451120''>the</span> <span m=''1451260''>first</span> <span m=''1451630''>build,
  the</span> <span m=''1451960''>faster</span> <span m=''1452245''>build,</span> <span
  m=''1453370''>was</span> <span m=''1453620''>a</span> <span m=''1453700''>32-bit</span>
  <span m=''1454620''>executable</span> <span m=''1455440''>running</span> <span m=''1455750''>on</span>
  <span m=''1455860''>64-bit</span> <span m=''1456520''>hardware.</span> <span m=''1458120''>While</span>
  <span m=''1458470''>in</span> <span m=''1458540''>the</span> <span m=''1458780''>second</span>
  <span m=''1459010''>case,</span> <span m=''1459500''>it</span> <span m=''1459590''>was</span>
  <span m=''1459740''>a</span> <span m=''1459790''>64-bit</span> <span m=''1460620''>executable</span>
  <span m=''1461590''>running</span> <span m=''1461850''>on</span> <span m=''1461960''>64-bit</span>
  <span m=''1462580''>hardware.</span> <span m=''1463270''>Now</span> <span m=''1463490''>if</span>
  <span m=''1463560''>you''re</span> <span m=''1463680''>like</span> <span m=''1463910''>me--</span>
  <span m=''1465510''>which</span> <span m=''1465910''>hopefully</span> <span m=''1466240''>you''re</span>
  <span m=''1466270''>not--</span> <span m=''1466480''>but</span> <span m=''1466580''>if</span>
  <span m=''1466680''>you''re</span> <span m=''1466760''>like</span> <span m=''1466960''>me,</span>
  <span m=''1467130''>you</span> <span m=''1467220''>think</span> <span m=''1467420''>yourself,</span>
  <span m=''1467790''>well,</span> <span m=''1467900''>there</span> <span m=''1468050''>shouldn''t</span>
  <span m=''1468360''>be</span> <span m=''1468450''>much</span> <span m=''1468680''>difference</span>
  <span m=''1469000''>between</span> <span m=''1469200''>32-bit and</span> <span m=''1469620''>64-bit.</span>
  <span m=''1470120''>In</span> <span m=''1470200''>fact,</span> <span m=''1470420''>64-bit</span>
  <span m=''1470960''>should</span> <span m=''1471060''>be</span> <span m=''1471160''>a</span>
  <span m=''1471220''>lot</span> <span m=''1471430''>faster</span> <span m=''1471860''>for</span>
  <span m=''1471990''>a</span> <span m=''1472120''>lot</span> <span m=''1472280''>of</span>
  <span m=''1472360''>reasons</span> <span m=''1472620''>you''re going</span> <span
  m=''1472760''>to learn about</span> <span m=''1473090''>in 004.</span> </p><p><span
  m=''1473860''>So</span> <span m=''1474050''>the</span> <span m=''1474150''>question</span>
  <span m=''1474470''>is</span> <span m=''1474570''>what''s</span> <span m=''1474850''>going</span>
  <span m=''1475060''>on?</span> <span m=''1475130''>I</span> <span m=''1475170''>can</span>
  <span m=''1475360''>distinctly</span> <span m=''1476050''>remember</span> <span
  m=''1476680''>when</span> <span m=''1476870''>this</span> <span m=''1477050''>check-in</span>
  <span m=''1477450''>was</span> <span m=''1477670''>done,</span> <span m=''1478060''>somebody</span>
  <span m=''1478390''>said,</span> <span m=''1478520''>oh,</span> <span m=''1478580''>we''re</span>
  <span m=''1478690''>making</span> <span m=''1478990''>the</span> <span m=''1479090''>switch</span>
  <span m=''1479420''>over,</span> <span m=''1479630''>but it</span> <span m=''1479690''>shouldn''t</span>
  <span m=''1479910''>be</span> <span m=''1480030''>a</span> <span m=''1480080''>big</span>
  <span m=''1480270''>deal.</span> <span m=''1480440''>And foolishly,</span> <span
  m=''1481110''>like</span> <span m=''1481270''>a</span> <span m=''1481330''>moron,</span>
  <span m=''1481710''>I</span> <span m=''1481800''>actually</span> <span m=''1482210''>believed</span>
  <span m=''1482460''>that</span> <span m=''1482610''>person.</span> <span m=''1483160''>Very</span>
  <span m=''1483410''>bad</span> <span m=''1483630''>idea.</span> <span m=''1484220''>So</span>
  <span m=''1484560''>this</span> <span m=''1484710''>came</span> <span m=''1484820''>back</span>
  <span m=''1484960''>to</span> <span m=''1485030''>haunt</span> <span m=''1485230''>us</span>
  <span m=''1485320''>for</span> <span m=''1485400''>three</span> <span m=''1485570''>months.</span>
  </p><p><span m=''1486110''>So</span> <span m=''1486250''>what''s</span> <span m=''1486400''>the</span>
  <span m=''1486540''>deal?</span> <span m=''1487760''>Remember,</span> <span m=''1488550''>a</span>
  <span m=''1488620''>32-bit</span> <span m=''1488960''>executable</span> <span m=''1489510''>running</span>
  <span m=''1489750''>on</span> <span m=''1489870''>64-bit</span> <span m=''1490410''>code</span>
  <span m=''1490600''>was</span> <span m=''1490740''>faster</span> <span m=''1491190''>than</span>
  <span m=''1491330''>a</span> <span m=''1491380''>64-bit</span> <span m=''1491930''>executable</span>
  <span m=''1492670''>running</span> <span m=''1492900''>on</span> <span m=''1492980''>a</span>
  <span m=''1493020''>64-bit</span> <span m=''1493910''>application.</span> <span
  m=''1494760''>So</span> <span m=''1494950''>the</span> <span m=''1495040''>first</span>
  <span m=''1495330''>thing</span> <span m=''1495420''>we</span> <span m=''1495510''>do--</span>
  <span m=''1495770''>first</span> <span m=''1495920''>of all,</span> <span m=''1496070''>you''ve</span>
  <span m=''1496120''>got</span> <span m=''1496250''>to</span> <span m=''1496300''>find</span>
  <span m=''1496490''>the</span> <span m=''1496560''>right</span> <span m=''1496760''>tool</span>
  <span m=''1496910''>for</span> <span m=''1496980''>the</span> <span m=''1497050''>right</span>
  <span m=''1497260''>job.</span> <span m=''1497950''>In</span> <span m=''1498130''>this</span>
  <span m=''1498340''>case,</span> <span m=''1498570''>we</span> <span m=''1498720''>use</span>
  <span m=''1498920''>a</span> <span m=''1498970''>profiling</span> <span m=''1499520''>tool</span>
  <span m=''1499700''>called</span> <span m=''1499920''>Xperf.</span> </p><p><span
  m=''1500350''>Xperf</span> <span m=''1500740''>is</span> <span m=''1500870''>a</span>
  <span m=''1500920''>very</span> <span m=''1501300''>powerful</span> <span m=''1501750''>profiler,</span>
  <span m=''1502260''>kind</span> <span m=''1502560''>of</span> <span m=''1502650''>like</span>
  <span m=''1502950''>Vtune,</span> <span m=''1503550''>or</span> <span m=''1503740''>Valgrind,</span>
  <span m=''1504450''>or</span> <span m=''1504710''>Quantifier,</span> <span m=''1505300''>or</span>
  <span m=''1505430''>a</span> <span m=''1505490''>lot</span> <span m=''1505660''>of</span>
  <span m=''1505700''>the</span> <span m=''1505820''>other</span> <span m=''1505930''>tools</span>
  <span m=''1506190''>you''ve</span> <span m=''1506360''>used.</span> <span m=''1506790''>The</span>
  <span m=''1506900''>nice</span> <span m=''1507130''>thing</span> <span m=''1507270''>is
  it''s</span> <span m=''1507440''>built</span> <span m=''1507760''>into</span> <span
  m=''1507920''>the</span> <span m=''1508110''>OS.</span> <span m=''1508710''>It</span>
  <span m=''1508840''>runs</span> <span m=''1509070''>on</span> <span m=''1509170''>Windows</span>
  <span m=''1509450''>2008.</span> <span m=''1510240''>And</span> <span m=''1510380''>it''s</span>
  <span m=''1510480''>a</span> <span m=''1510530''>sampling</span> <span m=''1510970''>based</span>
  <span m=''1511240''>profiler</span> <span m=''1511680''>that has</span> <span m=''1511890''>a</span>
  <span m=''1511940''>lot</span> <span m=''1512130''>of</span> <span m=''1512200''>pretty</span>
  <span m=''1512430''>cool</span> <span m=''1512680''>attributes.</span> <span m=''1513220''>If</span>
  <span m=''1513370''>you</span> <span m=''1513520''>have</span> <span m=''1513690''>Windows</span>
  <span m=''1513770''>2008,</span> <span m=''1514770''>I</span> <span m=''1514850''>think</span>
  <span m=''1514970''>you ought</span> <span m=''1515140''>to just</span> <span m=''1515340''>go
  and</span> <span m=''1515530''>download it.</span> <span m=''1515990''>It''s</span>
  <span m=''1516140''>free.</span> <span m=''1516490''>And</span> <span m=''1516600''>play</span>
  <span m=''1516760''>with</span> <span m=''1516900''>it.</span> </p><p><span m=''1517840''>This</span>
  <span m=''1518020''>gives</span> <span m=''1518080''>a</span> <span m=''1518130''>lot</span>
  <span m=''1518270''>of</span> <span m=''1518310''>information</span> <span m=''1518640''>like</span>
  <span m=''1518790''>stack</span> <span m=''1519130''>traces,</span> <span m=''1519620''>caller/callee</span>
  <span m=''1520420''>information,</span> <span m=''1520920''>et</span> <span m=''1521040''>cetera.</span>
  <span m=''1521510''>It''s</span> <span m=''1522230''>potentially</span> <span m=''1523170''>the</span>
  <span m=''1523260''>perfect</span> <span m=''1523720''>tool</span> <span m=''1523880''>for</span>
  <span m=''1523970''>this</span> <span m=''1524140''>kind</span> <span m=''1524260''>of</span>
  <span m=''1524380''>job.</span> <span m=''1525230''>What</span> <span m=''1525620''>kind</span>
  <span m=''1525760''>of</span> <span m=''1525900''>output</span> <span m=''1526230''>does
  it</span> <span m=''1526410''>show?</span> </p><p><span m=''1526990''>In</span>
  <span m=''1527150''>this</span> <span m=''1527340''>case,</span> <span m=''1527530''>remember</span>
  <span m=''1527800''>the</span> <span m=''1527890''>setup.</span> <span m=''1528170''>The</span>
  <span m=''1528240''>setup</span> <span m=''1528480''>is</span> <span m=''1528580''>I</span>
  <span m=''1528670''>run</span> <span m=''1528830''>build</span> <span m=''1529030''>A.</span>
  <span m=''1529530''>And</span> <span m=''1529630''>I''m</span> <span m=''1529700''>getting</span>
  <span m=''1529970''>twice</span> <span m=''1530340''>as</span> <span m=''1530450''>much</span>
  <span m=''1530680''>throughput</span> <span m=''1530950''>as</span> <span m=''1531050''>running</span>
  <span m=''1531290''>build</span> <span m=''1531550''>B.</span> <span m=''1532120''>So</span>
  <span m=''1532300''>let''s</span> <span m=''1532510''>take</span> <span m=''1532730''>a</span>
  <span m=''1532780''>look</span> <span m=''1533010''>at</span> <span m=''1533230''>the</span>
  <span m=''1533310''>CPU</span> <span m=''1533740''>usage,</span> <span m=''1534110''>just</span>
  <span m=''1534240''>as a</span> <span m=''1534330''>first</span> <span m=''1534640''>cut</span>
  <span m=''1534760''>to</span> <span m=''1534800''>see</span> <span m=''1534960''>what''s</span>
  <span m=''1535120''>going</span> <span m=''1535360''>on.</span> </p><p><span m=''1536080''>In</span>
  <span m=''1536330''>the</span> <span m=''1536430''>64-bit</span> <span m=''1537190''>case,</span>
  <span m=''1537430''>which</span> <span m=''1537550''>is</span> <span m=''1537640''>what</span>
  <span m=''1537770''>I</span> <span m=''1537820''>showed</span> <span m=''1538130''>here.</span>
  <span m=''1538340''>I</span> <span m=''1538380''>showed</span> <span m=''1538490''>the
  output</span> <span m=''1538710''>of this</span> <span m=''1538890''>Xperf</span>
  <span m=''1539330''>for</span> <span m=''1539440''>64-bit.</span> <span m=''1540230''>What</span>
  <span m=''1540490''>you</span> <span m=''1540640''>can</span> <span m=''1540780''>see,</span>
  <span m=''1541090''>x-axis</span> <span m=''1541690''>is</span> <span m=''1541900''>just</span>
  <span m=''1542170''>time.</span> <span m=''1542490''>And</span> <span m=''1542570''>y-axis</span>
  <span m=''1543130''>is</span> <span m=''1543230''>CPU</span> <span m=''1543550''>usage.</span>
  <span m=''1543870''>It''s</span> <span m=''1544240''>totally</span> <span m=''1544810''>saturated.</span>
  <span m=''1545610''>In</span> <span m=''1545830''>the</span> <span m=''1546010''>64-bit</span>
  <span m=''1546690''>case,</span> <span m=''1547520''>we''re</span> <span m=''1547740''>completely</span>
  <span m=''1548190''>saturated.</span> <span m=''1548940''>Take</span> <span m=''1549230''>my</span>
  <span m=''1549270''>word</span> <span m=''1549510''>for</span> <span m=''1549660''>it,</span>
  <span m=''1549810''>in the 32-bit</span> <span m=''1550300''>case,</span> <span
  m=''1550520''>you''re</span> <span m=''1550640''>not.</span> <span m=''1551090''>And</span>
  <span m=''1551310''>this</span> <span m=''1551470''>accounts</span> <span m=''1551880''>for</span>
  <span m=''1551960''>the</span> <span m=''1552060''>difference.</span> <span m=''1552950''>So</span>
  <span m=''1553120''>now</span> <span m=''1553290''>let''s</span> <span m=''1553510''>dig</span>
  <span m=''1553710''>deeper</span> <span m=''1554020''>and</span> <span m=''1554100''>find</span>
  <span m=''1554350''>out</span> <span m=''1554590''>why</span> <span m=''1554910''>we''re</span>
  <span m=''1555040''>seeing</span> <span m=''1555320''>this</span> <span m=''1555510''>difference.</span>
  </p><p><span m=''1557940''>So</span> <span m=''1558420''>first,</span> <span m=''1558950''>we</span>
  <span m=''1559060''>look</span> <span m=''1559220''>at</span> <span m=''1559260''>the</span>
  <span m=''1559340''>sampling</span> <span m=''1559720''>profiler.</span> <span m=''1560370''>Now</span>
  <span m=''1560520''>there''s</span> <span m=''1560670''>a</span> <span m=''1560730''>lot</span>
  <span m=''1560900''>of</span> <span m=''1560980''>perils</span> <span m=''1561400''>of</span>
  <span m=''1561480''>using</span> <span m=''1561710''>sampling</span> <span m=''1562090''>profilers.</span>
  </p><p><span m=''1562970''>In</span> <span m=''1563170''>this</span> <span m=''1563310''>particular</span>
  <span m=''1563800''>case,</span> <span m=''1564080''>here''s</span> <span m=''1564290''>the</span>
  <span m=''1564370''>deal.</span> <span m=''1565090''>I''ve</span> <span m=''1565340''>got</span>
  <span m=''1565910''>a</span> <span m=''1566000''>process.</span> <span m=''1566690''>And</span>
  <span m=''1566810''>that</span> <span m=''1566980''>process</span> <span m=''1567490''>spawns</span>
  <span m=''1567770''>a</span> <span m=''1567810''>bunch</span> <span m=''1568060''>of</span>
  <span m=''1568150''>threads.</span> <span m=''1568820''>In</span> <span m=''1569000''>this</span>
  <span m=''1569220''>particular</span> <span m=''1569790''>view,</span> <span m=''1570220''>what</span>
  <span m=''1570500''>you''re</span> <span m=''1570640''>seeing</span> <span m=''1571130''>is</span>
  <span m=''1571530''>where</span> <span m=''1571820''>is</span> <span m=''1571920''>the</span>
  <span m=''1571990''>time</span> <span m=''1572270''>being</span> <span m=''1572470''>spent</span>
  <span m=''1572780''>in</span> <span m=''1572920''>this</span> <span m=''1573090''>process.</span>
  <span m=''1573840''>And</span> <span m=''1574000''>as</span> <span m=''1574140''>you</span>
  <span m=''1574260''>can</span> <span m=''1574370''>see,</span> <span m=''1574840''>most</span>
  <span m=''1575070''>of</span> <span m=''1575290''>the</span> <span m=''1575380''>time</span>
  <span m=''1575660''>is</span> <span m=''1575750''>spent</span> <span m=''1576520''>at</span>
  <span m=''1576760''>the</span> <span m=''1576840''>root,</span> <span m=''1577040''>which</span>
  <span m=''1577210''>kind</span> <span m=''1577320''>of</span> <span m=''1577430''>makes</span>
  <span m=''1577650''>sense.</span> <span m=''1577820''>Because</span> <span m=''1578060''>everything</span>
  <span m=''1578590''>in</span> <span m=''1578670''>some</span> <span m=''1578880''>sense</span>
  <span m=''1579150''>is a</span> <span m=''1579230''>child</span> <span m=''1579620''>of</span>
  <span m=''1579720''>the</span> <span m=''1579810''>root.</span> </p><p><span m=''1580610''>But</span>
  <span m=''1580750''>the</span> <span m=''1580830''>first</span> <span m=''1581120''>thing</span>
  <span m=''1581250''>our</span> <span m=''1581440''>poor</span> <span m=''1581710''>process</span>
  <span m=''1582180''>does,</span> <span m=''1582400''>it</span> <span m=''1582510''>spawns</span>
  <span m=''1582840''>a</span> <span m=''1582890''>bunch</span> <span m=''1583200''>of</span>
  <span m=''1583280''>child</span> <span m=''1583680''>threads.</span> <span m=''1585100''>So</span>
  <span m=''1585290''>clearly,</span> <span m=''1585660''>all</span> <span m=''1585820''>of</span>
  <span m=''1585980''>the</span> <span m=''1586090''>time</span> <span m=''1586320''>is</span>
  <span m=''1586380''>essentially</span> <span m=''1586800''>going</span> <span m=''1586930''>to</span>
  <span m=''1586980''>be</span> <span m=''1587090''>spent</span> <span m=''1587600''>in</span>
  <span m=''1587770''>the</span> <span m=''1587860''>routine</span> <span m=''1588340''>that</span>
  <span m=''1588550''>calls</span> <span m=''1589040''>all</span> <span m=''1589260''>of</span>
  <span m=''1589380''>these</span> <span m=''1589640''>threads,</span> <span m=''1589930''>because</span>
  <span m=''1590130''>that''s</span> <span m=''1590350''>the</span> <span m=''1590440''>first</span>
  <span m=''1590740''>entry</span> <span m=''1591050''>point.</span> <span m=''1591850''>But</span>
  <span m=''1592010''>unfortunately,</span> <span m=''1592570''>that''s</span> <span
  m=''1592770''>remarkably</span> <span m=''1593340''>unhelpful.</span> <span m=''1594370''>So</span>
  <span m=''1595310''>the</span> <span m=''1595430''>deal</span> <span m=''1595770''>is</span>
  <span m=''1595960''>we</span> <span m=''1596190''>have</span> <span m=''1596330''>to</span>
  <span m=''1596420''>dig</span> <span m=''1596680''>deeper</span> <span m=''1596980''>and</span>
  <span m=''1597060''>find</span> <span m=''1597330''>out,</span> <span m=''1597430''>where</span>
  <span m=''1597710''>is</span> <span m=''1597800''>this</span> <span m=''1597940''>time</span>
  <span m=''1598180''>actually</span> <span m=''1598570''>being</span> <span m=''1598780''>spent.</span>
  </p><p><span m=''1600480''>So</span> <span m=''1600670''>like</span> <span m=''1600910''>I</span>
  <span m=''1600960''>said,</span> <span m=''1601230''>just</span> <span m=''1601430''>to</span>
  <span m=''1601540''>kind</span> <span m=''1601730''>of</span> <span m=''1602390''>reiterate</span>
  <span m=''1602860''>the</span> <span m=''1602930''>point</span> <span m=''1603240''>that
  I</span> <span m=''1603280''>made</span> <span m=''1603450''>on</span> <span m=''1603510''>the</span>
  <span m=''1603580''>previous</span> <span m=''1603920''>slide.</span> <span m=''1604140''>The</span>
  <span m=''1604220''>point</span> <span m=''1604410''>is</span> <span m=''1604520''>that</span>
  <span m=''1604600''>your</span> <span m=''1604770''>entry</span> <span m=''1605020''>point</span>
  <span m=''1605370''>is</span> <span m=''1605560''>spawning</span> <span m=''1605820''>all</span>
  <span m=''1605920''>the</span> <span m=''1606010''>threads.</span> <span m=''1606330''>And</span>
  <span m=''1606390''>if</span> <span m=''1606470''>that''s</span> <span m=''1606670''>kind</span>
  <span m=''1606760''>of</span> <span m=''1606850''>the</span> <span m=''1606920''>starting</span>
  <span m=''1607260''>point</span> <span m=''1607470''>for</span> <span m=''1607630''>accounting,</span>
  <span m=''1608290''>you''re</span> <span m=''1608440''>not</span> <span m=''1608620''>going</span>
  <span m=''1608700''>to</span> <span m=''1608770''>get</span> <span m=''1608980''>any</span>
  <span m=''1609170''>help</span> <span m=''1609400''>if</span> <span m=''1609540''>you''re</span>
  <span m=''1609610''>just</span> <span m=''1609800''>looking</span> <span m=''1610140''>at</span>
  <span m=''1610250''>that</span> <span m=''1610460''>starting</span> <span m=''1610720''>point.</span>
  <span m=''1610860''>You</span> <span m=''1610940''>have</span> <span m=''1611010''>to</span>
  <span m=''1611110''>dig</span> <span m=''1611350''>a</span> <span m=''1611400''>little</span>
  <span m=''1611670''>bit</span> <span m=''1611910''>deeper.</span> <span m=''1613070''>And</span>
  <span m=''1613230''>so</span> <span m=''1615270''>what</span> <span m=''1615450''>I''m</span>
  <span m=''1615550''>basically</span> <span m=''1615930''>trying</span> <span m=''1616080''>to</span>
  <span m=''1616220''>say,</span> <span m=''1616410''>is</span> <span m=''1616520''>that</span>
  <span m=''1616710''>even</span> <span m=''1617010''>though</span> <span m=''1617080''>this</span>
  <span m=''1617130''>thing</span> <span m=''1617480''>records</span> <span m=''1617690''>stack</span>
  <span m=''1618020''>traces,</span> <span m=''1619540''>this</span> <span m=''1619950''>stack</span>
  <span m=''1620300''>happens</span> <span m=''1620620''>to</span> <span m=''1620730''>be</span>
  <span m=''1620830''>the</span> <span m=''1620910''>most</span> <span m=''1621130''>popular</span>
  <span m=''1621600''>stack.</span> <span m=''1622020''>But</span> <span m=''1622330''>it''s</span>
  <span m=''1622510''>not</span> <span m=''1622670''>actually</span> <span m=''1623010''>the</span>
  <span m=''1623090''>problem.</span> <span m=''1623400''>Because it''s</span> <span
  m=''1623550''>the</span> <span m=''1623620''>most</span> <span m=''1623800''>popular,</span>
  <span m=''1623980''>because</span> <span m=''1624340''>that''s</span> <span m=''1624480''>where</span>
  <span m=''1624630''>everybody</span> <span m=''1625030''>starts.</span> <span m=''1625330''>So</span>
  <span m=''1625470''>all</span> <span m=''1625750''>of the</span> <span m=''1625850''>time</span>
  <span m=''1626110''>that is</span> <span m=''1626300''>charged</span> <span m=''1626610''>gets</span>
  <span m=''1626760''>charged</span> <span m=''1627100''>to that</span> <span m=''1627290''>stack.</span>
  </p><p><span m=''1627860''>We</span> <span m=''1628040''>have</span> <span m=''1628150''>to</span>
  <span m=''1628270''>look</span> <span m=''1628460''>a</span> <span m=''1628510''>little</span>
  <span m=''1628740''>bit</span> <span m=''1628920''>deeper.</span> <span m=''1629620''>So</span>
  <span m=''1629950''>in</span> <span m=''1630080''>order</span> <span m=''1630290''>to</span>
  <span m=''1630410''>look</span> <span m=''1630580''>a</span> <span m=''1630620''>little</span>
  <span m=''1630800''>bit</span> <span m=''1630950''>deeper,</span> <span m=''1631260''>let''s</span>
  <span m=''1631480''>think</span> <span m=''1631640''>about</span> <span m=''1631810''>the</span>
  <span m=''1631890''>problem</span> <span m=''1632190''>in</span> <span m=''1632260''>a</span>
  <span m=''1632300''>slightly</span> <span m=''1632630''>different</span> <span m=''1632900''>way.</span>
  <span m=''1633870''>Suppose</span> <span m=''1634270''>I''ve</span> <span m=''1634370''>got</span>
  <span m=''1634520''>my</span> <span m=''1634660''>root.</span> <span m=''1635550''>That''s</span>
  <span m=''1635810''>where</span> <span m=''1635950''>everything</span> <span m=''1636310''>starts.</span>
  <span m=''1636760''>That''s</span> <span m=''1636950''>where</span> <span m=''1637110''>all</span>
  <span m=''1637180''>the threads</span> <span m=''1637530''>are</span> <span m=''1637690''>spawned,</span>
  <span m=''1638140''>whatever.</span> <span m=''1638240''>And suppose</span> <span
  m=''1638620''>I</span> <span m=''1638760''>have</span> <span m=''1638890''>three</span>
  <span m=''1639190''>paths</span> <span m=''1640010''>to</span> <span m=''1640190''>a</span>
  <span m=''1640260''>tiny</span> <span m=''1640600''>little</span> <span m=''1640800''>function</span>
  <span m=''1641180''>at</span> <span m=''1641270''>the</span> <span m=''1641340''>very</span>
  <span m=''1641660''>end.</span> <span m=''1643760''>Maybe</span> <span m=''1644130''>I''m</span>
  <span m=''1644210''>spending</span> <span m=''1644540''>all</span> <span m=''1644710''>of</span>
  <span m=''1644780''>my</span> <span m=''1644930''>time</span> <span m=''1645330''>in</span>
  <span m=''1645430''>the</span> <span m=''1645510''>path</span> <span m=''1645830''>that</span>
  <span m=''1645940''>I''ve</span> <span m=''1646100''>indicated.</span> </p><p><span
  m=''1647530''>But</span> <span m=''1648220''>the</span> <span m=''1648390''>problem</span>
  <span m=''1648830''>is</span> <span m=''1648950''>that--</span> <span m=''1649980''>suppose</span>
  <span m=''1650260''>you''re</span> <span m=''1650360''>spending</span> <span m=''1650620''>all</span>
  <span m=''1650830''>of</span> <span m=''1650900''>your</span> <span m=''1651000''>time</span>
  <span m=''1651260''>in</span> <span m=''1651310''>that</span> <span m=''1651500''>tiny</span>
  <span m=''1651780''>little</span> <span m=''1651980''>function,</span> <span m=''1652990''>and</span>
  <span m=''1653160''>suppose</span> <span m=''1653530''>it''s</span> <span m=''1653680''>equally</span>
  <span m=''1654040''>spent</span> <span m=''1654410''>among</span> <span m=''1655050''>these</span>
  <span m=''1655360''>other</span> <span m=''1655530''>three</span> <span m=''1655730''>paths.</span>
  <span m=''1656120''>Well,</span> <span m=''1657360''>it''s</span> <span m=''1657550''>not</span>
  <span m=''1657830''>any</span> <span m=''1658070''>path</span> <span m=''1658340''>that''s</span>
  <span m=''1658450''>kind</span> <span m=''1658600''>of</span> <span m=''1658740''>screwed
  up.</span> <span m=''1659010''>It''s</span> <span m=''1659250''>that that</span>
  <span m=''1659420''>tiny</span> <span m=''1659680''>function is</span> <span m=''1660120''>kind</span>
  <span m=''1660230''>of</span> <span m=''1660330''>messed</span> <span m=''1660620''>up.</span>
  </p><p><span m=''1660700''>So</span> <span m=''1660800''>you</span> <span m=''1660850''>got</span>
  <span m=''1660960''>to</span> <span m=''1661020''>figure</span> <span m=''1661290''>out</span>
  <span m=''1661400''>why</span> <span m=''1661620''>are you</span> <span m=''1661750''>spending</span>
  <span m=''1662030''>time</span> <span m=''1662220''>in</span> <span m=''1662290''>that</span>
  <span m=''1662360''>tiny</span> <span m=''1662640''>function?</span> <span m=''1663350''>And</span>
  <span m=''1663530''>is</span> <span m=''1663630''>there</span> <span m=''1663740''>something</span>
  <span m=''1664100''>that</span> <span m=''1664210''>you</span> <span m=''1664330''>can</span>
  <span m=''1664440''>do</span> <span m=''1664570''>to</span> <span m=''1664640''>fix</span>
  <span m=''1664970''>that?</span> <span m=''1666090''>So</span> <span m=''1666610''>let''s</span>
  <span m=''1666910''>look</span> <span m=''1667330''>from</span> <span m=''1667480''>the</span>
  <span m=''1667600''>opposite</span> <span m=''1668090''>perspective.</span> <span
  m=''1668540''>Let''s</span> <span m=''1668770''>look</span> <span m=''1668900''>at</span>
  <span m=''1669020''>the</span> <span m=''1669120''>caller</span> <span m=''1669650''>view.</span>
  <span m=''1670850''>In</span> <span m=''1671000''>this</span> <span m=''1671200''>case,</span>
  <span m=''1671610''>what</span> <span m=''1671800''>I</span> <span m=''1671860''>did</span>
  <span m=''1672000''>was</span> <span m=''1672100''>I</span> <span m=''1672160''>looked</span>
  <span m=''1672420''>at</span> <span m=''1672480''>a</span> <span m=''1672530''>bunch</span>
  <span m=''1672930''>of</span> <span m=''1673040''>different</span> <span m=''1673350''>routines,</span>
  <span m=''1673820''>a</span> <span m=''1673870''>bunch</span> <span m=''1674090''>of</span>
  <span m=''1674140''>these</span> <span m=''1674270''>different</span> <span m=''1674540''>so-called</span>
  <span m=''1674940''>tiny</span> <span m=''1675340''>functions.</span> <span m=''1676080''>And</span>
  <span m=''1676200''>I</span> <span m=''1676250''>looked</span> <span m=''1676500''>at</span>
  <span m=''1676570''>what</span> <span m=''1676710''>was</span> <span m=''1676890''>calling</span>
  <span m=''1677400''>those</span> <span m=''1677620''>tiny</span> <span m=''1677900''>functions.</span>
  <span m=''1678640''>It</span> <span m=''1678780''>turns</span> <span m=''1679030''>out</span>
  <span m=''1679140''>that</span> <span m=''1679230''>here''s</span> <span m=''1679510''>a</span>
  <span m=''1679560''>call,</span> <span m=''1680030''>ZwQueryVirtualMemory</span>
  <span m=''1681290''>some</span> <span m=''1681470''>tiny</span> <span m=''1681760''>function.</span>
  <span m=''1682280''>It</span> <span m=''1682390''>happens</span> <span m=''1682720''>to</span>
  <span m=''1682930''>be--</span> <span m=''1683010''>it</span> <span m=''1683090''>turns</span>
  <span m=''1683370''>out</span> <span m=''1683520''>that</span> <span m=''1683630''>we''re</span>
  <span m=''1683770''>spending,</span> <span m=''1684200''>as</span> <span m=''1684410''>it</span>
  <span m=''1684490''>indicates,</span> <span m=''1685050''>77%</span> <span m=''1686030''>of</span>
  <span m=''1686120''>our</span> <span m=''1686220''>time</span> <span m=''1686950''>in</span>
  <span m=''1687170''>this</span> <span m=''1687430''>tiny</span> <span m=''1688000''>function.</span>
  </p><p><span m=''1689480''>And</span> <span m=''1689530''>just</span> <span m=''1689740''>to</span>
  <span m=''1689800''>emphasize</span> <span m=''1690450''>that</span> <span m=''1690640''>this</span>
  <span m=''1690790''>is</span> <span m=''1690930''>not</span> <span m=''1691330''>being</span>
  <span m=''1691560''>called</span> <span m=''1691830''>from</span> <span m=''1692070''>the</span>
  <span m=''1692160''>root.</span> <span m=''1692450''>So</span> <span m=''1692570''>you</span>
  <span m=''1692690''>don''t</span> <span m=''1692880''>see</span> <span m=''1693030''>it
  from</span> <span m=''1693180''>your</span> <span m=''1693270''>first</span> <span
  m=''1693540''>glance.</span> <span m=''1694190''>You</span> <span m=''1694370''>can</span>
  <span m=''1694510''>see</span> <span m=''1694720''>that</span> <span m=''1694850''>the</span>
  <span m=''1694930''>number</span> <span m=''1695220''>of</span> <span m=''1695300''>times</span>
  <span m=''1695600''>this</span> <span m=''1695720''>tiny</span> <span m=''1696060''>function</span>
  <span m=''1696410''>was</span> <span m=''1696590''>called</span> <span m=''1696790''>from</span>
  <span m=''1696990''>the</span> <span m=''1697190''>root</span> <span m=''1697700''>is</span>
  <span m=''1697900''>0.34%.</span> <span m=''1699600''>So</span> <span m=''1699780''>if</span>
  <span m=''1699860''>you were</span> <span m=''1700090''>just</span> <span m=''1700300''>looking</span>
  <span m=''1700530''>from</span> <span m=''1700630''>the</span> <span m=''1700710''>root</span>
  <span m=''1700890''>and trying</span> <span m=''1701240''>to figure out</span> <span
  m=''1701470''>what''s being</span> <span m=''1701650''>called</span> <span m=''1701870''>from</span>
  <span m=''1702010''>the</span> <span m=''1702090''>root.</span> <span m=''1702520''>It</span>
  <span m=''1702890''>would</span> <span m=''1702980''>be</span> <span m=''1703100''>totally</span>
  <span m=''1703570''>useless.</span> <span m=''1703940''>Instead,</span> <span m=''1704070''>you</span>
  <span m=''1704120''>have</span> <span m=''1704310''>to</span> <span m=''1704360''>dig</span>
  <span m=''1704560''>deeper.</span> <span m=''1704830''>And</span> <span m=''1704910''>see</span>
  <span m=''1705200''>all</span> <span m=''1705450''>the</span> <span m=''1705520''>different</span>
  <span m=''1705790''>functions</span> <span m=''1706120''>that are</span> <span m=''1706200''>being</span>
  <span m=''1706400''>called.</span> <span m=''1706640''>And</span> <span m=''1706730''>find</span>
  <span m=''1706950''>out</span> <span m=''1707060''>where they''re</span> <span m=''1707350''>being</span>
  <span m=''1707560''>called</span> <span m=''1707840''>from.</span> </p><p><span
  m=''1708440''>So</span> <span m=''1708610''>we</span> <span m=''1708730''>know</span>
  <span m=''1708890''>that</span> <span m=''1709020''>this</span> <span m=''1709200''>function,</span>
  <span m=''1709530''>ZwQueryVirtualMemory,</span> <span m=''1710740''>is taking</span>
  <span m=''1711010''>like</span> <span m=''1711240''>70%</span> <span m=''1711770''>of</span>
  <span m=''1711920''>the</span> <span m=''1712010''>CPU,</span> <span m=''1712430''>which
  is an</span> <span m=''1712800''>enormously</span> <span m=''1713500''>large</span>
  <span m=''1713810''>amount</span> <span m=''1714010''>of</span> <span m=''1714070''>CPU.</span>
  <span m=''1714740''>We</span> <span m=''1714960''>also</span> <span m=''1715200''>know</span>
  <span m=''1715370''>what''s</span> <span m=''1715730''>calling</span> <span m=''1716280''>it</span>
  <span m=''1717780''>are</span> <span m=''1717940''>these</span> <span m=''1718250''>two</span>
  <span m=''1718450''>routines</span> <span m=''1718910''>right</span> <span m=''1719130''>here.</span>
  <span m=''1719270''>This</span> <span m=''1719490''>thing,</span> <span m=''1719720''>this</span>
  <span m=''1719870''>magical</span> <span m=''1720310''>thing</span> <span m=''1720500''>called</span>
  <span m=''1720680''>RTDynamicCast</span> <span m=''1721710''>and</span> <span m=''1721780''>RTtypeid.</span>
  <span m=''1722710''>So</span> <span m=''1722880''>it</span> <span m=''1722960''>turns</span>
  <span m=''1723190''>out</span> <span m=''1723260''>we</span> <span m=''1723350''>have</span>
  <span m=''1723430''>two</span> <span m=''1723640''>paths</span> <span m=''1725790''>that</span>
  <span m=''1725990''>are</span> <span m=''1726220''>going</span> <span m=''1726340''>to</span>
  <span m=''1726460''>this</span> <span m=''1726580''>tiny</span> <span m=''1726840''>function.</span>
  <span m=''1727340''>And</span> <span m=''1727500''>those</span> <span m=''1727740''>two</span>
  <span m=''1727910''>paths</span> <span m=''1729070''>comprise</span> <span m=''1729440''>most</span>
  <span m=''1729680''>of</span> <span m=''1729730''>the</span> <span m=''1729830''>calls</span>
  <span m=''1730160''>to</span> <span m=''1730240''>this</span> <span m=''1730320''>tiny</span>
  <span m=''1730570''>function.</span> <span m=''1731180''>And</span> <span m=''1731340''>it</span>
  <span m=''1731420''>turns</span> <span m=''1731610''>out</span> <span m=''1731660''>we''re</span>
  <span m=''1731790''>spending</span> <span m=''1732000''>a</span> <span m=''1732040''>boatload</span>
  <span m=''1732430''>of</span> <span m=''1732500''>time</span> <span m=''1732740''>in</span>
  <span m=''1732800''>this</span> <span m=''1732930''>tiny</span> <span m=''1733190''>function.</span>
  </p><p><span m=''1734800''>So</span> <span m=''1734980''>let''s</span> <span m=''1735210''>dig</span>
  <span m=''1735410''>deeper</span> <span m=''1735650''>and</span> <span m=''1735730''>find</span>
  <span m=''1735880''>out</span> <span m=''1736030''>what</span> <span m=''1736210''>on
  earth</span> <span m=''1736540''>these</span> <span m=''1736690''>two</span> <span
  m=''1736980''>routines</span> <span m=''1737280''>are.</span> <span m=''1737360''>What</span>
  <span m=''1737550''>is</span> <span m=''1737660''>RTtypeid?</span> <span m=''1738550''>What</span>
  <span m=''1738680''>is</span> <span m=''1738890''>RTDynamicCast,</span> <span m=''1739920''>whatever?</span>
  <span m=''1741070''>So</span> <span m=''1741250''>let''s</span> <span m=''1741440''>first</span>
  <span m=''1741700''>look</span> <span m=''1741840''>at</span> <span m=''1741900''>RTDynamicCast.</span>
  <span m=''1742850''>What</span> <span m=''1743060''>I show</span> <span m=''1743340''>here--</span>
  <span m=''1743890''>in</span> <span m=''1744050''>contrast</span> <span m=''1744550''>to
  the</span> <span m=''1744630''>previous</span> <span m=''1744970''>view.</span>
  <span m=''1745420''>The previous view</span> <span m=''1745570''>said,</span> <span
  m=''1745930''>I</span> <span m=''1746080''>have</span> <span m=''1746210''>a</span>
  <span m=''1746270''>tiny</span> <span m=''1746560''>function.</span> <span m=''1747080''>What</span>
  <span m=''1747380''>are</span> <span m=''1747430''>the</span> <span m=''1747530''>people</span>
  <span m=''1747830''>that</span> <span m=''1747980''>call</span> <span m=''1748270''>me?</span>
  <span m=''1748800''>Let''s</span> <span m=''1749060''>look</span> <span m=''1749230''>at</span>
  <span m=''1749300''>the</span> <span m=''1749380''>reverse.</span> <span m=''1749690''>Let''s</span>
  <span m=''1749930''>go</span> <span m=''1750230''>and</span> <span m=''1750400''>start</span>
  <span m=''1750650''>at</span> <span m=''1750740''>one</span> <span m=''1750880''>of</span>
  <span m=''1750940''>these</span> <span m=''1751090''>two</span> <span m=''1751250''>routines,</span>
  <span m=''1751630''>RTtypeid.</span> <span m=''1752540''>And</span> <span m=''1752710''>figure</span>
  <span m=''1753010''>out</span> <span m=''1753180''>what</span> <span m=''1753570''>it''s</span>
  <span m=''1753850''>calling</span> <span m=''1754720''>that</span> <span m=''1754860''>is</span>
  <span m=''1754960''>spending</span> <span m=''1755330''>so</span> <span m=''1755480''>much</span>
  <span m=''1755670''>time,</span> <span m=''1755870''>and</span> <span m=''1756000''>ultimately</span>
  <span m=''1756350''>leads</span> <span m=''1756760''>to us</span> <span m=''1756960''>calling</span>
  <span m=''1757260''>that</span> <span m=''1757450''>ZwQueryVirtualMemory</span>
  <span m=''1759160''>or</span> <span m=''1759200''>whatever.</span> </p><p><span
  m=''1760090''>And</span> <span m=''1760220''>as</span> <span m=''1760390''>you</span>
  <span m=''1760510''>can</span> <span m=''1760620''>see,</span> <span m=''1760780''>this</span>
  <span m=''1760910''>RTtypeid,</span> <span m=''1762250''>it</span> <span m=''1762380''>calls</span>
  <span m=''1762650''>two</span> <span m=''1762850''>functions</span> <span m=''1763300''>primarily.</span>
  <span m=''1763870''>One</span> <span m=''1764150''>is</span> <span m=''1764270''>incrementing</span>
  <span m=''1764900''>a</span> <span m=''1765030''>reference</span> <span m=''1765450''>counter.</span>
  <span m=''1765735''>And the</span> <span m=''1766020''>other</span> <span m=''1766280''>is</span>
  <span m=''1766540''>decrementing</span> <span m=''1766920''>a reference</span> <span
  m=''1767270''>counter.</span> <span m=''1767600''>Now</span> <span m=''1767710''>you''re</span>
  <span m=''1767860''>thinking to</span> <span m=''1768190''>yourself,</span> <span
  m=''1768580''>incrementing</span> <span m=''1768970''>a</span> <span m=''1769030''>reference</span>
  <span m=''1769370''>counter,</span> <span m=''1769650''>decrementing</span> <span
  m=''1770190''>a</span> <span m=''1770240''>reference</span> <span m=''1770580''>counter</span>
  <span m=''1770770''>should</span> <span m=''1770900''>be</span> <span m=''1771020''>very</span>
  <span m=''1771290''>simple,</span> <span m=''1771630''>very</span> <span m=''1771860''>low</span>
  <span m=''1772040''>CPU,</span> <span m=''1772530''>and</span> <span m=''1772640''>basically</span>
  <span m=''1772970''>should</span> <span m=''1773120''>cost</span> <span m=''1773340''>you</span>
  <span m=''1773420''>nothing.</span> <span m=''1773970''>And</span> <span m=''1774110''>all</span>
  <span m=''1774200''>of</span> <span m=''1774280''>those three</span> <span m=''1774540''>assumptions</span>
  <span m=''1774940''>are</span> <span m=''1775010''>dead</span> <span m=''1775210''>wrong,</span>
  <span m=''1775500''>unfortunately.</span> </p><p><span m=''1776280''>So</span> <span
  m=''1776450''>let''s</span> <span m=''1776620''>try</span> <span m=''1776770''>to</span>
  <span m=''1776840''>understand</span> <span m=''1777240''>a</span> <span m=''1777290''>little</span>
  <span m=''1777490''>bit</span> <span m=''1777580''>as</span> <span m=''1777670''>to</span>
  <span m=''1777770''>why</span> <span m=''1777950''>that''s</span> <span m=''1778190''>happening.</span>
  <span m=''1778960''>Turns</span> <span m=''1779230''>out</span> <span m=''1779340''>RTtypeid</span>
  <span m=''1780400''>is</span> <span m=''1780640''>used</span> <span m=''1780970''>in</span>
  <span m=''1781030''>order</span> <span m=''1781170''>to</span> <span m=''1781260''>figure</span>
  <span m=''1781590''>out</span> <span m=''1781690''>the</span> <span m=''1782290''>C++</span>
  <span m=''1782520''>type</span> <span m=''1782860''>of</span> <span m=''1782960''>an</span>
  <span m=''1783040''>object.</span> <span m=''1783380''>So</span> <span m=''1783510''>we''re</span>
  <span m=''1783630''>trying</span> <span m=''1783810''>to</span> <span m=''1783880''>figure</span>
  <span m=''1784070''>this</span> <span m=''1784250''>out</span> <span m=''1784350''>on</span>
  <span m=''1784500''>the</span> <span m=''1784580''>fly.</span> <span m=''1785200''>And</span>
  <span m=''1785680''>as</span> <span m=''1785950''>I</span> <span m=''1786030''>said,</span>
  <span m=''1786260''>it''s</span> <span m=''1786400''>kind</span> <span m=''1786570''>of</span>
  <span m=''1786640''>mystifying</span> <span m=''1787200''>that</span> <span m=''1787360''>this</span>
  <span m=''1787520''>routine,</span> <span m=''1787950''>which</span> <span m=''1788120''>calls</span>
  <span m=''1788330''>our</span> <span m=''1788400''>tiny</span> <span m=''1788670''>function,</span>
  <span m=''1789000''>that you''re spending</span> <span m=''1789170''>39%</span>
  <span m=''1790250''>overall</span> <span m=''1790990''>in</span> <span m=''1791200''>this</span>
  <span m=''1791380''>routine</span> <span m=''1791660''>in</span> <span m=''1791790''>that</span>
  <span m=''1791960''>tiny</span> <span m=''1792210''>function.</span> <span m=''1793930''>So</span>
  <span m=''1794450''>let''s</span> <span m=''1794720''>figure</span> <span m=''1794930''>out</span>
  <span m=''1794990''>what''s</span> <span m=''1795170''>going</span> <span m=''1795390''>on</span>
  <span m=''1795500''>by</span> <span m=''1795600''>looking</span> <span m=''1795890''>at</span>
  <span m=''1795970''>a</span> <span m=''1796010''>simple</span> <span m=''1796300''>example,</span>
  <span m=''1796710''>which</span> <span m=''1796880''>would</span> <span m=''1796980''>be</span>
  <span m=''1797100''>IncRef.</span> </p><p><span m=''1797880''>So</span> <span m=''1798060''>it</span>
  <span m=''1798140''>turns</span> <span m=''1798370''>out</span> <span m=''1798420''>if</span>
  <span m=''1798500''>you''re</span> <span m=''1798610''>looking</span> <span m=''1798850''>at</span>
  <span m=''1798910''>this</span> <span m=''1799080''>code,</span> <span m=''1799890''>the</span>
  <span m=''1800170''>dreadful</span> <span m=''1800660''>line</span> <span m=''1801080''>is</span>
  <span m=''1801370''>the</span> <span m=''1801460''>fact</span> <span m=''1801710''>that</span>
  <span m=''1801820''>we''re</span> <span m=''1801930''>doing</span> <span m=''1802140''>const</span>
  <span m=''1802440''>type</span> <span m=''1802740''>info</span> <span m=''1803240''>reference</span>
  <span m=''1803870''>tinfo</span> <span m=''1804320''>equals</span> <span m=''1804610''>typeid</span>
  <span m=''1805250''>of</span> <span m=''1805460''>*this.</span> <span m=''1806880''>This</span>
  <span m=''1807180''>is</span> <span m=''1807350''>basically,</span> <span m=''1807830''>you
  have</span> <span m=''1807960''>to</span> <span m=''1808060''>call</span> <span
  m=''1808270''>RTtypeid</span> <span m=''1809030''>to</span> <span m=''1809090''>get</span>
  <span m=''1809250''>this</span> <span m=''1809390''>kind</span> <span m=''1809560''>of</span>
  <span m=''1809610''>information.</span> <span m=''1810470''>And</span> <span m=''1811460''>in</span>
  <span m=''1811610''>order</span> <span m=''1811780''>to</span> <span m=''1811880''>do</span>
  <span m=''1812010''>that,</span> <span m=''1812150''>you</span> <span m=''1812210''>need</span>
  <span m=''1812350''>some</span> <span m=''1812530''>runtime</span> <span m=''1813270''>type</span>
  <span m=''1813520''>information.</span> <span m=''1814580''>This</span> <span m=''1814790''>runtime</span>
  <span m=''1815380''>type</span> <span m=''1815650''>information</span> <span m=''1816260''>has</span>
  <span m=''1816490''>some</span> <span m=''1816700''>pointers</span> <span m=''1817180''>associated</span>
  <span m=''1817830''>with</span> <span m=''1818020''>it.</span> </p><p><span m=''1818720''>So</span>
  <span m=''1819580''>here''s</span> <span m=''1819830''>the</span> <span m=''1819910''>deal.</span>
  <span m=''1820120''>Whether</span> <span m=''1820340''>I''m</span> <span m=''1820430''>running</span>
  <span m=''1820620''>a</span> <span m=''1820660''>32-bit--</span> <span m=''1821610''>Remember,</span>
  <span m=''1821870''>we even</span> <span m=''1822210''>forgot</span> <span m=''1822480''>the</span>
  <span m=''1822570''>original</span> <span m=''1822860''>problem,</span> <span m=''1823200''>which
  is,</span> <span m=''1823300''>gee,</span> <span m=''1823520''>I''m</span> <span
  m=''1823640''>32-bit,</span> <span m=''1824420''>64-bit</span> <span m=''1825030''>executable--</span>
  <span m=''1825870''>sorry</span> <span m=''1826040''>32-bit</span> <span m=''1826280''>executable</span>
  <span m=''1826560''>on</span> <span m=''1826840''>64-bit</span> <span m=''1827400''>hardware.</span>
  <span m=''1827910''>We</span> <span m=''1828070''>were</span> <span m=''1828180''>slower</span>
  <span m=''1828520''>than</span> <span m=''1828620''>a</span> <span m=''1828860''>64-bit--</span>
  <span m=''1829450''>we</span> <span m=''1829600''>were</span> <span m=''1829660''>faster</span>
  <span m=''1829980''>than</span> <span m=''1830060''>a</span> <span m=''1830130''>64-bit</span>
  <span m=''1830630''>executable</span> <span m=''1830940''>on</span> <span m=''1831150''>64-bit</span>
  <span m=''1831670''>hardware.</span> <span m=''1831900''>Let''s</span> <span m=''1831990''>try</span>
  <span m=''1832110''>to</span> <span m=''1832160''>figure</span> <span m=''1832390''>out</span>
  <span m=''1832480''>why.</span> </p><p><span m=''1833330''>Well,</span> <span m=''1834600''>remember,</span>
  <span m=''1835300''>every</span> <span m=''1835550''>time I</span> <span m=''1835730''>increment</span>
  <span m=''1836000''>or decrement</span> <span m=''1836310''>a</span> <span m=''1836780''>reference</span>
  <span m=''1836920''>counter,</span> <span m=''1837300''>I</span> <span m=''1837400''>get</span>
  <span m=''1837610''>some</span> <span m=''1837730''>type</span> <span m=''1837950''>information</span>
  <span m=''1838620''>by</span> <span m=''1838860''>consulting</span> <span m=''1839310''>this</span>
  <span m=''1839430''>runtime</span> <span m=''1839820''>type</span> <span m=''1840020''>information.</span>
  <span m=''1840700''>It''s</span> <span m=''1840890''>got</span> <span m=''1841040''>a</span>
  <span m=''1841080''>bunch</span> <span m=''1841290''>of</span> <span m=''1841360''>pointers.</span>
  <span m=''1842270''>When</span> <span m=''1842630''>I</span> <span m=''1842720''>run</span>
  <span m=''1842930''>a</span> <span m=''1842990''>32-bit</span> <span m=''1843770''>executable</span>
  <span m=''1844500''>on</span> <span m=''1844610''>64-bit</span> <span m=''1845210''>hardware,</span>
  <span m=''1846060''>those</span> <span m=''1846460''>pointers</span> <span m=''1846990''>are</span>
  <span m=''1847100''>just</span> <span m=''1847290''>raw</span> <span m=''1847760''>32-bit</span>
  <span m=''1848380''>pointers.</span> <span m=''1848640''>You</span> <span m=''1848780''>just</span>
  <span m=''1848920''>look</span> <span m=''1849090''>them</span> <span m=''1849220''>up,</span>
  <span m=''1849340''>and</span> <span m=''1849440''>you''re</span> <span m=''1849540''>done.</span>
  </p><p><span m=''1850660''>In</span> <span m=''1850840''>64-bit,</span> <span m=''1851680''>pretty</span>
  <span m=''1851910''>much</span> <span m=''1852080''>the</span> <span m=''1852200''>only</span>
  <span m=''1852390''>difference</span> <span m=''1852800''>is</span> <span m=''1852880''>that</span>
  <span m=''1853020''>instead</span> <span m=''1853300''>of</span> <span m=''1853370''>those</span>
  <span m=''1853570''>pointers</span> <span m=''1853940''>being</span> <span m=''1854350''>actual</span>
  <span m=''1854720''>pointers,</span> <span m=''1855360''>they''re</span> <span m=''1855560''>32-bit</span>
  <span m=''1856490''>offsets.</span> <span m=''1857490''>So you</span> <span m=''1857770''>take</span>
  <span m=''1858080''>the</span> <span m=''1858220''>offset,</span> <span m=''1859580''>you</span>
  <span m=''1859760''>add</span> <span m=''1860020''>it</span> <span m=''1860100''>to</span>
  <span m=''1860160''>the</span> <span m=''1860280''>base</span> <span m=''1860660''>address</span>
  <span m=''1861080''>of</span> <span m=''1861170''>the</span> <span m=''1861260''>DLL</span>
  <span m=''1861860''>of</span> <span m=''1861930''>the</span> <span m=''1862090''>executable</span>
  <span m=''1862680''>or</span> <span m=''1862740''>whatever,</span> <span m=''1864270''>where</span>
  <span m=''1864460''>that</span> <span m=''1864670''>runtime</span> <span m=''1865070''>typeid</span>
  <span m=''1865540''>call</span> <span m=''1865960''>is being</span> <span m=''1866080''>made.</span>
  <span m=''1866400''>And</span> <span m=''1866480''>then</span> <span m=''1866590''>you''re</span>
  <span m=''1866720''>done.</span> <span m=''1868090''>Once</span> <span m=''1868400''>you''ve</span>
  <span m=''1868520''>added</span> <span m=''1868760''>that</span> <span m=''1868890''>offset,</span>
  <span m=''1869130''>you</span> <span m=''1869240''>get a</span> <span m=''1869400''>64-bit</span>
  <span m=''1869880''>pointer.</span> <span m=''1870360''>You</span> <span m=''1870510''>look</span>
  <span m=''1870720''>up</span> <span m=''1870810''>that</span> <span m=''1870890''>64-bit</span>
  <span m=''1871590''>pointer,</span> <span m=''1871880''>everybody''s</span> <span
  m=''1872340''>happy.</span> </p><p><span m=''1873520''>So</span> <span m=''1873710''>here''s</span>
  <span m=''1873880''>the</span> <span m=''1873960''>deal.</span> <span m=''1874540''>Remember,</span>
  <span m=''1874860''>we</span> <span m=''1874980''>said</span> <span m=''1875150''>32-bit''s</span>
  <span m=''1875550''>faster.</span> <span m=''1876140''>32-bit</span> <span m=''1876520''>is</span>
  <span m=''1876620''>just</span> <span m=''1876790''>a</span> <span m=''1876830''>pointer</span>
  <span m=''1877160''>look</span> <span m=''1877350''>up.</span> <span m=''1877450''>And</span>
  <span m=''1877530''>then</span> <span m=''1877940''>you''re</span> <span m=''1878070''>done.</span>
  <span m=''1878490''>64-bit''s</span> <span m=''1879100''>slower.</span> <span m=''1879670''>It''s</span>
  <span m=''1879870''>a</span> <span m=''1879930''>pointer</span> <span m=''1880330''>look</span>
  <span m=''1880580''>up--</span> <span m=''1881030''>and</span> <span m=''1881190''>it''s</span>
  <span m=''1881320''>an</span> <span m=''1881400''>addition</span> <span m=''1881850''>plus</span>
  <span m=''1882070''>a</span> <span m=''1882120''>pointer</span> <span m=''1882410''>look</span>
  <span m=''1882640''>up.</span> </p><p><span m=''1884640''>So</span> <span m=''1884750''>I</span>
  <span m=''1884830''>pause,</span> <span m=''1885170''>because</span> <span m=''1885410''>you''re</span>
  <span m=''1885510''>thinking</span> <span m=''1885700''>to</span> <span m=''1885770''>yourself,</span>
  <span m=''1886140''>an</span> <span m=''1886230''>addition</span> <span m=''1886690''>plus</span>
  <span m=''1886880''>a</span> <span m=''1886940''>pointer</span> <span m=''1887250''>look</span>
  <span m=''1887440''>up</span> <span m=''1887550''>versus</span> <span m=''1887770''>a</span>
  <span m=''1887840''>pointer</span> <span m=''1888140''>look</span> <span m=''1888360''>up.</span>
  <span m=''1888800''>Does</span> <span m=''1888950''>that</span> <span m=''1889090''>mean</span>
  <span m=''1889190''>that</span> <span m=''1889310''>addition</span> <span m=''1889700''>is</span>
  <span m=''1889790''>slow?</span> <span m=''1889980''>That</span> <span m=''1890180''>sounds</span>
  <span m=''1890380''>really</span> <span m=''1890660''>stupid.</span> <span m=''1891260''>And</span>
  <span m=''1891420''>by</span> <span m=''1891570''>the</span> <span m=''1891660''>way,</span>
  <span m=''1891770''>it</span> <span m=''1891870''>is</span> <span m=''1892080''>really</span>
  <span m=''1892350''>stupid.</span> <span m=''1892670''>It''s</span> <span m=''1892780''>not</span>
  <span m=''1892950''>true.</span> </p><p><span m=''1893570''>So</span> <span m=''1893720''>the</span>
  <span m=''1893820''>deal</span> <span m=''1894070''>is</span> <span m=''1894160''>this.</span>
  <span m=''1894320''>It''s</span> <span m=''1894440''>not</span> <span m=''1894730''>that</span>
  <span m=''1894900''>addition</span> <span m=''1895570''>to</span> <span m=''1895710''>create</span>
  <span m=''1895940''>a</span> <span m=''1895970''>64-bit</span> <span m=''1896560''>pointer
  is</span> <span m=''1896930''>slow.</span> <span m=''1897810''>The</span> <span
  m=''1897920''>deal</span> <span m=''1898210''>is</span> <span m=''1898320''>that--</span>
  <span m=''1898370''>remember</span> <span m=''1898660''>this</span> <span m=''1898800''>2-step</span>
  <span m=''1899170''>process.</span> <span m=''1899850''>You</span> <span m=''1899990''>find</span>
  <span m=''1900360''>out</span> <span m=''1900470''>the</span> <span m=''1900560''>base</span>
  <span m=''1900900''>address</span> <span m=''1901310''>of</span> <span m=''1901400''>a</span>
  <span m=''1901450''>module.</span> <span m=''1901810''>And</span> <span m=''1901890''>you</span>
  <span m=''1902060''>add</span> <span m=''1902380''>this</span> <span m=''1902570''>offset</span>
  <span m=''1903020''>to</span> <span m=''1903090''>that</span> <span m=''1903250''>base</span>
  <span m=''1903490''>address.</span> </p><p><span m=''1904220''>Determining</span>
  <span m=''1904830''>that</span> <span m=''1905060''>base</span> <span m=''1905340''>address</span>
  <span m=''1906020''>is</span> <span m=''1906210''>really,</span> <span m=''1906890''>really</span>
  <span m=''1907300''>slow.</span> <span m=''1908540''>It</span> <span m=''1908700''>turns</span>
  <span m=''1908850''>out</span> <span m=''1908900''>you</span> <span m=''1909000''>have</span>
  <span m=''1909080''>to</span> <span m=''1909190''>call</span> <span m=''1909400''>a</span>
  <span m=''1909450''>bunch</span> <span m=''1909770''>of</span> <span m=''1909860''>different</span>
  <span m=''1910110''>random</span> <span m=''1910510''>routines</span> <span m=''1911700''>that</span>
  <span m=''1911730''>have</span> <span m=''1911870''>to</span> <span m=''1911980''>walk</span>
  <span m=''1912410''>the</span> <span m=''1912490''>list</span> <span m=''1912820''>of</span>
  <span m=''1912900''>loaded</span> <span m=''1913360''>modules.</span> <span m=''1913640''>And</span>
  <span m=''1913920''>you''re</span> <span m=''1914060''>doing</span> <span m=''1914200''>this</span>
  <span m=''1914510''>every</span> <span m=''1914810''>single</span> <span m=''1915060''>time</span>
  <span m=''1915230''>you</span> <span m=''1915310''>call</span> <span m=''1915490''>this</span>
  <span m=''1915580''>routine.</span> <span m=''1916130''>And</span> <span m=''1916410''>if
  you increment</span> <span m=''1916730''>a</span> <span m=''1916800''>reference</span>
  <span m=''1917190''>whenever</span> <span m=''1917660''>you</span> <span m=''1917830''>do</span>
  <span m=''1917990''>a</span> <span m=''1918060''>memory</span> <span m=''1918400''>allocation,</span>
  <span m=''1918860''>you</span> <span m=''1918960''>can</span> <span m=''1919050''>imagine</span>
  <span m=''1919370''>that</span> <span m=''1919480''>this</span> <span m=''1919610''>is</span>
  <span m=''1919720''>going</span> <span m=''1919820''>to</span> <span m=''1919870''>consume</span>
  <span m=''1920670''>a</span> <span m=''1920780''>lot of</span> <span m=''1921240''>CPU.</span>
  </p><p><span m=''1922630''>So</span> <span m=''1922860''>it</span> <span m=''1922950''>turns</span>
  <span m=''1923190''>out,</span> <span m=''1923380''>this</span> <span m=''1923560''>is</span>
  <span m=''1923650''>what''s</span> <span m=''1923860''>actually</span> <span m=''1924230''>slow.</span>
  <span m=''1924810''>And</span> <span m=''1925300''>remember,</span> <span m=''1925650''>that</span>
  <span m=''1925760''>we</span> <span m=''1925870''>started</span> <span m=''1926130''>this</span>
  <span m=''1926290''>off</span> <span m=''1926420''>a</span> <span m=''1926470''>little</span>
  <span m=''1926670''>by</span> <span m=''1926810''>saying, oh,</span> <span m=''1926990''>we''ve</span>
  <span m=''1927090''>got</span> <span m=''1927220''>this</span> <span m=''1927340''>weird</span>
  <span m=''1927600''>function,</span> <span m=''1927950''>ZwQueryVirtualMemory,</span>
  <span m=''1929210''>which</span> <span m=''1929400''>seems</span> <span m=''1929600''>to</span>
  <span m=''1929740''>be being</span> <span m=''1929990''>called</span> <span m=''1930310''>a</span>
  <span m=''1930440''>lot</span> <span m=''1930830''>from</span> <span m=''1930910''>a</span>
  <span m=''1930950''>bunch</span> <span m=''1931160''>of</span> <span m=''1931230''>different</span>
  <span m=''1931500''>places.</span> <span m=''1932320''>The</span> <span m=''1932430''>reason</span>
  <span m=''1932730''>it''s</span> <span m=''1932890''>called</span> <span m=''1933110''>a</span>
  <span m=''1933150''>lot</span> <span m=''1933280''>is</span> <span m=''1933400''>because</span>
  <span m=''1933730''>all</span> <span m=''1933980''>of</span> <span m=''1934080''>these</span>
  <span m=''1934270''>routines</span> <span m=''1934750''>to</span> <span m=''1934850''>get</span>
  <span m=''1935020''>typeid</span> <span m=''1935390''>information</span> <span m=''1935850''>are</span>
  <span m=''1936020''>calling</span> <span m=''1936460''>this</span> <span m=''1936640''>routine.</span>
  <span m=''1937550''>So</span> <span m=''1937730''>there''s</span> <span m=''1937920''>actually</span>
  <span m=''1938320''>two</span> <span m=''1938510''>solutions.</span> <span m=''1939060''>And</span>
  <span m=''1939310''>you</span> <span m=''1939430''>can</span> <span m=''1939570''>look</span>
  <span m=''1939760''>on</span> <span m=''1939880''>this</span> <span m=''1940020''>blog
  to</span> <span m=''1940520''>actually</span> <span m=''1940780''>figure</span>
  <span m=''1941120''>out</span> <span m=''1941250''>that this</span> <span m=''1941460''>is</span>
  <span m=''1941560''>a</span> <span m=''1941620''>known</span> <span m=''1941960''>problem</span>
  <span m=''1942220''>that</span> <span m=''1942300''>Microsoft</span> <span m=''1943030''>eventually</span>
  <span m=''1943530''>fixed.</span> </p><p><span m=''1944270''>And</span> <span m=''1944520''>it</span>
  <span m=''1944630''>turns</span> <span m=''1944860''>out,</span> <span m=''1944960''>that</span>
  <span m=''1945070''>the</span> <span m=''1945160''>two</span> <span m=''1945360''>solutions</span>
  <span m=''1947340''>end</span> <span m=''1947540''>up</span> <span m=''1947690''>being</span>
  <span m=''1947960''>that</span> <span m=''1948350''>you</span> <span m=''1948490''>can</span>
  <span m=''1948620''>either</span> <span m=''1949280''>statically</span> <span m=''1949400''>compute</span>
  <span m=''1949730''>that</span> <span m=''1949920''>base</span> <span m=''1950190''>address</span>
  <span m=''1950465''>so</span> <span m=''1950740''>you''re</span> <span m=''1950780''>not</span>
  <span m=''1950960''>constantly</span> <span m=''1951570''>relooking</span> <span
  m=''1952380''>it</span> <span m=''1952460''>up</span> <span m=''1952580''>every</span>
  <span m=''1952790''>single</span> <span m=''1953090''>time.</span> <span m=''1953530''>But</span>
  <span m=''1953720''>there''s</span> <span m=''1953880''>actually</span> <span m=''1954270''>a</span>
  <span m=''1954320''>much</span> <span m=''1954560''>simpler and</span> <span m=''1955050''>stupider</span>
  <span m=''1955430''>solution,</span> <span m=''1955810''>which</span> <span m=''1955940''>is,</span>
  <span m=''1956180''>use</span> <span m=''1956470''>the</span> <span m=''1956560''>latest</span>
  <span m=''1956900''>runtime</span> <span m=''1957330''>library</span> <span m=''1957660''>where
  they</span> <span m=''1957790''>have</span> <span m=''1957920''>actually</span>
  <span m=''1958270''>fixed</span> <span m=''1958670''>this</span> <span m=''1958920''>problem.</span>
  </p><p><span m=''1959940''>So</span> <span m=''1961060''>just</span> <span m=''1961220''>to</span>
  <span m=''1961530''>summarize</span> <span m=''1961890''>what</span> <span m=''1961960''>was</span>
  <span m=''1962120''>going</span> <span m=''1962380''>on.</span> <span m=''1963610''>We</span>
  <span m=''1963750''>were</span> <span m=''1964590''>CPU</span> <span m=''1964920''>saturated.</span>
  <span m=''1965670''>We</span> <span m=''1965800''>looked</span> <span m=''1966030''>from</span>
  <span m=''1966170''>the</span> <span m=''1966260''>top</span> <span m=''1966630''>down.</span>
  <span m=''1966850''>We</span> <span m=''1966950''>didn''t</span> <span m=''1967130''>notice</span>
  <span m=''1967420''>anything.</span> <span m=''1967850''>We</span> <span m=''1968030''>looked</span>
  <span m=''1968270''>from</span> <span m=''1968330''>the</span> <span m=''1968410''>bottom</span>
  <span m=''1968810''>up.</span> <span m=''1969070''>And</span> <span m=''1969140''>we</span>
  <span m=''1969320''>noticed that some</span> <span m=''1969590''>bottom was</span>
  <span m=''1970000''>being</span> <span m=''1970230''>called</span> <span m=''1970500''>a</span>
  <span m=''1970540''>lot.</span> <span m=''1970930''>We</span> <span m=''1971150''>figured</span>
  <span m=''1971460''>out</span> <span m=''1971570''>where</span> <span m=''1971730''>that</span>
  <span m=''1971960''>bottom</span> <span m=''1972220''>was</span> <span m=''1972350''>being</span>
  <span m=''1972550''>called</span> <span m=''1972770''>by</span> <span m=''1972840''>looking</span>
  <span m=''1973090''>at</span> <span m=''1973840''>caller/callee</span> <span m=''1974660''>views.</span>
  </p><p><span m=''1975240''>Once</span> <span m=''1975470''>we</span> <span m=''1975540''>figured</span>
  <span m=''1975750''>out</span> <span m=''1975810''>where</span> <span m=''1975980''>it
  was</span> <span m=''1976020''>being called,</span> <span m=''1976370''>we</span>
  <span m=''1976450''>then</span> <span m=''1976570''>tried</span> <span m=''1976720''>to</span>
  <span m=''1976810''>figure</span> <span m=''1977040''>out</span> <span m=''1977150''>why</span>
  <span m=''1977340''>that</span> <span m=''1977530''>thing</span> <span m=''1977650''>was</span>
  <span m=''1977790''>being</span> <span m=''1978010''>called.</span> <span m=''1978490''>And</span>
  <span m=''1978600''>then</span> <span m=''1978660''>we</span> <span m=''1978770''>fixed</span>
  <span m=''1979010''>the</span> <span m=''1979090''>problem.</span> <span m=''1979960''>So</span>
  <span m=''1981140''>to</span> <span m=''1981300''>me,</span> <span m=''1981490''>I</span>
  <span m=''1981520''>guess</span> <span m=''1981720''>the</span> <span m=''1981820''>take-home</span>
  <span m=''1982130''>lesson</span> <span m=''1982480''>from</span> <span m=''1982660''>this</span>
  <span m=''1983260''>is</span> <span m=''1983490''>that</span> <span m=''1984380''>when</span>
  <span m=''1984520''>that</span> <span m=''1984660''>developer</span> <span m=''1985070''>said</span>
  <span m=''1985260''>to</span> <span m=''1985320''>me,</span> <span m=''1985450''>three</span>
  <span m=''1985630''>months</span> <span m=''1985840''>before</span> <span m=''1986080''>this</span>
  <span m=''1986240''>whole</span> <span m=''1986410''>debacle</span> <span m=''1986790''>started,</span>
  <span m=''1987110''>he</span> <span m=''1987210''>said,</span> <span m=''1987350''>oh,</span>
  <span m=''1987470''>yeah,</span> <span m=''1987680''>we''re</span> <span m=''1987940''>switching</span>
  <span m=''1988260''>from</span> <span m=''1988400''>say</span> <span m=''1988540''>32
  to</span> <span m=''1988930''>64-bit.</span> <span m=''1989520''>That''s</span>
  <span m=''1989710''>not</span> <span m=''1989850''>a</span> <span m=''1989890''>big</span>
  <span m=''1990060''>deal.</span> <span m=''1990980''>You</span> <span m=''1991070''>can''t</span>
  <span m=''1991280''>really</span> <span m=''1991430''>take</span> <span m=''1991620''>that</span>
  <span m=''1991730''>stuff</span> <span m=''1991830''>at</span> <span m=''1991920''>face</span>
  <span m=''1992190''>value,</span> <span m=''1992490''>because</span> <span m=''1992680''>a</span>
  <span m=''1992750''>lot</span> <span m=''1992890''>of</span> <span m=''1993020''>little</span>
  <span m=''1993280''>things</span> <span m=''1993520''>can</span> <span m=''1993650''>really</span>
  <span m=''1993920''>add</span> <span m=''1994070''>up.</span> <span m=''1994180''>And</span>
  <span m=''1994280''>we</span> <span m=''1994380''>could</span> <span m=''1994550''>never</span>
  <span m=''1994810''>have really</span> <span m=''1995040''>guessed</span> <span
  m=''1995320''>that</span> <span m=''1995380''>this</span> <span m=''1995550''>would</span>
  <span m=''1995650''>happen</span> <span m=''1996400''>beforehand.</span> </p><p><span
  m=''1999070''>So</span> <span m=''1999740''>that''s</span> <span m=''2000120''>four.</span>
  <span m=''2000360''>Let</span> <span m=''2000450''>me</span> <span m=''2000540''>go</span>
  <span m=''2000660''>over</span> <span m=''2000830''>another</span> <span m=''2001060''>one.</span>
  <span m=''2001800''>Memory</span> <span m=''2002180''>usage.</span> <span m=''2003150''>So</span>
  <span m=''2003910''>excessive--</span> <span m=''2004690''>I''m</span> <span m=''2004840''>sure</span>
  <span m=''2005060''>actually</span> <span m=''2005370''>all</span> <span m=''2005570''>of</span>
  <span m=''2005660''>you</span> <span m=''2006110''>know</span> <span m=''2006560''>that</span>
  <span m=''2006680''>memory</span> <span m=''2006960''>usage</span> <span m=''2007220''>is</span>
  <span m=''2007300''>a</span> <span m=''2007340''>big</span> <span m=''2007560''>problem.</span>
  <span m=''2008130''>Your</span> <span m=''2008360''>application</span> <span m=''2008910''>is
  going</span> <span m=''2009010''>to slow down</span> <span m=''2009500''>if</span>
  <span m=''2009560''>you''re inducing</span> <span m=''2010030''>a</span> <span m=''2010080''>lot</span>
  <span m=''2010240''>of</span> <span m=''2010330''>paging.</span> <span m=''2011130''>And</span>
  <span m=''2011580''>at</span> <span m=''2011670''>least</span> <span m=''2011880''>in</span>
  <span m=''2011980''>32-bit</span> <span m=''2012580''>Windows,</span> <span m=''2012950''>if</span>
  <span m=''2013030''>you</span> <span m=''2013160''>exceed</span> <span m=''2013520''>two</span>
  <span m=''2013700''>gigabytes</span> <span m=''2014190''>for</span> <span m=''2014260''>the</span>
  <span m=''2014330''>process</span> <span m=''2014605''>that</span> <span m=''2014880''>you''re</span>
  <span m=''2014940''>running,</span> <span m=''2015450''>the</span> <span m=''2015610''>process</span>
  <span m=''2016060''>is</span> <span m=''2016160''>just</span> <span m=''2016320''>going</span>
  <span m=''2016400''>to</span> <span m=''2016470''>crash.</span> <span m=''2017090''>So</span>
  <span m=''2017240''>you</span> <span m=''2017370''>clearly</span> <span m=''2017700''>do</span>
  <span m=''2017940''>care</span> <span m=''2018290''>about</span> <span m=''2018480''>memory</span>
  <span m=''2018780''>usage.</span> </p><p><span m=''2020030''>And</span> <span m=''2020540''>I</span>
  <span m=''2020660''>want</span> <span m=''2020870''>to</span> <span m=''2021750''>differentiate</span>
  <span m=''2022690''>between</span> <span m=''2023010''>memory</span> <span m=''2023320''>leaks</span>
  <span m=''2023600''>and</span> <span m=''2023660''>memory</span> <span m=''2023870''>accumulation.</span>
  <span m=''2024610''>You''re</span> <span m=''2024730''>wondering</span> <span m=''2025030''>why</span>
  <span m=''2025190''>would a</span> <span m=''2025340''>process</span> <span m=''2025700''>take</span>
  <span m=''2025880''>up</span> <span m=''2025950''>two</span> <span m=''2026090''>gigabytes</span>
  <span m=''2026520''>of</span> <span m=''2026580''>memory.</span> <span m=''2026840''>Well,</span>
  <span m=''2027160''>one</span> <span m=''2027460''>is</span> <span m=''2027540''>that</span>
  <span m=''2027660''>maybe</span> <span m=''2027830''>you</span> <span m=''2027970''>have</span>
  <span m=''2028050''>a</span> <span m=''2028130''>leak.</span> <span m=''2028440''>You
  allocate</span> <span m=''2028830''>something.</span> <span m=''2029090''>You</span>
  <span m=''2029160''>don''t</span> <span m=''2029340''>remove</span> <span m=''2029520''>it.</span>
  </p><p><span m=''2030320''>That</span> <span m=''2030370''>might</span> <span m=''2030570''>just
  be an</span> <span m=''2030880''>accumulation.</span> <span m=''2031630''>You</span>
  <span m=''2031770''>allocate</span> <span m=''2032200''>something</span> <span m=''2032500''>somewhere</span>
  <span m=''2032850''>in</span> <span m=''2032900''>your</span> <span m=''2033080''>code,</span>
  <span m=''2033320''>you</span> <span m=''2033420''>actually</span> <span m=''2033710''>are</span>
  <span m=''2034170''>freeing</span> <span m=''2034620''>it.</span> <span m=''2034950''>But</span>
  <span m=''2035100''>the</span> <span m=''2035170''>trouble</span> <span m=''2035430''>is</span>
  <span m=''2035500''>that</span> <span m=''2035650''>routine</span> <span m=''2035870''>never</span>
  <span m=''2036070''>gets</span> <span m=''2036260''>called,</span> <span m=''2036480''>because</span>
  <span m=''2036700''>in</span> <span m=''2036780''>your</span> <span m=''2036960''>code</span>
  <span m=''2037240''>logic</span> <span m=''2037730''>you</span> <span m=''2037880''>never</span>
  <span m=''2038940''>take</span> <span m=''2039130''>the</span> <span m=''2039220''>time</span>
  <span m=''2039420''>to</span> <span m=''2039470''>think</span> <span m=''2039750''>and</span>
  <span m=''2039840''>say,</span> <span m=''2039970''>OK,</span> <span m=''2040180''>can</span>
  <span m=''2040340''>I</span> <span m=''2040450''>actually</span> <span m=''2040790''>get</span>
  <span m=''2040970''>rid</span> <span m=''2041170''>of</span> <span m=''2041250''>this</span>
  <span m=''2041490''>at</span> <span m=''2041750''>this</span> <span m=''2041980''>point.</span>
  <span m=''2043250''>And</span> <span m=''2043370''>that''s</span> <span m=''2043560''>what</span>
  <span m=''2043690''>I''m</span> <span m=''2043780''>going</span> <span m=''2043860''>to</span>
  <span m=''2043940''>call</span> <span m=''2044140''>a</span> <span m=''2044210''>memory</span>
  <span m=''2044790''>accumulation.</span> </p><p><span m=''2046340''>There''s</span>
  <span m=''2046500''>a</span> <span m=''2046570''>lot</span> <span m=''2046710''>of</span>
  <span m=''2046830''>different</span> <span m=''2047130''>tools</span> <span m=''2047390''>out</span>
  <span m=''2047500''>there to</span> <span m=''2047650''>analyze</span> <span m=''2048090''>memory</span>
  <span m=''2048389''>usage.</span> <span m=''2048980''>And</span> <span m=''2049480''>the</span>
  <span m=''2049590''>sad</span> <span m=''2049889''>part</span> <span m=''2050060''>about</span>
  <span m=''2050340''>this</span> <span m=''2050480''>is</span> <span m=''2050620''>that</span>
  <span m=''2050750''>almost</span> <span m=''2051070''>none</span> <span m=''2051260''>of</span>
  <span m=''2051340''>them</span> <span m=''2051489''>work</span> <span m=''2051719''>for</span>
  <span m=''2051800''>the</span> <span m=''2051889''>particular</span> <span m=''2052330''>example</span>
  <span m=''2052710''>that</span> <span m=''2052840''>we</span> <span m=''2052929''>have,</span>
  <span m=''2053100''>because</span> <span m=''2053300''>they</span> <span m=''2053400''>just</span>
  <span m=''2053949''>didn''t</span> <span m=''2054330''>scale</span> <span m=''2054719''>very</span>
  <span m=''2054969''>well.</span> <span m=''2055360''>It''s</span> <span m=''2055570''>fine</span>
  <span m=''2055860''>if you''ve got your</span> <span m=''2056159''>toy,</span> <span
  m=''2056400''>stupid</span> <span m=''2056719''>little</span> <span m=''2056909''>application</span>
  <span m=''2057389''>that</span> <span m=''2057469''>does</span> <span m=''2057600''>addition</span>
  <span m=''2057960''>in</span> <span m=''2058040''>a</span> <span m=''2058110''>loop.</span>
  <span m=''2058550''>Not</span> <span m=''2058770''>so</span> <span m=''2058860''>fine
  if</span> <span m=''2059110''>you''ve</span> <span m=''2059250''>got an</span> <span
  m=''2059380''>enterprising</span> <span m=''2059780''>middleware</span> <span m=''2060120''>application.</span>
  </p><p><span m=''2060650''>So</span> <span m=''2060770''>we</span> <span m=''2060889''>ended</span>
  <span m=''2061080''>up,</span> <span m=''2061570''>despite</span> <span m=''2061870''>all</span>
  <span m=''2061980''>the</span> <span m=''2062179''>tools</span> <span m=''2062449''>that</span>
  <span m=''2062520''>we</span> <span m=''2062590''>have</span> <span m=''2062699''>available,</span>
  <span m=''2063370''>we</span> <span m=''2063570''>ended</span> <span m=''2063730''>up</span>
  <span m=''2063770''>having</span> <span m=''2064000''>to</span> <span m=''2064060''>write</span>
  <span m=''2064280''>our</span> <span m=''2064500''>own.</span> <span m=''2064780''>I</span>
  <span m=''2064929''>didn''t</span> <span m=''2065080''>do</span> <span m=''2065170''>this,</span>
  <span m=''2065300''>a</span> <span m=''2065360''>colleague</span> <span m=''2065690''>did.</span>
  <span m=''2065860''>But</span> <span m=''2066270''>anyway,</span> <span m=''2067250''>I</span>
  <span m=''2067320''>guess</span> <span m=''2067469''>that</span> <span m=''2067580''>distinction</span>
  <span m=''2067900''>doesn''t</span> <span m=''2068040''>really</span> <span m=''2068239''>matter.</span>
  <span m=''2068610''>But</span> <span m=''2068750''>anyway,</span> <span m=''2068940''>the</span>
  <span m=''2069030''>point</span> <span m=''2069260''>is</span> <span m=''2069360''>that</span>
  <span m=''2069460''>you</span> <span m=''2069560''>do</span> <span m=''2069760''>a</span>
  <span m=''2069790''>lot</span> <span m=''2070070''>of what</span> <span m=''2070230''>these</span>
  <span m=''2070360''>other</span> <span m=''2070520''>tools</span> <span m=''2070760''>do.</span>
  <span m=''2070880''>But</span> <span m=''2071010''>you</span> <span m=''2071110''>do</span>
  <span m=''2071230''>it</span> <span m=''2071350''>special</span> <span m=''2071690''>to</span>
  <span m=''2071770''>your</span> <span m=''2071929''>environment.</span> </p><p><span
  m=''2072580''>In</span> <span m=''2072670''>this</span> <span m=''2072820''>case,</span>
  <span m=''2073020''>we</span> <span m=''2073120''>just</span> <span m=''2073239''>hooked</span>
  <span m=''2073480''>a</span> <span m=''2073530''>lot</span> <span m=''2073690''>of</span>
  <span m=''2073760''>the</span> <span m=''2073820''>calls</span> <span m=''2074110''>to</span>
  <span m=''2074210''>malloc.</span> <span m=''2075000''>And</span> <span m=''2075120''>we</span>
  <span m=''2075230''>figure</span> <span m=''2075489''>out</span> <span m=''2075639''>what</span>
  <span m=''2075830''>pointers</span> <span m=''2076190''>are</span> <span m=''2076270''>live.</span>
  <span m=''2076670''>And</span> <span m=''2076760''>then</span> <span m=''2076920''>we</span>
  <span m=''2078219''>do</span> <span m=''2078520''>stuff</span> <span m=''2078719''>from</span>
  <span m=''2078840''>there.</span> <span m=''2079179''>This</span> <span m=''2079360''>is</span>
  <span m=''2079489''>how</span> <span m=''2079580''>normal</span> <span m=''2079949''>tools</span>
  <span m=''2080179''>work.</span> <span m=''2080409''>And</span> <span m=''2080480''>of</span>
  <span m=''2080560''>course,</span> <span m=''2080800''>this</span> <span m=''2080989''>can</span>
  <span m=''2081100''>be</span> <span m=''2081250''>unusably</span> <span m=''2081889''>slow</span>
  <span m=''2082449''>if</span> <span m=''2082560''>you</span> <span m=''2082659''>do</span>
  <span m=''2082780''>a</span> <span m=''2082830''>ton</span> <span m=''2083000''>of</span>
  <span m=''2083090''>allocations.</span> </p><p><span m=''2083760''>For</span> <span
  m=''2083870''>example,</span> <span m=''2084400''>if</span> <span m=''2084440''>you''re</span>
  <span m=''2084530''>doing</span> <span m=''2084710''>millions</span> <span m=''2085000''>of</span>
  <span m=''2085090''>allocations</span> <span m=''2085630''>per</span> <span m=''2085739''>second,</span>
  <span m=''2086040''>you</span> <span m=''2086120''>can</span> <span m=''2086239''>imagine</span>
  <span m=''2086530''>you''re</span> <span m=''2086639''>calling</span> <span m=''2086920''>this</span>
  <span m=''2087050''>kind</span> <span m=''2087170''>of</span> <span m=''2087290''>routine,</span>
  <span m=''2087820''>which</span> <span m=''2088050''>itself--</span> <span m=''2088489''>if</span>
  <span m=''2088650''>it</span> <span m=''2088690''>only</span> <span m=''2088880''>has</span>
  <span m=''2089080''>a</span> <span m=''2089520''>10x</span> <span m=''2089880''>overhead</span>
  <span m=''2090280''>over</span> <span m=''2091380''>a</span> <span m=''2091780''>call</span>
  <span m=''2092030''>without</span> <span m=''2092340''>that,</span> <span m=''2092460''>you''re</span>
  <span m=''2092590''>slowing</span> <span m=''2092870''>down</span> <span m=''2093030''>your</span>
  <span m=''2093150''>program</span> <span m=''2093469''>by</span> <span m=''2093570''>10x</span>
  <span m=''2093969''>for</span> <span m=''2094080''>every</span> <span m=''2094300''>single</span>
  <span m=''2094510''>memory</span> <span m=''2094770''>allocation.</span> <span m=''2095270''>That
  means</span> <span m=''2095540''>performance</span> <span m=''2095989''>depends</span>
  <span m=''2096239''>on</span> <span m=''2096310''>how</span> <span m=''2096429''>many</span>
  <span m=''2096550''>allocations</span> <span m=''2097020''>you do,</span> <span
  m=''2097670''>which</span> <span m=''2097880''>is</span> <span m=''2097960''>really</span>
  <span m=''2098220''>bad.</span> </p><p><span m=''2098800''>And</span> <span m=''2098950''>just</span>
  <span m=''2099120''>to</span> <span m=''2099180''>illustrate</span> <span m=''2099540''>what</span>
  <span m=''2099690''>I</span> <span m=''2099830''>mean</span> <span m=''2100030''>by</span>
  <span m=''2100230''>a leak.</span> <span m=''2100440''>My</span> <span m=''2100580''>definition</span>
  <span m=''2100800''>is</span> <span m=''2100990''>basically</span> <span m=''2101390''>that</span>
  <span m=''2101500''>you''ve</span> <span m=''2101600''>got</span> <span m=''2101750''>this</span>
  <span m=''2101870''>routine,</span> <span m=''2102550''>foo.</span> <span m=''2103210''>And</span>
  <span m=''2103350''>it</span> <span m=''2103460''>mallocs</span> <span m=''2103850''>some</span>
  <span m=''2104080''>data.</span> <span m=''2104600''>But</span> <span m=''2104830''>it</span>
  <span m=''2104980''>returns</span> <span m=''2105430''>without</span> <span m=''2105670''>freeing</span>
  <span m=''2106010''>that</span> <span m=''2106210''>data.</span> <span m=''2106620''>And</span>
  <span m=''2106780''>nowhere</span> <span m=''2107140''>else</span> <span m=''2107360''>in</span>
  <span m=''2107440''>the</span> <span m=''2107540''>code</span> <span m=''2107770''>log</span>
  <span m=''2108040''>did you</span> <span m=''2108170''>actually</span> <span m=''2108410''>have</span>
  <span m=''2108560''>a</span> <span m=''2108600''>free.</span> <span m=''2109210''>That''s</span>
  <span m=''2109510''>an</span> <span m=''2109570''>actual</span> <span m=''2109880''>memory</span>
  <span m=''2110200''>leak.</span> <span m=''2110830''>An</span> <span m=''2110930''>accumulation</span>
  <span m=''2111420''>would be</span> <span m=''2111510''>if</span> <span m=''2111640''>you</span>
  <span m=''2111740''>have</span> <span m=''2111930''>some</span> <span m=''2112100''>free</span>
  <span m=''2112340''>somewhere.</span> <span m=''2112640''>But</span> <span m=''2112740''>it''s</span>
  <span m=''2112860''>never</span> <span m=''2113100''>actually</span> <span m=''2113450''>called.</span>
  </p><p><span m=''2115080''>So</span> <span m=''2116470''>a</span> <span m=''2116630''>lot</span>
  <span m=''2116800''>of</span> <span m=''2116860''>the</span> <span m=''2116950''>code</span>
  <span m=''2117160''>that</span> <span m=''2117250''>we</span> <span m=''2117400''>write</span>
  <span m=''2117600''>happened--</span> <span m=''2117890''>at</span> <span m=''2118080''>least</span>
  <span m=''2118270''>in</span> <span m=''2118330''>the</span> <span m=''2118410''>past,</span>
  <span m=''2118840''>it''s</span> <span m=''2118890''>changing--</span> <span m=''2119280''>but</span>
  <span m=''2119370''>a</span> <span m=''2119420''>lot</span> <span m=''2119580''>of</span>
  <span m=''2119650''>it</span> <span m=''2119700''>happened</span> <span m=''2119930''>to</span>
  <span m=''2119970''>be</span> <span m=''2120060''>written</span> <span m=''2120210''>in</span>
  <span m=''2120710''>C++.</span> <span m=''2120960''>And</span> <span m=''2121410''>all</span>
  <span m=''2121590''>of</span> <span m=''2121690''>you,</span> <span m=''2122540''>I</span>
  <span m=''2122650''>guess</span> <span m=''2122830''>assume,</span> <span m=''2123140''>you</span>
  <span m=''2123240''>know</span> <span m=''2123400''>about</span> <span m=''2123800''>new</span>
  <span m=''2124150''>and</span> <span m=''2124260''>delete</span> <span m=''2124550''>and
  all those</span> <span m=''2124770''>kinds</span> <span m=''2124960''>of</span>
  <span m=''2125060''>things</span> <span m=''2125250''>that</span> <span m=''2125330''>we</span>
  <span m=''2125430''>do</span> <span m=''2125560''>in</span> <span m=''2126090''>C++.</span>
  <span m=''2126610''>And</span> <span m=''2126730''>it</span> <span m=''2126810''>turns</span>
  <span m=''2127050''>out,</span> <span m=''2127120''>that</span> <span m=''2127240''>those</span>
  <span m=''2127460''>things</span> <span m=''2127690''>are</span> <span m=''2127770''>notoriously</span>
  <span m=''2128280''>bad</span> <span m=''2128560''>for</span> <span m=''2128680''>assigning</span>
  <span m=''2128950''>memory</span> <span m=''2129110''>leaks.</span> </p><p><span
  m=''2129360''>So</span> <span m=''2129490''>instead,</span> <span m=''2129790''>what</span>
  <span m=''2129920''>people</span> <span m=''2130150''>typically</span> <span m=''2130530''>do</span>
  <span m=''2130910''>is</span> <span m=''2131050''>they</span> <span m=''2131140''>use</span>
  <span m=''2131310''>reference</span> <span m=''2131700''>counted</span> <span m=''2131920''>objects.</span>
  <span m=''2132380''>So every</span> <span m=''2132610''>time</span> <span m=''2132780''>you</span>
  <span m=''2132990''>use something</span> <span m=''2133380''>you</span> <span m=''2133490''>increment</span>
  <span m=''2134080''>some</span> <span m=''2134590''>reference</span> <span m=''2134970''>count.</span>
  <span m=''2135210''>And</span> <span m=''2135300''>every</span> <span m=''2135490''>time</span>
  <span m=''2135850''>you</span> <span m=''2135980''>delete</span> <span m=''2136390''>it,</span>
  <span m=''2137230''>you</span> <span m=''2137350''>decrement a</span> <span m=''2137750''>reference</span>
  <span m=''2138110''>count.</span> <span m=''2138270''>And</span> <span m=''2138330''>when</span>
  <span m=''2138440''>the</span> <span m=''2138510''>decremented</span> <span m=''2138720''>reference</span>
  <span m=''2138970''>count</span> <span m=''2139230''>is zero</span> <span m=''2140640''>it</span>
  <span m=''2140860''>automatically</span> <span m=''2141370''>gets</span> <span m=''2141570''>deleted.</span>
  <span m=''2142310''>Now</span> <span m=''2142580''>of</span> <span m=''2142810''>course,</span>
  <span m=''2143050''>this</span> <span m=''2143190''>only</span> <span m=''2143380''>solves
  an</span> <span m=''2143730''>actual</span> <span m=''2144160''>leak.</span> <span
  m=''2144250''>It</span> <span m=''2144340''>doesn''t</span> <span m=''2144430''>solve
  an</span> <span m=''2144610''>accumulation.</span> </p><p><span m=''2146470''>So</span>
  <span m=''2146610''>here was</span> <span m=''2146900''>the</span> <span m=''2146980''>problem</span>
  <span m=''2147340''>that</span> <span m=''2147450''>I</span> <span m=''2147560''>noticed.</span>
  <span m=''2148190''>That</span> <span m=''2148340''>was</span> <span m=''2148490''>all</span>
  <span m=''2148620''>kind</span> <span m=''2148800''>of</span> <span m=''2148860''>setup,</span>
  <span m=''2149170''>just</span> <span m=''2149270''>saying</span> <span m=''2149480''>what''s</span>
  <span m=''2149660''>a</span> <span m=''2149830''>memory</span> <span m=''2150110''>leak,</span>
  <span m=''2150330''>what''s</span> <span m=''2150510''>an</span> <span m=''2150570''>accumulation,</span>
  <span m=''2151290''>why</span> <span m=''2151630''>is</span> <span m=''2151720''>memory</span>
  <span m=''2151990''>a</span> <span m=''2152050''>problem.</span> <span m=''2152530''>Let''s</span>
  <span m=''2152790''>get</span> <span m=''2152930''>to</span> <span m=''2153000''>actually</span>
  <span m=''2153270''>why</span> <span m=''2153460''>it</span> <span m=''2153500''>was</span>
  <span m=''2153750''>a</span> <span m=''2153810''>problem.</span> </p><p><span m=''2155050''>I</span>
  <span m=''2155130''>had</span> <span m=''2155300''>this</span> <span m=''2155460''>issue.</span>
  <span m=''2156230''>I</span> <span m=''2156350''>have</span> <span m=''2156540''>our</span>
  <span m=''2156650''>little</span> <span m=''2156870''>server</span> <span m=''2157270''>application.</span>
  <span m=''2157950''>And</span> <span m=''2158060''>it''s</span> <span m=''2158180''>running</span>
  <span m=''2158470''>out</span> <span m=''2158570''>of</span> <span m=''2158670''>memory</span>
  <span m=''2158980''>after</span> <span m=''2159190''>several</span> <span m=''2159590''>hours.</span>
  <span m=''2161950''>Now</span> <span m=''2162150''>I</span> <span m=''2162230''>used</span>
  <span m=''2162530''>Purify</span> <span m=''2163950''>on</span> <span m=''2164160''>a</span>
  <span m=''2164210''>much,</span> <span m=''2164710''>much</span> <span m=''2165050''>smaller</span>
  <span m=''2165420''>setup.</span> <span m=''2165950''>It</span> <span m=''2166040''>was</span>
  <span m=''2166150''>about</span> <span m=''2166380''>1/100</span> <span m=''2167270''>the</span>
  <span m=''2167340''>size</span> <span m=''2167680''>of</span> <span m=''2167730''>the</span>
  <span m=''2167840''>actual</span> <span m=''2168240''>setup,</span> <span m=''2168690''>because</span>
  <span m=''2169870''>larger</span> <span m=''2170150''>than</span> <span m=''2170260''>that,</span>
  <span m=''2170420''>Purify</span> <span m=''2170770''>would</span> <span m=''2170900''>crash,</span>
  <span m=''2171230''>because</span> <span m=''2171470''>it</span> <span m=''2171570''>would</span>
  <span m=''2171710''>run</span> <span m=''2171860''>out</span> <span m=''2171960''>of</span>
  <span m=''2172040''>memory.</span> <span m=''2172480''>Because</span> <span m=''2172720''>by</span>
  <span m=''2172880''>the</span> <span m=''2172970''>way,</span> <span m=''2173080''>to</span>
  <span m=''2173170''>track</span> <span m=''2173490''>all</span> <span m=''2173590''>the</span>
  <span m=''2173660''>memory</span> <span m=''2173920''>references,</span> <span m=''2174380''>it''s</span>
  <span m=''2174650''>got to</span> <span m=''2174810''>allocate</span> <span m=''2175240''>memory,</span>
  <span m=''2175480''>which</span> <span m=''2175630''>ends</span> <span m=''2175790''>up</span>
  <span m=''2175890''>being</span> <span m=''2176100''>a</span> <span m=''2176150''>nightmare</span>
  <span m=''2176530''>of</span> <span m=''2176950''>unprecedented</span> <span m=''2177460''>proportions.</span>
  </p><p><span m=''2178260''>So</span> <span m=''2178470''>the</span> <span m=''2178580''>deal</span>
  <span m=''2179360''>was,</span> <span m=''2179850''>was</span> <span m=''2180070''>that</span>
  <span m=''2181640''>I</span> <span m=''2181750''>couldn''t</span> <span m=''2182030''>really</span>
  <span m=''2182210''>detect</span> <span m=''2182520''>this</span> <span m=''2182680''>leak</span>
  <span m=''2182880''>very</span> <span m=''2183140''>easily.</span> <span m=''2184670''>So</span>
  <span m=''2185180''>what</span> <span m=''2185370''>I</span> <span m=''2185430''>did</span>
  <span m=''2185600''>was</span> <span m=''2185710''>I</span> <span m=''2185760''>examined</span>
  <span m=''2186210''>the</span> <span m=''2186280''>memory</span> <span m=''2186590''>that</span>
  <span m=''2186720''>was</span> <span m=''2186870''>in</span> <span m=''2186970''>use.</span>
  <span m=''2187350''>Essentially,</span> <span m=''2187710''>what</span> <span m=''2187810''>I''m</span>
  <span m=''2187890''>trying</span> <span m=''2188010''>to</span> <span m=''2188120''>say</span>
  <span m=''2188260''>is</span> <span m=''2188360''>that,</span> <span m=''2188490''>there</span>
  <span m=''2188570''>wasn''t</span> <span m=''2188970''>so</span> <span m=''2189090''>much</span>
  <span m=''2189270''>a</span> <span m=''2189330''>leak</span> <span m=''2189630''>as</span>
  <span m=''2189770''>there</span> <span m=''2189860''>was</span> <span m=''2190060''>an</span>
  <span m=''2190130''>accumulation.</span> <span m=''2191750''>Accumulation</span>
  <span m=''2192280''>again</span> <span m=''2192520''>being</span> <span m=''2192700''>a</span>
  <span m=''2192770''>logical</span> <span m=''2193330''>problem.</span> <span m=''2193630''>Well,</span>
  <span m=''2193720''>yeah,</span> <span m=''2193940''>all</span> <span m=''2194060''>of</span>
  <span m=''2194170''>my</span> <span m=''2194270''>code</span> <span m=''2194500''>is</span>
  <span m=''2194560''>written</span> <span m=''2194760''>correctly.</span> <span m=''2195120''>But</span>
  <span m=''2195370''>it''s</span> <span m=''2195530''>just</span> <span m=''2195740''>that</span>
  <span m=''2195940''>free</span> <span m=''2196110''>call</span> <span m=''2196400''>is
  never</span> <span m=''2196640''>called.</span> </p><p><span m=''2197470''>So</span>
  <span m=''2197980''>I</span> <span m=''2198450''>examined</span> <span m=''2198890''>the</span>
  <span m=''2198960''>memory</span> <span m=''2199340''>in use</span> <span m=''2199590''>and</span>
  <span m=''2199660''>I</span> <span m=''2200040''>localized</span> <span m=''2200315''>it</span>
  <span m=''2200590''>to</span> <span m=''2200680''>one</span> <span m=''2200900''>operation</span>
  <span m=''2201410''>that</span> <span m=''2201510''>whenever</span> <span m=''2201790''>we</span>
  <span m=''2201920''>did it,</span> <span m=''2202170''>memory</span> <span m=''2202420''>would</span>
  <span m=''2202540''>increase.</span> <span m=''2203280''>So</span> <span m=''2203720''>since</span>
  <span m=''2204000''>doing</span> <span m=''2204210''>it</span> <span m=''2204280''>only</span>
  <span m=''2204490''>once,</span> <span m=''2204810''>there''s</span> <span m=''2204940''>a</span>
  <span m=''2204990''>lot</span> <span m=''2205180''>of</span> <span m=''2205270''>noise.</span>
  <span m=''2205600''>What</span> <span m=''2205730''>I</span> <span m=''2205790''>did</span>
  <span m=''2205950''>was</span> <span m=''2206050''>I</span> <span m=''2206120''>said,</span>
  <span m=''2206270''>well,</span> <span m=''2206370''>OK,</span> <span m=''2206720''>why</span>
  <span m=''2207000''>don''t</span> <span m=''2207130''>I</span> <span m=''2207190''>just</span>
  <span m=''2207360''>do</span> <span m=''2207430''>this</span> <span m=''2207610''>operation</span>
  <span m=''2208040''>hundreds</span> <span m=''2208450''>of</span> <span m=''2208540''>times</span>
  <span m=''2208920''>at the</span> <span m=''2208990''>same</span> <span m=''2209270''>time.</span>
  <span m=''2209530''>Because</span> <span m=''2209780''>then,</span> <span m=''2210000''>if</span>
  <span m=''2210250''>I</span> <span m=''2210320''>see</span> <span m=''2210480''>some</span>
  <span m=''2210650''>allocation</span> <span m=''2211130''>that''s</span> <span m=''2211290''>100x</span>
  <span m=''2211970''>from</span> <span m=''2212080''>before</span> <span m=''2212360''>I</span>
  <span m=''2212400''>started</span> <span m=''2212790''>this</span> <span m=''2213140''>I</span>
  <span m=''2213310''>can</span> <span m=''2213510''>know</span> <span m=''2213670''>that</span>
  <span m=''2213800''>this</span> <span m=''2213920''>was</span> <span m=''2214040''>actually</span>
  <span m=''2214420''>a</span> <span m=''2214470''>problem.</span> </p><p><span m=''2215680''>And</span>
  <span m=''2215800''>that''s</span> <span m=''2215960''>exactly</span> <span m=''2216370''>what</span>
  <span m=''2216490''>I</span> <span m=''2216560''>did.</span> <span m=''2217270''>I</span>
  <span m=''2217410''>had</span> <span m=''2217620''>this</span> <span m=''2217790''>issue</span>
  <span m=''2218070''>where</span> <span m=''2218250''>something</span> <span m=''2218550''>was</span>
  <span m=''2218690''>being</span> <span m=''2218820''>allocated</span> <span m=''2219230''>64</span>
  <span m=''2219660''>bytes.</span> <span m=''2220370''>Now</span> <span m=''2220540''>64</span>
  <span m=''2220830''>bytes</span> <span m=''2221230''>is so</span> <span m=''2221450''>small</span>
  <span m=''2221680''>that it''s</span> <span m=''2221870''>pretty</span> <span m=''2222030''>much</span>
  <span m=''2222210''>in</span> <span m=''2222280''>the</span> <span m=''2222350''>noise.</span>
  <span m=''2222580''>But</span> <span m=''2222690''>if</span> <span m=''2222750''>you</span>
  <span m=''2222850''>do</span> <span m=''2223000''>it</span> <span m=''2223050''>a
  hundred</span> <span m=''2223340''>times,</span> <span m=''2223820''>and you''re</span>
  <span m=''2223990''>seeing</span> <span m=''2224180''>6,400</span> <span m=''2224820''>bytes.</span>
  <span m=''2224950''>Then  you</span> <span m=''2225190''>do it a thousand</span>
  <span m=''2225690''>times</span> <span m=''2226040''>and</span> <span m=''2226260''>you</span>
  <span m=''2226480''>see</span> <span m=''2226640''>64</span> <span m=''2226990''>times</span>
  <span m=''2227190''>1,000.</span> <span m=''2227740''>Then</span> <span m=''2227970''>it</span>
  <span m=''2228060''>becomes</span> <span m=''2228410''>something</span> <span m=''2228710''>easily</span>
  <span m=''2229160''>that you</span> <span m=''2229290''>can</span> <span m=''2229410''>then</span>
  <span m=''2229580''>track.</span> </p><p><span m=''2230900''>Once</span> <span m=''2231470''>I</span>
  <span m=''2231550''>noticed</span> <span m=''2231930''>that</span> <span m=''2232050''>this</span>
  <span m=''2232190''>particular</span> <span m=''2232640''>piece</span> <span m=''2232830''>of</span>
  <span m=''2232950''>data</span> <span m=''2233210''>was</span> <span m=''2233340''>being</span>
  <span m=''2233520''>allocated</span> <span m=''2233950''>like</span> <span m=''2234110''>this,</span>
  <span m=''2234250''>I</span> <span m=''2234300''>went</span> <span m=''2234560''>through</span>
  <span m=''2234650''>and</span> <span m=''2234760''>I</span> <span m=''2234830''>realized</span>
  <span m=''2235250''>that this</span> <span m=''2235430''>actually</span> <span m=''2235720''>was--</span>
  <span m=''2237220''>it</span> <span m=''2237310''>was</span> <span m=''2237450''>an</span>
  <span m=''2237520''>accumulation</span> <span m=''2237845''>and</span> <span m=''2238170''>not</span>
  <span m=''2238330''>a leak.</span> <span m=''2238530''>So</span> <span m=''2238660''>someone</span>
  <span m=''2238920''>would</span> <span m=''2239020''>allocate</span> <span m=''2239450''>something</span>
  <span m=''2239700''>whenever an</span> <span m=''2240100''>incoming</span> <span
  m=''2240490''>message</span> <span m=''2240830''>came</span> <span m=''2241070''>in.</span>
  <span m=''2241490''>And</span> <span m=''2241660''>there</span> <span m=''2241810''>was</span>
  <span m=''2242040''>a</span> <span m=''2242110''>free</span> <span m=''2242390''>somewhere,</span>
  <span m=''2242720''>but</span> <span m=''2242830''>it</span> <span m=''2242870''>was</span>
  <span m=''2243020''>never</span> <span m=''2243260''>being</span> <span m=''2243520''>called.</span>
  </p><p><span m=''2245060''>So</span> <span m=''2245710''>the</span> <span m=''2245850''>lesson</span>
  <span m=''2246140''>that</span> <span m=''2246230''>I</span> <span m=''2246610''>learned</span>
  <span m=''2246800''>from</span> <span m=''2246960''>this</span> <span m=''2247180''>is</span>
  <span m=''2247330''>that</span> <span m=''2247800''>in</span> <span m=''2247940''>a</span>
  <span m=''2248000''>lot</span> <span m=''2248100''>of</span> <span m=''2248190''>situations</span>
  <span m=''2248840''>with</span> <span m=''2248980''>performance</span> <span m=''2249420''>debugging,</span>
  <span m=''2250030''>it''s</span> <span m=''2250260''>very</span> <span m=''2250520''>helpful</span>
  <span m=''2250810''>to</span> <span m=''2250870''>try</span> <span m=''2251020''>to</span>
  <span m=''2251100''>find</span> <span m=''2251460''>a</span> <span m=''2251510''>problem--</span>
  <span m=''2252100''>in</span> <span m=''2252230''>order</span> <span m=''2252360''>to</span>
  <span m=''2252400''>try</span> <span m=''2252550''>to</span> <span m=''2252620''>find</span>
  <span m=''2252820''>a</span> <span m=''2252870''>problem,</span> <span m=''2253035''>it''s</span>
  <span m=''2253200''>very</span> <span m=''2253370''>helpful</span> <span m=''2253580''>to</span>
  <span m=''2253660''>magnify</span> <span m=''2254030''>it</span> <span m=''2254400''>and</span>
  <span m=''2254520''>make</span> <span m=''2254690''>it</span> <span m=''2254770''>a</span>
  <span m=''2254830''>lot</span> <span m=''2255200''>worse.</span> <span m=''2256390''>If</span>
  <span m=''2256480''>you</span> <span m=''2256600''>think</span> <span m=''2256840''>something</span>
  <span m=''2257110''>is</span> <span m=''2257220''>problematic</span> <span m=''2257710''>in</span>
  <span m=''2257780''>the</span> <span m=''2257870''>network,</span> <span m=''2258440''>slow</span>
  <span m=''2258900''>down</span> <span m=''2259110''>your</span> <span m=''2259210''>network</span>
  <span m=''2259630''>if that''s</span> <span m=''2259850''>an</span> <span m=''2259930''>option.</span>
  <span m=''2260160''>If</span> <span m=''2260210''>you</span> <span m=''2260300''>think</span>
  <span m=''2260480''>something</span> <span m=''2260700''>has</span> <span m=''2260780''>a</span>
  <span m=''2260840''>problem</span> <span m=''2261930''>with</span> <span m=''2262100''>memory</span>
  <span m=''2262370''>usage,</span> <span m=''2262860''>either</span> <span m=''2263270''>do</span>
  <span m=''2263420''>something</span> <span m=''2264010''>like</span> <span m=''2264230''>what</span>
  <span m=''2264340''>I''ve</span> <span m=''2264410''>described</span> <span m=''2264730''>here.</span>
  <span m=''2264855''>Or maybe</span> <span m=''2264980''>reduce</span> <span m=''2265350''>the</span>
  <span m=''2265430''>amount</span> <span m=''2265640''>of</span> <span m=''2265690''>memory.</span>
  </p><p><span m=''2266220''>When</span> <span m=''2266390''>I</span> <span m=''2266480''>was</span>
  <span m=''2266570''>in</span> <span m=''2266640''>graduate</span> <span m=''2267000''>school,</span>
  <span m=''2268380''>we</span> <span m=''2268530''>were</span> <span m=''2268600''>working</span>
  <span m=''2268950''>on</span> <span m=''2269040''>a</span> <span m=''2269090''>cache</span>
  <span m=''2269360''>coherence</span> <span m=''2269680''>protocol.</span> <span
  m=''2270660''>And</span> <span m=''2270810''>I''m</span> <span m=''2270950''>going
  to</span> <span m=''2271140''>spare you</span> <span m=''2271320''>a lot of the</span>
  <span m=''2271410''>details.</span> <span m=''2271780''>But</span> <span m=''2271860''>here''s</span>
  <span m=''2272060''>the</span> <span m=''2272140''>thing.</span> <span m=''2272670''>We</span>
  <span m=''2272900''>basically</span> <span m=''2273300''>stored</span> <span m=''2273550''>a</span>
  <span m=''2273630''>linked</span> <span m=''2273920''>list</span> <span m=''2274140''>for</span>
  <span m=''2274240''>every</span> <span m=''2274450''>data</span> <span m=''2274620''>in</span>
  <span m=''2274810''>memory.</span> <span m=''2275360''>And</span> <span m=''2275470''>we</span>
  <span m=''2275590''>had</span> <span m=''2275720''>to</span> <span m=''2275780''>make</span>
  <span m=''2276040''>sure</span> <span m=''2276150''>that that</span> <span m=''2276390''>linked</span>
  <span m=''2276630''>list</span> <span m=''2276820''>was</span> <span m=''2277020''>rock</span>
  <span m=''2277290''>solid</span> <span m=''2277530''>no</span> <span m=''2277590''>matter</span>
  <span m=''2277870''>what</span> <span m=''2278040''>the</span> <span m=''2278130''>size</span>
  <span m=''2278410''>of</span> <span m=''2278470''>the</span> <span m=''2278580''>inventory</span>
  <span m=''2278960''>was.</span> <span m=''2280290''>And</span> <span m=''2280570''>if</span>
  <span m=''2280730''>you</span> <span m=''2280970''>exceeded</span> <span m=''2281320''>the</span>
  <span m=''2281390''>linked list, you''d</span> <span m=''2281820''>store</span>
  <span m=''2282010''>stuff</span> <span m=''2282190''>in</span> <span m=''2282470''>disk.</span>
  <span m=''2282780''>So</span> <span m=''2282970''>what</span> <span m=''2283140''>we</span>
  <span m=''2283250''>did</span> <span m=''2283450''>to</span> <span m=''2283530''>magnify</span>
  <span m=''2284060''>any</span> <span m=''2284250''>possible</span> <span m=''2284630''>bugs</span>
  <span m=''2284850''>was we</span> <span m=''2285280''>created</span> <span m=''2285590''>it</span>
  <span m=''2285900''>so</span> <span m=''2286110''>that</span> <span m=''2286290''>you</span>
  <span m=''2286400''>could</span> <span m=''2286530''>make</span> <span m=''2286700''>a</span>
  <span m=''2286770''>linked</span> <span m=''2286990''>list</span> <span m=''2287190''>of</span>
  <span m=''2287280''>at</span> <span m=''2287390''>most</span> <span m=''2287640''>one</span>
  <span m=''2288130''>item.</span> </p><p><span m=''2288980''>That</span> <span m=''2289190''>way</span>
  <span m=''2289310''>no</span> <span m=''2289450''>matter</span> <span m=''2289750''>what</span>
  <span m=''2289990''>you</span> <span m=''2290110''>did</span> <span m=''2290230''>it
  would</span> <span m=''2290310''>force</span> <span m=''2290620''>you to</span>
  <span m=''2290780''>overflow</span> <span m=''2291260''>and</span> <span m=''2291303''>go</span>
  <span m=''2291346''>into</span> <span m=''2291520''>disk.</span> <span m=''2291770''>And</span>
  <span m=''2291850''>that</span> <span m=''2291950''>was</span> <span m=''2292060''>a</span>
  <span m=''2292120''>great</span> <span m=''2292490''>way</span> <span m=''2292900''>to</span>
  <span m=''2293010''>test</span> <span m=''2293200''>a</span> <span m=''2293260''>lot</span>
  <span m=''2293450''>of</span> <span m=''2293540''>overflow</span> <span m=''2294000''>conditions</span>
  <span m=''2294440''>that</span> <span m=''2294730''>in</span> <span m=''2294880''>practice</span>
  <span m=''2295310''>would</span> <span m=''2295430''>never</span> <span m=''2295700''>have</span>
  <span m=''2295830''>occurred.</span> <span m=''2296140''>Because</span> <span m=''2296530''>we</span>
  <span m=''2296680''>do</span> <span m=''2296770''>the</span> <span m=''2296870''>engineering</span>
  <span m=''2297320''>thing,</span> <span m=''2297550''>figure</span> <span m=''2297840''>out</span>
  <span m=''2297910''>the</span> <span m=''2297980''>capacity,</span> <span m=''2298460''>double</span>
  <span m=''2298760''>it,</span> <span m=''2298810''>and</span> <span m=''2298880''>hope
  that</span> <span m=''2299150''>nothing</span> <span m=''2299370''>happens.</span>
  <span m=''2299990''>So</span> <span m=''2301010''>it''s</span> <span m=''2301190''>good</span>
  <span m=''2301350''>to</span> <span m=''2301630''>exaggerate</span> <span m=''2302150''>edge</span>
  <span m=''2302340''>conditions.</span> </p><p><span m=''2303900''>So</span> <span
  m=''2304070''>that''s</span> <span m=''2304270''>one</span> <span m=''2304670''>memory</span>
  <span m=''2304980''>analysis</span> <span m=''2305400''>problem.</span> <span m=''2305980''>Here''s</span>
  <span m=''2306170''>another</span> <span m=''2306410''>one.</span> <span m=''2307250''>Here''s</span>
  <span m=''2307440''>the</span> <span m=''2307510''>deal.</span> <span m=''2307790''>You''ve</span>
  <span m=''2307940''>got</span> <span m=''2308100''>a</span> <span m=''2308140''>user</span>
  <span m=''2308400''>and</span> <span m=''2308480''>they''re</span> <span m=''2308560''>using</span>
  <span m=''2308850''>this</span> <span m=''2308970''>middleware</span> <span m=''2309320''>server.</span>
  <span m=''2309820''>And</span> <span m=''2309960''>they</span> <span m=''2310050''>complain</span>
  <span m=''2310470''>that</span> <span m=''2310580''>with</span> <span m=''2310830''>time</span>
  <span m=''2311120''>it</span> <span m=''2311160''>gets</span> <span m=''2311360''>slower,</span>
  <span m=''2312450''>and</span> <span m=''2312590''>slower,</span> <span m=''2313340''>and</span>
  <span m=''2313510''>slower.</span> <span m=''2314260''>And</span> <span m=''2314400''>if</span>
  <span m=''2314480''>you</span> <span m=''2314620''>look</span> <span m=''2314800''>at</span>
  <span m=''2314890''>all</span> <span m=''2315040''>of</span> <span m=''2315130''>the--</span>
  <span m=''2315290''>if</span> <span m=''2315370''>you</span> <span m=''2315480''>look</span>
  <span m=''2315620''>at</span> <span m=''2315710''>CPU</span> <span m=''2316030''>network</span>
  <span m=''2316320''>and</span> <span m=''2316440''>disk,</span> <span m=''2316810''>you</span>
  <span m=''2316940''>see</span> <span m=''2317080''>that</span> <span m=''2317210''>nothing</span>
  <span m=''2317630''>is</span> <span m=''2317760''>being</span> <span m=''2317950''>saturated</span>
  <span m=''2318510''>there.</span> <span m=''2318960''>But</span> <span m=''2319060''>if</span>
  <span m=''2319140''>you</span> <span m=''2319260''>look</span> <span m=''2319420''>at</span>
  <span m=''2319490''>memory,</span> <span m=''2320100''>it''s</span> <span m=''2320310''>increasing</span>
  <span m=''2320860''>pretty</span> <span m=''2321320''>dramatically.</span> <span
  m=''2322300''>And</span> <span m=''2322460''>at</span> <span m=''2322550''>some</span>
  <span m=''2322770''>point,</span> <span m=''2322980''>it increases</span> <span
  m=''2323450''>so</span> <span m=''2323600''>dramatically</span> <span m=''2324170''>that</span>
  <span m=''2324810''>the</span> <span m=''2325010''>server</span> <span m=''2325390''>application</span>
  <span m=''2325930''>crashes.</span> </p><p><span m=''2327300''>So</span> <span m=''2328090''>first</span>
  <span m=''2328420''>thing,</span> <span m=''2328680''>let''s</span> <span m=''2328880''>actually</span>
  <span m=''2329140''>look</span> <span m=''2329800''>at</span> <span m=''2329930''>the</span>
  <span m=''2330020''>memory</span> <span m=''2330190''>utilization</span> <span m=''2330820''>and</span>
  <span m=''2330920''>see</span> <span m=''2331130''>the</span> <span m=''2331210''>timeline.</span>
  <span m=''2332150''>What</span> <span m=''2332380''>I</span> <span m=''2332440''>show</span>
  <span m=''2332670''>here is</span> <span m=''2332850''>I</span> <span m=''2332910''>show</span>
  <span m=''2333140''>versus</span> <span m=''2333560''>time,</span> <span m=''2334100''>I</span>
  <span m=''2334220''>show a</span> <span m=''2334510''>chart</span> <span m=''2334820''>of</span>
  <span m=''2334880''>something</span> <span m=''2335280''>in</span> <span m=''2335400''>Windows</span>
  <span m=''2335860''>that''s</span> <span m=''2335990''>called</span> <span m=''2336260''>private</span>
  <span m=''2336680''>bytes.</span> <span m=''2337190''>Essentially,</span> <span
  m=''2337620''>think</span> <span m=''2337820''>of</span> <span m=''2337950''>that</span>
  <span m=''2338070''>as</span> <span m=''2338170''>memory.</span> <span m=''2340060''>What</span>
  <span m=''2340280''>you</span> <span m=''2340400''>see</span> <span m=''2340750''>is</span>
  <span m=''2340900''>that</span> <span m=''2341050''>memory is</span> <span m=''2341640''>growing</span>
  <span m=''2341910''>slowly,</span> <span m=''2342280''>whatever.</span> <span m=''2342550''>But</span>
  <span m=''2342660''>at</span> <span m=''2342750''>some</span> <span m=''2342960''>point,</span>
  <span m=''2343330''>near the</span> <span m=''2343430''>very</span> <span m=''2343780''>end,</span>
  <span m=''2344300''>near</span> <span m=''2344470''>when</span> <span m=''2344640''>the</span>
  <span m=''2344700''>server</span> <span m=''2345000''>crashes,</span> <span m=''2345550''>it</span>
  <span m=''2345670''>starts</span> <span m=''2345990''>growing</span> <span m=''2346350''>at</span>
  <span m=''2346420''>a</span> <span m=''2346480''>really,</span> <span m=''2347100''>really</span>
  <span m=''2347530''>fast</span> <span m=''2347920''>clip.</span> <span m=''2350010''>Now</span>
  <span m=''2350190''>remember,</span> <span m=''2350480''>I</span> <span m=''2350520''>call</span>
  <span m=''2350770''>this</span> <span m=''2350900''>private</span> <span m=''2351290''>bytes.</span>
  <span m=''2351440''>What</span> <span m=''2351620''>that</span> <span m=''2351760''>essentially</span>
  <span m=''2352290''>is,</span> <span m=''2352970''>in</span> <span m=''2353120''>this</span>
  <span m=''2353290''>particular</span> <span m=''2353660''>case,</span> <span m=''2354340''>it''s</span>
  <span m=''2354480''>Windows</span> <span m=''2355060''>giving</span> <span m=''2355360''>a</span>
  <span m=''2355440''>process</span> <span m=''2356310''>some</span> <span m=''2356580''>amount</span>
  <span m=''2356880''>of</span> <span m=''2356950''>memory.</span> </p><p><span m=''2358120''>It''s</span>
  <span m=''2358330''>not</span> <span m=''2358510''>necessarily</span> <span m=''2359610''>what</span>
  <span m=''2359760''>the</span> <span m=''2359830''>process</span> <span m=''2360170''>or</span>
  <span m=''2360220''>what</span> <span m=''2360330''>the</span> <span m=''2360410''>application
  is</span> <span m=''2360860''>requesting.</span> <span m=''2361900''>The</span>
  <span m=''2362150''>application</span> <span m=''2362550''>will request</span> <span
  m=''2362910''>some</span> <span m=''2363070''>amount.</span> <span m=''2363260''>And</span>
  <span m=''2363340''>Windows</span> <span m=''2363580''>will</span> <span m=''2363680''>give</span>
  <span m=''2363810''>it</span> <span m=''2363990''>this</span> <span m=''2364310''>much.</span>
  <span m=''2364730''>Well,</span> <span m=''2364950''>Windows</span> <span m=''2365130''>keeps</span>
  <span m=''2365370''>giving</span> <span m=''2365530''>it</span> <span m=''2365610''>more</span>
  <span m=''2366230''>and</span> <span m=''2366430''>more</span> <span m=''2367010''>and</span>
  <span m=''2367200''>more.</span> <span m=''2367570''>And</span> <span m=''2367940''>it</span>
  <span m=''2368090''>eventually</span> <span m=''2368490''>just</span> <span m=''2368730''>runs</span>
  <span m=''2369010''>out</span> <span m=''2369130''>of</span> <span m=''2369210''>memory</span>
  <span m=''2369510''>to</span> <span m=''2369580''>give.</span> </p><p><span m=''2371840''>So</span>
  <span m=''2372450''>the</span> <span m=''2372580''>reason</span> <span m=''2372870''>I</span>
  <span m=''2373210''>made</span> <span m=''2373440''>the</span> <span m=''2373520''>distinction</span>
  <span m=''2373970''>between</span> <span m=''2374150''>something</span> <span m=''2374390''>that
  an</span> <span m=''2374500''>application</span> <span m=''2375150''>and</span>
  <span m=''2375570''>something</span> <span m=''2375860''>Windows</span> <span m=''2375950''>is</span>
  <span m=''2376200''>giving</span> <span m=''2376460''>it</span> <span m=''2376670''>is</span>
  <span m=''2376820''>that</span> <span m=''2376900''>I,</span> <span m=''2377110''>as</span>
  <span m=''2377310''>an</span> <span m=''2377380''>application,</span> <span m=''2378260''>might</span>
  <span m=''2378530''>be</span> <span m=''2378660''>asking</span> <span m=''2379040''>for</span>
  <span m=''2379260''>four</span> <span m=''2379450''>bytes at a</span> <span m=''2379600''>time.</span>
  <span m=''2379950''>Four</span> <span m=''2380150''>bytes,</span> <span m=''2380330''>four</span>
  <span m=''2380500''>bytes,</span> <span m=''2380630''>whatever.</span> <span m=''2380980''>But
  what</span> <span m=''2381190''>if</span> <span m=''2381310''>Windows</span> <span
  m=''2381990''>has</span> <span m=''2382160''>this</span> <span m=''2382310''>problem</span>
  <span m=''2382780''>where,</span> <span m=''2383170''>whenever</span> <span m=''2383510''>you</span>
  <span m=''2383620''>allocate--</span> <span m=''2384020''>it</span> <span m=''2384160''>doesn''t,</span>
  <span m=''2384460''>but</span> <span m=''2384590''>suppose</span> <span m=''2384940''>it
  does--</span> <span m=''2385120''>suppose</span> <span m=''2385420''>that</span>
  <span m=''2385740''>every</span> <span m=''2385910''>time</span> <span m=''2386040''>you
  ask</span> <span m=''2386190''>for</span> <span m=''2386460''>four</span> <span
  m=''2386590''>bytes,</span> <span m=''2386720''>it says,</span> <span m=''2386800''>well,</span>
  <span m=''2387120''>you know</span> <span m=''2387480''>what,</span> <span m=''2387540''>I''m</span>
  <span m=''2387600''>just</span> <span m=''2387700''>going</span> <span m=''2387780''>to</span>
  <span m=''2387820''>give</span> <span m=''2387970''>you</span> <span m=''2388160''>16</span>
  <span m=''2388500''>bytes</span> <span m=''2388720''>because</span> <span m=''2388900''>that''s</span>
  <span m=''2389060''>my</span> <span m=''2389170''>smallest</span> <span m=''2389580''>increment</span>
  <span m=''2390050''>of</span> <span m=''2390150''>memory.</span> </p><p><span m=''2390530''>You</span>
  <span m=''2390660''>can</span> <span m=''2390770''>imagine</span> <span m=''2391070''>if</span>
  <span m=''2391160''>I</span> <span m=''2391220''>keep</span> <span m=''2391430''>asking</span>
  <span m=''2391680''>for</span> <span m=''2391940''>4</span> <span m=''2392100''>and
  it''s dumb</span> <span m=''2392340''>enough</span> <span m=''2392480''>to</span>
  <span m=''2392550''>give</span> <span m=''2392650''>me</span> <span m=''2392730''>16</span>
  <span m=''2393100''>every</span> <span m=''2393300''>time,</span> <span m=''2393680''>we''re</span>
  <span m=''2393850''>going</span> <span m=''2393940''>to</span> <span m=''2394020''>see</span>
  <span m=''2394170''>a</span> <span m=''2394240''>huge</span> <span m=''2394500''>expansion</span>
  <span m=''2394900''>of memory,</span> <span m=''2395170''>even</span> <span m=''2395350''>though</span>
  <span m=''2395510''>I,</span> <span m=''2395700''>as</span> <span m=''2395830''>an</span>
  <span m=''2395910''>application,</span> <span m=''2396490''>didn''t</span> <span
  m=''2396680''>ask</span> <span m=''2396940''>for</span> <span m=''2397040''>that</span>
  <span m=''2397280''>much.</span> <span m=''2397730''>So</span> <span m=''2397870''>it''s</span>
  <span m=''2398240''>important</span> <span m=''2398510''>to</span> <span m=''2398550''>keep</span>
  <span m=''2398730''>these</span> <span m=''2398880''>distinctions</span> <span m=''2399400''>in</span>
  <span m=''2399480''>mind.</span> </p><p><span m=''2400810''>So</span> <span m=''2400970''>the</span>
  <span m=''2401050''>point</span> <span m=''2401290''>is</span> <span m=''2401400''>what
  was</span> <span m=''2401630''>happening</span> <span m=''2401920''>in</span> <span
  m=''2401970''>this</span> <span m=''2402140''>case,</span> <span m=''2402550''>was</span>
  <span m=''2402750''>my</span> <span m=''2402860''>server''s</span> <span m=''2403230''>going</span>
  <span m=''2403460''>fine,</span> <span m=''2403800''>fine,</span> <span m=''2404090''>and
  fine,</span> <span m=''2404570''>until near</span> <span m=''2404670''>the</span>
  <span m=''2404770''>very</span> <span m=''2405060''>end where it</span> <span m=''2405280''>starts</span>
  <span m=''2405550''>increasing</span> <span m=''2406000''>in</span> <span m=''2406100''>memory</span>
  <span m=''2406405''>use</span> <span m=''2406710''>at</span> <span m=''2406840''>such</span>
  <span m=''2407020''>a</span> <span m=''2407070''>dramatic</span> <span m=''2407520''>rate,</span>
  <span m=''2407700''>that it</span> <span m=''2407870''>eventually</span> <span m=''2408280''>crashes.</span>
  </p><p><span m=''2410090''>So</span> <span m=''2410250''>the</span> <span m=''2410340''>first</span>
  <span m=''2410640''>thing</span> <span m=''2410780''>I</span> <span m=''2410850''>did--</span>
  <span m=''2411390''>We</span> <span m=''2411490''>just</span> <span m=''2411640''>talked</span>
  <span m=''2411830''>a</span> <span m=''2411880''>lot</span> <span m=''2412030''>about</span>
  <span m=''2412160''>these</span> <span m=''2412290''>reference</span> <span m=''2412640''>counted</span>
  <span m=''2412940''>objects.</span> <span m=''2413870''>The</span> <span m=''2414160''>fact
  that</span> <span m=''2414380''>I</span> <span m=''2414460''>keep</span> <span m=''2414700''>track</span>
  <span m=''2415010''>of</span> <span m=''2415100''>whenever</span> <span m=''2415370''>something</span>
  <span m=''2415580''>is</span> <span m=''2415670''>allocated and</span> <span m=''2416130''>whenever</span>
  <span m=''2416400''>something</span> <span m=''2416830''>is</span> <span m=''2417270''>not</span>
  <span m=''2417550''>being</span> <span m=''2417740''>looked</span> <span m=''2418020''>at</span>
  <span m=''2418140''>anymore.</span> <span m=''2418590''>When</span> <span m=''2418640''>it''s
  not being</span> <span m=''2418970''>looked</span> <span m=''2419180''>at</span>
  <span m=''2419240''>anymore,</span> <span m=''2419560''>I</span> <span m=''2419590''>go</span>
  <span m=''2419780''>ahead</span> <span m=''2419920''>and</span> <span m=''2419990''>remove</span>
  <span m=''2420270''>it.</span> </p><p><span m=''2420660''>If</span> <span m=''2420830''>you</span>
  <span m=''2420890''>look</span> <span m=''2421060''>at</span> <span m=''2421100''>the</span>
  <span m=''2421170''>reference</span> <span m=''2421490''>counted</span> <span m=''2421700''>objects,</span>
  <span m=''2422000''>they</span> <span m=''2422400''>were</span> <span m=''2422470''>pretty</span>
  <span m=''2422750''>flat</span> <span m=''2423310''>until</span> <span m=''2423640''>you</span>
  <span m=''2423770''>get</span> <span m=''2424060''>to</span> <span m=''2424180''>the</span>
  <span m=''2424300''>very</span> <span m=''2424740''>end</span> <span m=''2425010''>of</span>
  <span m=''2425130''>the</span> <span m=''2425210''>run,</span> <span m=''2425650''>exactly</span>
  <span m=''2426260''>the</span> <span m=''2426340''>same</span> <span m=''2426620''>as</span>
  <span m=''2426720''>when</span> <span m=''2426890''>the</span> <span m=''2426970''>memory</span>
  <span m=''2427260''>was</span> <span m=''2427420''>increasing.</span> <span m=''2428150''>And</span>
  <span m=''2428300''>it</span> <span m=''2428370''>turns</span> <span m=''2428610''>out,</span>
  <span m=''2428690''>I''ve</span> <span m=''2428810''>highlighted</span> <span m=''2429230''>a</span>
  <span m=''2429270''>few</span> <span m=''2429530''>of</span> <span m=''2429580''>these,</span>
  <span m=''2430450''>and</span> <span m=''2430620''>they</span> <span m=''2430760''>ended</span>
  <span m=''2430960''>up</span> <span m=''2431070''>being--</span> <span m=''2431710''>it</span>
  <span m=''2431910''>doesn''t</span> <span m=''2432100''>matter</span> <span m=''2432250''>what</span>
  <span m=''2432370''>they</span> <span m=''2432450''>specifically</span> <span m=''2432960''>were--</span>
  <span m=''2433070''>but</span> <span m=''2433170''>in</span> <span m=''2433240''>this</span>
  <span m=''2433390''>case,</span> <span m=''2433580''>they ended up</span> <span
  m=''2433850''>being</span> <span m=''2434030''>related</span> <span m=''2434360''>to</span>
  <span m=''2434450''>threads,</span> <span m=''2435010''>and</span> <span m=''2435180''>mutexes,</span>
  <span m=''2436070''>and</span> <span m=''2436480''>stuff</span> <span m=''2436770''>associated</span>
  <span m=''2437300''>with</span> <span m=''2437440''>keeping</span> <span m=''2437740''>track</span>
  <span m=''2438040''>of</span> <span m=''2438100''>what</span> <span m=''2438190''>was</span>
  <span m=''2438340''>going</span> <span m=''2438560''>on</span> <span m=''2438730''>in
  the</span> <span m=''2438810''>system.</span> </p><p><span m=''2440040''>So</span>
  <span m=''2440200''>some</span> <span m=''2440630''>thread-related</span> <span
  m=''2441210''>objects</span> <span m=''2441570''>were</span> <span m=''2441670''>increasing</span>
  <span m=''2442120''>for</span> <span m=''2442220''>some</span> <span m=''2442440''>reason.</span>
  <span m=''2442940''>Now</span> <span m=''2443110''>turns</span> <span m=''2443460''>out</span>
  <span m=''2443620''>thread</span> <span m=''2443860''>state</span> <span m=''2444220''>in</span>
  <span m=''2444320''>some</span> <span m=''2444550''>sense</span> <span m=''2444780''>is</span>
  <span m=''2444900''>very</span> <span m=''2445180''>cheap.</span> <span m=''2445690''>So</span>
  <span m=''2445970''>just</span> <span m=''2446190''>because</span> <span m=''2446440''>these</span>
  <span m=''2446650''>guys</span> <span m=''2446850''>were</span> <span m=''2446960''>increasing,</span>
  <span m=''2447750''>it</span> <span m=''2447900''>doesn''t</span> <span m=''2448130''>really</span>
  <span m=''2448320''>explain</span> <span m=''2448680''>why</span> <span m=''2448870''>we''re</span>
  <span m=''2448990''>dramatically</span> <span m=''2449450''>increasing</span> <span
  m=''2449890''>in</span> <span m=''2449970''>memory.</span> <span m=''2450400''>But</span>
  <span m=''2450560''>I''ll</span> <span m=''2450660''>tell</span> <span m=''2450790''>you</span>
  <span m=''2450900''>what</span> <span m=''2451060''>does</span> <span m=''2451910''>explain</span>
  <span m=''2452230''>it.</span> <span m=''2452800''>If</span> <span m=''2452970''>you</span>
  <span m=''2453050''>take</span> <span m=''2453210''>a</span> <span m=''2453270''>look</span>
  <span m=''2453420''>at</span> <span m=''2453480''>a</span> <span m=''2453540''>different</span>
  <span m=''2453850''>attribute,</span> <span m=''2454170''>which</span> <span m=''2454340''>is</span>
  <span m=''2454420''>these</span> <span m=''2454610''>are</span> <span m=''2454640''>the</span>
  <span m=''2454750''>total</span> <span m=''2455020''>number</span> <span m=''2455220''>of</span>
  <span m=''2455320''>threads</span> <span m=''2455580''>in</span> <span m=''2455650''>our</span>
  <span m=''2455730''>system,</span> <span m=''2456190''>we</span> <span m=''2456390''>have</span>
  <span m=''2456460''>a</span> <span m=''2456510''>static</span> <span m=''2456890''>pool</span>
  <span m=''2457060''>of</span> <span m=''2457140''>threads.</span> <span m=''2457800''>And</span>
  <span m=''2457970''>whenever</span> <span m=''2458320''>a</span> <span m=''2458370''>work</span>
  <span m=''2458680''>item</span> <span m=''2458880''>comes</span> <span m=''2459130''>in,</span>
  <span m=''2459240''>we</span> <span m=''2459370''>allocate</span> <span m=''2459720''>a</span>
  <span m=''2459840''>thread.</span> <span m=''2460170''>Whenever</span> <span m=''2460490''>that</span>
  <span m=''2460650''>work</span> <span m=''2461020''>item is</span> <span m=''2461160''>done,</span>
  <span m=''2461340''>we</span> <span m=''2461470''>deallocate</span> <span m=''2461730''>the</span>
  <span m=''2461990''>thread.</span> <span m=''2462340''>So</span> <span m=''2462450''>we</span>
  <span m=''2462560''>keep</span> <span m=''2462750''>it</span> <span m=''2462980''>to</span>
  <span m=''2463170''>a</span> <span m=''2463230''>minimal</span> <span m=''2463550''>number.</span>
  </p><p><span m=''2464210''>And</span> <span m=''2464350''>it</span> <span m=''2464410''>turns</span>
  <span m=''2464630''>out,</span> <span m=''2464680''>we</span> <span m=''2464810''>had
  a</span> <span m=''2464880''>cap.</span> <span m=''2465200''>We</span> <span m=''2465310''>said,</span>
  <span m=''2465440''>OK,</span> <span m=''2465850''>I''m</span> <span m=''2466020''>going</span>
  <span m=''2466170''>to</span> <span m=''2466310''>allow</span> <span m=''2466370''>at</span>
  <span m=''2466610''>most</span> <span m=''2466800''>20</span> <span m=''2467070''>operations</span>
  <span m=''2467520''>to</span> <span m=''2467730''>occur in</span> <span m=''2468040''>flight.</span>
  <span m=''2468600''>Anything</span> <span m=''2469000''>beyond</span> <span m=''2469300''>20,</span>
  <span m=''2470080''>I''m</span> <span m=''2470240''>going</span> <span m=''2470390''>to</span>
  <span m=''2470700''>queue</span> <span m=''2470770''>it up</span> <span m=''2470880''>in</span>
  <span m=''2470990''>memory.</span> <span m=''2471690''>And</span> <span m=''2471970''>we''ll</span>
  <span m=''2472100''>deal</span> <span m=''2472310''>with</span> <span m=''2472430''>it</span>
  <span m=''2472510''>later.</span> </p><p><span m=''2473080''>Here''s</span> <span
  m=''2473310''>the</span> <span m=''2473390''>deal.</span> <span m=''2473710''>What</span>
  <span m=''2473950''>you</span> <span m=''2474060''>see</span> <span m=''2474210''>when</span>
  <span m=''2474300''>you</span> <span m=''2474390''>look</span> <span m=''2474530''>at</span>
  <span m=''2474570''>the</span> <span m=''2474640''>number</span> <span m=''2474830''>of</span>
  <span m=''2474900''>threads</span> <span m=''2475150''>being</span> <span m=''2475380''>used</span>
  <span m=''2475670''>is</span> <span m=''2475740''>that--</span> <span m=''2476570''>it''s</span>
  <span m=''2476760''>the</span> <span m=''2476840''>bottom</span> <span m=''2477130''>chart,</span>
  <span m=''2477360''>unfortunately,</span> <span m=''2477620''>it''s</span> <span
  m=''2477740''>a</span> <span m=''2477790''>little</span> <span m=''2477950''>hard</span>
  <span m=''2478090''>to</span> <span m=''2478130''>see.</span> <span m=''2478280''>But</span>
  <span m=''2478550''>the</span> <span m=''2478640''>point</span> <span m=''2478950''>is
  it goes</span> <span m=''2479110''>up</span> <span m=''2479230''>and</span> <span
  m=''2479350''>down,</span> <span m=''2479570''>up</span> <span m=''2479670''>and</span>
  <span m=''2479810''>down,</span> <span m=''2480000''>up</span> <span m=''2480100''>and</span>
  <span m=''2480230''>down</span> <span m=''2480580''>with</span> <span m=''2480780''>time.</span>
  <span m=''2481230''>So</span> <span m=''2481870''>stuff</span> <span m=''2482190''>gets</span>
  <span m=''2482360''>allocated.</span> <span m=''2482850''>Stuff</span> <span m=''2483080''>gets</span>
  <span m=''2483270''>used.</span> <span m=''2483530''>Stuff</span> <span m=''2483780''>gets</span>
  <span m=''2483960''>removed.</span> </p><p><span m=''2484420''>But</span> <span
  m=''2484660''>then</span> <span m=''2484790''>when</span> <span m=''2484900''>you</span>
  <span m=''2484970''>get</span> <span m=''2485100''>to</span> <span m=''2485170''>the</span>
  <span m=''2485270''>very</span> <span m=''2485535''>end,</span> <span m=''2485800''>you
  see</span> <span m=''2485970''>this</span> <span m=''2486330''>monotonic</span>
  <span m=''2486670''>increase</span> <span m=''2487460''>in</span> <span m=''2487600''>the</span>
  <span m=''2487740''>number</span> <span m=''2488010''>of</span> <span m=''2488090''>threads</span>
  <span m=''2488390''>being</span> <span m=''2488570''>used.</span> <span m=''2488790''>It</span>
  <span m=''2488890''>never</span> <span m=''2489180''>goes</span> <span m=''2489450''>down.</span>
  <span m=''2489750''>And at</span> <span m=''2489850''>some</span> <span m=''2490040''>point,</span>
  <span m=''2490540''>you</span> <span m=''2490700''>hit</span> <span m=''2490880''>the</span>
  <span m=''2490950''>point</span> <span m=''2491320''>where</span> <span m=''2491730''>all</span>
  <span m=''2491940''>of</span> <span m=''2492020''>the</span> <span m=''2492100''>threads</span>
  <span m=''2492360''>that you''ve</span> <span m=''2492490''>preallocated</span>
  <span m=''2493320''>are</span> <span m=''2493500''>completely</span> <span m=''2494300''>taken.</span>
  <span m=''2495460''>You</span> <span m=''2495630''>obviously</span> <span m=''2496000''>can''t</span>
  <span m=''2496280''>allocate</span> <span m=''2496750''>any more</span> <span m=''2496890''>threads.</span>
  <span m=''2497130''>So</span> <span m=''2497210''>every</span> <span m=''2497420''>incoming</span>
  <span m=''2497740''>request,</span> <span m=''2498330''>you</span> <span m=''2498470''>go</span>
  <span m=''2498670''>ahead</span> <span m=''2498860''>and</span> <span m=''2498990''>queue.</span>
  </p><p><span m=''2500940''>This</span> <span m=''2501210''>was</span> <span m=''2501460''>the</span>
  <span m=''2501540''>root</span> <span m=''2501790''>of</span> <span m=''2501850''>the</span>
  <span m=''2501910''>problem.</span> <span m=''2502260''>The</span> <span m=''2502360''>root</span>
  <span m=''2502540''>of</span> <span m=''2502580''>the</span> <span m=''2502660''>problem</span>
  <span m=''2503430''>is</span> <span m=''2503670''>that</span> <span m=''2504010''>in</span>
  <span m=''2504150''>this</span> <span m=''2504280''>particular</span> <span m=''2504660''>situation,</span>
  <span m=''2505750''>each</span> <span m=''2506000''>of</span> <span m=''2506060''>the</span>
  <span m=''2506170''>times</span> <span m=''2506550''>that</span> <span m=''2506700''>it</span>
  <span m=''2506740''>was</span> <span m=''2506900''>increasing</span> <span m=''2507940''>was</span>
  <span m=''2508050''>because</span> <span m=''2508350''>there</span> <span m=''2508470''>was</span>
  <span m=''2508610''>again</span> <span m=''2509060''>an</span> <span m=''2509400''>uncaught</span>
  <span m=''2509950''>exception.</span> <span m=''2511070''>That</span> <span m=''2511340''>uncaught</span>
  <span m=''2511780''>exception</span> <span m=''2512960''>resulted</span> <span m=''2513500''>in</span>
  <span m=''2513590''>a</span> <span m=''2513640''>thread</span> <span m=''2514090''>not</span>
  <span m=''2514390''>being</span> <span m=''2514830''>deallocated.</span> <span m=''2515510''>At</span>
  <span m=''2515710''>some</span> <span m=''2515910''>point,</span> <span m=''2516070''>we</span>
  <span m=''2516190''>ran</span> <span m=''2516530''>out</span> <span m=''2516620''>of</span>
  <span m=''2516710''>threads.</span> <span m=''2516950''>And</span> <span m=''2517070''>every</span>
  <span m=''2517380''>single</span> <span m=''2517680''>request</span> <span m=''2518060''>that</span>
  <span m=''2518170''>came</span> <span m=''2518460''>in</span> <span m=''2519000''>was</span>
  <span m=''2519320''>being</span> <span m=''2519550''>allocated</span> <span m=''2520100''>in</span>
  <span m=''2520220''>memory</span> <span m=''2520670''>and</span> <span m=''2520880''>waiting</span>
  <span m=''2521200''>around</span> <span m=''2521440''>for</span> <span m=''2521590''>a</span>
  <span m=''2521620''>thread</span> <span m=''2521840''>to</span> <span m=''2521900''>become</span>
  <span m=''2522150''>available</span> <span m=''2522800''>before</span> <span m=''2523190''>it</span>
  <span m=''2523260''>could</span> <span m=''2523410''>be</span> <span m=''2523890''>finished.</span>
  </p><p><span m=''2524730''>Well,</span> <span m=''2524910''>if</span> <span m=''2525010''>no</span>
  <span m=''2525170''>threads</span> <span m=''2525330''>are</span> <span m=''2525600''>available,</span>
  <span m=''2525990''>these</span> <span m=''2526260''>things</span> <span m=''2526450''>can</span>
  <span m=''2526570''>never</span> <span m=''2526760''>get</span> <span m=''2526910''>pulled</span>
  <span m=''2527100''>off</span> <span m=''2527220''>the</span> <span m=''2527310''>queue.</span>
  <span m=''2527840''>You see</span> <span m=''2528000''>a</span> <span m=''2528040''>monotonic</span>
  <span m=''2528550''>increase in the</span> <span m=''2528980''>amount</span> <span
  m=''2529190''>of</span> <span m=''2529230''>memory.</span> <span m=''2529540''>And</span>
  <span m=''2529650''>you</span> <span m=''2529760''>eventually</span> <span m=''2530140''>die.</span>
  </p><p><span m=''2531810''>And</span> <span m=''2531990''>so,</span> <span m=''2533930''>it''s</span>
  <span m=''2534250''>actually a</span> <span m=''2534500''>correctness</span> <span
  m=''2534960''>issue.</span> <span m=''2535190''>Why</span> <span m=''2535370''>are</span>
  <span m=''2535480''>you</span> <span m=''2535590''>not</span> <span m=''2535860''>catching</span>
  <span m=''2536230''>exceptions</span> <span m=''2536690''>properly?</span> <span
  m=''2537180''>And why are</span> <span m=''2537360''>you</span> <span m=''2537530''>not</span>
  <span m=''2537680''>recovering</span> <span m=''2538110''>properly</span> <span
  m=''2538470''>from</span> <span m=''2538650''>them.</span> <span m=''2538920''>But</span>
  <span m=''2539120''>interestingly,</span> <span m=''2539415''>it</span> <span m=''2539710''>manifested</span>
  <span m=''2540400''>itself</span> <span m=''2540690''>in</span> <span m=''2540790''>a</span>
  <span m=''2540840''>performance</span> <span m=''2541370''>issue.</span> </p><p><span
  m=''2542980''>So</span> <span m=''2543730''>in</span> <span m=''2543980''>each</span>
  <span m=''2544150''>of</span> <span m=''2544250''>these</span> <span m=''2544350''>cases,</span>
  <span m=''2544680''>what</span> <span m=''2544800''>we''ve</span> <span m=''2544950''>done,</span>
  <span m=''2545120''>is</span> <span m=''2545200''>we''ve</span> <span m=''2545300''>looked</span>
  <span m=''2545480''>at</span> <span m=''2545650''>customized</span> <span m=''2546100''>profiler</span>
  <span m=''2546660''>instead</span> <span m=''2546920''>of</span> <span m=''2547000''>a</span>
  <span m=''2547080''>tool</span> <span m=''2547380''>that</span> <span m=''2547470''>we</span>
  <span m=''2547860''>might</span> <span m=''2548060''>have</span> <span m=''2548160''>gotten,</span>
  <span m=''2548880''>Purifier,</span> <span m=''2549770''>Valgrind,</span> <span
  m=''2550220''>or</span> <span m=''2550260''>whatever--</span> <span m=''2550860''>it''s</span>
  <span m=''2551030''>nice</span> <span m=''2551270''>that it''s</span> <span m=''2551460''>tailored</span>
  <span m=''2551740''>to</span> <span m=''2551830''>our</span> <span m=''2551890''>application.</span>
  <span m=''2552185''>And</span> <span m=''2552480''>we</span> <span m=''2552590''>can</span>
  <span m=''2552690''>make</span> <span m=''2552870''>it as</span> <span m=''2553050''>arbitrarily</span>
  <span m=''2553530''>fast,</span> <span m=''2553820''>because</span> <span m=''2554060''>it</span>
  <span m=''2554160''>understands</span> <span m=''2554720''>what</span> <span m=''2554900''>our</span>
  <span m=''2555020''>application</span> <span m=''2555530''>is</span> <span m=''2555660''>doing.</span>
  <span m=''2556760''>And</span> <span m=''2556980''>it also--</span> <span m=''2557260''>the</span>
  <span m=''2557370''>other</span> <span m=''2557520''>nice</span> <span m=''2557710''>thing</span>
  <span m=''2557830''>about</span> <span m=''2557990''>this</span> <span m=''2558190''>is</span>
  <span m=''2558390''>this can</span> <span m=''2558660''>be run in</span> <span m=''2558700''>production</span>
  <span m=''2559070''>environments.</span> <span m=''2559610''>If</span> <span m=''2559690''>you</span>
  <span m=''2559780''>write</span> <span m=''2559920''>your</span> <span m=''2560070''>own</span>
  <span m=''2560180''>tool,</span> <span m=''2560590''>and</span> <span m=''2560710''>a</span>
  <span m=''2560760''>customer</span> <span m=''2561110''>calls</span> <span m=''2561350''>and</span>
  <span m=''2561480''>complains,</span> <span m=''2561670''>you</span> <span m=''2561810''>can</span>
  <span m=''2561990''>just</span> <span m=''2562240''>say,</span> <span m=''2562330''>oh,</span>
  <span m=''2562370''>just</span> <span m=''2562520''>twiddle</span> <span m=''2562760''>this</span>
  <span m=''2562850''>knob and you''re</span> <span m=''2562950''>done.</span> </p><p><span
  m=''2564460''>That''s</span> <span m=''2564730''>kind</span> <span m=''2564890''>of</span>
  <span m=''2564950''>convenient.</span> <span m=''2565370''>But</span> <span m=''2565470''>of</span>
  <span m=''2565540''>course,</span> <span m=''2565730''>the</span> <span m=''2565790''>disadvantage</span>
  <span m=''2566330''>is</span> <span m=''2566420''>that</span> <span m=''2566570''>now</span>
  <span m=''2566700''>you</span> <span m=''2566860''>have</span> <span m=''2567020''>to--</span>
  <span m=''2567420''>whenever</span> <span m=''2567740''>you</span> <span m=''2568260''>rewrite</span>
  <span m=''2568650''>your</span> <span m=''2568790''>code</span> <span m=''2569210''>or</span>
  <span m=''2569300''>do</span> <span m=''2569450''>a new</span> <span m=''2569600''>rev,</span>
  <span m=''2569970''>or</span> <span m=''2570030''>whatever,</span> <span m=''2570300''>you</span>
  <span m=''2570390''>have to</span> <span m=''2570500''>make</span> <span m=''2570660''>sure</span>
  <span m=''2570770''>that</span> <span m=''2570900''>these</span> <span m=''2571090''>tools</span>
  <span m=''2571350''>work</span> <span m=''2571610''>right.</span> <span m=''2571865''>And</span>
  <span m=''2572120''>you</span> <span m=''2572250''>have</span> <span m=''2572330''>to</span>
  <span m=''2572590''>recompile</span> <span m=''2573050''>the</span> <span m=''2573130''>code.</span>
  <span m=''2573820''>If</span> <span m=''2574070''>you</span> <span m=''2574150''>have</span>
  <span m=''2574320''>something</span> <span m=''2574530''>like</span> <span m=''2574670''>Purifier,</span>
  <span m=''2574900''>Quanitify,</span> <span m=''2575390''>in a</span> <span m=''2575450''>lot</span>
  <span m=''2575600''>of</span> <span m=''2575660''>situations,</span> <span m=''2576140''>you</span>
  <span m=''2576260''>can</span> <span m=''2576380''>run</span> <span m=''2576530''>with</span>
  <span m=''2576650''>some</span> <span m=''2576790''>sort</span> <span m=''2576950''>of</span>
  <span m=''2577020''>preexisting</span> <span m=''2577490''>binary--</span> <span
  m=''2577860''>sometimes,</span> <span m=''2578590''>not</span> <span m=''2578740''>always.</span>
  <span m=''2579010''>You</span> <span m=''2579100''>can</span> <span m=''2579460''>run</span>
  <span m=''2579670''>it</span> <span m=''2579730''>without</span> <span m=''2579980''>having</span>
  <span m=''2580170''>to</span> <span m=''2580390''>recompile.</span> <span m=''2580870''>And</span>
  <span m=''2580960''>that</span> <span m=''2581100''>can</span> <span m=''2581200''>be</span>
  <span m=''2581310''>very</span> <span m=''2581530''>convenient.</span> </p><p><span
  m=''2583320''>So</span> <span m=''2584470''>I</span> <span m=''2584590''>don''t</span>
  <span m=''2584700''>know.</span> <span m=''2585200''>I was</span> <span m=''2585620''>kind</span>
  <span m=''2585780''>of</span> <span m=''2585840''>stuck</span> <span m=''2586070''>for</span>
  <span m=''2586170''>what</span> <span m=''2586310''>a</span> <span m=''2586360''>lesson</span>
  <span m=''2586630''>this</span> <span m=''2586780''>was</span> <span m=''2586980''>besides</span>
  <span m=''2587330''>common</span> <span m=''2587600''>sense</span> <span m=''2587800''>is</span>
  <span m=''2587890''>useful.</span> <span m=''2588230''>So</span> <span m=''2588320''>I</span>
  <span m=''2588390''>just</span> <span m=''2588580''>said</span> <span m=''2588650''>memory</span>
  <span m=''2588890''>profiling</span> <span m=''2589310''>is</span> <span m=''2589390''>pretty</span>
  <span m=''2589620''>critical.</span> <span m=''2589980''>Don''t</span> <span m=''2590150''>ignore</span>
  <span m=''2590410''>that</span> <span m=''2590550''>when</span> <span m=''2590650''>you''re</span>
  <span m=''2590770''>writing</span> <span m=''2590890''>your</span> <span m=''2591010''>applications.</span>
  <span m=''2592090''>And</span> <span m=''2592600''>I</span> <span m=''2592710''>think</span>
  <span m=''2592950''>I</span> <span m=''2593050''>also</span> <span m=''2593310''>want</span>
  <span m=''2593460''>to</span> <span m=''2593510''>point</span> <span m=''2593810''>out</span>
  <span m=''2594010''>that--</span> <span m=''2594760''>I</span> <span m=''2594870''>didn''t</span>
  <span m=''2595080''>put</span> <span m=''2595220''>this</span> <span m=''2595370''>here.</span>
  <span m=''2595560''>But</span> <span m=''2596540''>you</span> <span m=''2596680''>might</span>
  <span m=''2596900''>think</span> <span m=''2597040''>that</span> <span m=''2597140''>when
  you''re</span> <span m=''2597260''>using</span> <span m=''2597550''>a</span> <span
  m=''2597610''>garbage</span> <span m=''2597990''>collected</span> <span m=''2598290''>language,</span>
  <span m=''2598600''>like</span> <span m=''2598740''>something</span> <span m=''2598950''>like</span>
  <span m=''2599110''>Java,</span> <span m=''2599370''>that</span> <span m=''2599650''>these</span>
  <span m=''2599820''>problems</span> <span m=''2600250''>go</span> <span m=''2600400''>away.</span>
  <span m=''2600980''>But</span> <span m=''2601290''>they</span> <span m=''2601350''>actually</span>
  <span m=''2601710''>don''t.</span> <span m=''2602120''>The</span> <span m=''2602220''>problem</span>
  <span m=''2602580''>is</span> <span m=''2602780''>actually</span> <span m=''2603100''>now</span>
  <span m=''2603280''>memory</span> <span m=''2603550''>allocations</span> <span m=''2604010''>and</span>
  <span m=''2604110''>deallocations</span> <span m=''2604600''>are</span> <span m=''2604650''>more</span>
  <span m=''2604910''>hidden</span> <span m=''2605140''>from</span> <span m=''2605270''>you.</span>
  <span m=''2605530''>So</span> <span m=''2605660''>you</span> <span m=''2605700''>have</span>
  <span m=''2605780''>to</span> <span m=''2605860''>be</span> <span m=''2605940''>a</span>
  <span m=''2606000''>little</span> <span m=''2606150''>bit</span> <span m=''2606260''>more</span>
  <span m=''2606470''>careful</span> <span m=''2606800''>about</span> <span m=''2607490''>how</span>
  <span m=''2607610''>you</span> <span m=''2607750''>analyze</span> <span m=''2608190''>them.</span>
  </p><p><span m=''2609810''>Case</span> <span m=''2610090''>study</span> <span m=''2610320''>number</span>
  <span m=''2610550''>seven.</span> <span m=''2611080''>So</span> <span m=''2611220''>we''ve</span>
  <span m=''2611340''>looked</span> <span m=''2611530''>a</span> <span m=''2611620''>lot</span>
  <span m=''2611790''>of</span> <span m=''2611860''>things</span> <span m=''2612030''>related
  to</span> <span m=''2612340''>CPU</span> <span m=''2612640''>usage.</span> <span
  m=''2612940''>We''ve looked at</span> <span m=''2613100''>a</span> <span m=''2613280''>lot</span>
  <span m=''2613490''>of</span> <span m=''2613590''>things</span> <span m=''2614240''>related</span>
  <span m=''2614620''>to</span> <span m=''2614920''>memory.</span> <span m=''2615380''>Now</span>
  <span m=''2615540''>let''s</span> <span m=''2615720''>look</span> <span m=''2615800''>a</span>
  <span m=''2615840''>little</span> <span m=''2616050''>bit</span> <span m=''2616190''>at
  the</span> <span m=''2616280''>network.</span> <span m=''2617260''>Here</span> <span
  m=''2617440''>was</span> <span m=''2617610''>the</span> <span m=''2617690''>problem.</span>
  <span m=''2618240''>I</span> <span m=''2618410''>have</span> <span m=''2618580''>a</span>
  <span m=''2618660''>user,</span> <span m=''2619100''>our</span> <span m=''2619250''>Canonical</span>
  <span m=''2619680''>admin.</span> <span m=''2620050''>The</span> <span m=''2620250''>user</span>
  <span m=''2620600''>wants</span> <span m=''2620820''>to</span> <span m=''2620910''>perform</span>
  <span m=''2621290''>an</span> <span m=''2621370''>operation</span> <span m=''2621970''>on</span>
  <span m=''2622110''>some</span> <span m=''2622350''>virtual</span> <span m=''2622780''>machine</span>
  <span m=''2623220''>somewhere.</span> <span m=''2623810''>Remember</span> <span
  m=''2624150''>the</span> <span m=''2624240''>flow.</span> <span m=''2624920''>Issue</span>
  <span m=''2625210''>request,</span> <span m=''2625880''>it goes to some</span> <span
  m=''2626400''>server.</span> <span m=''2627430''>The</span> <span m=''2627520''>server</span>
  <span m=''2627840''>goes</span> <span m=''2628260''>to</span> <span m=''2628350''>the</span>
  <span m=''2628450''>host</span> <span m=''2628750''>where</span> <span m=''2628890''>that</span>
  <span m=''2629030''>VM</span> <span m=''2629290''>is.</span> <span m=''2629910''>Does</span>
  <span m=''2630100''>some</span> <span m=''2630230''>operation,</span> <span m=''2630670''>comes</span>
  <span m=''2630870''>back.</span> </p><p><span m=''2631570''>So</span> <span m=''2631680''>this</span>
  <span m=''2631800''>user</span> <span m=''2632000''>wants</span> <span m=''2632190''>to</span>
  <span m=''2632290''>perform</span> <span m=''2632540''>an</span> <span m=''2632600''>operation</span>
  <span m=''2632960''>on a</span> <span m=''2633020''>virtual</span> <span m=''2633300''>machine.</span>
  <span m=''2634000''>I</span> <span m=''2634200''>had</span> <span m=''2634400''>setup</span>
  <span m=''2635120''>A,</span> <span m=''2636420''>In</span> <span m=''2636800''>setup</span>
  <span m=''2637090''>A,</span> <span m=''2637530''>this</span> <span m=''2637970''>operation</span>
  <span m=''2638620''>end</span> <span m=''2638750''>to</span> <span m=''2638880''>end</span>
  <span m=''2639120''>took</span> <span m=''2639260''>about</span> <span m=''2639520''>eight</span>
  <span m=''2639710''>seconds.</span> <span m=''2640710''>Fine.</span> <span m=''2641280''>That</span>
  <span m=''2641440''>doesn''t</span> <span m=''2641650''>mean</span> <span m=''2641820''>much</span>
  <span m=''2642200''>until</span> <span m=''2642420''>you</span> <span m=''2642520''>compare</span>
  <span m=''2642860''>to</span> <span m=''2642950''>setup</span> <span m=''2643280''>B,</span>
  <span m=''2643770''>where it</span> <span m=''2644010''>took</span> <span m=''2644210''>twice</span>
  <span m=''2644680''>the</span> <span m=''2644790''>amount</span> <span m=''2644980''>of</span>
  <span m=''2645040''>time.</span> <span m=''2645340''>It</span> <span m=''2645450''>took</span>
  <span m=''2645630''>16</span> <span m=''2646050''>seconds,</span> <span m=''2646400''>not</span>
  <span m=''2646560''>8</span> <span m=''2646930''>seconds.</span> <span m=''2647300''>So</span>
  <span m=''2647430''>now</span> <span m=''2647600''>the</span> <span m=''2647690''>question</span>
  <span m=''2648020''>you''re</span> <span m=''2648130''>asking</span> <span m=''2648380''>yourself</span>
  <span m=''2648730''>is</span> <span m=''2648930''>what''s</span> <span m=''2649240''>the</span>
  <span m=''2649560''>difference</span> <span m=''2650070''>between</span> <span m=''2650430''>setups</span>
  <span m=''2650640''>A</span> <span m=''2650790''>and</span> <span m=''2651060''>B.</span>
  </p><p><span m=''2651620''>In</span> <span m=''2651860''>setups</span> <span m=''2652220''>A</span>
  <span m=''2652360''>and</span> <span m=''2652520''>B,</span> <span m=''2652910''>the</span>
  <span m=''2653070''>only</span> <span m=''2653390''>difference</span> <span m=''2653860''>is</span>
  <span m=''2653970''>that</span> <span m=''2654220''>this</span> <span m=''2654290''>middle</span>
  <span m=''2654600''>server</span> <span m=''2655400''>is</span> <span m=''2655560''>a</span>
  <span m=''2655640''>different</span> <span m=''2656090''>version</span> <span m=''2656480''>number.</span>
  <span m=''2657560''>But</span> <span m=''2657820''>everything</span> <span m=''2658200''>else</span>
  <span m=''2658370''>is</span> <span m=''2658450''>exactly</span> <span m=''2658920''>the</span>
  <span m=''2659000''>same.</span> <span m=''2659520''>So</span> <span m=''2660060''>with</span>
  <span m=''2660270''>this</span> <span m=''2660460''>different</span> <span m=''2660760''>version</span>
  <span m=''2661070''>you</span> <span m=''2661190''>somehow</span> <span m=''2661460''>manage</span>
  <span m=''2661810''>to</span> <span m=''2661900''>make</span> <span m=''2662120''>your</span>
  <span m=''2662630''>performance</span> <span m=''2663160''>twice</span> <span m=''2663500''>as</span>
  <span m=''2663640''>bad,</span> <span m=''2664110''>which</span> <span m=''2664350''>is</span>
  <span m=''2664430''>a</span> <span m=''2664490''>really</span> <span m=''2664720''>bad</span>
  <span m=''2664960''>thing.</span> <span m=''2665080''>We</span> <span m=''2665170''>got</span>
  <span m=''2665280''>to</span> <span m=''2665320''>get</span> <span m=''2665460''>to</span>
  <span m=''2665530''>the</span> <span m=''2665610''>bottom</span> <span m=''2665880''>of</span>
  <span m=''2665930''>that.</span> <span m=''2666590''>And</span> <span m=''2666960''>in</span>
  <span m=''2667090''>addition,</span> <span m=''2667470''>it''s</span> <span m=''2667590''>not</span>
  <span m=''2667720''>like</span> <span m=''2667850''>it</span> <span m=''2667910''>was</span>
  <span m=''2668000''>some</span> <span m=''2668160''>random</span> <span m=''2668510''>thing
  that</span> <span m=''2668610''>happened</span> <span m=''2668830''>once.</span>
  <span m=''2669120''>It</span> <span m=''2669210''>happened</span> <span m=''2669480''>every</span>
  <span m=''2669660''>single</span> <span m=''2669900''>time.</span> </p><p><span
  m=''2670480''>So</span> <span m=''2670630''>now,</span> <span m=''2671520''>let''s</span>
  <span m=''2671760''>take</span> <span m=''2671960''>a</span> <span m=''2672020''>look</span>
  <span m=''2672420''>at</span> <span m=''2672580''>what</span> <span m=''2672730''>was</span>
  <span m=''2672880''>going</span> <span m=''2673130''>on.</span> <span m=''2673540''>So</span>
  <span m=''2673870''>again,</span> <span m=''2674630''>a</span> <span m=''2674710''>lot</span>
  <span m=''2674880''>of</span> <span m=''2674940''>times,</span> <span m=''2675490''>I</span>
  <span m=''2675620''>tend</span> <span m=''2675790''>to</span> <span m=''2675860''>do</span>
  <span m=''2675990''>things in a</span> <span m=''2676170''>top</span> <span m=''2676430''>down</span>
  <span m=''2676640''>manner,</span> <span m=''2676890''>where</span> <span m=''2677020''>I</span>
  <span m=''2677050''>say</span> <span m=''2677180''>what''s</span> <span m=''2677410''>the</span>
  <span m=''2677540''>easiest</span> <span m=''2677980''>information</span> <span
  m=''2678440''>to</span> <span m=''2678520''>collect.</span> <span m=''2679280''>And</span>
  <span m=''2679470''>then,</span> <span m=''2679990''>OK.</span> <span m=''2680180''>What''s</span>
  <span m=''2680430''>more</span> <span m=''2680610''>difficult,</span> <span m=''2680990''>what''s</span>
  <span m=''2681190''>more</span> <span m=''2681300''>difficult?</span> </p><p><span
  m=''2681380''>And</span> <span m=''2681620''>finally,</span> <span m=''2681910''>if</span>
  <span m=''2682000''>you</span> <span m=''2682080''>have</span> <span m=''2682160''>to</span>
  <span m=''2682530''>use</span> <span m=''2682960''>really</span> <span m=''2683280''>industrial</span>
  <span m=''2683610''>strength</span> <span m=''2683850''>tools,</span> <span m=''2684040''>you</span>
  <span m=''2684140''>use</span> <span m=''2684380''>them.</span> <span m=''2684670''>But</span>
  <span m=''2684820''>it</span> <span m=''2684890''>might</span> <span m=''2685050''>not
  be</span> <span m=''2685280''>necessary.</span> <span m=''2685700''>In</span> <span
  m=''2685750''>this</span> <span m=''2685920''>case,</span> <span m=''2686340''>my</span>
  <span m=''2686500''>first</span> <span m=''2686780''>thing</span> <span m=''2686880''>was</span>
  <span m=''2687020''>just</span> <span m=''2687100''>to</span> <span m=''2687200''>use</span>
  <span m=''2687420''>logging</span> <span m=''2687890''>and</span> <span m=''2687980''>try</span>
  <span m=''2688110''>to</span> <span m=''2688200''>figure</span> <span m=''2688450''>out</span>
  <span m=''2688540''>where</span> <span m=''2688690''>time</span> <span m=''2688950''>was</span>
  <span m=''2689050''>being</span> <span m=''2689240''>spent.</span> </p><p><span
  m=''2690060''>Remember,</span> <span m=''2690330''>we''ve</span> <span m=''2690540''>got
  a</span> <span m=''2690600''>client</span> <span m=''2690910''>talking to</span>
  <span m=''2691190''>a</span> <span m=''2691260''>server,</span> <span m=''2691540''>talking</span>
  <span m=''2691790''>to</span> <span m=''2691890''>an</span> <span m=''2692120''>end
  host.</span> <span m=''2692630''>In</span> <span m=''2692760''>this</span> <span
  m=''2692930''>case,</span> <span m=''2693380''>the</span> <span m=''2693540''>latency</span>
  <span m=''2693980''>imposed</span> <span m=''2694280''>by</span> <span m=''2694390''>that</span>
  <span m=''2694580''>client</span> <span m=''2695360''>was</span> <span m=''2695570''>exactly</span>
  <span m=''2696170''>the</span> <span m=''2696250''>same</span> <span m=''2697380''>in</span>
  <span m=''2697460''>these</span> <span m=''2697600''>two</span> <span m=''2697730''>setups.</span>
  <span m=''2698010''>So that''s</span> <span m=''2698290''>not</span> <span m=''2698430''>where</span>
  <span m=''2698520''>this</span> <span m=''2698700''>eight</span> <span m=''2698860''>seconds
  is</span> <span m=''2699230''>being</span> <span m=''2699440''>lost.</span> <span
  m=''2700940''>The</span> <span m=''2701250''>amount</span> <span m=''2701550''>of</span>
  <span m=''2701640''>time</span> <span m=''2701960''>being</span> <span m=''2702350''>claimed</span>
  <span m=''2702700''>by</span> <span m=''2702860''>the</span> <span m=''2702960''>server</span>
  <span m=''2703700''>was</span> <span m=''2703920''>exactly</span> <span m=''2704580''>the</span>
  <span m=''2704690''>same.</span> </p><p><span m=''2705340''>I''m</span> <span m=''2705460''>a</span>
  <span m=''2705510''>client.</span> <span m=''2706010''>I go</span> <span m=''2706190''>to
  a</span> <span m=''2706230''>server.</span> <span m=''2706630''>It then</span> <span
  m=''2706820''>goes</span> <span m=''2707010''>to</span> <span m=''2707110''>a</span>
  <span m=''2707210''>host.</span> <span m=''2709180''>However,</span> <span m=''2710000''>the</span>
  <span m=''2710130''>time</span> <span m=''2710450''>spent</span> <span m=''2710780''>on</span>
  <span m=''2711040''>the</span> <span m=''2711140''>host</span> <span m=''2712140''>was</span>
  <span m=''2712360''>different.</span> <span m=''2712710''>That''s</span> <span m=''2712920''>where</span>
  <span m=''2713040''>all</span> <span m=''2713230''>of</span> <span m=''2713300''>the</span>
  <span m=''2713400''>time</span> <span m=''2713660''>was</span> <span m=''2713790''>being</span>
  <span m=''2713990''>spent.</span> </p><p><span m=''2714710''>Now,</span> <span m=''2715490''>you''re</span>
  <span m=''2715680''>probably</span> <span m=''2716070''>looking</span> <span m=''2716400''>at--</span>
  <span m=''2716600''>well,</span> <span m=''2716820''>you</span> <span m=''2716910''>may</span>
  <span m=''2716990''>not</span> <span m=''2717150''>be.</span> <span m=''2717230''>But</span>
  <span m=''2717330''>I''ll</span> <span m=''2717420''>tell you</span> <span m=''2717610''>to</span>
  <span m=''2717670''>look</span> <span m=''2717820''>now.</span> <span m=''2718220''>We</span>
  <span m=''2718370''>had</span> <span m=''2718530''>setup</span> <span m=''2718740''>A.</span>
  <span m=''2719380''>Setup</span> <span m=''2719610''>A</span> <span m=''2719860''>was</span>
  <span m=''2719990''>a</span> <span m=''2720120''>client</span> <span m=''2720530''>and</span>
  <span m=''2720640''>the</span> <span m=''2720750''>server</span> <span m=''2721080''>were</span>
  <span m=''2721340''>each</span> <span m=''2721600''>at</span> <span m=''2721690''>some</span>
  <span m=''2721860''>version</span> <span m=''2722200''>number.</span> <span m=''2722470''>And</span>
  <span m=''2722590''>the</span> <span m=''2722660''>host</span> <span m=''2722920''>was</span>
  <span m=''2722990''>at</span> <span m=''2723260''>the</span> <span m=''2723370''>same</span>
  <span m=''2723610''>version</span> <span m=''2723860''>number.</span> <span m=''2724710''>In</span>
  <span m=''2724900''>setup</span> <span m=''2725150''>B,</span> <span m=''2725650''>the</span>
  <span m=''2725770''>client</span> <span m=''2726100''>and</span> <span m=''2726170''>the</span>
  <span m=''2726240''>server</span> <span m=''2726580''>were</span> <span m=''2726770''>at
  a</span> <span m=''2726790''>different</span> <span m=''2727110''>version</span>
  <span m=''2727400''>number</span> <span m=''2727570''>with</span> <span m=''2727740''>respect</span>
  <span m=''2728040''>to</span> <span m=''2728090''>the</span> <span m=''2728160''>host.</span>
  <span m=''2729160''>But</span> <span m=''2729460''>we</span> <span m=''2729600''>just</span>
  <span m=''2729830''>said</span> <span m=''2730020''>all</span> <span m=''2730310''>of
  the</span> <span m=''2730410''>time</span> <span m=''2730620''>is</span> <span m=''2730710''>being</span>
  <span m=''2730890''>spent</span> <span m=''2731180''>in</span> <span m=''2731260''>the</span>
  <span m=''2731330''>host.</span> <span m=''2731860''>So</span> <span m=''2732100''>why</span>
  <span m=''2732720''>is</span> <span m=''2732860''>that</span> <span m=''2733050''>going</span>
  <span m=''2733330''>on?</span> <span m=''2733520''>And</span> <span m=''2733840''>this</span>
  <span m=''2734100''>is</span> <span m=''2734160''>where</span> <span m=''2734330''>understanding</span>
  <span m=''2734720''>the</span> <span m=''2734850''>architecture</span> <span m=''2735340''>is</span>
  <span m=''2735570''>important.</span> </p><p><span m=''2735830''>It</span> <span
  m=''2735920''>turns</span> <span m=''2736180''>out</span> <span m=''2736270''>in</span>
  <span m=''2736350''>this</span> <span m=''2736520''>case,</span> <span m=''2736960''>the</span>
  <span m=''2737050''>first</span> <span m=''2737380''>thing</span> <span m=''2737470''>that</span>
  <span m=''2737600''>happens</span> <span m=''2737850''>when</span> <span m=''2737940''>you</span>
  <span m=''2738000''>have</span> <span m=''2738100''>a</span> <span m=''2738160''>difference</span>
  <span m=''2738540''>in</span> <span m=''2738640''>version</span> <span m=''2739010''>number</span>
  <span m=''2739450''>is</span> <span m=''2739640''>that</span> <span m=''2739750''>the</span>
  <span m=''2739830''>server</span> <span m=''2740320''>helpfully</span> <span m=''2740830''>talks</span>
  <span m=''2741150''>to</span> <span m=''2741240''>the</span> <span m=''2741400''>end</span>
  <span m=''2741990''>host</span> <span m=''2742280''>and</span> <span m=''2742370''>says</span>
  <span m=''2742630''>you</span> <span m=''2742760''>know what,</span> <span m=''2742980''>you''re
  in a</span> <span m=''2743210''>different</span> <span m=''2743510''>version</span>
  <span m=''2743820''>number.</span> <span m=''2744010''>So</span> <span m=''2744100''>let</span>
  <span m=''2744160''>me</span> <span m=''2744250''>give</span> <span m=''2744550''>you</span>
  <span m=''2744670''>some</span> <span m=''2744940''>code</span> <span m=''2745250''>to</span>
  <span m=''2745320''>run,</span> <span m=''2746470''>because</span> <span m=''2746870''>you''re</span>
  <span m=''2747040''>in a</span> <span m=''2747090''>different</span> <span m=''2747350''>version</span>
  <span m=''2747670''>number.</span> <span m=''2747810''>So</span> <span m=''2747950''>in</span>
  <span m=''2748120''>fact,</span> <span m=''2748530''>even</span> <span m=''2748770''>though</span>
  <span m=''2748860''>the</span> <span m=''2748950''>host is</span> <span m=''2749320''>at</span>
  <span m=''2749380''>the</span> <span m=''2749470''>same</span> <span m=''2749720''>version</span>
  <span m=''2750030''>number,</span> <span m=''2750430''>there''s</span> <span m=''2750610''>a</span>
  <span m=''2750670''>small</span> <span m=''2750990''>shim</span> <span m=''2751350''>running</span>
  <span m=''2751660''>on</span> <span m=''2751790''>that</span> <span m=''2751980''>host</span>
  <span m=''2752280''>that</span> <span m=''2752440''>makes</span> <span m=''2752750''>up</span>
  <span m=''2752890''>for</span> <span m=''2752970''>the</span> <span m=''2753070''>fact</span>
  <span m=''2753490''>that</span> <span m=''2753600''>it''s</span> <span m=''2753730''>not</span>
  <span m=''2753920''>at the</span> <span m=''2753990''>same</span> <span m=''2754230''>version</span>
  <span m=''2754530''>number.</span> </p><p><span m=''2756110''>So</span> <span m=''2756270''>now</span>
  <span m=''2756420''>let''s</span> <span m=''2756600''>analyze</span> <span m=''2756855''>this</span>
  <span m=''2757110''>host</span> <span m=''2757190''>and</span> <span m=''2757550''>figure</span>
  <span m=''2757820''>out</span> <span m=''2757950''>where</span> <span m=''2758180''>is</span>
  <span m=''2758280''>this</span> <span m=''2758420''>time</span> <span m=''2758700''>being</span>
  <span m=''2758920''>spent.</span> </p><p><span m=''2760350''>I</span> <span m=''2760460''>did</span>
  <span m=''2760680''>a</span> <span m=''2760720''>little</span> <span m=''2760920''>bit</span>
  <span m=''2761050''>more</span> <span m=''2761260''>logging</span> <span m=''2761590''>on</span>
  <span m=''2761710''>the</span> <span m=''2761780''>host.</span> <span m=''2762020''>The</span>
  <span m=''2762100''>reason</span> <span m=''2762380''>I</span> <span m=''2762440''>did</span>
  <span m=''2762600''>this,</span> <span m=''2762710''>because</span> <span m=''2762890''>a</span>
  <span m=''2762940''>lot</span> <span m=''2763110''>of</span> <span m=''2763150''>the</span>
  <span m=''2763220''>standard</span> <span m=''2763640''>tools</span> <span m=''2763880''>that</span>
  <span m=''2763910''>you</span> <span m=''2764040''>might</span> <span m=''2764310''>use,</span>
  <span m=''2764570''>like</span> <span m=''2764730''>gprof</span> <span m=''2765330''>or
  whatever,</span> <span m=''2765880''>these</span> <span m=''2766120''>things</span>
  <span m=''2766360''>didn''t</span> <span m=''2766630''>exist.</span> <span m=''2766920''>We</span>
  <span m=''2767000''>have</span> <span m=''2767130''>our</span> <span m=''2767240''>own</span>
  <span m=''2767470''>kernel.</span> <span m=''2768050''>Which</span> <span m=''2768260''>therefore,</span>
  <span m=''2768620''>we</span> <span m=''2768880''>have our</span> <span m=''2769145''>own</span>
  <span m=''2769730''>tools</span> <span m=''2770100''>and</span> <span m=''2770200''>our</span>
  <span m=''2770320''>own</span> <span m=''2770590''>nightmares, and</span> <span
  m=''2770780''>headaches</span> <span m=''2771260''>associated</span> <span m=''2771750''>with</span>
  <span m=''2771930''>it.</span> </p><p><span m=''2772200''>So</span> <span m=''2772370''>we</span>
  <span m=''2772470''>had</span> <span m=''2772630''>to</span> <span m=''2772670''>use</span>
  <span m=''2772940''>these</span> <span m=''2773180''>tools</span> <span m=''2773510''>instead</span>
  <span m=''2773840''>of</span> <span m=''2773980''>commercially</span> <span m=''2774440''>available</span>
  <span m=''2774850''>tools.</span> <span m=''2775680''>When</span> <span m=''2775930''>you</span>
  <span m=''2776000''>use</span> <span m=''2776220''>these</span> <span m=''2776380''>tools,</span>
  <span m=''2776640''>we</span> <span m=''2776810''>ended up</span> <span m=''2776980''>narrowing</span>
  <span m=''2777350''>down</span> <span m=''2777540''>the</span> <span m=''2777610''>time.</span>
  <span m=''2777880''>Here''s</span> <span m=''2778070''>what</span> <span m=''2778160''>goes</span>
  <span m=''2778410''>on.</span> <span m=''2778850''>I''m</span> <span m=''2779050''>a
  client.</span> <span m=''2779360''>And I</span> <span m=''2779530''>talk</span>
  <span m=''2779710''>to</span> <span m=''2779770''>the</span> <span m=''2779850''>server.</span>
  <span m=''2780480''>The</span> <span m=''2780580''>server</span> <span m=''2780920''>talks</span>
  <span m=''2781210''>to</span> <span m=''2781330''>an</span> <span m=''2781530''>agent</span>
  <span m=''2781930''>on</span> <span m=''2782090''>the</span> <span m=''2782180''>host.</span>
  <span m=''2782430''>It says,</span> <span m=''2782640''>agent,</span> <span m=''2783300''>this</span>
  <span m=''2783490''>is</span> <span m=''2783590''>what</span> <span m=''2783740''>I</span>
  <span m=''2783790''>want</span> <span m=''2784020''>to</span> <span m=''2784060''>do.</span>
  <span m=''2784680''>The</span> <span m=''2784900''>agent</span> <span m=''2785380''>then</span>
  <span m=''2785530''>talks</span> <span m=''2785780''>to</span> <span m=''2785860''>the</span>
  <span m=''2785940''>hardware</span> <span m=''2786240''>abstraction</span> <span
  m=''2786740''>layer</span> <span m=''2786910''>and</span> <span m=''2786980''>says,</span>
  <span m=''2787300''>dude,</span> <span m=''2787470''>this</span> <span m=''2787650''>is</span>
  <span m=''2787740''>what</span> <span m=''2787870''>I</span> <span m=''2787930''>want</span>
  <span m=''2788170''>to</span> <span m=''2788230''>do.</span> <span m=''2788780''>The</span>
  <span m=''2788860''>hardware</span> <span m=''2789130''>abstraction</span> <span
  m=''2789550''>layer</span> <span m=''2789650''>comes</span> <span m=''2789800''>back</span>
  <span m=''2789990''>to</span> <span m=''2790060''>the</span> <span m=''2790220''>agent
  and</span> <span m=''2790600''>says,</span> <span m=''2790800''>done.</span> <span
  m=''2791390''>Agent</span> <span m=''2791670''>goes</span> <span m=''2791800''>back</span>
  <span m=''2791980''>to</span> <span m=''2792050''>the</span> <span m=''2792110''>server.</span>
  <span m=''2792670''>Sever goes</span> <span m=''2793050''>back</span> <span m=''2793210''>to</span>
  <span m=''2793270''>the</span> <span m=''2793350''>client,</span> <span m=''2793700''>blah,
  blah,  blah.</span> </p><p><span m=''2794790''>It</span> <span m=''2794960''>turns</span>
  <span m=''2795270''>out</span> <span m=''2795460''>that</span> <span m=''2795600''>this</span>
  <span m=''2795780''>interaction</span> <span m=''2796400''>on</span> <span m=''2796660''>the</span>
  <span m=''2796740''>host</span> <span m=''2797340''>between</span> <span m=''2797590''>the</span>
  <span m=''2797820''>agent</span> <span m=''2798450''>that</span> <span m=''2798830''>accepted</span>
  <span m=''2799130''>the</span> <span m=''2799290''>call from</span> <span m=''2799560''>the</span>
  <span m=''2799630''>server</span> <span m=''2800230''>and</span> <span m=''2800580''>the</span>
  <span m=''2800680''>hardware</span> <span m=''2800890''>abstraction</span> <span
  m=''2801350''>layer,</span> <span m=''2801690''>that</span> <span m=''2802020''>was</span>
  <span m=''2802170''>where</span> <span m=''2802340''>all</span> <span m=''2802710''>of
  the</span> <span m=''2802800''>time</span> <span m=''2803030''>was</span> <span
  m=''2803170''>being</span> <span m=''2803370''>spent.</span> <span m=''2803820''>It</span>
  <span m=''2803920''>was</span> <span m=''2804100''>10</span> <span m=''2804430''>milliseconds</span>
  <span m=''2804940''>in</span> <span m=''2805000''>one</span> <span m=''2805250''>case.</span>
  <span m=''2805640''>And</span> <span m=''2805820''>20</span> <span m=''2806240''>times</span>
  <span m=''2806660''>that</span> <span m=''2806910''>length</span> <span m=''2807430''>in</span>
  <span m=''2807620''>the</span> <span m=''2807790''>other</span> <span m=''2807960''>case.</span>
  <span m=''2808610''>And</span> <span m=''2808750''>so</span> <span m=''2808840''>this</span>
  <span m=''2809040''>was</span> <span m=''2809210''>a</span> <span m=''2809360''>pretty</span>
  <span m=''2809880''>big</span> <span m=''2810040''>difference</span> <span m=''2810440''>not</span>
  <span m=''2810630''>to</span> <span m=''2810710''>be</span> <span m=''2811010''>ignored.</span>
  <span m=''2811280''>So</span> <span m=''2811390''>we</span> <span m=''2811460''>wanted</span>
  <span m=''2811620''>to</span> <span m=''2811720''>look</span> <span m=''2811910''>at</span>
  <span m=''2811970''>why</span> <span m=''2812240''>that</span> <span m=''2812370''>was</span>
  <span m=''2812520''>going</span> <span m=''2812770''>on.</span> </p><p><span m=''2813950''>So</span>
  <span m=''2814250''>here,</span> <span m=''2814770''>it''s</span> <span m=''2814920''>kind</span>
  <span m=''2815030''>of</span> <span m=''2815150''>a</span> <span m=''2815210''>dumb</span>
  <span m=''2815460''>thing.</span> <span m=''2815660''>But</span> <span m=''2815770''>the</span>
  <span m=''2815840''>next the</span> <span m=''2816050''>thing</span> <span m=''2816160''>I</span>
  <span m=''2816210''>did</span> <span m=''2816390''>was, well,</span> <span m=''2816550''>let''s</span>
  <span m=''2816710''>take</span> <span m=''2816840''>a</span> <span m=''2816910''>look</span>
  <span m=''2816980''>at</span> <span m=''2817050''>the</span> <span m=''2817130''>configuration.</span>
  <span m=''2817620''>Maybe</span> <span m=''2817840''>I</span> <span m=''2817880''>did</span>
  <span m=''2818000''>something</span> <span m=''2818180''>stupid</span> <span m=''2818560''>that</span>
  <span m=''2818670''>would</span> <span m=''2818780''>have caused</span> <span m=''2819040''>this</span>
  <span m=''2819160''>to</span> <span m=''2819260''>happen.</span> <span m=''2820680''>Here''s</span>
  <span m=''2820900''>the</span> <span m=''2820980''>deal.</span> <span m=''2821370''>In</span>
  <span m=''2821530''>setup</span> <span m=''2821890''>A,</span> <span m=''2822020''>remember</span>
  <span m=''2822390''>everything</span> <span m=''2822730''>is</span> <span m=''2822820''>at</span>
  <span m=''2822870''>the</span> <span m=''2822940''>same</span> <span m=''2823220''>version</span>
  <span m=''2823540''>number.</span> <span m=''2823990''>And</span> <span m=''2824120''>it
  turns</span> <span m=''2824380''>out</span> <span m=''2824470''>this</span> <span
  m=''2824660''>agent</span> <span m=''2825020''>HAL</span> <span m=''2825240''>communication</span>
  <span m=''2825840''>occurs</span> <span m=''2826160''>over</span> <span m=''2826490''>a
  named</span> <span m=''2826960''>pipe.</span> <span m=''2827780''>OK,</span> <span
  m=''2828040''>whatever.</span> </p><p><span m=''2829220''>It</span> <span m=''2829360''>turns</span>
  <span m=''2829620''>out</span> <span m=''2829750''>in</span> <span m=''2829870''>setup</span>
  <span m=''2830010''>B--</span> <span m=''2830310''>remember</span> <span m=''2830590''>the</span>
  <span m=''2830720''>client</span> <span m=''2831050''>and</span> <span m=''2831120''>the</span>
  <span m=''2831200''>server</span> <span m=''2831570''>were</span> <span m=''2831740''>at</span>
  <span m=''2831850''>a</span> <span m=''2831950''>different</span> <span m=''2832280''>version</span>
  <span m=''2832550''>from</span> <span m=''2832690''>the</span> <span m=''2832780''>host,</span>
  <span m=''2833230''>so</span> <span m=''2833370''>the</span> <span m=''2833450''>server
  has</span> <span m=''2833840''>to</span> <span m=''2833930''>download</span> <span
  m=''2834390''>some</span> <span m=''2834570''>shim</span> <span m=''2834910''>code</span>
  <span m=''2835400''>onto</span> <span m=''2835740''>that</span> <span m=''2835920''>host</span>
  <span m=''2836150''>so</span> <span m=''2836290''>that</span> <span m=''2836400''>everybody</span>
  <span m=''2836720''>can</span> <span m=''2836860''>talk</span> <span m=''2837090''>correctly.</span>
  <span m=''2838270''>It</span> <span m=''2838440''>turns</span> <span m=''2838750''>out</span>
  <span m=''2838950''>that</span> <span m=''2839110''>shim</span> <span m=''2839490''>code</span>
  <span m=''2840490''>was</span> <span m=''2840650''>communicating</span> <span m=''2841140''>with</span>
  <span m=''2841290''>the</span> <span m=''2841520''>hardware</span> <span m=''2841900''>abstraction
  layer--</span> <span m=''2842210''>instead</span> <span m=''2842600''>of</span>
  <span m=''2842680''>over</span> <span m=''2842910''>a</span> <span m=''2842960''>named</span>
  <span m=''2843340''>pipe--</span> <span m=''2843810''>it</span> <span m=''2843910''>was</span>
  <span m=''2844060''>communicating</span> <span m=''2844640''>over</span> <span m=''2844810''>TCP/IP.</span>
  </p><p><span m=''2847030''>Now</span> <span m=''2847910''>I</span> <span m=''2848080''>have</span>
  <span m=''2848250''>to</span> <span m=''2848340''>give</span> <span m=''2848550''>credit</span>
  <span m=''2848810''>to</span> <span m=''2848870''>my</span> <span m=''2848990''>colleague</span>
  <span m=''2849450''>on</span> <span m=''2849560''>this.</span> <span m=''2850590''>As</span>
  <span m=''2850710''>soon</span> <span m=''2850900''>as</span> <span m=''2851010''>I</span>
  <span m=''2851060''>showed</span> <span m=''2851320''>him</span> <span m=''2851380''>this</span>
  <span m=''2851540''>information,</span> <span m=''2852440''>he</span> <span m=''2852660''>hit</span>
  <span m=''2852840''>a</span> <span m=''2853320''>flash</span> <span m=''2853620''>of</span>
  <span m=''2853680''>inspiration.</span> <span m=''2855170''>It</span> <span m=''2855520''>turns</span>
  <span m=''2855620''>out</span> <span m=''2856290''>that</span> <span m=''2856680''>when</span>
  <span m=''2856860''>you''re</span> <span m=''2856940''>using</span> <span m=''2857200''>the</span>
  <span m=''2857270''>named</span> <span m=''2857530''>pipe and</span> <span m=''2857790''>it</span>
  <span m=''2857960''>takes</span> <span m=''2858140''>10</span> <span m=''2858330''>milliseconds,</span>
  <span m=''2859210''>the</span> <span m=''2859480''>reason</span> <span m=''2859850''>that''s</span>
  <span m=''2860160''>different</span> <span m=''2860680''>from</span> <span m=''2860810''>TCP/IP</span>
  <span m=''2861550''>communication</span> <span m=''2861885''>is</span> <span m=''2862850''>because</span>
  <span m=''2863040''>of</span> <span m=''2863110''>something</span> <span m=''2863380''>called</span>
  <span m=''2863630''>Nagle''s</span> <span m=''2864040''>algorithm.</span> <span
  m=''2864800''>Nagle''s</span> <span m=''2865210''>algorithm</span> <span m=''2865590''>basically</span>
  <span m=''2866000''>says,</span> <span m=''2866770''>you</span> <span m=''2866910''>want</span>
  <span m=''2867080''>to</span> <span m=''2867120''>accumulate</span> <span m=''2867560''>data</span>
  <span m=''2867720''>before</span> <span m=''2867940''>you</span> <span m=''2868050''>send</span>
  <span m=''2868270''>it</span> <span m=''2868340''>so</span> <span m=''2868610''>you</span>
  <span m=''2868830''>reduce</span> <span m=''2869150''>the</span> <span m=''2869230''>number</span>
  <span m=''2869480''>of</span> <span m=''2870160''>round</span> <span m=''2870450''>trips</span>
  <span m=''2870730''>and</span> <span m=''2870920''>the</span> <span m=''2871010''>overhead</span>
  <span m=''2871360''>of</span> <span m=''2871450''>creating</span> <span m=''2871780''>a</span>
  <span m=''2871840''>connection,</span> <span m=''2872250''>and whatever.</span>
  </p><p><span m=''2872570''>And</span> <span m=''2872630''>the</span> <span m=''2872700''>problem</span>
  <span m=''2873170''>was</span> <span m=''2873660''>this</span> <span m=''2873980''>was</span>
  <span m=''2874160''>biting</span> <span m=''2874610''>us.</span> <span m=''2874910''>Essentially,</span>
  <span m=''2875390''>we were</span> <span m=''2875710''>waiting</span> <span m=''2876050''>within</span>
  <span m=''2876300''>that</span> <span m=''2876470''>shim</span> <span m=''2876730''>to</span>
  <span m=''2876810''>collect</span> <span m=''2877070''>enough</span> <span m=''2877270''>data</span>
  <span m=''2877510''>to</span> <span m=''2877600''>send</span> <span m=''2877850''>it</span>
  <span m=''2877970''>back</span> <span m=''2878200''>to</span> <span m=''2878280''>that</span>
  <span m=''2878460''>HAL.</span> <span m=''2879180''>And</span> <span m=''2879320''>we</span>
  <span m=''2879430''>were</span> <span m=''2879470''>waiting</span> <span m=''2879880''>fairly</span>
  <span m=''2880240''>needlessly,</span> <span m=''2880800''>because</span> <span
  m=''2881830''>what</span> <span m=''2882010''>happens</span> <span m=''2882370''>is</span>
  <span m=''2882490''>that</span> <span m=''2883260''>this</span> <span m=''2883450''>algorithm</span>
  <span m=''2883840''>waits</span> <span m=''2884160''>for</span> <span m=''2884280''>a</span>
  <span m=''2884330''>certain</span> <span m=''2884540''>amount</span> <span m=''2884710''>of</span>
  <span m=''2884790''>time.</span> <span m=''2885010''>And</span> <span m=''2885140''>then
  if</span> <span m=''2885220''>it</span> <span m=''2885280''>hasn''t</span> <span
  m=''2885580''>gotten</span> <span m=''2885800''>more</span> <span m=''2886000''>data,</span>
  <span m=''2886260''>it goes</span> <span m=''2886490''>ahead and</span> <span m=''2886730''>sends</span>
  <span m=''2886960''>it.</span> <span m=''2887070''>So</span> <span m=''2887140''>we</span>
  <span m=''2887280''>are</span> <span m=''2887340''>basically</span> <span m=''2887700''>stuck,</span>
  <span m=''2888500''>waiting</span> <span m=''2889010''>for</span> <span m=''2889130''>this</span>
  <span m=''2889330''>time</span> <span m=''2889610''>out</span> <span m=''2889730''>to</span>
  <span m=''2889820''>occur</span> <span m=''2890040''>before</span> <span m=''2890320''>the</span>
  <span m=''2890430''>data</span> <span m=''2890640''>actually</span> <span m=''2890970''>got</span>
  <span m=''2891150''>transferred.</span> </p><p><span m=''2891960''>And</span> <span
  m=''2892140''>there''s</span> <span m=''2892310''>a</span> <span m=''2892360''>very</span>
  <span m=''2892620''>simple</span> <span m=''2892920''>way</span> <span m=''2893030''>to</span>
  <span m=''2893080''>get</span> <span m=''2893280''>rid</span> <span m=''2893410''>of</span>
  <span m=''2893460''>that.</span> <span m=''2893640''>You just</span> <span m=''2893830''>tell</span>
  <span m=''2893950''>it, hey,</span> <span m=''2894090''>don''t</span> <span m=''2894280''>use</span>
  <span m=''2894530''>Nagle''s</span> <span m=''2894690''>algorithm.</span> <span
  m=''2894990''>We</span> <span m=''2895090''>don''t</span> <span m=''2895260''>care.</span>
  <span m=''2895760''>And</span> <span m=''2895880''>that</span> <span m=''2896130''>solves</span>
  <span m=''2896300''>the</span> <span m=''2896420''>entire</span> <span m=''2896770''>problem.</span>
  <span m=''2898300''>So</span> <span m=''2899100''>the</span> <span m=''2899170''>point</span>
  <span m=''2899410''>is</span> <span m=''2899490''>once</span> <span m=''2899670''>you</span>
  <span m=''2899740''>get</span> <span m=''2899900''>rid</span> <span m=''2900010''>of</span>
  <span m=''2900110''>that,</span> <span m=''2900570''>the</span> <span m=''2900670''>performance</span>
  <span m=''2901110''>is</span> <span m=''2901190''>exactly</span> <span m=''2901560''>the</span>
  <span m=''2901620''>same.</span> </p><p><span m=''2901860''>It''s</span> <span m=''2901960''>a</span>
  <span m=''2902010''>very</span> <span m=''2902190''>simple</span> <span m=''2902420''>configuration</span>
  <span m=''2903030''>setting.</span> <span m=''2903220''>But</span> <span m=''2903360''>that''s</span>
  <span m=''2903590''>again,</span> <span m=''2903810''>a</span> <span m=''2903860''>situation</span>
  <span m=''2904430''>where</span> <span m=''2904830''>somebody--</span> <span m=''2905490''>and</span>
  <span m=''2905640''>in</span> <span m=''2905720''>fact,</span> <span m=''2905940''>I</span>
  <span m=''2905980''>remember</span> <span m=''2906750''>asking</span> <span m=''2907310''>why</span>
  <span m=''2907540''>this</span> <span m=''2907720''>particular</span> <span m=''2908160''>change</span>
  <span m=''2908540''>was made.</span> <span m=''2908850''>And again,</span> <span
  m=''2909130''>it was,</span> <span m=''2909270''>well,</span> <span m=''2909470''>we</span>
  <span m=''2909560''>didn''t</span> <span m=''2909740''>think</span> <span m=''2909880''>it
  was</span> <span m=''2910040''>going</span> <span m=''2910150''>to</span> <span
  m=''2910190''>be</span> <span m=''2910330''>a</span> <span m=''2910380''>big</span>
  <span m=''2910590''>deal.</span> <span m=''2911470''>And</span> <span m=''2911610''>that</span>
  <span m=''2911750''>ends</span> <span m=''2911890''>up</span> <span m=''2911980''>being,</span>
  <span m=''2912180''>again,</span> <span m=''2912380''>a</span> <span m=''2912430''>very</span>
  <span m=''2912700''>bad</span> <span m=''2913040''>way</span> <span m=''2913210''>of</span>
  <span m=''2913300''>doing</span> <span m=''2913470''>performance</span> <span m=''2913920''>engineering.</span>
  </p><p><span m=''2914440''>So</span> <span m=''2915020''>definitely,</span> <span
  m=''2916390''>the</span> <span m=''2916480''>lesson</span> <span m=''2916810''>that
  I</span> <span m=''2916880''>learned</span> <span m=''2917100''>here</span> <span
  m=''2917290''>is</span> <span m=''2917390''>just</span> <span m=''2917580''>like</span>
  <span m=''2917720''>the</span> <span m=''2917770''>lesson</span> <span m=''2918000''>with</span>
  <span m=''2918100''>32-bit,</span> <span m=''2918470''>64-bit.</span> <span m=''2919300''>You</span>
  <span m=''2919430''>might</span> <span m=''2919670''>think</span> <span m=''2919840''>that</span>
  <span m=''2919940''>a</span> <span m=''2920010''>little</span> <span m=''2920250''>change</span>
  <span m=''2920530''>like</span> <span m=''2920690''>this</span> <span m=''2921550''>doesn''t</span>
  <span m=''2921860''>mean</span> <span m=''2922020''>anything.</span> <span m=''2922280''>But</span>
  <span m=''2922380''>it</span> <span m=''2922450''>really</span> <span m=''2922660''>does.</span>
  <span m=''2922920''>And</span> <span m=''2922990''>here,</span> <span m=''2923140''>it''s</span>
  <span m=''2923240''>actually</span> <span m=''2923540''>important</span> <span m=''2924020''>to</span>
  <span m=''2924140''>understand</span> <span m=''2924560''>the</span> <span m=''2924650''>entire</span>
  <span m=''2925010''>stack</span> <span m=''2925380''>end</span> <span m=''2925580''>to</span>
  <span m=''2925660''>end.</span> <span m=''2925850''>Because</span> <span m=''2926070''>otherwise,</span>
  <span m=''2926340''>you''re</span> <span m=''2926420''>never</span> <span m=''2926580''>going</span>
  <span m=''2926670''>to</span> <span m=''2926710''>be</span> <span m=''2926770''>able</span>
  <span m=''2926850''>to</span> <span m=''2926960''>figure</span> <span m=''2927420''>out</span>
  <span m=''2927510''>where</span> <span m=''2927600''>the</span> <span m=''2927700''>problem</span>
  <span m=''2928010''>actually</span> <span m=''2928250''>was</span> <span m=''2928370''>occurring.</span>
  </p><p><span m=''2931560''>I</span> <span m=''2931710''>already</span> <span m=''2931930''>alluded</span>
  <span m=''2932200''>to</span> <span m=''2932280''>a</span> <span m=''2932370''>previous</span>
  <span m=''2932750''>situation</span> <span m=''2933330''>where</span> <span m=''2933800''>we</span>
  <span m=''2933930''>had</span> <span m=''2934010''>a</span> <span m=''2934090''>correctness</span>
  <span m=''2934520''>problem,</span> <span m=''2934820''>which</span> <span m=''2935025''>masked</span>
  <span m=''2935230''>as</span> <span m=''2935390''>a</span> <span m=''2935550''>performance</span>
  <span m=''2935710''>problem.</span> <span m=''2936150''>In</span> <span m=''2936260''>the</span>
  <span m=''2936330''>previous</span> <span m=''2936760''>case,</span> <span m=''2937180''>it</span>
  <span m=''2937280''>was</span> <span m=''2937430''>because</span> <span m=''2937950''>I</span>
  <span m=''2938080''>had</span> <span m=''2938230''>a</span> <span m=''2938290''>limited</span>
  <span m=''2938590''>thread</span> <span m=''2938930''>pool.</span> <span m=''2939270''>And</span>
  <span m=''2939360''>whenever</span> <span m=''2939660''>I</span> <span m=''2939700''>ran</span>
  <span m=''2939950''>out</span> <span m=''2940030''>of</span> <span m=''2940090''>threads,</span>
  <span m=''2940430''>I''d</span> <span m=''2940590''>queue</span> <span m=''2941090''>everyting.
  And at</span> <span m=''2941270''>some</span> <span m=''2941410''>point,</span>
  <span m=''2941830''>I</span> <span m=''2941970''>had</span> <span m=''2942050''>a</span>
  <span m=''2942100''>correctness</span> <span m=''2942460''>problem where</span>
  <span m=''2942680''>I</span> <span m=''2942860''>kept</span> <span m=''2943020''>killing</span>
  <span m=''2943360''>threads</span> <span m=''2943670''>and</span> <span m=''2943760''>never</span>
  <span m=''2943980''>resurrecting</span> <span m=''2944570''>them.</span> <span m=''2944790''>And</span>
  <span m=''2944890''>so</span> <span m=''2945030''>I</span> <span m=''2945110''>ended</span>
  <span m=''2945260''>up</span> <span m=''2945420''>queuing</span> <span m=''2945680''>everything.</span>
  <span m=''2946060''>And</span> <span m=''2946140''>everything</span> <span m=''2946410''>went</span>
  <span m=''2946570''>to</span> <span m=''2946640''>pot.</span> </p><p><span m=''2947370''>Now</span>
  <span m=''2947570''>let</span> <span m=''2947650''>me</span> <span m=''2947740''>talk</span>
  <span m=''2947930''>about a</span> <span m=''2948120''>different</span> <span m=''2948400''>situation.</span>
  <span m=''2949360''>Here</span> <span m=''2949820''>I''ve</span> <span m=''2950040''>got</span>
  <span m=''2950210''>a</span> <span m=''2950290''>poor</span> <span m=''2950640''>little</span>
  <span m=''2950850''>customer,</span> <span m=''2951135''>in fact</span> <span m=''2951420''>that</span>
  <span m=''2951830''>customer</span> <span m=''2952140''>was</span> <span m=''2952270''>me.</span>
  <span m=''2952950''>I</span> <span m=''2953030''>was</span> <span m=''2953190''>powering</span>
  <span m=''2953540''>on</span> <span m=''2953790''>a</span> <span m=''2953830''>virtual</span>
  <span m=''2954190''>machine.</span> <span m=''2955300''>Remember</span> <span m=''2955570''>it</span>
  <span m=''2955800''>goes to</span> <span m=''2955860''>the</span> <span m=''2955920''>server,</span>
  <span m=''2956260''>goes</span> <span m=''2956440''>to</span> <span m=''2956520''>host,</span>
  <span m=''2956830''>powers on</span> <span m=''2957200''>the</span> <span m=''2957280''>virtual</span>
  <span m=''2957560''>machine,</span> <span m=''2958020''>tells</span> <span m=''2958220''>me</span>
  <span m=''2958390''>it''s</span> <span m=''2958885''>done.</span> <span m=''2959380''>Every</span>
  <span m=''2959780''>other</span> <span m=''2960070''>time</span> <span m=''2960400''>I</span>
  <span m=''2960470''>would</span> <span m=''2960630''>do</span> <span m=''2960750''>this,</span>
  <span m=''2960980''>it</span> <span m=''2961110''>took</span> <span m=''2961290''>five</span>
  <span m=''2961600''>seconds,</span> <span m=''2962110''>which</span> <span m=''2962300''>is</span>
  <span m=''2962410''>pretty</span> <span m=''2962690''>OK.</span> </p><p><span m=''2963970''>In</span>
  <span m=''2964120''>comparison,</span> <span m=''2964730''>every</span> <span m=''2965070''>other</span>
  <span m=''2965340''>time</span> <span m=''2965620''>I</span> <span m=''2965700''>did</span>
  <span m=''2965950''>it,</span> <span m=''2966000''>it would</span> <span m=''2966120''>take</span>
  <span m=''2966290''>about</span> <span m=''2966440''>five</span> <span m=''2966860''>minutes.</span>
  <span m=''2967780''>That''s</span> <span m=''2967980''>a</span> <span m=''2968040''>pretty</span>
  <span m=''2968400''>huge</span> <span m=''2968640''>expansion.</span> <span m=''2969120''>And</span>
  <span m=''2969280''>if a</span> <span m=''2969340''>customer</span> <span m=''2969720''>called</span>
  <span m=''2969960''>me</span> <span m=''2970040''>and</span> <span m=''2970160''>said</span>
  <span m=''2970340''>this,</span> <span m=''2970760''>I</span> <span m=''2970910''>would</span>
  <span m=''2971040''>basically</span> <span m=''2971410''>be</span> <span m=''2971770''>in</span>
  <span m=''2971940''>deep</span> <span m=''2972720''>doggy</span> <span m=''2972940''>do-do.</span>
  </p><p><span m=''2973150''>So</span> <span m=''2973330''>it</span> <span m=''2973800''>was</span>
  <span m=''2974010''>important</span> <span m=''2974340''>to try</span> <span m=''2974460''>to</span>
  <span m=''2974540''>figure</span> <span m=''2974850''>what was</span> <span m=''2975080''>actually</span>
  <span m=''2975380''>going</span> <span m=''2975650''>on</span> <span m=''2975860''>here.</span>
  <span m=''2976020''>So why</span> <span m=''2976710''>does</span> <span m=''2976790''>powering</span>
  <span m=''2977110''>on</span> <span m=''2977210''>a</span> <span m=''2977330''>VM</span>
  <span m=''2977470''>have</span> <span m=''2977600''>such</span> <span m=''2977890''>a</span>
  <span m=''2977930''>variable</span> <span m=''2978530''>performance?</span> <span
  m=''2979950''>Well,</span> <span m=''2980130''>the</span> <span m=''2980230''>key</span>
  <span m=''2980470''>here,</span> <span m=''2980590''>again,</span> <span m=''2980770''>is</span>
  <span m=''2980850''>to</span> <span m=''2980930''>understand</span> <span m=''2981270''>what''s</span>
  <span m=''2981500''>the</span> <span m=''2981630''>end</span> <span m=''2982030''>to
  end</span> <span m=''2982370''>path for</span> <span m=''2982460''>things.</span>
  </p><p><span m=''2983340''>In</span> <span m=''2983470''>this</span> <span m=''2983640''>case,</span>
  <span m=''2983820''>what</span> <span m=''2984000''>I</span> <span m=''2984110''>know</span>
  <span m=''2984300''>is</span> <span m=''2984380''>that</span> <span m=''2984470''>when</span>
  <span m=''2984580''>you</span> <span m=''2984670''>power</span> <span m=''2985010''>on</span>
  <span m=''2985150''>a</span> <span m=''2985190''>virtual</span> <span m=''2985550''>machine,</span>
  <span m=''2986100''>one</span> <span m=''2986470''>of</span> <span m=''2986550''>the</span>
  <span m=''2986630''>things</span> <span m=''2986840''>you</span> <span m=''2987000''>have</span>
  <span m=''2987120''>to</span> <span m=''2987200''>do</span> <span m=''2987280''>is</span>
  <span m=''2987400''>allocate</span> <span m=''2988270''>some</span> <span m=''2988500''>space</span>
  <span m=''2988850''>on</span> <span m=''2988980''>disk</span> <span m=''2989250''>to</span>
  <span m=''2989370''>write</span> <span m=''2989600''>swap</span> <span m=''2989930''>information</span>
  <span m=''2990490''>and</span> <span m=''2990570''>whatever.</span> <span m=''2991180''>So</span>
  <span m=''2991420''>one</span> <span m=''2991590''>of</span> <span m=''2991630''>the</span>
  <span m=''2991820''>first</span> <span m=''2992020''>places</span> <span m=''2992300''>I</span>
  <span m=''2992380''>looked</span> <span m=''2992610''>was</span> <span m=''2992720''>I</span>
  <span m=''2992780''>said,</span> <span m=''2992920''>well,</span> <span m=''2993260''>let</span>
  <span m=''2993410''>me</span> <span m=''2993540''>understand</span> <span m=''2993990''>how</span>
  <span m=''2994090''>the</span> <span m=''2994200''>disk is</span> <span m=''2994570''>performing</span>
  <span m=''2994990''>in</span> <span m=''2995060''>each</span> <span m=''2995190''>of</span>
  <span m=''2995300''>these</span> <span m=''2995410''>cases</span> <span m=''2995750''>to</span>
  <span m=''2995850''>try</span> <span m=''2996010''>to</span> <span m=''2996090''>figure</span>
  <span m=''2996350''>out</span> <span m=''2996440''>what''s</span> <span m=''2996680''>going</span>
  <span m=''2996910''>on.</span> <span m=''2997220''>It''s</span> <span m=''2997480''>a</span>
  <span m=''2997520''>mixture</span> <span m=''2997820''>of common</span> <span m=''2998125''>sense
  and</span> <span m=''2998430''>knowing</span> <span m=''2998700''>what''s</span>
  <span m=''2998930''>going</span> <span m=''2999170''>on,</span> <span m=''2999450''>and</span>
  <span m=''2999550''>then</span> <span m=''2999680''>knowing</span> <span m=''2999930''>where</span>
  <span m=''3000080''>to</span> <span m=''3000160''>look.</span> </p><p><span m=''3001550''>So</span>
  <span m=''3001730''>let me</span> <span m=''3002060''>let</span> <span m=''3002210''>you</span>
  <span m=''3002370''>in</span> <span m=''3002540''>on a</span> <span m=''3002600''>little</span>
  <span m=''3002780''>secret.</span> <span m=''3004190''>In</span> <span m=''3004330''>the</span>
  <span m=''3004420''>real</span> <span m=''3004690''>world,</span> <span m=''3005090''>if</span>
  <span m=''3005240''>you''re</span> <span m=''3005350''>using</span> <span m=''3005710''>some</span>
  <span m=''3005890''>sort</span> <span m=''3006090''>of</span> <span m=''3006190''>disk,</span>
  <span m=''3006780''>if</span> <span m=''3007020''>your</span> <span m=''3007200''>disk</span>
  <span m=''3007500''>latency</span> <span m=''3007920''>is</span> <span m=''3008050''>basically</span>
  <span m=''3008490''>10</span> <span m=''3008750''>milliseconds</span> <span m=''3009300''>or</span>
  <span m=''3009360''>less,</span> <span m=''3009820''>you''re</span> <span m=''3009990''>more</span>
  <span m=''3010300''>or</span> <span m=''3010340''>less</span> <span m=''3010570''>golden.</span>
  <span m=''3011080''>That''s</span> <span m=''3011310''>not</span> <span m=''3011390''>a</span>
  <span m=''3011480''>problem.</span> <span m=''3012410''>If</span> <span m=''3012610''>your</span>
  <span m=''3012750''>latency</span> <span m=''3013260''>is</span> <span m=''3013370''>between</span>
  <span m=''3013680''>10</span> <span m=''3014040''>and</span> <span m=''3014100''>20</span>
  <span m=''3014170''>milliseconds,</span> <span m=''3014980''>maybe</span> <span
  m=''3015300''>that''s</span> <span m=''3015550''>acceptable</span> <span m=''3015930''>because</span>
  <span m=''3016140''>you</span> <span m=''3016250''>have</span> <span m=''3016290''>a</span>
  <span m=''3016610''>complicated</span> <span m=''3017190''>topology.</span> <span
  m=''3017970''>You''re</span> <span m=''3018240''>some</span> <span m=''3018410''>multinational</span>
  <span m=''3018970''>corporation</span> <span m=''3019540''>with</span> <span m=''3019670''>sites</span>
  <span m=''3019910''>everywhere,</span> <span m=''3020280''>whatever.</span> </p><p><span
  m=''3021140''>If</span> <span m=''3021300''>your</span> <span m=''3021460''>latency</span>
  <span m=''3021715''>is</span> <span m=''3022100''>getting</span> <span m=''3022370''>to</span>
  <span m=''3022430''>the</span> <span m=''3022540''>point</span> <span m=''3022890''>where</span>
  <span m=''3023170''>they''re</span> <span m=''3023300''>50</span> <span m=''3023610''>milliseconds,</span>
  <span m=''3024870''>then</span> <span m=''3025420''>you</span> <span m=''3026000''>probably</span>
  <span m=''3026350''>have</span> <span m=''3026460''>to</span> <span m=''3026550''>start</span>
  <span m=''3026810''>worrying.</span> <span m=''3027180''>That''s</span> <span m=''3027400''>actually</span>
  <span m=''3027680''>quite</span> <span m=''3028070''>a bit</span> <span m=''3028100''>high.</span>
  <span m=''3028940''>If</span> <span m=''3029230''>your</span> <span m=''3029380''>latency</span>
  <span m=''3029760''>is</span> <span m=''3030000''>greater</span> <span m=''3030480''>than
  51</span> <span m=''3030630''>seconds,</span> <span m=''3031480''>that</span> <span
  m=''3031760''>is</span> <span m=''3031870''>staggeringly</span> <span m=''3032690''>bad.</span>
  <span m=''3034240''>In</span> <span m=''3034480''>this</span> <span m=''3034720''>chart,</span>
  <span m=''3035480''>I</span> <span m=''3035640''>show</span> <span m=''3035890''>you</span>
  <span m=''3036020''>the</span> <span m=''3036110''>latency</span> <span m=''3037320''>versus</span>
  <span m=''3037760''>time.</span> <span m=''3038290''>And</span> <span m=''3038950''>what</span>
  <span m=''3039130''>this</span> <span m=''3039290''>chart</span> <span m=''3039520''>shows</span>
  <span m=''3039800''>you</span> <span m=''3039910''>is</span> <span m=''3040030''>that</span>
  <span m=''3040130''>every</span> <span m=''3040350''>single</span> <span m=''3040630''>time</span>
  <span m=''3040890''>step,</span> <span m=''3041100''>it</span> <span m=''3041200''>says</span>
  <span m=''3041540''>in</span> <span m=''3041650''>the</span> <span m=''3041730''>last</span>
  <span m=''3042030''>five</span> <span m=''3042310''>minutes,</span> <span m=''3042890''>what</span>
  <span m=''3043080''>was</span> <span m=''3043240''>the</span> <span m=''3043300''>highest</span>
  <span m=''3043900''>disk</span> <span m=''3044210''>latency</span> <span m=''3044670''>that</span>
  <span m=''3044990''>I</span> <span m=''3045300''>saw.</span> </p><p><span m=''3046920''>And</span>
  <span m=''3047630''>remember</span> <span m=''3048030''>our</span> <span m=''3048140''>rules</span>
  <span m=''3048350''>of</span> <span m=''3048460''>thumb.</span> <span m=''3049160''>10</span>
  <span m=''3049370''>milliseconds,</span> <span m=''3049770''>good.</span> <span
  m=''3050440''>20</span> <span m=''3050770''>milliseconds,</span> <span m=''3051420''>not</span>
  <span m=''3051680''>so</span> <span m=''3051790''>good.</span> <span m=''3052150''>50</span>
  <span m=''3052470''>milliseconds,</span> <span m=''3053350''>not</span> <span m=''3053630''>so</span>
  <span m=''3053740''>good.</span> <span m=''3054110''>This</span> <span m=''3054360''>one</span>
  <span m=''3054560''>is</span> <span m=''3055430''>1,100</span> <span m=''3056500''>milliseconds.</span>
  <span m=''3057530''>That''s</span> <span m=''3057860''>like</span> <span m=''3058180''>you</span>
  <span m=''3058290''>could</span> <span m=''3058410''>walk</span> <span m=''3058800''>to</span>
  <span m=''3058910''>the</span> <span m=''3059020''>disk,</span> <span m=''3059660''>get</span>
  <span m=''3059920''>the</span> <span m=''3060000''>data,</span> <span m=''3060240''>and</span>
  <span m=''3060330''>bring</span> <span m=''3060530''>it</span> <span m=''3060620''>back</span>
  <span m=''3060900''>faster</span> <span m=''3061320''>than what it''s</span> <span
  m=''3061500''>actually</span> <span m=''3061800''>doing.</span> <span m=''3062940''>That''s</span>
  <span m=''3063170''>when you''ve</span> <span m=''3063310''>got</span> <span m=''3063430''>to</span>
  <span m=''3063470''>call a</span> <span m=''3063690''>priest.</span> <span m=''3064070''>OK.</span>
  <span m=''3064240''>That''s</span> <span m=''3064420''>horrible.</span> <span m=''3065010''>So</span>
  <span m=''3065470''>this</span> <span m=''3065820''>was</span> <span m=''3066020''>the</span>
  <span m=''3066100''>reason</span> <span m=''3066490''>that</span> <span m=''3066580''>five</span>
  <span m=''3066930''>seconds</span> <span m=''3067300''>versus</span> <span m=''3067650''>five</span>
  <span m=''3067900''>minutes.</span> </p><p><span m=''3068470''>So</span> <span m=''3068640''>now</span>
  <span m=''3068870''>the</span> <span m=''3068970''>question</span> <span m=''3069350''>is</span>
  <span m=''3069650''>why</span> <span m=''3069940''>is</span> <span m=''3070050''>this</span>
  <span m=''3070210''>going</span> <span m=''3070400''>on?</span> <span m=''3070510''>Why</span>
  <span m=''3070710''>am</span> <span m=''3070820''>I</span> <span m=''3070910''>seeing</span>
  <span m=''3071120''>such</span> <span m=''3071320''>unbelievably</span> <span m=''3072360''>bad</span>
  <span m=''3072890''>disk</span> <span m=''3073200''>latency?</span> <span m=''3074300''>And</span>
  <span m=''3074530''>remember,</span> <span m=''3075140''>the</span> <span m=''3075280''>title</span>
  <span m=''3075570''>of</span> <span m=''3075640''>this</span> <span m=''3075800''>case</span>
  <span m=''3076010''>study</span> <span m=''3076210''>was</span> <span m=''3076390''>&quot;Correctness</span>
  <span m=''3076840''>Impacts</span> <span m=''3077170''>Performance.&quot;</span>
  <span m=''3079040''>So</span> <span m=''3080080''>let''s</span> <span m=''3080370''>take</span>
  <span m=''3080580''>a</span> <span m=''3080640''>look.</span> <span m=''3081170''>What</span>
  <span m=''3081380''>I</span> <span m=''3081490''>do</span> <span m=''3081750''>here</span>
  <span m=''3082240''>is</span> <span m=''3082400''>I</span> <span m=''3082470''>take</span>
  <span m=''3082730''>a</span> <span m=''3082790''>look</span> <span m=''3082970''>at</span>
  <span m=''3083020''>all</span> <span m=''3083170''>of</span> <span m=''3083320''>the</span>
  <span m=''3083470''>events</span> <span m=''3083860''>that</span> <span m=''3083930''>are</span>
  <span m=''3084000''>happening</span> <span m=''3084480''>with</span> <span m=''3084660''>respect</span>
  <span m=''3085210''>to</span> <span m=''3085310''>that</span> <span m=''3085800''>disk.</span>
  <span m=''3086710''>You''re</span> <span m=''3086820''>not</span> <span m=''3086960''>going</span>
  <span m=''3087050''>to</span> <span m=''3087300''>understand</span> <span m=''3087490''>this.</span>
  <span m=''3087540''>It''s some</span> <span m=''3087820''>junk</span> <span m=''3088050''>related
  to our</span> <span m=''3088490''>product.</span> <span m=''3088890''>But</span>
  <span m=''3089060''>I''m</span> <span m=''3089130''>going</span> <span m=''3089210''>to</span>
  <span m=''3089260''>circle</span> <span m=''3089540''>the</span> <span m=''3089610''>relevant</span>
  <span m=''3089960''>portion.</span> </p><p><span m=''3090880''>You''ll</span> <span
  m=''3091040''>notice</span> <span m=''3091330''>a little</span> <span m=''3091410''>line</span>
  <span m=''3091910''>that</span> <span m=''3092040''>says</span> <span m=''3092180''>lost</span>
  <span m=''3092580''>access</span> <span m=''3093050''>to</span> <span m=''3093150''>volume.</span>
  <span m=''3094360''>Here''s</span> <span m=''3094600''>the</span> <span m=''3094670''>deal.</span>
  <span m=''3095170''>I</span> <span m=''3096030''>send</span> <span m=''3096300''>a</span>
  <span m=''3096330''>request</span> <span m=''3096760''>to the</span> <span m=''3096810''>disk.</span>
  <span m=''3097480''>It</span> <span m=''3097720''>turns</span> <span m=''3097910''>out</span>
  <span m=''3097970''>the</span> <span m=''3098060''>disk</span> <span m=''3098330''>is</span>
  <span m=''3098470''>connected</span> <span m=''3099310''>over</span> <span m=''3099510''>some</span>
  <span m=''3099690''>channel</span> <span m=''3100090''>to</span> <span m=''3100190''>some</span>
  <span m=''3100500''>channel,</span> <span m=''3101260''>a</span> <span m=''3101360''>disk</span>
  <span m=''3101570''>controller,</span> <span m=''3102020''>which</span> <span m=''3102130''>is</span>
  <span m=''3102200''>talking</span> <span m=''3102530''>to</span> <span m=''3102710''>some</span>
  <span m=''3103060''>disk.</span> <span m=''3103410''>It</span> <span m=''3103640''>turns</span>
  <span m=''3103950''>out,</span> <span m=''3104820''>I</span> <span m=''3105000''>kept</span>
  <span m=''3105480''>losing</span> <span m=''3105970''>access</span> <span m=''3106530''>to</span>
  <span m=''3106630''>that</span> <span m=''3106880''>disk.</span> <span m=''3107440''>Whenever</span>
  <span m=''3107890''>I</span> <span m=''3107980''>would</span> <span m=''3108080''>lose</span>
  <span m=''3108230''>access,</span> <span m=''3108505''>it would</span> <span m=''3108780''>keep</span>
  <span m=''3109050''>retrying.</span> <span m=''3109600''>And</span> <span m=''3109740''>that''s</span>
  <span m=''3109890''>why</span> <span m=''3110080''>ultimately,</span> <span m=''3110560''>yes,</span>
  <span m=''3110790''>it</span> <span m=''3110890''>would</span> <span m=''3110990''>complete.</span>
  <span m=''3111610''>But</span> <span m=''3111770''>it</span> <span m=''3111810''>would</span>
  <span m=''3111980''>take</span> <span m=''3112190''>over</span> <span m=''3112450''>a</span>
  <span m=''3112500''>second</span> <span m=''3112990''>per</span> <span m=''3113400''>disk</span>
  <span m=''3113710''>request.</span> <span m=''3117230''>In</span> <span m=''3117400''>the</span>
  <span m=''3117530''>situations</span> <span m=''3118060''>where</span> <span m=''3118210''>I</span>
  <span m=''3118260''>was</span> <span m=''3118610''>not</span> <span m=''3118780''>seeing</span>
  <span m=''3119010''>that</span> <span m=''3119190''>loss</span> <span m=''3119470''>of</span>
  <span m=''3119560''>connectivity,</span> <span m=''3120550''>things</span> <span
  m=''3120790''>were</span> <span m=''3120880''>occurring</span> <span m=''3121220''>at</span>
  <span m=''3121320''>the</span> <span m=''3121390''>order</span> <span m=''3121650''>of</span>
  <span m=''3121720''>milliseconds</span> <span m=''3122510''>and</span> <span m=''3122990''>my</span>
  <span m=''3123130''>power-on</span> <span m=''3123560''>would</span> <span m=''3123680''>take</span>
  <span m=''3123920''>five</span> <span m=''3124180''>seconds.</span> </p><p><span
  m=''3124820''>So</span> <span m=''3125240''>the</span> <span m=''3125390''>point</span>
  <span m=''3125680''>here</span> <span m=''3125960''>is</span> <span m=''3126100''>that</span>
  <span m=''3126780''>in</span> <span m=''3126900''>this</span> <span m=''3127070''>case,</span>
  <span m=''3127280''>it</span> <span m=''3127320''>was</span> <span m=''3127460''>actually</span>
  <span m=''3127730''>a</span> <span m=''3127780''>correctness</span> <span m=''3128330''>problem</span>
  <span m=''3128660''>with</span> <span m=''3128780''>my</span> <span m=''3128920''>controller.</span>
  <span m=''3130020''>And</span> <span m=''3130130''>the</span> <span m=''3130240''>controller</span>
  <span m=''3130455''>would</span> <span m=''3130670''>basically</span> <span m=''3131070''>flake</span>
  <span m=''3131510''>out</span> <span m=''3131700''>and not</span> <span m=''3131970''>talk</span>
  <span m=''3132200''>to</span> <span m=''3132280''>the</span> <span m=''3132350''>disk</span>
  <span m=''3132630''>properly.</span> <span m=''3133280''>And</span> <span m=''3133400''>this</span>
  <span m=''3133520''>manifested</span> <span m=''3134170''>itself</span> <span m=''3134490''>in</span>
  <span m=''3134600''>a</span> <span m=''3134650''>performance</span> <span m=''3135140''>problem.</span>
  <span m=''3135380''>Once</span> <span m=''3135600''>I</span> <span m=''3135680''>changed</span>
  <span m=''3136270''>the</span> <span m=''3136400''>disk</span> <span m=''3136690''>controller,</span>
  <span m=''3137880''>performance</span> <span m=''3138390''>problems</span> <span
  m=''3138690''>went</span> <span m=''3138870''>away.</span> </p><p><span m=''3139490''>So</span>
  <span m=''3140280''>if</span> <span m=''3140620''>you''re</span> <span m=''3140730''>doing</span>
  <span m=''3140910''>this</span> <span m=''3141040''>kind</span> <span m=''3141190''>of</span>
  <span m=''3141340''>debugging,</span> <span m=''3141680''>sometimes</span> <span
  m=''3142140''>you</span> <span m=''3142250''>have</span> <span m=''3142370''>to</span>
  <span m=''3142800''>eliminate--</span> <span m=''3143760''>I</span> <span m=''3143850''>guess</span>
  <span m=''3144070''>it''s a</span> <span m=''3144170''>Sherlock</span> <span m=''3144560''>Holmesism--</span>
  <span m=''3144870''>that</span> <span m=''3144930''>you</span> <span m=''3145140''>eliminate</span>
  <span m=''3145450''>the</span> <span m=''3145560''>obvious</span> <span m=''3146000''>and</span>
  <span m=''3146060''>whatever''s</span> <span m=''3146410''>left</span> <span m=''3146650''>must</span>
  <span m=''3146850''>be</span> <span m=''3146970''>it.</span> <span m=''3148060''>A</span>
  <span m=''3148190''>good</span> <span m=''3148370''>example</span> <span m=''3148700''>of</span>
  <span m=''3148750''>this</span> <span m=''3148900''>is</span> <span m=''3149610''>my</span>
  <span m=''3149770''>ex-officemate,</span> <span m=''3149980''>he</span> <span m=''3150760''>used</span>
  <span m=''3150890''>to</span> <span m=''3151030''>ask</span> <span m=''3151200''>this</span>
  <span m=''3151360''>question</span> <span m=''3151890''>whenever</span> <span m=''3152130''>he''d</span>
  <span m=''3152380''>interview</span> <span m=''3152640''>somebody</span> <span m=''3152890''>for</span>
  <span m=''3153010''>VMware.</span> <span m=''3153380''>He''d say,</span> <span m=''3153530''>OK,</span>
  <span m=''3154180''>you</span> <span m=''3154370''>have</span> <span m=''3154520''>a</span>
  <span m=''3154580''>networking</span> <span m=''3155570''>problem.</span> <span
  m=''3156680''>Where</span> <span m=''3156870''>is</span> <span m=''3156960''>the</span>
  <span m=''3157040''>first</span> <span m=''3157310''>place</span> <span m=''3157540''>you</span>
  <span m=''3157650''>look?</span> </p><p><span m=''3158090''>And</span> <span m=''3158240''>everybody</span>
  <span m=''3158570''>that''s</span> <span m=''3158730''>coming</span> <span m=''3159000''>in</span>
  <span m=''3159070''>with</span> <span m=''3159270''>a</span> <span m=''3159620''>grad</span>
  <span m=''3159960''>degree</span> <span m=''3160280''>or</span> <span m=''3160400''>whatever,</span>
  <span m=''3160470''>they''re like,</span> <span m=''3160870''>I</span> <span m=''3160980''>would</span>
  <span m=''3161110''>look</span> <span m=''3161270''>at</span> <span m=''3161330''>the</span>
  <span m=''3161390''>stack.</span> <span m=''3161810''>I''d</span> <span m=''3161920''>look</span>
  <span m=''3162070''>at</span> <span m=''3163120''>the</span> <span m=''3163220''>CPU.</span>
  <span m=''3163640''>I''d</span> <span m=''3163720''>look</span> <span m=''3163860''>at</span>
  <span m=''3163930''>a</span> <span m=''3163970''>cache</span> <span m=''3164280''>counters,</span>
  <span m=''3164520''>or</span> <span m=''3164590''>whatever.</span> <span m=''3165190''>And</span>
  <span m=''3165390''>my</span> <span m=''3165530''>officemate</span> <span m=''3165710''>would</span>
  <span m=''3165830''>just</span> <span m=''3165950''>look</span> <span m=''3166140''>at</span>
  <span m=''3166270''>them and</span> <span m=''3166360''>say,</span> <span m=''3166560''>why
  don''t</span> <span m=''3166880''>you</span> <span m=''3166950''>just</span> <span
  m=''3167100''>check</span> <span m=''3167280''>the</span> <span m=''3167350''>cable</span>
  <span m=''3167690''>and see if it''s</span> <span m=''3167900''>plugged</span> <span
  m=''3168240''>in.</span> <span m=''3169450''>And</span> <span m=''3170110''>surprisingly,</span>
  <span m=''3170830''>it''s</span> <span m=''3170980''>so</span> <span m=''3171140''>dumb.</span>
  <span m=''3171360''>But</span> <span m=''3172380''>when</span> <span m=''3172600''>you''re</span>
  <span m=''3172690''>talking</span> <span m=''3172950''>to</span> <span m=''3173030''>customers,</span>
  <span m=''3173410''>they''re</span> <span m=''3173430''>like</span> <span m=''3173760''>I</span>
  <span m=''3173970''>swear</span> <span m=''3174140''>I did that.</span> <span m=''3174310''>I
  swear I</span> <span m=''3174470''>did</span> <span m=''3174590''>that.</span> <span
  m=''3175530''>Their</span> <span m=''3175800''>swearing</span> <span m=''3176040''>doesn''t</span>
  <span m=''3176200''>necessarily</span> <span m=''3176560''>mean</span> <span m=''3176700''>anything,</span>
  <span m=''3177890''>unless</span> <span m=''3178050''>it''s</span> <span m=''3178190''>directed</span>
  <span m=''3178500''>at</span> <span m=''3178570''>you.</span> </p><p><span m=''3179770''>So</span>
  <span m=''3180030''>that''s</span> <span m=''3180250''>case</span> <span m=''3180470''>study</span>
  <span m=''3180720''>nine--</span> <span m=''3181220''>eight.</span> <span m=''3183750''>The</span>
  <span m=''3183880''>last</span> <span m=''3184130''>two</span> <span m=''3184250''>case</span>
  <span m=''3184470''>studies</span> <span m=''3184730''>are</span> <span m=''3184780''>going</span>
  <span m=''3184910''>to</span> <span m=''3184950''>be</span> <span m=''3185040''>specific</span>
  <span m=''3185570''>to</span> <span m=''3185620''>virtualization.</span> <span m=''3186790''>And</span>
  <span m=''3186950''>so</span> <span m=''3187330''>what</span> <span m=''3187560''>I''m</span>
  <span m=''3187630''>going</span> <span m=''3187710''>to</span> <span m=''3187800''>do</span>
  <span m=''3187920''>is</span> <span m=''3188010''>talk</span> <span m=''3188220''>a</span>
  <span m=''3188270''>little</span> <span m=''3188540''>bit</span> <span m=''3188640''>about</span>
  <span m=''3188830''>how</span> <span m=''3188930''>the</span> <span m=''3189020''>CPU</span>
  <span m=''3189380''>scheduler</span> <span m=''3189820''>works</span> <span m=''3190420''>in</span>
  <span m=''3190590''>the</span> <span m=''3190670''>VMware</span> <span m=''3191380''>server</span>
  <span m=''3191750''>class</span> <span m=''3192030''>product.</span> <span m=''3192460''>And</span>
  <span m=''3192620''>then</span> <span m=''3192700''>I''ll</span> <span m=''3192850''>talk</span>
  <span m=''3193080''>about</span> <span m=''3193230''>the</span> <span m=''3193290''>last</span>
  <span m=''3193560''>two</span> <span m=''3193670''>case</span> <span m=''3193890''>studies.</span>
  </p><p><span m=''3194830''>So</span> <span m=''3195910''>actually</span> <span m=''3196190''>how</span>
  <span m=''3196310''>many</span> <span m=''3196430''>of</span> <span m=''3196480''>you</span>
  <span m=''3196620''>have used</span> <span m=''3196840''>VMware</span> <span m=''3197220''>before?</span>
  <span m=''3197890''>Just</span> <span m=''3198180''>as</span> <span m=''3198300''>a</span>
  <span m=''3198490''>hand.</span> <span m=''3200310''>Thankfully,</span> <span m=''3200640''>Saman
  has used it.</span> <span m=''3201230''>That''s</span> <span m=''3201410''>good.</span>
  <span m=''3201810''>So</span> <span m=''3203210''>basically,</span> <span m=''3203680''>the</span>
  <span m=''3203800''>idea</span> <span m=''3204010''>is</span> <span m=''3204120''>that</span>
  <span m=''3205740''>you''re</span> <span m=''3205870''>multiplexing</span> <span
  m=''3206540''>time</span> <span m=''3206870''>on</span> <span m=''3206960''>the</span>
  <span m=''3207020''>CPU</span> <span m=''3207710''>between</span> <span m=''3208030''>different</span>
  <span m=''3208340''>virtual</span> <span m=''3208720''>machines</span> <span m=''3209140''>that
  are</span> <span m=''3209250''>running</span> <span m=''3209530''>on</span> <span
  m=''3209620''>the</span> <span m=''3209680''>CPU.</span> </p><p><span m=''3211310''>So</span>
  <span m=''3211490''>what</span> <span m=''3211650''>I</span> <span m=''3211730''>show</span>
  <span m=''3211950''>here</span> <span m=''3212070''>is</span> <span m=''3212150''>I</span>
  <span m=''3212200''>show</span> <span m=''3212450''>ESX,</span> <span m=''3212970''>which</span>
  <span m=''3213110''>is</span> <span m=''3213190''>our</span> <span m=''3213280''>server</span>
  <span m=''3213730''>class</span> <span m=''3214110''>product.</span> <span m=''3214700''>Basically,</span>
  <span m=''3215110''>think</span> <span m=''3215320''>of</span> <span m=''3215430''>that</span>
  <span m=''3215550''>as</span> <span m=''3215640''>the</span> <span m=''3215720''>hardware.</span>
  <span m=''3216030''>So</span> <span m=''3216180''>you''re</span> <span m=''3216360''>running</span>
  <span m=''3216610''>virtual</span> <span m=''3216920''>machines</span> <span m=''3217300''>on</span>
  <span m=''3217490''>hardware.</span> <span m=''3218160''>That</span> <span m=''3218360''>hardware</span>
  <span m=''3219140''>has,</span> <span m=''3219670''>in</span> <span m=''3219810''>this</span>
  <span m=''3220010''>particular</span> <span m=''3220490''>case,</span> <span m=''3220860''>four</span>
  <span m=''3221600''>physical</span> <span m=''3221980''>CPUs.</span> <span m=''3223410''>No</span>
  <span m=''3223590''>problem.</span> <span m=''3224070''>You''ve</span> <span m=''3224140''>got</span>
  <span m=''3224210''>four</span> <span m=''3224280''>physical</span> <span m=''3224650''>CPUs.</span>
  </p><p><span m=''3225080''>And</span> <span m=''3225150''>you</span> <span m=''3225230''>want</span>
  <span m=''3225450''>to</span> <span m=''3225570''>run</span> <span m=''3225990''>virtual</span>
  <span m=''3226380''>machines</span> <span m=''3226900''>on</span> <span m=''3227130''>this</span>
  <span m=''3227330''>hardware.</span> <span m=''3228110''>So</span> <span m=''3228570''>you''ve</span>
  <span m=''3228740''>got</span> <span m=''3228950''>one</span> <span m=''3229150''>virtual</span>
  <span m=''3229510''>machine.</span> <span m=''3230430''>Well,</span> <span m=''3230740''>that''s</span>
  <span m=''3231020''>fine.</span> <span m=''3231560''>There''s</span> <span m=''3231770''>four</span>
  <span m=''3232160''>CPUs.</span> <span m=''3232530''>One</span> <span m=''3232730''>virtual</span>
  <span m=''3233050''>machine.</span> <span m=''3233650''>No</span> <span m=''3234040''>problem.</span>
  <span m=''3234810''>Plenty</span> <span m=''3235230''>of</span> <span m=''3235350''>CPU
  to</span> <span m=''3235510''>go</span> <span m=''3235660''>around.</span> <span
  m=''3236170''>Now</span> <span m=''3236290''>you</span> <span m=''3236400''>got</span>
  <span m=''3236550''>another</span> <span m=''3236790''>one.</span> <span m=''3237170''>Still</span>
  <span m=''3237650''>no</span> <span m=''3237820''>problem.</span> <span m=''3238100''>They''re</span>
  <span m=''3238210''>not</span> <span m=''3238450''>chained</span> <span m=''3239050''>to</span>
  <span m=''3239140''>any</span> <span m=''3239320''>given</span> <span m=''3239550''>CPU.</span>
  <span m=''3240250''>And</span> <span m=''3240480''>there''s</span> <span m=''3240640''>plenty</span>
  <span m=''3240990''>of</span> <span m=''3241220''>CPU</span> <span m=''3241510''>to
  go around.</span> <span m=''3241790''>No</span> <span m=''3242030''>problem.</span>
  </p><p><span m=''3242770''>Same</span> <span m=''3243020''>with</span> <span m=''3243180''>three</span>
  <span m=''3243380''>and</span> <span m=''3243500''>four.</span> <span m=''3244030''>You</span>
  <span m=''3244280''>got</span> <span m=''3244390''>all</span> <span m=''3244510''>these</span>
  <span m=''3244660''>four</span> <span m=''3244820''>virtual</span> <span m=''3245110''>machines.</span>
  <span m=''3246080''>It''s</span> <span m=''3246320''>not</span> <span m=''3246520''>a</span>
  <span m=''3246580''>one</span> <span m=''3246810''>to</span> <span m=''3246880''>one</span>
  <span m=''3247080''>correspondence</span> <span m=''3247720''>in</span> <span m=''3247800''>terms</span>
  <span m=''3247980''>of</span> <span m=''3248050''>CPU.</span> <span m=''3248500''>We</span>
  <span m=''3248600''>don''t</span> <span m=''3248730''>work</span> <span m=''3248950''>that</span>
  <span m=''3249110''>way.</span> <span m=''3249530''>But</span> <span m=''3249770''>there''s</span>
  <span m=''3249940''>plenty--</span> <span m=''3250220''>the point</span> <span m=''3250440''>is,</span>
  <span m=''3250510''>there''s</span> <span m=''3250640''>plenty</span> <span m=''3251030''>of</span>
  <span m=''3251210''>CPU to</span> <span m=''3251390''>go</span> <span m=''3251630''>around.</span>
  <span m=''3253170''>Now</span> <span m=''3253470''>what</span> <span m=''3253690''>happens,</span>
  <span m=''3254550''>and</span> <span m=''3255140''>when</span> <span m=''3256140''>VMs</span>
  <span m=''3256410''>are</span> <span m=''3256540''>basically</span> <span m=''3257060''>available</span>
  <span m=''3257870''>and</span> <span m=''3258060''>when</span> <span m=''3258260''>there''s</span>
  <span m=''3258480''>hardware</span> <span m=''3258980''>on</span> <span m=''3259140''>which</span>
  <span m=''3259340''>they</span> <span m=''3259470''>can</span> <span m=''3259610''>run</span>
  <span m=''3260580''>and</span> <span m=''3260780''>they''re</span> <span m=''3260900''>using</span>
  <span m=''3261210''>the</span> <span m=''3261310''>hardware,</span> <span m=''3261810''>that''s</span>
  <span m=''3262060''>called</span> <span m=''3262410''>the</span> <span m=''3262470''>run</span>
  <span m=''3262810''>state.</span> <span m=''3263240''>So</span> <span m=''3263440''>running</span>
  <span m=''3263840''>means</span> <span m=''3264080''>I''m</span> <span m=''3264340''>golden.</span>
  <span m=''3264750''>I''m</span> <span m=''3265110''>using</span> <span m=''3265690''>the</span>
  <span m=''3265800''>hardware.</span> </p><p><span m=''3266930''>Now,</span> <span
  m=''3267970''>let''s</span> <span m=''3268310''>add</span> <span m=''3269350''>another</span>
  <span m=''3269770''>VM.</span> <span m=''3270520''>I</span> <span m=''3270660''>put</span>
  <span m=''3270900''>it</span> <span m=''3270970''>in</span> <span m=''3271110''>red,</span>
  <span m=''3271330''>because</span> <span m=''3271580''>this</span> <span m=''3271770''>poor</span>
  <span m=''3272080''>VM,</span> <span m=''3272670''>he</span> <span m=''3272840''>wants</span>
  <span m=''3273180''>to</span> <span m=''3273290''>run.</span> <span m=''3273800''>But</span>
  <span m=''3274050''>you''ll</span> <span m=''3274200''>see</span> <span m=''3274440''>that</span>
  <span m=''3274560''>every</span> <span m=''3274850''>single</span> <span m=''3275210''>CPU</span>
  <span m=''3275980''>is</span> <span m=''3276160''>actually</span> <span m=''3276480''>taken</span>
  <span m=''3276860''>up</span> <span m=''3277050''>by</span> <span m=''3277230''>another</span>
  <span m=''3277760''>virtual</span> <span m=''3278270''>machine.</span> <span m=''3279650''>So</span>
  <span m=''3279880''>even</span> <span m=''3280130''>if</span> <span m=''3280200''>this</span>
  <span m=''3280360''>virtual</span> <span m=''3280600''>machine</span> <span m=''3280890''>wants</span>
  <span m=''3281190''>to</span> <span m=''3281280''>run,</span> <span m=''3281960''>it</span>
  <span m=''3282180''>can''t.</span> <span m=''3282700''>It</span> <span m=''3283130''>has</span>
  <span m=''3283410''>to</span> <span m=''3283540''>wait.</span> <span m=''3284230''>The</span>
  <span m=''3284360''>time</span> <span m=''3284750''>that it</span> <span m=''3285000''>spends</span>
  <span m=''3285790''>ready</span> <span m=''3286230''>to</span> <span m=''3286390''>use</span>
  <span m=''3286710''>the</span> <span m=''3286780''>CPU,</span> <span m=''3287490''>but</span>
  <span m=''3288090''>unable</span> <span m=''3288690''>to</span> <span m=''3288810''>use</span>
  <span m=''3289000''>the</span> <span m=''3289080''>CPU,</span> <span m=''3289530''>because</span>
  <span m=''3290090''>there''s</span> <span m=''3290390''>no</span> <span m=''3290590''>CPU</span>
  <span m=''3291000''>available,</span> <span m=''3291840''>that''s</span> <span m=''3292220''>called</span>
  <span m=''3292750''>ready</span> <span m=''3293100''>time.</span> <span m=''3293870''>In</span>
  <span m=''3294000''>some</span> <span m=''3294220''>sense,</span> <span m=''3294400''>it''s</span>
  <span m=''3294530''>kind</span> <span m=''3294670''>of</span> <span m=''3294820''>the</span>
  <span m=''3295220''>demand.</span> <span m=''3295950''>Ready</span> <span m=''3296260''>plus</span>
  <span m=''3297210''>signals</span> <span m=''3297620''>down.</span> </p><p><span
  m=''3297810''>But anyway,</span> <span m=''3298030''>the</span> <span m=''3298110''>point</span>
  <span m=''3298260''>is</span> <span m=''3298500''>it''s</span> <span m=''3298710''>sitting</span>
  <span m=''3298970''>around</span> <span m=''3299160''>waiting</span> <span m=''3299580''>to</span>
  <span m=''3299660''>use</span> <span m=''3299920''>the</span> <span m=''3300180''>CPU.</span>
  <span m=''3300550''>But</span> <span m=''3300720''>it</span> <span m=''3300830''>can''t,</span>
  <span m=''3301070''>because</span> <span m=''3301270''>other</span> <span m=''3301450''>people</span>
  <span m=''3301700''>are</span> <span m=''3301750''>using</span> <span m=''3302160''>it.</span>
  <span m=''3302290''>So it</span> <span m=''3302390''>has</span> <span m=''3302510''>to</span>
  <span m=''3302610''>wait</span> <span m=''3302790''>its</span> <span m=''3302940''>turn.</span>
  <span m=''3303360''>It</span> <span m=''3303500''>waits</span> <span m=''3303800''>its</span>
  <span m=''3303950''>turn.</span> <span m=''3304910''>And</span> <span m=''3305090''>eventually</span>
  <span m=''3305590''>a</span> <span m=''3305770''>VM,</span> <span m=''3306430''>our</span>
  <span m=''3306740''>ESX</span> <span m=''3307000''>scheduler</span> <span m=''3307310''>is</span>
  <span m=''3307410''>smart</span> <span m=''3307690''>enough</span> <span m=''3307840''>to</span>
  <span m=''3307950''>realize</span> <span m=''3308510''>that</span> <span m=''3308610''>it</span>
  <span m=''3308680''>has</span> <span m=''3308840''>to</span> <span m=''3308920''>fix</span>
  <span m=''3309150''>the</span> <span m=''3309210''>situation.</span> <span m=''3310050''>So</span>
  <span m=''3310220''>it</span> <span m=''3310500''>deschedules a</span> <span m=''3310950''>VM--</span>
  <span m=''3311420''>in</span> <span m=''3311470''>this</span> <span m=''3311620''>case,</span>
  <span m=''3311830''>VM</span> <span m=''3312200''>1--</span> <span m=''3312570''>and</span>
  <span m=''3312730''>goes</span> <span m=''3312930''>ahead</span> <span m=''3313100''>and</span>
  <span m=''3313190''>schedules</span> <span m=''3313660''>that</span> <span m=''3313860''>other</span>
  <span m=''3314260''>virtual</span> <span m=''3314630''>machine</span> <span m=''3314860''>that</span>
  <span m=''3314980''>was</span> <span m=''3315120''>previously</span> <span m=''3315740''>waiting.</span>
  </p><p><span m=''3316440''>Now</span> <span m=''3316710''>predictably,</span> <span
  m=''3317760''>the</span> <span m=''3317890''>VM</span> <span m=''3318370''>that''s</span>
  <span m=''3318590''>now</span> <span m=''3319010''>ready</span> <span m=''3319270''>to</span>
  <span m=''3319410''>run</span> <span m=''3319630''>but</span> <span m=''3319830''>can''t</span>
  <span m=''3320240''>is</span> <span m=''3320400''>in</span> <span m=''3320580''>the</span>
  <span m=''3320820''>ready</span> <span m=''3321080''>state.</span> <span m=''3321880''>And</span>
  <span m=''3322270''>the</span> <span m=''3322400''>VM</span> <span m=''3322530''>that</span>
  <span m=''3322670''>formerly</span> <span m=''3323410''>was</span> <span m=''3323650''>in</span>
  <span m=''3323770''>the</span> <span m=''3323870''>ready</span> <span m=''3324120''>state</span>
  <span m=''3324310''>is</span> <span m=''3324390''>now</span> <span m=''3324530''>using</span>
  <span m=''3324970''>the</span> <span m=''3325050''>CPU.</span> <span m=''3325790''>So</span>
  <span m=''3326050''>it''s</span> <span m=''3326190''>in</span> <span m=''3326310''>the</span>
  <span m=''3326400''>run</span> <span m=''3326700''>state.</span> <span m=''3327050''>It''s</span>
  <span m=''3327230''>very</span> <span m=''3327500''>happy.</span> </p><p><span m=''3329260''>The</span>
  <span m=''3329360''>final</span> <span m=''3329680''>thing</span> <span m=''3329850''>that
  I</span> <span m=''3329890''>should</span> <span m=''3330070''>point</span> <span
  m=''3330310''>out</span> <span m=''3330400''>is</span> <span m=''3330530''>that</span>
  <span m=''3330790''>VMs</span> <span m=''3330970''>don''t</span> <span m=''3331140''>have</span>
  <span m=''3331440''>to</span> <span m=''3331540''>be</span> <span m=''3331630''>in</span>
  <span m=''3331710''>the</span> <span m=''3331810''>ready</span> <span m=''3332070''>state.</span>
  <span m=''3332440''>They</span> <span m=''3332550''>don''t</span> <span m=''3332700''>have</span>
  <span m=''3332900''>to be</span> <span m=''3333030''>either</span> <span m=''3333260''>using</span>
  <span m=''3333620''>the</span> <span m=''3334020''>CPU</span> <span m=''3334150''>or
  ready to</span> <span m=''3334340''>use the</span> <span m=''3334635''>CPU.</span>
  <span m=''3335200''>Some</span> <span m=''3335530''>VMs</span> <span m=''3335840''>are</span>
  <span m=''3335890''>voluntarily</span> <span m=''3336310''>descheduled,</span> <span
  m=''3337140''>because</span> <span m=''3337370''>they</span> <span m=''3337440''>have</span>
  <span m=''3337520''>nothing</span> <span m=''3337830''>to</span> <span m=''3337890''>do.</span>
  <span m=''3338670''>Some</span> <span m=''3338980''>VMs</span> <span m=''3339230''>are</span>
  <span m=''3339440''>descheduled,</span> <span m=''3339790''>because</span> <span
  m=''3340060''>they''re</span> <span m=''3340170''>waiting--</span> <span m=''3341260''>they''re</span>
  <span m=''3341400''>basically</span> <span m=''3341800''>waiting</span> <span m=''3342180''>for</span>
  <span m=''3342390''>an</span> <span m=''3342630''>IO</span> <span m=''3342870''>to
  complete.</span> <span m=''3343300''>And so</span> <span m=''3343380''>they</span>
  <span m=''3343460''>don''t</span> <span m=''3343580''>need</span> <span m=''3343730''>to</span>
  <span m=''3343780''>use</span> <span m=''3343960''>the</span> <span m=''3344030''>CPU.</span>
  <span m=''3344730''>And</span> <span m=''3344870''>that''s</span> <span m=''3345040''>what</span>
  <span m=''3345110''>I</span> <span m=''3345180''>depict</span> <span m=''3345570''>by</span>
  <span m=''3345900''>VM6.</span> <span m=''3346470''>These</span> <span m=''3346580''>are
  in</span> <span m=''3346660''>what''s</span> <span m=''3346850''>called</span> <span
  m=''3347070''>the</span> <span m=''3347130''>wait</span> <span m=''3347440''>or</span>
  <span m=''3347630''>idle</span> <span m=''3347900''>states.</span> </p><p><span
  m=''3350160''>So</span> <span m=''3351220''>hopefully,</span> <span m=''3351780''>you</span>
  <span m=''3351910''>now</span> <span m=''3352110''>have</span> <span m=''3352190''>a</span>
  <span m=''3352280''>fairly</span> <span m=''3352680''>rudimentary</span> <span m=''3353430''>understanding</span>
  <span m=''3353980''>of</span> <span m=''3354060''>what</span> <span m=''3354210''>our</span>
  <span m=''3354300''>CPU</span> <span m=''3354690''>scheduler</span> <span m=''3355000''>is</span>
  <span m=''3355310''>doing.</span> <span m=''3356080''>Let''s</span> <span m=''3356320''>talk</span>
  <span m=''3356560''>a</span> <span m=''3356620''>little</span> <span m=''3356840''>bit</span>
  <span m=''3356950''>about</span> <span m=''3357120''>a</span> <span m=''3357160''>very</span>
  <span m=''3357510''>simple</span> <span m=''3357760''>performance</span> <span m=''3358200''>problem</span>
  <span m=''3358440''>related</span> <span m=''3358790''>to</span> <span m=''3358860''>this.</span>
  <span m=''3360310''>And</span> <span m=''3360520''>I</span> <span m=''3360570''>call</span>
  <span m=''3360790''>this--</span> <span m=''3360930''>But</span> <span m=''3361060''>It''s</span>
  <span m=''3361160''>Only</span> <span m=''3361350''>a</span> <span m=''3361510''>small</span>
  <span m=''3361810''>probe</span> <span m=''3362290''>VM.</span> <span m=''3362910''>I''ll</span>
  <span m=''3363180''>explain what</span> <span m=''3363400''>this</span> <span m=''3363530''>means</span>
  <span m=''3363670''>in</span> <span m=''3363740''>a</span> <span m=''3363770''>minute.</span>
  </p><p><span m=''3364710''>Essentially,</span> <span m=''3365090''>you''ve</span>
  <span m=''3365250''>got</span> <span m=''3365480''>two</span> <span m=''3365680''>of</span>
  <span m=''3365750''>these</span> <span m=''3365960''>hosts,</span> <span m=''3366720''>two</span>
  <span m=''3366970''>ESX</span> <span m=''3367160''>hosts</span> <span m=''3367590''>that</span>
  <span m=''3367840''>both</span> <span m=''3368030''>want</span> <span m=''3368200''>to</span>
  <span m=''3368250''>run</span> <span m=''3368450''>VMs.</span> <span m=''3369840''>And</span>
  <span m=''3370000''>I''ve</span> <span m=''3370110''>got</span> <span m=''3370280''>a</span>
  <span m=''3370350''>user,</span> <span m=''3371100''>depicted</span> <span m=''3371510''>by</span>
  <span m=''3371660''>the</span> <span m=''3371770''>user</span> <span m=''3372270''>icon.</span>
  <span m=''3373250''>And</span> <span m=''3373370''>he''s</span> <span m=''3373590''>talking</span>
  <span m=''3373920''>to</span> <span m=''3373990''>this</span> <span m=''3374140''>one</span>
  <span m=''3374470''>VM.</span> <span m=''3375080''>Let''s</span> <span m=''3375360''>call</span>
  <span m=''3375710''>this</span> <span m=''3375970''>VM</span> <span m=''3376140''>the</span>
  <span m=''3376930''>vSphere</span> <span m=''3377690''>VM.</span> <span m=''3378420''>Please</span>
  <span m=''3378740''>pardon</span> <span m=''3378970''>the</span> <span m=''3379040''>nomenclature.</span>
  <span m=''3379800''>It</span> <span m=''3379880''>doesn''t</span> <span m=''3380100''>really</span>
  <span m=''3380270''>matter.</span> <span m=''3380520''>But</span> <span m=''3380640''>anyway,</span>
  <span m=''3380770''>he''s</span> <span m=''3381000''>talking to</span> <span m=''3381290''>this</span>
  <span m=''3381460''>vSphere</span> <span m=''3381690''>VM</span> <span m=''3382380''>on</span>
  <span m=''3382650''>one</span> <span m=''3382800''>of</span> <span m=''3382850''>the</span>
  <span m=''3383060''>hosts.</span> </p><p><span m=''3383490''>Now,</span> <span m=''3383690''>it</span>
  <span m=''3383810''>turns</span> <span m=''3384140''>out</span> <span m=''3384400''>that
  that VM</span> <span m=''3384660''>that</span> <span m=''3384950''>he''s</span>
  <span m=''3385140''>talking</span> <span m=''3385480''>to,</span> <span m=''3385830''>as</span>
  <span m=''3386010''>I</span> <span m=''3386070''>depicted</span> <span m=''3386390''>in</span>
  <span m=''3386450''>the</span> <span m=''3386520''>diagram,</span> <span m=''3387310''>is</span>
  <span m=''3387540''>talking</span> <span m=''3387940''>to</span> <span m=''3388170''>another</span>
  <span m=''3388490''>virtual</span> <span m=''3388880''>machine,</span> <span m=''3389290''>which</span>
  <span m=''3389560''>I have</span> <span m=''3389780''>labeled</span> <span m=''3390450''>vSphere</span>
  <span m=''3391130''>database.</span> <span m=''3393420''>So</span> <span m=''3393650''>it</span>
  <span m=''3393720''>turns</span> <span m=''3393920''>out,</span> <span m=''3394000''>this</span>
  <span m=''3394140''>vSphere</span> <span m=''3394590''>VM is</span> <span m=''3394690''>talking</span>
  <span m=''3394880''>to</span> <span m=''3394950''>a database</span> <span m=''3395290''>over</span>
  <span m=''3395470''>what''s</span> <span m=''3395690''>called</span> <span m=''3395900''>an</span>
  <span m=''3395970''>ODBC</span> <span m=''3396590''>connection.</span> <span m=''3397410''>That</span>
  <span m=''3397710''>doesn''t</span> <span m=''3397930''>matter.</span> <span m=''3398170''>Don''t</span>
  <span m=''3398320''>worry</span> <span m=''3398550''>about</span> <span m=''3398780''>that.</span>
  <span m=''3399350''>And</span> <span m=''3399520''>it</span> <span m=''3399590''>turns</span>
  <span m=''3399850''>out</span> <span m=''3399930''>that</span> <span m=''3400040''>on</span>
  <span m=''3400170''>that</span> <span m=''3400300''>other</span> <span m=''3400570''>host</span>
  <span m=''3401255''>where</span> <span m=''3401550''>the</span> <span m=''3401730''>database</span>
  <span m=''3402080''>virtual</span> <span m=''3402410''>machine is</span> <span m=''3402790''>running,</span>
  <span m=''3403210''>we</span> <span m=''3403400''>have</span> <span m=''3403540''>another</span>
  <span m=''3403860''>virtual</span> <span m=''3404290''>machine.</span> <span m=''3404810''>It''s</span>
  <span m=''3405010''>called</span> <span m=''3405260''>the</span> <span m=''3405330''>probe</span>
  <span m=''3406000''>virtual</span> <span m=''3406400''>machine.</span> </p><p><span
  m=''3407630''>The</span> <span m=''3407770''>job</span> <span m=''3408200''>of that</span>
  <span m=''3408400''>probe</span> <span m=''3408740''>virtual</span> <span m=''3409190''>machine</span>
  <span m=''3409730''>is</span> <span m=''3409880''>to</span> <span m=''3409990''>sniff</span>
  <span m=''3410400''>any</span> <span m=''3410680''>traffic</span> <span m=''3411220''>going</span>
  <span m=''3411480''>into</span> <span m=''3411650''>the</span> <span m=''3411730''>database.</span>
  <span m=''3415090''>So</span> <span m=''3415460''>as</span> <span m=''3415640''>I''ve</span>
  <span m=''3415710''>said,</span> <span m=''3416050''>the</span> <span m=''3416510''>vSphere</span>
  <span m=''3416690''>VM</span> <span m=''3416800''>communicates</span> <span m=''3417270''>with</span>
  <span m=''3417360''>the</span> <span m=''3417430''>database.</span> <span m=''3418960''>This</span>
  <span m=''3419200''>probe</span> <span m=''3419525''>VM</span> <span m=''3419850''>is</span>
  <span m=''3419940''>monitoring</span> <span m=''3420490''>any</span> <span m=''3420710''>traffic</span>
  <span m=''3421040''>that''s</span> <span m=''3421370''>going</span> <span m=''3421560''>to</span>
  <span m=''3421750''>that</span> <span m=''3421940''>database</span> <span m=''3422390''>virtual</span>
  <span m=''3422740''>machine.</span> <span m=''3424160''>And</span> <span m=''3424380''>therefore,</span>
  <span m=''3424760''>as</span> <span m=''3424870''>you</span> <span m=''3424980''>can</span>
  <span m=''3425090''>imagine,</span> <span m=''3425760''>the</span> <span m=''3425870''>more</span>
  <span m=''3426180''>traffic</span> <span m=''3426720''>that''s</span> <span m=''3426890''>being</span>
  <span m=''3427100''>sent</span> <span m=''3427370''>between</span> <span m=''3427610''>this</span>
  <span m=''3427900''>vSphere</span> <span m=''3428160''>VM</span> <span m=''3428650''>and</span>
  <span m=''3428880''>the</span> <span m=''3428940''>database,</span> <span m=''3429730''>the</span>
  <span m=''3429840''>more</span> <span m=''3430180''>work</span> <span m=''3430960''>that</span>
  <span m=''3431100''>that</span> <span m=''3431300''>probe</span> <span m=''3431650''>VM</span>
  <span m=''3431930''>has</span> <span m=''3432210''>to</span> <span m=''3432310''>do.</span>
  </p><p><span m=''3434900''>Here</span> <span m=''3435180''>was</span> <span m=''3435420''>the</span>
  <span m=''3435500''>complaint.</span> <span m=''3436260''>My</span> <span m=''3436440''>colleague</span>
  <span m=''3436970''>called</span> <span m=''3437290''>me</span> <span m=''3437440''>up,</span>
  <span m=''3437840''>and</span> <span m=''3438000''>he</span> <span m=''3438090''>said,</span>
  <span m=''3438950''>hey,</span> <span m=''3439410''>I''m</span> <span m=''3439530''>having</span>
  <span m=''3439790''>a</span> <span m=''3439840''>little</span> <span m=''3440040''>bit</span>
  <span m=''3440180''>of</span> <span m=''3440260''>a</span> <span m=''3440330''>problem</span>
  <span m=''3440720''>with</span> <span m=''3440790''>my</span> <span m=''3441150''>vSphere</span>
  <span m=''3441510''>VM.</span> <span m=''3441810''>All</span> <span m=''3441930''>of</span>
  <span m=''3442050''>a</span> <span m=''3442090''>sudden,</span> <span m=''3442360''>it''s</span>
  <span m=''3442500''>completely</span> <span m=''3443240''>unresponsive.</span> <span
  m=''3445390''>So</span> <span m=''3445620''>then</span> <span m=''3445750''>I</span>
  <span m=''3445860''>was</span> <span m=''3445970''>like,</span> <span m=''3446130''>OK,</span>
  <span m=''3446380''>well,</span> <span m=''3446480''>this</span> <span m=''3446640''>is</span>
  <span m=''3447480''>kind</span> <span m=''3447660''>of</span> <span m=''3447720''>silly.</span>
  <span m=''3448060''>Let''s</span> <span m=''3448200''>try</span> <span m=''3448290''>to</span>
  <span m=''3448390''>figure</span> <span m=''3448620''>out</span> <span m=''3448680''>what''s</span>
  <span m=''3448860''>going</span> <span m=''3449070''>on.</span> </p><p><span m=''3449770''>So</span>
  <span m=''3449960''>here''s</span> <span m=''3450150''>what</span> <span m=''3450290''>I</span>
  <span m=''3450360''>did.</span> <span m=''3451580''>I</span> <span m=''3452670''>graphed</span>
  <span m=''3453110''>various</span> <span m=''3453790''>metrics,</span> <span m=''3454170''>which</span>
  <span m=''3454240''>I</span> <span m=''3454470''>just</span> <span m=''3454860''>spoke</span>
  <span m=''3455170''>about,</span> <span m=''3455610''>the</span> <span m=''3455720''>used</span>
  <span m=''3456170''>time</span> <span m=''3456520''>and</span> <span m=''3456660''>the</span>
  <span m=''3456750''>ready</span> <span m=''3457010''>time,</span> <span m=''3457520''>on</span>
  <span m=''3457760''>this</span> <span m=''3458010''>chart.</span> <span m=''3458880''>The</span>
  <span m=''3459000''>time</span> <span m=''3459300''>is</span> <span m=''3459400''>on</span>
  <span m=''3459480''>the</span> <span m=''3459620''>x-axis.</span> <span m=''3460390''>And</span>
  <span m=''3460560''>the</span> <span m=''3460640''>y-axis</span> <span m=''3461440''>is</span>
  <span m=''3461580''>in</span> <span m=''3461680''>milliseconds.</span> <span m=''3463210''>In</span>
  <span m=''3463600''>what I''m</span> <span m=''3464030''>going</span> <span m=''3464130''>to</span>
  <span m=''3464210''>call</span> <span m=''3464500''>the</span> <span m=''3464590''>land</span>
  <span m=''3465000''>before</span> <span m=''3465360''>time,</span> <span m=''3466330''>the</span>
  <span m=''3466560''>ready</span> <span m=''3466980''>time</span> <span m=''3467860''>of</span>
  <span m=''3468030''>the</span> <span m=''3468120''>database.</span> <span m=''3468730''>So</span>
  <span m=''3469000''>look</span> <span m=''3469220''>at</span> <span m=''3469340''>the</span>
  <span m=''3469750''>circle</span> <span m=''3470380''>on</span> <span m=''3470630''>the--</span>
  <span m=''3470810''>let me think,</span> <span m=''3471150''>you''re--</span> <span
  m=''3471460''>on</span> <span m=''3471570''>the</span> <span m=''3471680''>left.</span>
  <span m=''3472970''>This</span> <span m=''3473270''>is</span> <span m=''3473460''>the</span>
  <span m=''3474070''>ready</span> <span m=''3474380''>time</span> <span m=''3474710''>of</span>
  <span m=''3474770''>that</span> <span m=''3475020''>database</span> <span m=''3475510''>virtual</span>
  <span m=''3475870''>machine.</span> <span m=''3476440''>Remember</span> <span m=''3476860''>what
  we</span> <span m=''3477010''>said,</span> <span m=''3477390''>when</span> <span
  m=''3477580''>you''re</span> <span m=''3477700''>accumulating</span> <span m=''3478240''>ready</span>
  <span m=''3478450''>time.</span> <span m=''3478850''>It means you</span> <span m=''3478960''>really</span>
  <span m=''3479160''>want</span> <span m=''3479350''>to</span> <span m=''3479390''>use</span>
  <span m=''3479550''>the</span> <span m=''3479610''>CPU.</span> <span m=''3480460''>But</span>
  <span m=''3480760''>you</span> <span m=''3480880''>can''t</span> <span m=''3481240''>because</span>
  <span m=''3481460''>all</span> <span m=''3481570''>the</span> <span m=''3481810''>CPUs</span>
  <span m=''3482040''>are</span> <span m=''3482130''>already</span> <span m=''3482470''>in</span>
  <span m=''3482570''>use.</span> </p><p><span m=''3483300''>So</span> <span m=''3484870''>it</span>
  <span m=''3485030''>turns</span> <span m=''3485290''>out</span> <span m=''3485400''>that</span>
  <span m=''3485910''>the</span> <span m=''3486000''>first</span> <span m=''3486250''>thing</span>
  <span m=''3486360''>that</span> <span m=''3486740''>happened</span> <span m=''3487320''>when</span>
  <span m=''3487570''>my</span> <span m=''3487700''>colleague</span> <span m=''3488040''>called</span>
  <span m=''3488240''>and said</span> <span m=''3488440''>I''m</span> <span m=''3488490''>having</span>
  <span m=''3488650''>a</span> <span m=''3488700''>problem,</span> <span m=''3488980''>is</span>
  <span m=''3489370''>I</span> <span m=''3489500''>look</span> <span m=''3489750''>at</span>
  <span m=''3489860''>this</span> <span m=''3489980''>chart,</span> <span m=''3490230''>which</span>
  <span m=''3490360''>is</span> <span m=''3490450''>versus</span> <span m=''3490760''>time.</span>
  <span m=''3490990''>And I</span> <span m=''3491080''>said,</span> <span m=''3491230''>let</span>
  <span m=''3491320''>me</span> <span m=''3491410''>guess.</span> <span m=''3491780''>Are</span>
  <span m=''3491970''>you</span> <span m=''3492070''>having</span> <span m=''3492320''>a</span>
  <span m=''3492370''>problem</span> <span m=''3492760''>at</span> <span m=''3492810''>about</span>
  <span m=''3493170''>such</span> <span m=''3493460''>and</span> <span m=''3493540''>such</span>
  <span m=''3493770''>time,</span> <span m=''3494040''>which</span> <span m=''3494210''>corresponds</span>
  <span m=''3494680''>to</span> <span m=''3494740''>the</span> <span m=''3494820''>middle</span>
  <span m=''3495090''>of</span> <span m=''3495170''>this</span> <span m=''3495360''>chart?</span>
  <span m=''3495870''>And</span> <span m=''3496240''>he</span> <span m=''3496310''>said,</span>
  <span m=''3496490''>yeah,</span> <span m=''3496730''>that''s</span> <span m=''3496920''>when</span>
  <span m=''3497040''>I''m</span> <span m=''3497100''>having</span> <span m=''3497290''>a</span>
  <span m=''3497340''>problem.</span> <span m=''3497580''>So you</span> <span m=''3497700''>can</span>
  <span m=''3497820''>tell</span> <span m=''3498030''>that</span> <span m=''3498100''>there</span>
  <span m=''3498240''>are</span> <span m=''3498470''>two</span> <span m=''3498870''>very</span>
  <span m=''3499220''>clearly</span> <span m=''3499660''>demarcated</span> <span m=''3500240''>regions</span>
  <span m=''3500590''>here.</span> </p><p><span m=''3502510''>In</span> <span m=''3502700''>the</span>
  <span m=''3502790''>left,</span> <span m=''3503550''>you</span> <span m=''3503730''>can</span>
  <span m=''3503880''>see</span> <span m=''3504110''>that</span> <span m=''3504240''>this</span>
  <span m=''3504380''>ready</span> <span m=''3504760''>time,</span> <span m=''3505010''>it''s</span>
  <span m=''3505180''>around</span> <span m=''3505440''>12%.</span> <span m=''3506120''>Now</span>
  <span m=''3506560''>if</span> <span m=''3507050''>you''re</span> <span m=''3507180''>like</span>
  <span m=''3507390''>me,</span> <span m=''3508260''>a</span> <span m=''3508340''>number</span>
  <span m=''3508720''>that</span> <span m=''3508860''>has</span> <span m=''3509020''>no</span>
  <span m=''3509160''>context</span> <span m=''3509610''>means</span> <span m=''3509810''>nothing.</span>
  <span m=''3510060''>So</span> <span m=''3510140''>12%</span> <span m=''3510620''>means</span>
  <span m=''3510840''>nothing.</span> <span m=''3511790''>However,</span> <span m=''3512510''>what</span>
  <span m=''3512700''>I''d</span> <span m=''3512800''>like</span> <span m=''3512960''>to</span>
  <span m=''3513050''>point</span> <span m=''3513300''>out</span> <span m=''3513480''>is</span>
  <span m=''3513590''>that</span> <span m=''3513940''>when</span> <span m=''3514270''>things</span>
  <span m=''3514540''>got</span> <span m=''3514730''>really</span> <span m=''3514970''>bad,</span>
  <span m=''3515830''>that</span> <span m=''3516170''>number</span> <span m=''3516420''>spiked</span>
  <span m=''3516910''>up</span> <span m=''3517030''>to</span> <span m=''3517120''>20%.</span>
  </p><p><span m=''3519130''>So</span> <span m=''3519280''>here''s</span> <span m=''3519500''>the</span>
  <span m=''3519580''>deal.</span> <span m=''3520120''>I''m</span> <span m=''3520320''>a</span>
  <span m=''3520390''>database</span> <span m=''3520820''>virtual</span> <span m=''3521110''>machine.</span>
  <span m=''3521710''>I</span> <span m=''3521880''>want</span> <span m=''3522130''>to</span>
  <span m=''3522210''>use</span> <span m=''3522570''>the</span> <span m=''3522630''>physical</span>
  <span m=''3522990''>hardware.</span> <span m=''3524500''>I</span> <span m=''3524610''>can</span>
  <span m=''3524910''>use</span> <span m=''3525100''>it</span> <span m=''3525190''>about</span>
  <span m=''3525380''>90%</span> <span m=''3525780''>of</span> <span m=''3525960''>the</span>
  <span m=''3526050''>time,</span> <span m=''3526270''>because</span> <span m=''3526460''>my</span>
  <span m=''3526520''>ready</span> <span m=''3526710''>time''s</span> <span m=''3526920''>about</span>
  <span m=''3527100''>12%,</span> <span m=''3527670''>whatever.</span> <span m=''3528110''>But</span>
  <span m=''3528300''>at</span> <span m=''3528410''>some</span> <span m=''3528600''>point,</span>
  <span m=''3529250''>something</span> <span m=''3529720''>happens</span> <span m=''3530100''>where
  I</span> <span m=''3530360''>now</span> <span m=''3530630''>can</span> <span m=''3530750''>only</span>
  <span m=''3530960''>use</span> <span m=''3531160''>it</span> <span m=''3531250''>80%</span>
  <span m=''3531730''>of</span> <span m=''3531920''>the</span> <span m=''3532000''>time.</span>
  <span m=''3532600''>And</span> <span m=''3532990''>it</span> <span m=''3533190''>turns</span>
  <span m=''3533520''>out</span> <span m=''3533610''>that</span> <span m=''3533750''>that</span>
  <span m=''3534030''>difference</span> <span m=''3534400''>was</span> <span m=''3534550''>enough</span>
  <span m=''3534810''>to</span> <span m=''3534940''>cause</span> <span m=''3535580''>this</span>
  <span m=''3536090''>vSphere</span> <span m=''3536400''>VM</span> <span m=''3537170''>talking</span>
  <span m=''3537720''>to</span> <span m=''3537830''>this</span> <span m=''3538010''>database</span>
  <span m=''3538730''>to</span> <span m=''3538850''>be</span> <span m=''3539110''>perturbed.</span>
  <span m=''3539760''>And</span> <span m=''3539890''>that</span> <span m=''3540030''>ultimately</span>
  <span m=''3540480''>was</span> <span m=''3540720''>the</span> <span m=''3540800''>customer''s</span>
  <span m=''3541270''>problem.</span> <span m=''3541850''>So</span> <span m=''3542020''>the</span>
  <span m=''3542110''>question</span> <span m=''3542540''>is</span> <span m=''3542660''>why.</span>
  <span m=''3543310''>And</span> <span m=''3543460''>here</span> <span m=''3543760''>is</span>
  <span m=''3543890''>the</span> <span m=''3543990''>reason.</span> </p><p><span m=''3545200''>Turns</span>
  <span m=''3545490''>out,</span> <span m=''3545850''>here''s</span> <span m=''3546090''>the</span>
  <span m=''3546170''>deal.</span> <span m=''3546360''>Let''s</span> <span m=''3546540''>go</span>
  <span m=''3546610''>back</span> <span m=''3546760''>to</span> <span m=''3546840''>the</span>
  <span m=''3546930''>diagram</span> <span m=''3547300''>so I</span> <span m=''3547630''>can
  explain</span> <span m=''3547870''>this.</span> <span m=''3548450''>Remember</span>
  <span m=''3548810''>that</span> <span m=''3548930''>the</span> <span m=''3549010''>vSphere</span>
  <span m=''3549290''>VM</span> <span m=''3549660''>talks</span> <span m=''3549880''>to</span>
  <span m=''3549960''>the</span> <span m=''3550030''>database</span> <span m=''3550460''>VM.</span>
  <span m=''3551810''>Remember</span> <span m=''3552200''>as</span> <span m=''3552300''>well,</span>
  <span m=''3552790''>that</span> <span m=''3552970''>the</span> <span m=''3553040''>more</span>
  <span m=''3553360''>traffic</span> <span m=''3553940''>there</span> <span m=''3554170''>is,</span>
  <span m=''3554640''>the</span> <span m=''3554760''>more</span> <span m=''3555040''>work</span>
  <span m=''3555290''>the</span> <span m=''3555400''>probe</span> <span m=''3555710''>VM</span>
  <span m=''3555950''>has</span> <span m=''3556150''>to</span> <span m=''3556230''>do.</span>
  <span m=''3557080''>It</span> <span m=''3557240''>turns</span> <span m=''3557530''>out</span>
  <span m=''3557680''>that</span> <span m=''3557800''>what</span> <span m=''3557990''>this</span>
  <span m=''3558140''>user</span> <span m=''3558480''>did</span> <span m=''3558870''>was</span>
  <span m=''3559110''>at</span> <span m=''3559220''>that</span> <span m=''3559390''>critical</span>
  <span m=''3559770''>juncture,</span> <span m=''3560270''>he</span> <span m=''3560590''>started</span>
  <span m=''3560900''>a</span> <span m=''3560960''>workload.</span> <span m=''3562290''>In</span>
  <span m=''3562430''>starting</span> <span m=''3562700''>that</span> <span m=''3562880''>workload,</span>
  <span m=''3563230''>he caused</span> <span m=''3563560''>a</span> <span m=''3563610''>lot</span>
  <span m=''3563860''>of</span> <span m=''3563960''>traffic</span> <span m=''3564370''>between</span>
  <span m=''3564550''>the</span> <span m=''3564630''>vSphere</span> <span m=''3564900''>VM</span>
  <span m=''3565180''>and</span> <span m=''3565270''>the</span> <span m=''3565370''>database,</span>
  <span m=''3566220''>which</span> <span m=''3566520''>therefore</span> <span m=''3566920''>caused</span>
  <span m=''3568040''>a</span> <span m=''3568280''>lot</span> <span m=''3568490''>of</span>
  <span m=''3568600''>work</span> <span m=''3568920''>by</span> <span m=''3569100''>this</span>
  <span m=''3569310''>probe</span> <span m=''3569740''>VM.</span> </p><p><span m=''3570460''>Well,</span>
  <span m=''3570850''>what''s</span> <span m=''3571150''>happening?</span> <span m=''3571680''>The</span>
  <span m=''3571800''>probe</span> <span m=''3572115''>VM</span> <span m=''3572430''>and</span>
  <span m=''3572470''>the</span> <span m=''3572550''>database</span> <span m=''3572860''>VM</span>
  <span m=''3573230''>are</span> <span m=''3573300''>sharing</span> <span m=''3573690''>the</span>
  <span m=''3573760''>same</span> <span m=''3574110''>underlying</span> <span m=''3574590''>CPUs.</span>
  <span m=''3575270''>So</span> <span m=''3575510''>if one</span> <span m=''3575770''>of</span>
  <span m=''3575870''>them</span> <span m=''3576020''>is</span> <span m=''3576120''>running,</span>
  <span m=''3576410''>the</span> <span m=''3576560''>other</span> <span m=''3576740''>one</span>
  <span m=''3576950''>can''t.</span> <span m=''3577470''>And</span> <span m=''3577660''>that''s</span>
  <span m=''3577950''>why</span> <span m=''3578120''>we</span> <span m=''3578250''>saw</span>
  <span m=''3578400''>this</span> <span m=''3578660''>gentle</span> <span m=''3579190''>increase</span>
  <span m=''3579650''>in the</span> <span m=''3579730''>amount</span> <span m=''3579950''>of</span>
  <span m=''3580040''>ready</span> <span m=''3580280''>time</span> <span m=''3580920''>to</span>
  <span m=''3581040''>vSphere</span> <span m=''3581550''>database.</span> </p><p><span
  m=''3582030''>Well,</span> <span m=''3582210''>this</span> <span m=''3582330''>has</span>
  <span m=''3582510''>a</span> <span m=''3582570''>cascading</span> <span m=''3583130''>effect,</span>
  <span m=''3583570''>because</span> <span m=''3583890''>it</span> <span m=''3583980''>can''t</span>
  <span m=''3584210''>get</span> <span m=''3584330''>as</span> <span m=''3584410''>much</span>
  <span m=''3584610''>time</span> <span m=''3584850''>to use</span> <span m=''3585050''>a</span>
  <span m=''3585100''>CPU.</span> <span m=''3586380''>Any</span> <span m=''3586650''>request</span>
  <span m=''3587090''>that</span> <span m=''3587210''>goes</span> <span m=''3587520''>to</span>
  <span m=''3587670''>it</span> <span m=''3587750''>gets</span> <span m=''3587980''>slowed</span>
  <span m=''3588260''>down.</span> <span m=''3588630''>Where</span> <span m=''3589120''>are
  the</span> <span m=''3589220''>requests</span> <span m=''3589610''>coming</span>
  <span m=''3589820''>from?</span> <span m=''3589960''>They''re</span> <span m=''3590070''>coming</span>
  <span m=''3590420''>from this</span> <span m=''3590670''>vSphere</span> <span m=''3590920''>VM.</span>
  <span m=''3591720''>Who''s</span> <span m=''3591910''>initiating</span> <span m=''3592330''>those</span>
  <span m=''3592510''>requests?</span> <span m=''3592950''>It''s</span> <span m=''3593050''>this</span>
  <span m=''3593310''>poor</span> <span m=''3593630''>admin.</span> </p><p><span m=''3593850''>The</span>
  <span m=''3593960''>bottom</span> <span m=''3594280''>line</span> <span m=''3594440''>is</span>
  <span m=''3594520''>that this</span> <span m=''3594610''>admin</span> <span m=''3594740''>is</span>
  <span m=''3594930''>seeing</span> <span m=''3595120''>poor</span> <span m=''3595650''>responsiveness</span>
  <span m=''3596240''>because</span> <span m=''3596560''>some</span> <span m=''3596660''>doofus</span>
  <span m=''3597080''>put</span> <span m=''3597190''>his</span> <span m=''3597330''>probe</span>
  <span m=''3597615''>VM</span> <span m=''3597900''>on</span> <span m=''3597980''>some</span>
  <span m=''3598140''>other</span> <span m=''3598320''>host,</span> <span m=''3598630''>because</span>
  <span m=''3598860''>he</span> <span m=''3598940''>wanted</span> <span m=''3599120''>to</span>
  <span m=''3599180''>see</span> <span m=''3599310''>what was</span> <span m=''3599520''>going</span>
  <span m=''3599740''>on</span> <span m=''3599930''>in the</span> <span m=''3599980''>database.</span>
  <span m=''3601530''>In</span> <span m=''3601730''>fairness,</span> <span m=''3602050''>I</span>
  <span m=''3602140''>was</span> <span m=''3602280''>that</span> <span m=''3602410''>doofus.</span>
  <span m=''3602650''>But</span> <span m=''3602730''>that''s</span> <span m=''3602910''>fine.</span>
  <span m=''3603360''>We</span> <span m=''3603470''>needed</span> <span m=''3603680''>that,</span>
  <span m=''3603810''>because</span> <span m=''3603990''>we</span> <span m=''3604040''>had</span>
  <span m=''3604150''>to</span> <span m=''3604200''>debug</span> <span m=''3604490''>other</span>
  <span m=''3604570''>performance</span> <span m=''3604900''>problems.</span> </p><p><span
  m=''3607150''>So</span> <span m=''3607230''>the</span> <span m=''3607320''>point</span>
  <span m=''3607640''>is</span> <span m=''3607910''>that</span> <span m=''3608840''>one</span>
  <span m=''3609110''>of</span> <span m=''3609180''>the</span> <span m=''3609260''>things</span>
  <span m=''3609520''>that''s</span> <span m=''3609680''>kind</span> <span m=''3609820''>of</span>
  <span m=''3609970''>important</span> <span m=''3610720''>in</span> <span m=''3610860''>this</span>
  <span m=''3610990''>particular</span> <span m=''3611420''>case</span> <span m=''3612460''>is</span>
  <span m=''3612640''>that</span> <span m=''3613010''>whenever</span> <span m=''3613420''>you</span>
  <span m=''3613580''>introduce</span> <span m=''3613940''>any</span> <span m=''3614130''>sort</span>
  <span m=''3614320''>of</span> <span m=''3614390''>monitoring--</span> <span m=''3614830''>it''s</span>
  <span m=''3614940''>like</span> <span m=''3615070''>a</span> <span m=''3615340''>Heisenberg</span>
  <span m=''3615610''>thing--</span> <span m=''3615960''>it''s</span> <span m=''3616230''>going</span>
  <span m=''3616500''>to</span> <span m=''3616590''>have</span> <span m=''3616850''>a</span>
  <span m=''3616910''>performance</span> <span m=''3617440''>impact.</span> <span
  m=''3617820''>And</span> <span m=''3617890''>understanding</span> <span m=''3618160''>that</span>
  <span m=''3618520''>performance</span> <span m=''3619010''>impact</span> <span m=''3619310''>is</span>
  <span m=''3619420''>pretty</span> <span m=''3619710''>key.</span> <span m=''3620180''>It</span>
  <span m=''3620320''>might</span> <span m=''3620460''>even</span> <span m=''3620700''>shift</span>
  <span m=''3621130''>where</span> <span m=''3621300''>the</span> <span m=''3621410''>bottlenecks</span>
  <span m=''3622010''>are</span> <span m=''3622320''>in</span> <span m=''3622430''>your</span>
  <span m=''3622560''>system.</span> <span m=''3624120''>If</span> <span m=''3624270''>your</span>
  <span m=''3624430''>thing</span> <span m=''3624680''>has</span> <span m=''3624840''>a</span>
  <span m=''3624900''>high</span> <span m=''3625170''>cost</span> <span m=''3625500''>in</span>
  <span m=''3625570''>terms</span> <span m=''3625750''>of</span> <span m=''3625820''>CPU,</span>
  <span m=''3626180''>it might</span> <span m=''3626330''>shift</span> <span m=''3626800''>the</span>
  <span m=''3627560''>overhead</span> <span m=''3627990''>of</span> <span m=''3628070''>whatever''s</span>
  <span m=''3628450''>running</span> <span m=''3628680''>to</span> <span m=''3628860''>the</span>
  <span m=''3629020''>CPU</span> <span m=''3629090''>where</span> <span m=''3629230''>it</span>
  <span m=''3629410''>wasn''t</span> <span m=''3629740''>there</span> <span m=''3629910''>before.</span>
  <span m=''3630230''>So</span> <span m=''3630330''>it''s</span> <span m=''3630430''>kind</span>
  <span m=''3630550''>of</span> <span m=''3630680''>important</span> <span m=''3631230''>to</span>
  <span m=''3631310''>understand</span> <span m=''3631860''>what</span> <span m=''3632050''>you''re</span>
  <span m=''3632150''>monitoring</span> <span m=''3632610''>and how you''re</span>
  <span m=''3632900''>monitoring</span> <span m=''3633420''>it.</span> </p><p><span
  m=''3634660''>OK.</span> <span m=''3634950''>We''re</span> <span m=''3635150''>almost</span>
  <span m=''3635480''>done.</span> <span m=''3636230''>This</span> <span m=''3636550''>was</span>
  <span m=''3636710''>a</span> <span m=''3636760''>really</span> <span m=''3637250''>curious</span>
  <span m=''3637670''>problem.</span> <span m=''3638560''>We</span> <span m=''3638770''>have</span>
  <span m=''3638910''>a</span> <span m=''3638970''>customer.</span> <span m=''3639800''>And</span>
  <span m=''3639880''>a</span> <span m=''3639970''>customer</span> <span m=''3640370''>was</span>
  <span m=''3640540''>performing</span> <span m=''3641300''>a</span> <span m=''3641440''>load</span>
  <span m=''3641870''>test</span> <span m=''3642300''>on</span> <span m=''3642460''>a</span>
  <span m=''3642500''>server.</span> <span m=''3643860''>And</span> <span m=''3644020''>in</span>
  <span m=''3644080''>that</span> <span m=''3644250''>load</span> <span m=''3644470''>test,</span>
  <span m=''3644800''>what</span> <span m=''3644980''>they</span> <span m=''3645140''>would</span>
  <span m=''3645300''>do</span> <span m=''3645740''>is</span> <span m=''3645870''>they
  would</span> <span m=''3646040''>just</span> <span m=''3646240''>keep</span> <span
  m=''3646430''>attaching</span> <span m=''3646870''>clients</span> <span m=''3647260''>to
  that</span> <span m=''3647460''>end</span> <span m=''3647650''>server</span> <span
  m=''3648190''>and</span> <span m=''3648330''>run</span> <span m=''3648930''>some</span>
  <span m=''3649140''>test.</span> </p><p><span m=''3650540''>At</span> <span m=''3650770''>some</span>
  <span m=''3651060''>point,</span> <span m=''3652100''>they</span> <span m=''3652260''>would</span>
  <span m=''3652400''>attach</span> <span m=''3652800''>clients</span> <span m=''3653120''>and</span>
  <span m=''3653270''>their</span> <span m=''3653370''>workload</span> <span m=''3653980''>suffered,</span>
  <span m=''3654700''>their</span> <span m=''3654820''>workload</span> <span m=''3655120''>performance</span>
  <span m=''3655560''>suffered</span> <span m=''3656070''>even</span> <span m=''3656360''>though</span>
  <span m=''3656460''>there</span> <span m=''3656580''>was</span> <span m=''3656750''>no</span>
  <span m=''3657030''>metric</span> <span m=''3657460''>that</span> <span m=''3657580''>was</span>
  <span m=''3657800''>saturated.</span> <span m=''3659700''>And</span> <span m=''3659800''>so</span>
  <span m=''3659890''>the</span> <span m=''3660000''>question</span> <span m=''3660280''>was</span>
  <span m=''3660640''>why.</span> <span m=''3660910''>Why you</span> <span m=''3660990''>keep</span>
  <span m=''3661220''>adding</span> <span m=''3661410''>clients,</span> <span m=''3661740''>nothing</span>
  <span m=''3662050''>is</span> <span m=''3662120''>saturated,</span> <span m=''3662790''>but</span>
  <span m=''3662890''>performance</span> <span m=''3663540''>suffers?</span> </p><p><span
  m=''3665140''>Well,</span> <span m=''3666310''>this</span> <span m=''3666560''>chart''s</span>
  <span m=''3666810''>kind</span> <span m=''3666910''>of</span> <span m=''3667020''>an</span>
  <span m=''3667090''>eyesore.</span> <span m=''3667730''>But</span> <span m=''3667850''>let</span>
  <span m=''3667970''>me</span> <span m=''3668090''>explain</span> <span m=''3668410''>it.</span>
  <span m=''3669770''>The</span> <span m=''3670190''>first</span> <span m=''3670410''>thing</span>
  <span m=''3670500''>we</span> <span m=''3670570''>do</span> <span m=''3670710''>is
  we''ve got some</span> <span m=''3670950''>profiling</span> <span m=''3671360''>information.</span>
  <span m=''3672020''>On</span> <span m=''3672270''>this</span> <span m=''3672430''>chart,</span>
  <span m=''3672690''>I</span> <span m=''3672760''>show</span> <span m=''3672970''>two</span>
  <span m=''3673160''>things.</span> <span m=''3673910''>In</span> <span m=''3674130''>purple,</span>
  <span m=''3674620''>I</span> <span m=''3674740''>show</span> <span m=''3674970''>CPU</span>
  <span m=''3675420''>usage.</span> <span m=''3676360''>And</span> <span m=''3676610''>in</span>
  <span m=''3676950''>white,</span> <span m=''3677630''>I</span> <span m=''3677750''>show</span>
  <span m=''3678010''>disk</span> <span m=''3678360''>latency.</span> </p><p><span
  m=''3679720''>As</span> <span m=''3680010''>you</span> <span m=''3680130''>can</span>
  <span m=''3680250''>see</span> <span m=''3680540''>from</span> <span m=''3680720''>this</span>
  <span m=''3680940''>chart--</span> <span m=''3681310''>and</span> <span m=''3681420''>the</span>
  <span m=''3681500''>y-axis</span> <span m=''3682010''>is just</span> <span m=''3682160''>100%.</span>
  <span m=''3682450''>And</span> <span m=''3682740''>they''re</span> <span m=''3682840''>both</span>
  <span m=''3683030''>normalized.</span> <span m=''3683580''>As</span> <span m=''3683760''>you</span>
  <span m=''3683860''>can</span> <span m=''3683960''>see</span> <span m=''3684150''>at</span>
  <span m=''3684250''>some</span> <span m=''3684450''>point,</span> <span m=''3684850''>the</span>
  <span m=''3685070''>CPU</span> <span m=''3685480''>usage</span> <span m=''3685800''>is</span>
  <span m=''3685960''>steadily,</span> <span m=''3686440''>steadily</span> <span m=''3686860''>increasing.</span>
  <span m=''3688190''>And</span> <span m=''3688670''>at</span> <span m=''3688830''>some</span>
  <span m=''3689000''>point,</span> <span m=''3689170''>the</span> <span m=''3689240''>disk</span>
  <span m=''3689570''>latency</span> <span m=''3689930''>takes</span> <span m=''3690250''>over</span>
  <span m=''3690580''>and</span> <span m=''3690730''>gets</span> <span m=''3690900''>to</span>
  <span m=''3690990''>be</span> <span m=''3691120''>really</span> <span m=''3691590''>large.</span>
  <span m=''3692100''>You</span> <span m=''3692230''>can</span> <span m=''3692380''>tell</span>
  <span m=''3692560''>that,</span> <span m=''3692740''>because</span> <span m=''3693720''>up</span>
  <span m=''3693900''>until</span> <span m=''3694310''>about</span> <span m=''3694600''>3/4</span>
  <span m=''3695110''>of</span> <span m=''3695190''>the</span> <span m=''3695270''>way</span>
  <span m=''3695490''>in,</span> <span m=''3695600''>the</span> <span m=''3695690''>disk</span>
  <span m=''3695955''>latency</span> <span m=''3696220''>hovers</span> <span m=''3696500''>around</span>
  <span m=''3696740''>zero.</span> <span m=''3697000''>And</span> <span m=''3697060''>all</span>
  <span m=''3697170''>of</span> <span m=''3697280''>a</span> <span m=''3697340''>sudden,</span>
  <span m=''3697770''>it</span> <span m=''3697950''>jumps</span> <span m=''3698260''>much</span>
  <span m=''3698510''>higher.</span> </p><p><span m=''3699030''>So</span> <span m=''3699210''>my</span>
  <span m=''3699390''>first</span> <span m=''3699740''>instinct</span> <span m=''3700180''>was</span>
  <span m=''3700390''>to</span> <span m=''3700480''>tell</span> <span m=''3700660''>the</span>
  <span m=''3700740''>customer</span> <span m=''3701250''>you''ve</span> <span m=''3701400''>got</span>
  <span m=''3701660''>a disk</span> <span m=''3701840''>problem.</span> <span m=''3703250''>Your</span>
  <span m=''3703390''>disk</span> <span m=''3703665''>latencies</span> <span m=''3703940''>are</span>
  <span m=''3703990''>going</span> <span m=''3704210''>over</span> <span m=''3704430''>a</span>
  <span m=''3704470''>cliff.</span> <span m=''3705150''>And</span> <span m=''3705280''>that''s</span>
  <span m=''3705500''>why</span> <span m=''3705660''>you''re</span> <span m=''3705770''>having</span>
  <span m=''3705960''>a</span> <span m=''3706010''>performance</span> <span m=''3706460''>problem.</span>
  <span m=''3707040''>Unfortunately,</span> <span m=''3708550''>that''s</span> <span
  m=''3708990''>not</span> <span m=''3709360''>correct.</span> <span m=''3710640''>Why</span>
  <span m=''3710970''>is</span> <span m=''3711100''>that</span> <span m=''3711230''>not</span>
  <span m=''3711440''>correct?</span> </p><p><span m=''3712900''>It''s</span> <span
  m=''3713130''>not</span> <span m=''3713370''>correct,</span> <span m=''3714110''>because,</span>
  <span m=''3714760''>yeah,</span> <span m=''3714870''>disk</span> <span m=''3715200''>latency</span>
  <span m=''3715550''>gets</span> <span m=''3715810''>worse</span> <span m=''3716140''>at</span>
  <span m=''3716320''>4:00</span> <span m=''3716600''>PM.</span> <span m=''3717440''>It''s</span>
  <span m=''3717630''>because</span> <span m=''3717870''>of</span> <span m=''3717890''>swapping</span>
  <span m=''3718010''>and</span> <span m=''3718390''>some</span> <span m=''3718520''>other</span>
  <span m=''3718640''>nonsense.</span> <span m=''3719120''>We</span> <span m=''3719230''>know</span>
  <span m=''3719400''>that.</span> <span m=''3720220''>However,</span> <span m=''3720640''>the</span>
  <span m=''3720750''>application</span> <span m=''3721330''>latency</span> <span
  m=''3721650''>actually</span> <span m=''3721940''>gets</span> <span m=''3722120''>worse</span>
  <span m=''3722370''>at</span> <span m=''3722740''>3:30,</span> <span m=''3723540''>not</span>
  <span m=''3723870''>at</span> <span m=''3723970''>4:00.</span> <span m=''3724310''>It''s</span>
  <span m=''3724660''>half</span> <span m=''3725010''>an</span> <span m=''3725110''>hour</span>
  <span m=''3725310''>earlier.</span> </p><p><span m=''3725810''>So</span> <span m=''3725940''>now</span>
  <span m=''3726050''>the</span> <span m=''3726140''>question</span> <span m=''3726450''>is</span>
  <span m=''3726540''>what''s</span> <span m=''3726880''>going</span> <span m=''3727140''>on</span>
  <span m=''3727310''>that</span> <span m=''3727420''>causes</span> <span m=''3727730''>the</span>
  <span m=''3727790''>problem,</span> <span m=''3728330''>even</span> <span m=''3728540''>before</span>
  <span m=''3728790''>disk</span> <span m=''3729250''>kicks</span> <span m=''3729620''>in</span>
  <span m=''3729720''>and</span> <span m=''3729800''>gets</span> <span m=''3729900''>to
  be</span> <span m=''3730140''>another</span> <span m=''3730370''>problem.</span>
  <span m=''3732820''>This</span> <span m=''3733120''>is</span> <span m=''3733230''>where</span>
  <span m=''3733810''>understanding</span> <span m=''3735100''>the</span> <span m=''3735190''>difference</span>
  <span m=''3735500''>in</span> <span m=''3735610''>metrics</span> <span m=''3735930''>becomes</span>
  <span m=''3736080''>pretty</span> <span m=''3736290''>critical.</span> <span m=''3736610''>Now,</span>
  <span m=''3737100''>I''m</span> <span m=''3737350''>not</span> <span m=''3737520''>expecting</span>
  <span m=''3737930''>very</span> <span m=''3738130''>many</span> <span m=''3738340''>people</span>
  <span m=''3738570''>to</span> <span m=''3738620''>understand</span> <span m=''3739030''>this</span>
  <span m=''3739200''>chart.</span> <span m=''3739800''>But</span> <span m=''3740350''>I</span>
  <span m=''3740440''>will</span> <span m=''3740560''>try</span> <span m=''3740740''>to</span>
  <span m=''3740800''>explain</span> <span m=''3741120''>it.</span> </p><p><span m=''3741860''>What</span>
  <span m=''3742130''>I</span> <span m=''3742210''>do</span> <span m=''3742390''>here</span>
  <span m=''3742560''>is</span> <span m=''3742650''>I</span> <span m=''3742710''>show</span>
  <span m=''3742980''>a</span> <span m=''3743020''>different</span> <span m=''3743360''>chart,</span>
  <span m=''3743570''>which</span> <span m=''3743740''>essentially</span> <span m=''3744190''>shows</span>
  <span m=''3744480''>CPU</span> <span m=''3744960''>usage</span> <span m=''3745340''>of</span>
  <span m=''3745430''>all</span> <span m=''3745580''>the</span> <span m=''3745740''>different</span>
  <span m=''3746110''>virtual</span> <span m=''3746470''>machines</span> <span m=''3746870''>and</span>
  <span m=''3747040''>processes</span> <span m=''3747840''>on</span> <span m=''3748020''>the</span>
  <span m=''3748140''>underlying</span> <span m=''3748600''>host.</span> <span m=''3749310''>Forget</span>
  <span m=''3749630''>about</span> <span m=''3749810''>what''s</span> <span m=''3749920''>in</span>
  <span m=''3750040''>most</span> <span m=''3750300''>of</span> <span m=''3750450''>this
  chart.</span> <span m=''3750570''>And</span> <span m=''3750700''>just</span> <span
  m=''3750880''>focus</span> <span m=''3751240''>on</span> <span m=''3751330''>what</span>
  <span m=''3751500''>I''ve</span> <span m=''3751620''>circled.</span> </p><p><span
  m=''3752360''>I</span> <span m=''3752490''>have</span> <span m=''3752710''>two</span>
  <span m=''3752890''>columns</span> <span m=''3753350''>shown</span> <span m=''3753680''>there.</span>
  <span m=''3754120''>One</span> <span m=''3754670''>column</span> <span m=''3755030''>is</span>
  <span m=''3755160''>called</span> <span m=''3755400''>percent</span> <span m=''3755840''>used.</span>
  <span m=''3757610''>And</span> <span m=''3757850''>one</span> <span m=''3758090''>column</span>
  <span m=''3758430''>is</span> <span m=''3758550''>called</span> <span m=''3758820''>percent</span>
  <span m=''3759620''>run.</span> <span m=''3761350''>You</span> <span m=''3761500''>can</span>
  <span m=''3761680''>think</span> <span m=''3761860''>about</span> <span m=''3762120''>it</span>
  <span m=''3762260''>and</span> <span m=''3762440''>think,</span> <span m=''3762900''>OK,</span>
  <span m=''3763180''>well,</span> <span m=''3763360''>I</span> <span m=''3763420''>can</span>
  <span m=''3763560''>imagine</span> <span m=''3763970''>used</span> <span m=''3764400''>time
  means</span> <span m=''3764810''>probably</span> <span m=''3765200''>how</span>
  <span m=''3765340''>much</span> <span m=''3765550''>time</span> <span m=''3765770''>I''m</span>
  <span m=''3765890''>using</span> <span m=''3766130''>the</span> <span m=''3766210''>CPU.</span>
  <span m=''3767480''>But</span> <span m=''3767620''>then</span> <span m=''3767830''>what</span>
  <span m=''3768010''>is</span> <span m=''3768160''>the</span> <span m=''3768250''>runtime?</span>
  <span m=''3768740''>Isn''t</span> <span m=''3768960''>runtime</span> <span m=''3769420''>the</span>
  <span m=''3769480''>same</span> <span m=''3769730''>thing,</span> <span m=''3769890''>because</span>
  <span m=''3769980''>I''m</span> <span m=''3770090''>using</span> <span m=''3770330''>the</span>
  <span m=''3770410''>CPU?</span> <span m=''3771080''>What''s</span> <span m=''3771240''>the</span>
  <span m=''3771410''>difference?</span> </p><p><span m=''3772990''>This</span> <span
  m=''3773240''>is</span> <span m=''3773350''>actually</span> <span m=''3773640''>the</span>
  <span m=''3773750''>critical</span> <span m=''3774090''>problem.</span> <span m=''3774680''>It</span>
  <span m=''3774850''>turns</span> <span m=''3775170''>out,</span> <span m=''3775710''>that</span>
  <span m=''3776260''>when</span> <span m=''3776440''>you</span> <span m=''3776530''>talk</span>
  <span m=''3776760''>of</span> <span m=''3776820''>a</span> <span m=''3776880''>percent</span>
  <span m=''3777280''>used</span> <span m=''3777600''>time,</span> <span m=''3778050''>you''re</span>
  <span m=''3778210''>normalizing</span> <span m=''3778950''>that</span> <span m=''3779265''>to</span>
  <span m=''3779580''>the</span> <span m=''3779670''>base</span> <span m=''3780120''>clock</span>
  <span m=''3780460''>frequency.</span> <span m=''3781110''>If</span> <span m=''3781250''>I''ve</span>
  <span m=''3781370''>got a</span> <span m=''3781570''>three</span> <span m=''3781740''>gigahertz</span>
  <span m=''3782150''>machine,</span> <span m=''3783070''>I''ve</span> <span m=''3783290''>normalized</span>
  <span m=''3783790''>it  to</span> <span m=''3783920''>three</span> <span m=''3784100''>gigahertz.</span>
  <span m=''3784650''>However,</span> <span m=''3785340''>we</span> <span m=''3785510''>all</span>
  <span m=''3785690''>live</span> <span m=''3785870''>in the</span> <span m=''3785940''>era</span>
  <span m=''3786350''>of</span> <span m=''3786390''>power</span> <span m=''3786740''>management.</span>
  <span m=''3787490''>It</span> <span m=''3787660''>turns</span> <span m=''3787950''>out</span>
  <span m=''3788400''>this</span> <span m=''3788600''>percent</span> <span m=''3789180''>run,</span>
  <span m=''3789450''>which</span> <span m=''3789640''>nobody</span> <span m=''3789900''>understands,</span>
  <span m=''3790520''>is</span> <span m=''3790700''>normalized</span> <span m=''3791250''>to</span>
  <span m=''3791370''>the</span> <span m=''3791520''>clock</span> <span m=''3791920''>frequency</span>
  <span m=''3792500''>at</span> <span m=''3792750''>the</span> <span m=''3792880''>time</span>
  <span m=''3793300''>you</span> <span m=''3793400''>were</span> <span m=''3793570''>running.</span>
  <span m=''3794100''>So</span> <span m=''3794350''>if</span> <span m=''3794450''>I</span>
  <span m=''3794540''>did</span> <span m=''3794730''>power</span> <span m=''3795060''>management,</span>
  <span m=''3795650''>and</span> <span m=''3795800''>I</span> <span m=''3795830''>was</span>
  <span m=''3795980''>only</span> <span m=''3796170''>running</span> <span m=''3796440''>at</span>
  <span m=''3796610''>two</span> <span m=''3796840''>gigahertz</span> <span m=''3797300''>for</span>
  <span m=''3797380''>a</span> <span m=''3797470''>certain</span> <span m=''3797680''>amount</span>
  <span m=''3797880''>of</span> <span m=''3797950''>time,</span> <span m=''3798480''>percent</span>
  <span m=''3798880''>run</span> <span m=''3799540''>captures</span> <span m=''3800100''>that.</span>
  </p><p><span m=''3800840''>And</span> <span m=''3801010''>so</span> <span m=''3801290''>in</span>
  <span m=''3801640''>this</span> <span m=''3801790''>particular</span> <span m=''3802220''>chart</span>
  <span m=''3802450''>what</span> <span m=''3802560''>I''m</span> <span m=''3802650''>showing</span>
  <span m=''3802910''>is</span> <span m=''3803030''>that a</span> <span m=''3803120''>bunch</span>
  <span m=''3803350''>of</span> <span m=''3803430''>virtual</span> <span m=''3803730''>machines</span>
  <span m=''3804260''>are</span> <span m=''3804430''>seeing</span> <span m=''3804820''>used</span>
  <span m=''3805220''>time</span> <span m=''3805820''>different</span> <span m=''3806300''>from</span>
  <span m=''3806420''>runtime.</span> <span m=''3807480''>And</span> <span m=''3807760''>the</span>
  <span m=''3807850''>runtime,</span> <span m=''3808410''>which</span> <span m=''3808560''>is</span>
  <span m=''3808640''>normalized</span> <span m=''3809100''>to</span> <span m=''3809200''>the</span>
  <span m=''3809290''>clock</span> <span m=''3809590''>frequency</span> <span m=''3809950''>of
  the</span> <span m=''3810080''>time</span> <span m=''3810310''>you''re using</span>
  <span m=''3810710''>it,</span> <span m=''3811050''>is</span> <span m=''3811320''>actually</span>
  <span m=''3811720''>greater</span> <span m=''3812130''>than</span> <span m=''3812290''>used</span>
  <span m=''3812480''>time,</span> <span m=''3812690''>which</span> <span m=''3812870''>suggests</span>
  <span m=''3813430''>that</span> <span m=''3813570''>the</span> <span m=''3813670''>user''s</span>
  <span m=''3814110''>actually</span> <span m=''3814510''>using</span> <span m=''3815030''>power</span>
  <span m=''3815390''>management.</span> <span m=''3816310''>And</span> <span m=''3816500''>it</span>
  <span m=''3816600''>turns</span> <span m=''3816960''>out,</span> <span m=''3818170''>that</span>
  <span m=''3818880''>power</span> <span m=''3819160''>management</span> <span m=''3819610''>was</span>
  <span m=''3819800''>kicking</span> <span m=''3820120''>in</span> <span m=''3820220''>at</span>
  <span m=''3820320''>some</span> <span m=''3820470''>point and</span> <span m=''3820750''>causing</span>
  <span m=''3821050''>their</span> <span m=''3821210''>application</span> <span m=''3821790''>latency</span>
  <span m=''3822130''>to</span> <span m=''3822200''>go</span> <span m=''3822390''>down</span>
  <span m=''3822980''>even</span> <span m=''3823260''>though</span> <span m=''3823340''>the</span>
  <span m=''3823430''>CPU</span> <span m=''3823930''>was</span> <span m=''3824080''>never</span>
  <span m=''3824340''>saturated.</span> </p><p><span m=''3826240''>And</span> <span
  m=''3826670''>in</span> <span m=''3826800''>this</span> <span m=''3826990''>case,</span>
  <span m=''3827230''>when we</span> <span m=''3827410''>went</span> <span m=''3827450''>back</span>
  <span m=''3827650''>to</span> <span m=''3827720''>the</span> <span m=''3827820''>customer--</span>
  <span m=''3828130''>you</span> <span m=''3828250''>look</span> <span m=''3828400''>at</span>
  <span m=''3828510''>this</span> <span m=''3828620''>chart,</span> <span m=''3829030''>and</span>
  <span m=''3829180''>you</span> <span m=''3829280''>instantly</span> <span m=''3829600''>see,</span>
  <span m=''3829740''>OK,</span> <span m=''3829900''>I</span> <span m=''3829960''>know</span>
  <span m=''3830190''>that</span> <span m=''3830310''>because</span> <span m=''3830880''>this</span>
  <span m=''3831090''>is</span> <span m=''3831200''>normalized</span> <span m=''3831540''>and</span>
  <span m=''3831630''>this</span> <span m=''3831780''>is</span> <span m=''3831860''>normalized</span>
  <span m=''3831970''>to</span> <span m=''3832010''>that.</span> <span m=''3832820''>This</span>
  <span m=''3832970''>is</span> <span m=''3833040''>what''s</span> <span m=''3833270''>going</span>
  <span m=''3833490''>on,</span> <span m=''3833780''>you</span> <span m=''3834020''>have
  to</span> <span m=''3834090''>first</span> <span m=''3834370''>of</span> <span m=''3834420''>all</span>
  <span m=''3834510''>change this</span> <span m=''3834900''>parameter.</span> <span
  m=''3835660''>They</span> <span m=''3835910''>changed</span> <span m=''3836370''>it.</span>
  <span m=''3836460''>And they</span> <span m=''3836550''>were</span> <span m=''3836680''>unbelievably</span>
  <span m=''3837300''>happy.</span> <span m=''3837670''>It</span> <span m=''3837750''>was</span>
  <span m=''3837900''>pretty</span> <span m=''3838100''>cool.</span> </p><p><span
  m=''3838630''>Now,</span> <span m=''3838760''>I</span> <span m=''3838910''>have</span>
  <span m=''3839060''>to</span> <span m=''3839150''>admit</span> <span m=''3839380''>that</span>
  <span m=''3839450''>there''s</span> <span m=''3839590''>much</span> <span m=''3839800''>more</span>
  <span m=''3839960''>to</span> <span m=''3840120''>this story</span> <span m=''3840790''>that</span>
  <span m=''3841070''>I''m</span> <span m=''3841200''>not</span> <span m=''3841440''>showing</span>
  <span m=''3841770''>you.</span> <span m=''3841890''>Which</span> <span m=''3842230''>I''m</span>
  <span m=''3842350''>not</span> <span m=''3842470''>allowed</span> <span m=''3842710''>to</span>
  <span m=''3842760''>show</span> <span m=''3842950''>you.</span> <span m=''3843260''>But</span>
  <span m=''3843450''>it</span> <span m=''3843540''>becomes</span> <span m=''3843800''>a</span>
  <span m=''3843830''>very</span> <span m=''3843990''>interesting</span> <span m=''3844430''>thing.</span>
  <span m=''3844540''>But the</span> <span m=''3844620''>point</span> <span m=''3844930''>is</span>
  <span m=''3845980''>it''s</span> <span m=''3846230''>very,</span> <span m=''3846600''>very</span>
  <span m=''3846870''>important</span> <span m=''3847210''>to</span> <span m=''3847270''>understand</span>
  <span m=''3849720''>your</span> <span m=''3849830''>metrics.</span> <span m=''3850370''>Here</span>
  <span m=''3850840''>just</span> <span m=''3851220''>understanding</span> <span m=''3851730''>the</span>
  <span m=''3851780''>difference</span> <span m=''3852190''>between</span> <span m=''3852310''>runtime</span>
  <span m=''3852550''>and</span> <span m=''3852760''>used</span> <span m=''3853040''>time</span>
  <span m=''3853090''>made</span> <span m=''3853400''>all</span> <span m=''3853630''>of</span>
  <span m=''3853690''>the</span> <span m=''3853780''>difference</span> <span m=''3854130''>in</span>
  <span m=''3854240''>diagnosing</span> <span m=''3855040''>this</span> <span m=''3855210''>customer''s</span>
  <span m=''3855620''>performance</span> <span m=''3856030''>related</span> <span
  m=''3856340''>issue.</span> </p><p><span m=''3858080''>So</span> <span m=''3858530''>I</span>
  <span m=''3858660''>just</span> <span m=''3858840''>pick</span> <span m=''3859000''>a</span>
  <span m=''3859040''>smattering</span> <span m=''3859520''>of</span> <span m=''3859610''>ten</span>
  <span m=''3859830''>random</span> <span m=''3860160''>bugs.</span> <span m=''3860880''>And</span>
  <span m=''3862190''>in</span> <span m=''3862470''>each</span> <span m=''3862620''>of</span>
  <span m=''3862660''>them,</span> <span m=''3862780''>I</span> <span m=''3862850''>tried</span>
  <span m=''3863130''>to</span> <span m=''3863850''>distill</span> <span m=''3864530''>one</span>
  <span m=''3864770''>kind</span> <span m=''3864960''>of</span> <span m=''3865020''>conclusion</span>
  <span m=''3865480''>you</span> <span m=''3865590''>can</span> <span m=''3865750''>get</span>
  <span m=''3865950''>from</span> <span m=''3866070''>that</span> <span m=''3866230''>particular</span>
  <span m=''3866660''>thing.</span> <span m=''3867170''>Because</span> <span m=''3867460''>all</span>
  <span m=''3867590''>of</span> <span m=''3867670''>you</span> <span m=''3867800''>can</span>
  <span m=''3867930''>read,</span> <span m=''3868160''>I''m</span> <span m=''3868230''>not</span>
  <span m=''3868390''>going</span> <span m=''3868470''>to</span> <span m=''3868550''>bother</span>
  <span m=''3869340''>repeating</span> <span m=''3869800''>all</span> <span m=''3869960''>of</span>
  <span m=''3870100''>these</span> <span m=''3870240''>things.</span> <span m=''3871370''>But</span>
  <span m=''3871940''>anyway,</span> <span m=''3872260''>here''s</span> <span m=''3872440''>the</span>
  <span m=''3872530''>first</span> <span m=''3872860''>five.</span> <span m=''3873140''>And
  you all</span> <span m=''3873390''>get</span> <span m=''3873530''>the</span> <span
  m=''3873600''>slides.</span> <span m=''3875500''>And</span> <span m=''3875900''>here''s</span>
  <span m=''3876250''>the</span> <span m=''3876320''>second</span> <span m=''3876640''>five.</span>
  <span m=''3877760''>Oops.</span> <span m=''3877900''>I''ll</span> <span m=''3878380''>just</span>
  <span m=''3878570''>keep</span> <span m=''3878740''>that</span> <span m=''3878840''>up</span>
  <span m=''3878960''>for a</span> <span m=''3879090''>second.</span> </p><p><span
  m=''3880070''>And</span> <span m=''3883730''>in</span> <span m=''3883870''>order</span>
  <span m=''3884020''>to</span> <span m=''3884150''>conclude</span> <span m=''3884470''>this</span>
  <span m=''3884620''>talk,</span> <span m=''3885600''>let</span> <span m=''3885730''>me</span>
  <span m=''3885840''>just</span> <span m=''3886000''>say</span> <span m=''3886210''>that</span>
  <span m=''3886970''>it''s</span> <span m=''3887200''>very</span> <span m=''3887590''>important</span>
  <span m=''3888040''>to</span> <span m=''3888170''>avoid</span> <span m=''3888500''>assumptions.</span>
  <span m=''3888990''>It''s</span> <span m=''3889130''>very</span> <span m=''3889370''>tempting</span>
  <span m=''3889810''>to</span> <span m=''3889870''>say</span> <span m=''3890070''>well</span>
  <span m=''3890880''>that''s--</span> <span m=''3891370''>I''ll</span> <span m=''3891700''>give</span>
  <span m=''3891820''>you</span> <span m=''3891910''>a</span> <span m=''3891960''>great</span>
  <span m=''3892160''>example.</span> <span m=''3892520''>I used</span> <span m=''3892620''>to</span>
  <span m=''3892730''>interview</span> <span m=''3893050''>people.</span> <span m=''3893440''>And</span>
  <span m=''3893520''>I''d</span> <span m=''3893600''>say,</span> <span m=''3893800''>OK,</span>
  <span m=''3893970''>you''ve</span> <span m=''3894060''>got</span> <span m=''3894180''>a</span>
  <span m=''3894220''>UI.</span> <span m=''3894570''>You''ve</span> <span m=''3894700''>got</span>
  <span m=''3894830''>a</span> <span m=''3894870''>problem.</span> <span m=''3895420''>You</span>
  <span m=''3895540''>have</span> <span m=''3895860''>a</span> <span m=''3896090''>UI.</span>
  <span m=''3896230''>And you click</span> <span m=''3896460''>on</span> <span m=''3896580''>something.</span>
  <span m=''3896840''>And</span> <span m=''3896910''>it</span> <span m=''3896970''>takes</span>
  <span m=''3897190''>a</span> <span m=''3897230''>long</span> <span m=''3897440''>time.</span>
  <span m=''3897790''>Why is it</span> <span m=''3898130''>taking</span> <span m=''3898340''>a</span>
  <span m=''3898390''>long</span> <span m=''3898590''>time?</span> </p><p><span m=''3899060''>And</span>
  <span m=''3899180''>the</span> <span m=''3899250''>first</span> <span m=''3899620''>thing</span>
  <span m=''3899800''>they''d say,</span> <span m=''3899940''>well,</span> <span m=''3900140''>I''d</span>
  <span m=''3900200''>go</span> <span m=''3900380''>and</span> <span m=''3900440''>look</span>
  <span m=''3900590''>at--</span> <span m=''3900770''>this</span> <span m=''3900940''>is</span>
  <span m=''3901060''>literally,</span> <span m=''3901360''>not</span> <span m=''3901590''>joking.</span>
  <span m=''3902030''>They''d</span> <span m=''3902170''>say,</span> <span m=''3902280''>well,</span>
  <span m=''3902460''>I''d go to</span> <span m=''3902590''>look</span> <span m=''3902770''>at</span>
  <span m=''3902830''>the</span> <span m=''3902900''>cache</span> <span m=''3903210''>messages</span>
  <span m=''3903460''>on</span> <span m=''3903540''>the</span> <span m=''3903620''>server.</span>
  <span m=''3904660''>And</span> <span m=''3904960''>I</span> <span m=''3905060''>just</span>
  <span m=''3905250''>looked</span> <span m=''3905490''>them</span> <span m=''3905590''>and
  I said,</span> <span m=''3906080''>how do you know</span> <span m=''3906140''>the</span>
  <span m=''3906230''>client''s</span> <span m=''3906550''>not</span> <span m=''3906870''>the
  problem?</span> <span m=''3907100''>Oh, the client''s</span> <span m=''3907350''>not
  a</span> <span m=''3907480''>problem.</span> <span m=''3908590''>And</span> <span
  m=''3908810''>you</span> <span m=''3908910''>base</span> <span m=''3909280''>this
  on</span> <span m=''3909380''>what</span> <span m=''3909530''>knowledge?</span>
  <span m=''3910510''>Don''t</span> <span m=''3910980''>use</span> <span m=''3911160''>assumptions.</span>
  <span m=''3911560''>It''s</span> <span m=''3911600''>a</span> <span m=''3911690''>very</span>
  <span m=''3911900''>bad</span> <span m=''3912240''>idea.</span> </p><p><span m=''3913730''>It''s</span>
  <span m=''3913950''>really</span> <span m=''3914500''>important</span> <span m=''3914860''>to</span>
  <span m=''3914910''>understand</span> <span m=''3915330''>the</span> <span m=''3915420''>entire</span>
  <span m=''3915810''>system</span> <span m=''3916180''>that you''re</span> <span
  m=''3916320''>dealing</span> <span m=''3916580''>with.</span> <span m=''3916790''>From
  the</span> <span m=''3916870''>client</span> <span m=''3917200''>to</span> <span
  m=''3917260''>the</span> <span m=''3917360''>server</span> <span m=''3917670''>to</span>
  <span m=''3917740''>the</span> <span m=''3917820''>hardware</span> <span m=''3918130''>to</span>
  <span m=''3918220''>the</span> <span m=''3918310''>network</span> <span m=''3918590''>to</span>
  <span m=''3918690''>the</span> <span m=''3918810''>disk.</span> <span m=''3919270''>You</span>
  <span m=''3919400''>have</span> <span m=''3919530''>to</span> <span m=''3919620''>understand</span>
  <span m=''3920000''>all</span> <span m=''3920230''>of</span> <span m=''3920290''>those</span>
  <span m=''3920450''>different</span> <span m=''3920740''>pieces,</span> <span m=''3921050''>because</span>
  <span m=''3921250''>you</span> <span m=''3921350''>have</span> <span m=''3921450''>to</span>
  <span m=''3921520''>understand</span> <span m=''3921940''>where</span> <span m=''3922140''>to</span>
  <span m=''3922240''>look.</span> <span m=''3924160''>And</span> <span m=''3925020''>what''s</span>
  <span m=''3925220''>really</span> <span m=''3925500''>onerous</span> <span m=''3925890''>is</span>
  <span m=''3926010''>that--</span> <span m=''3926460''>it</span> <span m=''3926520''>is</span>
  <span m=''3926670''>not</span> <span m=''3926860''>so</span> <span m=''3926940''>much</span>
  <span m=''3927100''>when</span> <span m=''3927210''>it''s</span> <span m=''3927300''>a</span>
  <span m=''3927350''>problem</span> <span m=''3927640''>in</span> <span m=''3927710''>your</span>
  <span m=''3927920''>code,</span> <span m=''3928110''>because</span> <span m=''3928320''>you</span>
  <span m=''3928400''>can</span> <span m=''3928500''>be</span> <span m=''3928600''>blamed</span>
  <span m=''3928890''>for</span> <span m=''3928970''>making</span> <span m=''3929200''>stupid</span>
  <span m=''3929460''>mistakes--</span> <span m=''3930000''>it''s</span> <span m=''3930140''>when
  it''s</span> <span m=''3930390''>problems</span> <span m=''3930720''>with</span>
  <span m=''3930810''>other</span> <span m=''3930990''>people''s</span> <span m=''3931330''>code</span>
  <span m=''3931590''>and you</span> <span m=''3931670''>spend</span> <span m=''3931910''>a</span>
  <span m=''3931960''>month</span> <span m=''3932280''>looking</span> <span m=''3932570''>at</span>
  <span m=''3932640''>other</span> <span m=''3932790''>people''s</span> <span m=''3933090''>code,</span>
  <span m=''3933240''>figuring</span> <span m=''3933480''>out</span> <span m=''3933530''>what''s</span>
  <span m=''3933640''>the</span> <span m=''3933730''>problem</span> <span m=''3934260''>That''s</span>
  <span m=''3934470''>when</span> <span m=''3934580''>things</span> <span m=''3934940''>are</span>
  <span m=''3935140''>really</span> <span m=''3935330''>kind</span> <span m=''3935490''>of</span>
  <span m=''3935560''>irritating.</span> <span m=''3936992''>And</span> <span m=''3937480''>especially</span>
  <span m=''3937880''>when</span> <span m=''3937990''>it''s</span> <span m=''3938090''>a</span>
  <span m=''3938150''>problem</span> <span m=''3938410''>with</span> <span m=''3938520''>hardware.</span>
  </p><p><span m=''3939240''>And</span> <span m=''3939710''>I</span> <span m=''3939830''>think</span>
  <span m=''3940040''>the</span> <span m=''3940120''>final</span> <span m=''3940450''>bullet</span>
  <span m=''3940710''>I''ll</span> <span m=''3940970''>say</span> <span m=''3941160''>is</span>
  <span m=''3941900''>be</span> <span m=''3941920''>persistent</span> <span m=''3942500''>and</span>
  <span m=''3942630''>be</span> <span m=''3942800''>thorough.</span> <span m=''3944680''>I</span>
  <span m=''3944770''>don''t</span> <span m=''3944880''>have</span> <span m=''3944950''>to</span>
  <span m=''3945050''>tell</span> <span m=''3945200''>you</span> <span m=''3945250''>how</span>
  <span m=''3945340''>to</span> <span m=''3945410''>be</span> <span m=''3945520''>good</span>
  <span m=''3945650''>workers.</span> <span m=''3946010''>So</span> <span m=''3946110''>let''s</span>
  <span m=''3946280''>just</span> <span m=''3946500''>blah, blah,</span> <span m=''3946830''>blah.</span>
  <span m=''3947190''>We''re</span> <span m=''3947270''>done.</span> </p>'
uid: 6c5baf59-0c2f-3b1e-77d7-ae779baf7afc
---
